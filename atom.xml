<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[Stdio's Blog]]></title>
  <subtitle><![CDATA[随便写写]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="//blog.stdioa.com/"/>
  <updated>2015-12-18T11:41:03.947Z</updated>
  <id>//blog.stdioa.com/</id>
  
  <author>
    <name><![CDATA[David Dai]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[博客迁移记（二）]]></title>
    <link href="//blog.stdioa.com/2015/12/blog-migration-ii/"/>
    <id>//blog.stdioa.com/2015/12/blog-migration-ii/</id>
    <published>2015-12-18T07:55:37.000Z</published>
    <updated>2015-12-18T11:41:03.947Z</updated>
    <content type="html"><![CDATA[<p>域名依然在备案中，依然想将博客部署到新买的VPS的我和腾讯斗智斗勇（雾），为博客添加了HTTPS&gt;_&lt;<br>同时，把自己的密码学课设也转移到VPS上来了。</p>
<a id="more"></a>
<h1 id="1-_使用Nginx针对多个host部署服务器">1. 使用Nginx针对多个host部署服务器</h1><h2 id="1-1_概述">1.1 概述</h2><p>如果一个VPS只能搭一个网站，那未免太浪费了，所以我们可以通过配置Nginx的方式来将针对多个域名的访问请求分开，从而进行不同的处理。例如，我在DNS配置时将<code>blog.stdioa.com</code>与<code>crypt.stdioa.com</code>同时指向到我的腾讯云的IP地址，用户访问这两个域名时，都会向我的VPS发送请求，我要做的是将这两种针对不同域名的访问请求分开。而这两种请求的区别在HTTP请求头的Host字段，所以我只需要针对不同的Host使用不同的处理方式即可。</p>
<h2 id="1-2_操作">1.2 操作</h2><p>我的VPS上撘有两个网站，其中<code>blog.stdioa.com</code>域名指向的是我的博客——一个静态服务器，而<code>crypt</code>域名指向的是一个使用flask搭建的网站，所以要在Nginx端进行反向代理，将请求转发到本地的5000端口。<br>具体配置文件如下：<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">server</span> &#123;</span><br><span class="line">     <span class="title">listen</span>       <span class="number">80</span>;</span><br><span class="line">     <span class="title">server_name</span>  stdioa.com blog.stdioa.com;       <span class="comment"># 通往博客的请求直接通过文件服务器返回</span></span><br><span class="line"></span><br><span class="line">     <span class="title">access_log</span>  /var/log/nginx/access_blog.log;</span><br><span class="line">     <span class="title">error_log</span> /var/log/nginx/error_blog.log;</span><br><span class="line"></span><br><span class="line">     <span class="title">root</span>   /home/stdio/blog;</span><br><span class="line">     <span class="title">index</span>  index index.html;</span><br><span class="line"></span><br><span class="line">     <span class="title">location</span> / &#123;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="title">location</span><span class="regexp"> ^~</span> /.git &#123;                            <span class="comment"># 禁止访问.git文件夹</span></span><br><span class="line">         <span class="title">deny</span> all;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="title">error_page</span>  <span class="number">404</span>     /<span class="number">404</span>.html;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title">server</span> &#123;</span><br><span class="line">     <span class="title">listen</span> <span class="number">80</span>;</span><br><span class="line">     <span class="title">server_name</span> crypt.stdioa.com;                  <span class="comment"># host为crypt的请求转发本地端口</span></span><br><span class="line"></span><br><span class="line">     <span class="title">access_log</span> /var/log/nginx/access_crypt.log;</span><br><span class="line">     <span class="title">error_log</span> /var/log/nginx/error_crypt.log;</span><br><span class="line"></span><br><span class="line">     <span class="title">location</span> / &#123;</span><br><span class="line">         <span class="title">proxy_pass</span> <span class="url">http://127.0.0.1:5000/</span>;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>配置完成后，重启Nginx, 可以看到访问不同域名时，请求会交给不同的程序处理。</p>
<h1 id="2-_屏蔽来自特定域名的请求">2. 屏蔽来自特定域名的请求</h1><h2 id="2-1_背景">2.1 背景</h2><p>网站部署好后，又发现了一个来自奇怪域名的请求；更坑爹的是，这个域名指向自己的VPS；更更坑爹的是，来自这个域名的请求有好多，直接把我的日志刷爆了…所以我需要将来自这个域名的所有请求拒绝掉。</p>
<h2 id="2-2_操作">2.2 操作</h2><p>新建一个Server就好啦。具体配置文件如下：<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">server</span> &#123;</span><br><span class="line">    <span class="title">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="title">server_name</span> bailigo.com <span class="regexp">*.bailigo.com</span>;</span><br><span class="line">    <span class="title">location</span> / &#123;</span><br><span class="line">        <span class="title">return</span> <span class="number">410</span>;         <span class="comment"># 410 Gone, 使用了这个状态码，不知道能不能不再让爬虫爬这个网页</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>配置完成，重新载入配置文件，成功。<br><em>本来想用418, 但是Nginx没有418的返回页面，想了想还是算了吧</em></p>
<h1 id="3-_为博客部署HTTPS服务器">3. 为博客部署HTTPS服务器</h1><h2 id="3-1_背景">3.1 背景</h2><p><code>blog.stdioa.com</code>博客上午还可以访问，中午吃顿饭就发现访问被截断了，原因与以前一样——域名未完成备案。经查看，腾讯对访问博客的请求进行了301跳转，于是想了想，给博客配置了HTTPS, 让你们再阻断→_→（好吧再阻断的话我真的不知道该怎么弄了</p>
<h2 id="3-2_使用Let’s_Encrypt生成网站证书">3.2 使用Let’s Encrypt生成网站证书</h2><p>之前就看中了<a href="https://letsencrypt.org/" target="_blank" rel="external">Let’s Encrypt</a>，它提供主流浏览器认证的免费证书，只可惜当时没有域名无法体验。现在有了域名，加上腾讯对未备案的域名查的很紧，所有未备案域名下的网站搭起来半天就被封掉，想了想，还是生成一个证书，配个HTTPS撑一阵子吧╮(╯_╰)╭<br>按照官方的<a href="https://community.letsencrypt.org/t/quick-start-guide/1631" target="_blank" rel="external">指南</a>以及<a href="http://www.vpser.net/build/letsencrypt-free-ssl.html" target="_blank" rel="external">此指南</a>在将<a href="https://github.com/letsencrypt/letsencrypt" target="_blank" rel="external">Let’s Encrypt的Repo</a> clone到本地之后，输入<code>./letsencrypt-auto certonly --email 邮箱 -d 域名 --agree-tos</code>来生成证书。由于腾讯云到Let’s Encrypt的服务器的链接极其不稳定，通常需要重试很多次才能正常跟Let’s Encrypt的服务器通信。成功后会显示：</p>
<blockquote>
<p>IMPORTANT NOTES:<br>- Congratulations! Your certificate and chain have been saved at<br>  /etc/letsencrypt/live/blog.stdioa.com/fullchain.pem. Your cert<br>  will expire on 2016-03-17. To obtain a new version of the<br>  certificate in the future, simply run Let’s Encrypt again.<br>- If you like Let’s Encrypt, please consider supporting our work by:</p>
<p>  Donating to ISRG / Let’s Encrypt:   <a href="https://letsencrypt.org/donate" target="_blank" rel="external">https://letsencrypt.org/donate</a><br>  Donating to EFF:                    <a href="https://eff.org/donate-le" target="_blank" rel="external">https://eff.org/donate-le</a></p>
</blockquote>
<p>证书已存储在上面信息指示的目录。</p>
<h2 id="3-3_配置Nginx,_搭建HTTPS服务器">3.3 配置Nginx, 搭建HTTPS服务器</h2><p>证书已生成，下面该配置Nginx了，添加下列配置：<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">server</span> &#123;</span><br><span class="line">    <span class="title">listen</span>  <span class="number">443</span> ssl;</span><br><span class="line">    <span class="title">server_name</span>  blog.stdioa.com;</span><br><span class="line"></span><br><span class="line">    <span class="title">ssl_certificate</span> /etc/letsencrypt/live/blog.stdioa.com/fullchain.pem;        <span class="comment"># 添加证书</span></span><br><span class="line">    <span class="title">ssl_certificate_key</span> /etc/letsencrypt/live/blog.stdioa.com/privkey.pem;      <span class="comment"># 添加密钥</span></span><br><span class="line">    <span class="title">ssl_ciphers</span> <span class="string">"EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH"</span>;</span><br><span class="line">    <span class="title">ssl_protocols</span> TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>;</span><br><span class="line">    <span class="title">ssl_prefer_server_ciphers</span> <span class="built_in">on</span>;</span><br><span class="line">    <span class="title">ssl_session_cache</span> shared:SSL:<span class="number">10m</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 后面和普通服务器一样</span></span><br><span class="line">    <span class="title">access_log</span>  /var/log/nginx/access_blog.log;</span><br><span class="line">    <span class="title">error_log</span> /var/log/nginx/error_blog.log;</span><br><span class="line"></span><br><span class="line">    <span class="title">root</span>   /home/stdio/blog;</span><br><span class="line">    <span class="title">index</span>  index index.html;</span><br><span class="line"></span><br><span class="line">    <span class="title">location</span><span class="regexp"> ^~</span> /.git &#123;</span><br><span class="line">        <span class="title">deny</span> all;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title">error_page</span>  <span class="number">404</span> /<span class="number">404</span>.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>重新加载配置，访问<a href="https://blog.stdioa.com" target="_blank" rel="external">https://blog.stdioa.com</a> , 成功~</p>
<p>小插曲：<br>昨天晚上熄灯之前发现Ubuntu上使用<code>apt-get</code>安装的Nginx版本太老了，于是在VPS上重新编译升级了Nginx，结果配置好HTTPS以后重启Nginx时发现启动失败，原因为缺少<code>ngx</code>组件。经Google后发现没有编译该组件，所以重新编译安装Nginx, 在配置时加入<code>--with-http_ssl_module</code>选项。</p>
<p>小插曲2：<br>HTTPS配置好后访问博客，Chrome提示“存在不安全的内容”，选择加载后，地址栏左边的HTTPS会变成红色，极其不好看（雾），于是看了博客的模板，发现有两个js在加载时选择使用HTTP方式加载，于是将<code>http://.../*.js</code>改为<code>//.../*.js</code>, 使浏览器可以根据当前协议自动选择JS文件的加载协议。更新博客模板，重新访问，所有js均使用HTTPS方式加载，问题解决。附图:</p>
<center><img src="/pics/hhh_HTTPS.jpg" alt="哈哈哈HTTPS"></center>

<p>小插曲3：<br>上面那张图片的链接之前来自七牛，采用HTTP协议而不是HTTPS加载。发布这篇博文后，我发现该文章页面中地址栏左侧的HTTPS标志变为了白色…还是不好看！打开Chrome的控制台，在控制台中看到，如果图片链接协议为HTTPS，则Chrome依然会提示“不安全”，但是个人感觉这只是一张图片而已啊，又不是JS_(:зゝ∠)_<br>解决方案：将图片链接改回本地，待域名备案后再想办法在七牛那边解决域名绑定及HTTPS的问题。</p>
<h1 id="4-_参考资料">4. 参考资料</h1><p><a href="http://www.vpser.net/build/letsencrypt-free-ssl.html" target="_blank" rel="external">免费SSL安全证书Let’s Encrypt安装使用教程(附Nginx/Apache配置)</a><br><a href="http://blog.csdn.net/donghustone/article/details/25797727" target="_blank" rel="external">http://blog.csdn.net/donghustone/article/details/25797727</a><br><a href="http://serverfault.com/questions/438889/nginx-ssl-error" target="_blank" rel="external">nginx SSL error - Server Fault</a><br><a href="http://www.zzidc.com/main/help/showHelpContent/id_473.html" target="_blank" rel="external">网站存在不安全因素的解决办法</a></p>
<h1 id="5-_后记">5. 后记</h1><p>快递已发出，相片已审核成功，腾讯收到资料之后会尽快报管局审理…希望2016年之前能够备案成功QvQ<br>嗯，Google真好用<br><strong>说好的准备考试呢！</strong></p>
<p>Update 16:38<br>上午才把资料用快递发走，下午腾讯云就说我的纸质资料已收到…打电话问了一下，客服说腾讯为了加快审核速度，帮我准备了一份材料上交管局，估计他们是用我的扫描件打印了一份交上去了吧，也是不错2333 最后希望通信交通管理局快一点_(:зゝ∠)_</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>域名依然在备案中，依然想将博客部署到新买的VPS的我和腾讯斗智斗勇（雾），为博客添加了HTTPS&gt;_&lt;<br>同时，把自己的密码学课设也转移到VPS上来了。</p>]]>
    
    </summary>
    
      <category term="Github" scheme="//blog.stdioa.com/tags/Github/"/>
    
      <category term="Let&#39;s Encrypt" scheme="//blog.stdioa.com/tags/Let-s-Encrypt/"/>
    
      <category term="nginx" scheme="//blog.stdioa.com/tags/nginx/"/>
    
      <category term="乱七八糟" scheme="//blog.stdioa.com/categories/%E4%B9%B1%E4%B8%83%E5%85%AB%E7%B3%9F/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[博客迁移记（一）]]></title>
    <link href="//blog.stdioa.com/2015/12/blog-migration/"/>
    <id>//blog.stdioa.com/2015/12/blog-migration/</id>
    <published>2015-12-17T11:55:37.000Z</published>
    <updated>2015-12-18T05:53:29.525Z</updated>
    <content type="html"><![CDATA[<p>昨天买了一个VPS、一个域名，决定把博客迁移到VPS上。</p>
<a id="more"></a>
<h1 id="1-_背景介绍">1. 背景介绍</h1><p>首先打个广告：借助“腾讯云+校园”计划，我成功地用上了1元/月的服务器和11元/月的.com域名。<br>有了国内访问速度极快的VPS，有了域名，就想自己鼓捣鼓捣，把自己的博客和其他站点托管到VPS上。</p>
<h1 id="2-_博客托管">2. 博客托管</h1><h2 id="2-1_搭建静态文件服务器">2.1 搭建静态文件服务器</h2><p>因为自己的博客是静态博客，之前托管在<a href="https://github.com/StdioA/stdioa.github.io" target="_blank" rel="external">Github</a>上，依靠Github Pages实现部署，所以我先将文件clone了下来，存放在<code>~/blog</code>目录中。<br>下面要做的，是搭建一个静态服务器。</p>
<h3 id="2-1-1_使用Python的SimpleHTTPServer">2.1.1 使用Python的SimpleHTTPServer</h3><p>Python的SimpleHTTPServer是一个非常实用、方便的库，可以使用简单一条命令在当前目录创建一个HTTP文件服务器。所以输入<code>sudo python -m SimpleHTTPServer 80</code>命令，即可搭建一个静态文件服务器，实现从外网对静态博客的直接访问。<br>然而搭建好后，我发现了一个问题：因为我的blog文件夹本身是一个Git Repo, 所以我可以直接从外网访问.git文件夹，虽然我的.git目录没有保存任何设置及账户等，但这样会带来一定的安全隐患，所以要想办法禁止外部用户对.git文件夹的访问。</p>
<h3 id="2-1-2_使用Nginx托管文件服务器">2.1.2 使用Nginx托管文件服务器</h3><p>关于Nginx的介绍，请自行访问<a href="http://nginx.org/" target="_blank" rel="external">官网</a>与<a href="https://en.wikipedia.org/wiki/Nginx" target="_blank" rel="external">维基百科</a>。<br>之前用过Apache, 但是在接触Nginx后，我认为我对Nginx更有好感，所以采用了Nginx做为文件托管服务器。<br>首先安装Nginx，删掉<code>/etc/nginx/sites-enabled</code>目录（我的系统是Ubuntu Server 14.04 LTS），在<code>conf.d</code>目录中设置配置文件：<br><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">server </span><span class="expression">&#123;</span><br><span class="line">    <span class="variable">listen</span> 80;                              <span class="begin-block"># </span>监听端口</span><br><span class="line">    <span class="variable">server</span>_<span class="variable">name</span> <span class="variable">server</span>;</span><br><span class="line">    <span class="variable">root</span> <span class="end-block">/home</span><span class="end-block">/ubuntu</span><span class="end-block">/blog</span>;                 <span class="begin-block"># </span>托管目录</span><br><span class="line">    <span class="variable">index</span> <span class="variable">index.html</span>;</span><br><span class="line">    <span class="variable">access</span>_<span class="variable">log</span> <span class="end-block">/var</span><span class="end-block">/log</span><span class="end-block">/nginx</span><span class="end-block">/access</span>_<span class="variable">blog.log</span></span><br><span class="line">    <span class="variable">error</span>_<span class="variable">log</span> <span class="end-block">/var</span><span class="end-block">/log</span><span class="end-block">/nginx</span><span class="end-block">/error</span>_<span class="variable">blog.log</span></span><br><span class="line"></span><br><span class="line">    <span class="begin-block"># </span>禁止对<span class="variable">.git</span>目录的访问</span><br><span class="line">    <span class="variable">location</span> ^~ <span class="end-block">/.git </span>&#123;</span><br><span class="line">        <span class="variable">deny</span> <span class="variable">all</span>;</span><br><span class="line">    &#125;</span><span class="xml"></span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>配置完成后，重启Nginx, 所有服务正常运行，访问.git目录时会返回403.</p>
<p><em>SimpleHTTPServer在建立服务器的时候只能监听<code>0.0.0.0</code>而不能只监听<code>127.0.0.1</code>, 之前搭建服务器的时候用的SimpleHTTPServer+Nginx反向代理，现在看起来感觉我就是个傻逼…</em></p>
<h2 id="2-2_借助Webhook实现博客的自动部署">2.2 借助Webhook实现博客的自动部署</h2><p>因为之前静态博客托管在Github Pages上，所以向Github Repo上面进行push操作之后会动态更新页面。但是如果将静态博客托管在VPS上，则需要每次执行<code>git pull</code>才能够将内容更新。所以我在VPS上写了一个脚本，能够在Push之后自动进行<code>git pull</code>来更新内容。</p>
<ol>
<li><p>在Github上的repo设置Webhook<br>在repo的设置页面可以设置Webhook, 可在该repo收到push之后，Github可以向一个特定的URL发送一个POST请求。所以我设置了一个Webhook, 在push之后可以向我的VPS的特定端口发送POST请求。</p>
</li>
<li><p>设置服务器接收Webhook<br>在VPS中配置一个服务器，开放VPS的一个端口来接收来自Github的Webhook，这里使用bottle来搭建服务器框架。服务器代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> bottle <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="decorator">@route("/push", method=["POST"])    # 监听Webhook</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pull</span><span class="params">()</span>:</span></span><br><span class="line">    os.system(<span class="string">"./auto_pull.sh"</span>)     <span class="comment"># 执行git pull脚本</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"OK"</span></span><br><span class="line"></span><br><span class="line">run(host=<span class="string">"0.0.0.0"</span>, port=<span class="number">23333</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写自动pull脚本<br>编写自动pull脚本<code>auto_pull.sh</code>:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env sh&#10;&#10;cd ~/blog&#10;git pull</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>运行服务器，则可监听23333端口的POST请求，然后自动执行<code>git pull</code>更新博客内容。</p>
<h1 id="3-_后记">3. 后记</h1><p>至此，博客<strong>部分</strong>成功迁移到VPS.<br>为什么要说“部分”？因为我的域名在做备案啊QvQ备案好麻烦还要打印材料还要跑到市中心去照相还要发快递到北京QvQ都做好还得等待管局审核QvQ<br>吐槽时间结束。后面等域名备案好以后可能会鼓捣一阵子Nginx，为服务器启用HTTPS等…<br><strong>唉，还是先去复习吧_(:зゝ∠)_</strong></p>
<p><em>在写博文时，去编译升级了一下Nginx, 鼓捣配置文件又弄了半天</em>╮(╯_╰)╭</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>昨天买了一个VPS、一个域名，决定把博客迁移到VPS上。</p>]]>
    
    </summary>
    
      <category term="Github" scheme="//blog.stdioa.com/tags/Github/"/>
    
      <category term="nginx" scheme="//blog.stdioa.com/tags/nginx/"/>
    
      <category term="python" scheme="//blog.stdioa.com/tags/python/"/>
    
      <category term="乱七八糟" scheme="//blog.stdioa.com/categories/%E4%B9%B1%E4%B8%83%E5%85%AB%E7%B3%9F/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[随手记 - 解决InsecurePlatformWarning]]></title>
    <link href="//blog.stdioa.com/2015/12/essay-solve-InsecurePlatformWarning/"/>
    <id>//blog.stdioa.com/2015/12/essay-solve-InsecurePlatformWarning/</id>
    <published>2015-12-07T15:01:00.000Z</published>
    <updated>2015-12-20T02:21:53.885Z</updated>
    <content type="html"><![CDATA[<p>第三次在VPS上面解决使用requests报InsecurePlatformWarning警告的问题。之前每次都要查资料折腾好久，这次决定把它记下来。</p>
<a id="more"></a>
<h1 id="1-_干货">1. 干货</h1><ul>
<li><p>Debian类系统</p>
<ol>
<li><code>sudo apt-get install python-dev libssl-dev</code></li>
<li><code>sudo pip install -U requests[security]</code></li>
</ol>
</li>
<li><p>Redhat类系统</p>
<ol>
<li><code>sudo yum install python-devel openssl-devel</code></li>
<li><code>sudo pip install -U requests[security]</code></li>
</ol>
</li>
</ul>
<h1 id="2-_需求">2. 需求</h1><p>自己的VPS系统有点老(Ubuntu 14.04 LTS), 所以python版本也比较落后(Python 2.7.3), 今天改代码需要用到requests新版本中提供的功能，但是requests升级后发送HTTPS请求时会报出InsecurePlatformWarning, 这是一个由openssl漏洞(Heartbleed)造成的警告，所以需要升级pyopenssl等模块。</p>
<h1 id="3-_升级过程">3. 升级过程</h1><p>pypi提供了一个升级包，叫做<code>requests[security]</code>, 用pip进行升级即可。输入<code>sudo pip install requests[security]</code>命令后，pip报错，才发现不能本地编译python包，遂安装<code>python-dev</code>. 然后再次安装时发现缺少<code>openssl/aes.h</code>头文件，又去安装openssl的开发包<code>libssl-dev</code>, 再次安装，安装成功。</p>
<h1 id="4-_参考资料">4. 参考资料</h1><ol>
<li><a href="http://blog.csdn.net/blog/henulwj/48131393" target="_blank" rel="external">[原]pip安装模块警告InsecurePlatformWarning</a></li>
<li><a href="http://stackoverflow.com/questions/30539798/zsh-no-matches-found-requestssecurity" target="_blank" rel="external">zsh - no matches found: requests[security]</a></li>
</ol>
]]></content>
    <summary type="html">
    <![CDATA[<p>第三次在VPS上面解决使用requests报InsecurePlatformWarning警告的问题。之前每次都要查资料折腾好久，这次决定把它记下来。</p>]]>
    
    </summary>
    
      <category term="openssl" scheme="//blog.stdioa.com/tags/openssl/"/>
    
      <category term="python" scheme="//blog.stdioa.com/tags/python/"/>
    
      <category term="requests" scheme="//blog.stdioa.com/tags/requests/"/>
    
      <category term="随手记" scheme="//blog.stdioa.com/categories/%E9%9A%8F%E6%89%8B%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Python学习之unittest]]></title>
    <link href="//blog.stdioa.com/2015/11/learning-python-unittest/"/>
    <id>//blog.stdioa.com/2015/11/learning-python-unittest/</id>
    <published>2015-11-12T10:53:02.000Z</published>
    <updated>2015-12-20T02:22:25.400Z</updated>
    <content type="html"><![CDATA[<p>单元测试，工程开发中重要的一环。</p>
<a id="more"></a>
<h1 id="1-_简介">1. 简介</h1><p>单元测试是用来对一个模块、一个函数或者一个类来进行正确性检验的测试工作。</p>
<h1 id="2-_使用unittest进行测试">2. 使用unittest进行测试</h1><p>unittest是Python自带的单元测试模块，通过编写测试类，在测试类中编写测试函数的方式进行测试。<br>不知道该测试什么，就对python的list对象测试一下好了。</p>
<h2 id="2-1_编写测试文件">2.1 编写测试文件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> unittest                                 <span class="comment"># 使用unittest模块</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestStringMethods</span><span class="params">(unittest.TestCase)</span>:</span>     <span class="comment"># 测试类需继承自unittest.TestCase</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># 在函数里进行测试之前需要进行的一些准备工作，setUp在每次测试之前都会运行一次</span></span><br><span class="line">        self.d = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_empty</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""\</span><br><span class="line">        Empty testcase</span><br><span class="line">        """</span></span><br><span class="line">        self.assertEqual([], [])                <span class="comment"># 若a和b相等则通过</span></span><br><span class="line">        self.assertNotEqual([<span class="number">1</span>], [])            <span class="comment"># 若不相等则通过</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_bool</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""\</span><br><span class="line">        Bool transform testcase</span><br><span class="line">        """</span></span><br><span class="line">        self.assertTrue([<span class="number">1</span>])                    <span class="comment"># 若内部的表达式或对象为真则通过</span></span><br><span class="line">        self.assertFalse([])                    <span class="comment"># 为假则通过</span></span><br><span class="line">        self.assertTrue(bool([<span class="number">1</span>]))</span><br><span class="line">        self.assertFalse(bool([]))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_append</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""\</span><br><span class="line">        Append testcase</span><br><span class="line">        """</span></span><br><span class="line">        list_ = []</span><br><span class="line">        list_.append(<span class="number">1</span>)</span><br><span class="line">        self.assertEqual(list_, [<span class="number">1</span>])</span><br><span class="line">        self.assertNotEqual(list_, [])</span><br><span class="line">        list_.append(<span class="number">2</span>)</span><br><span class="line">        self.assertIn(<span class="number">1</span>, list_)                 <span class="comment"># 若a in b则通过</span></span><br><span class="line">        self.assertNotIn(<span class="number">3</span>, list_)              <span class="comment"># 若a not in b则通过</span></span><br><span class="line">        self.assertTrue(list_[<span class="number">0</span>] == <span class="number">1</span>)</span><br><span class="line">        self.assertEqual(list_[<span class="number">1</span>], <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_instance</span><span class="params">(self)</span>:</span></span><br><span class="line">        list_ = []</span><br><span class="line">        self.assertIsInstance(list_, list)      <span class="comment"># 若isinstance(a, b)为真则通过</span></span><br><span class="line">        self.assertNotIsInstance(list_, str)    <span class="comment"># 若isinstance(a, b)为假则通过</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_index</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""\</span><br><span class="line">        Index testcase</span><br><span class="line">        """</span></span><br><span class="line">        list_ = []</span><br><span class="line">        <span class="keyword">with</span> self.assertRaises(IndexError):     <span class="comment"># 检测是否有异常抛出，有指定异常抛出则通过</span></span><br><span class="line">            a = list_[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        list_ = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">        self.assertEqual(list_[<span class="number">1</span>], <span class="number">2</span>)</span><br><span class="line">        self.assertEqual(list_[-<span class="number">2</span>], <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> self.assertRaises(IndexError):</span><br><span class="line">            a = list_[<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># 在测试之后需要进行的一些处理事项，tearDown在每次测试之后都会运行一次</span></span><br><span class="line">        <span class="keyword">del</span> self.d</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    __import__(<span class="string">"sys"</span>).argv.append(<span class="string">"-v"</span>)         <span class="comment"># 采用verbose方式，输出测试信息</span></span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure>
<h2 id="2-2_运行测试">2.2 运行测试</h2><ul>
<li><p>直接运行测试程序，输出:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>_append (__main__.TestStringMethods)</span><br><span class="line">Append testcase ... ok</span><br><span class="line"><span class="built_in">test</span>_bool (__main__.TestStringMethods)</span><br><span class="line">Bool transform testcase ... ok</span><br><span class="line"><span class="built_in">test</span>_empty (__main__.TestStringMethods)</span><br><span class="line">Empty testcase ... ok</span><br><span class="line"><span class="built_in">test</span>_index (__main__.TestStringMethods)</span><br><span class="line">Index testcase ... ok</span><br><span class="line"><span class="built_in">test</span>_instance (__main__.TestStringMethods) ... ok</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran <span class="number">5</span> tests <span class="keyword">in</span> <span class="number">0.001</span>s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行<code>python -m unittest test.py</code>也可以进行测试；</p>
</li>
<li>运行<code>python -m unittest</code>, unittest会在当前文件夹中寻找测试类进行测试（真智能）；</li>
<li>若有测试未通过，unittest会在测试时报告FAIL, 并在测试结束后将所有未通过测试的项目列出。</li>
</ul>
<h1 id="3-_使用Nose进行单元测试">3. 使用Nose进行单元测试</h1><p>Nose是一个对unittest的扩展测试框架，能自动发现并运行测试。使用Nose，可以将单元测试代码的编写变得更简单，不用再构造测试类，只需要在以<code>test</code>开头的文件中建立以<code>test</code>开头的函数即可。</p>
<h2 id="3-1_编写测试文件">3.1 编写测试文件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> nose</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_nose_installed_successfully</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">import</span> nose                         <span class="comment"># 运行测试代码</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="keyword">True</span>                         <span class="comment"># assert True表示测试成功</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_obviously_failed</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="keyword">False</span>                        <span class="comment"># assert False表示测试失败，测试时会报"FAIL"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_returns_an_exception</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">raise</span> ValueError                    <span class="comment"># 若抛出除AssertionError的异常，测试时会报"ERROR"</span></span><br><span class="line"></span><br><span class="line">nose.main()</span><br></pre></td></tr></table></figure>
<h2 id="3-2_运行测试文件">3.2 运行测试文件</h2><p>nose自带可执行文件，所以只需要输入<code>nosetests [测试文件名]</code>即可，若测试文件名为空，则nosetest会在当前文件夹寻找所有测试。以下命令格式均可接受：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nosetests test.module</span><br><span class="line">nosetests another.test:TestCase.test_method</span><br><span class="line">nosetests a.test:TestCase</span><br><span class="line">nosetests /path/to/<span class="built_in">test</span>/file.py:<span class="built_in">test</span>_<span class="keyword">function</span></span><br></pre></td></tr></table></figure></p>
<p>运行<code>nosetests test_with_nose -v</code>，输出：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ nosetests <span class="built_in">test</span>_with_nose -v</span><br><span class="line"><span class="built_in">test</span>_with_nose.test_nose_installed_successfully ... ok</span><br><span class="line"><span class="built_in">test</span>_with_nose.test_obviously_failed ... FAIL</span><br><span class="line"><span class="built_in">test</span>_with_nose.test_returns_an_exception ... ERROR</span><br><span class="line"></span><br><span class="line">======================================================================</span><br><span class="line">ERROR: <span class="built_in">test</span>_with_nose.test_returns_an_exception</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"c:\python35\lib\site-packages\nose\case.py"</span>, line <span class="number">198</span>, <span class="keyword">in</span> runTest</span><br><span class="line">    self.test(*self.arg)</span><br><span class="line">  File <span class="string">"C:\Users\Stdio\Desktop\temp\utest\test_with_nose.py"</span>, line <span class="number">13</span>, <span class="keyword">in</span> <span class="built_in">test</span>_returns_an_exception</span><br><span class="line">    raise ValueError</span><br><span class="line">ValueError</span><br><span class="line"></span><br><span class="line">======================================================================</span><br><span class="line">FAIL: <span class="built_in">test</span>_with_nose.test_obviously_failed</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line"> File <span class="string">"c:\python35\lib\site-packages\nose\case.py"</span>, line <span class="number">198</span>, <span class="keyword">in</span> runTest</span><br><span class="line">   self.test(*self.arg)</span><br><span class="line">  File <span class="string">"C:\Users\Stdio\Desktop\temp\utest\test_with_nose.py"</span>, line <span class="number">10</span>, <span class="keyword">in</span> <span class="built_in">test</span>_obviously_failed</span><br><span class="line">   assert False</span><br><span class="line">AssertionError</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran <span class="number">3</span> tests <span class="keyword">in</span> <span class="number">0.003</span>s</span><br><span class="line"></span><br><span class="line">FAILED (errors=<span class="number">1</span>, failures=<span class="number">1</span>)</span><br></pre></td></tr></table></figure></p>
<h1 id="4-_参考文档">4. 参考文档</h1><ol>
<li><a href="https://docs.python.org/3/library/unittest.html" target="_blank" rel="external">unitest - Python Doc</a></li>
<li><a href="http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/00143191629979802b566644aa84656b50cd484ec4a7838000" target="_blank" rel="external">单元测试 - 廖雪峰的python教程</a></li>
<li><a href="https://nose.readthedocs.org/en/latest/" target="_blank" rel="external">Nose documentation</a></li>
<li><a href="http://blog.csdn.net/linda1000/article/details/8533349" target="_blank" rel="external">Python的学习（十八）—- 单元测试工具nose</a></li>
</ol>
<h1 id="5-_后记">5. 后记</h1><p>拖了一个月，这个坑再不填日子没法过了(╯‵□′)╯︵┻━┻<br>到现在没给自己的代码写过测试，也是醉…<br>一直想转Py3一直没转，昨天改了环境变量，强迫自己用一阵子，多去看看Py3的特性，有时间整理一下。<br>Git的坑还没填完不过自己的Pro Git看的差不多了，貌似也满足自己的需求了，准备弃坑。<br>下一篇有可能是SQLAlchemy, MongoDB, Flask…哎，随它去吧。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>单元测试，工程开发中重要的一环。</p>]]>
    
    </summary>
    
      <category term="python" scheme="//blog.stdioa.com/tags/python/"/>
    
      <category term="unittest" scheme="//blog.stdioa.com/tags/unittest/"/>
    
      <category term="Python" scheme="//blog.stdioa.com/categories/Python/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Python学习之collections]]></title>
    <link href="//blog.stdioa.com/2015/10/learning-python-collections/"/>
    <id>//blog.stdioa.com/2015/10/learning-python-collections/</id>
    <published>2015-10-29T12:55:00.000Z</published>
    <updated>2015-12-20T02:22:17.054Z</updated>
    <content type="html"><![CDATA[<p>collection是Python内建的一个实用工具包，提供一些使用的容器，用于对传统容器类型进行功能提升。</p>
<a id="more"></a>
<h1 id="1-_简介">1. 简介</h1><p>上面就是简介，不会扯了，贴两个链接好了。<br><a href="http://www.liaoxuefeng.com/wiki/001374738125095c955c1e6d8bb493182103fac9270762a000/001411031239400f7181f65f33a4623bc42276a605debf6000" target="_blank" rel="external">Collections - 廖雪峰的Python教程</a><br><a href="https://docs.python.org/2.7/library/collections.html#module-collections" target="_blank" rel="external">Collections - High-performance container datatypes - Python Doc</a></p>
<h1 id="2-_namedtuple">2. namedtuple</h1><h2 id="2-1_功能简介">2.1 功能简介</h2><p><code>namedtuple</code>为一个函数，用于产生一个tuple类的子类。由该类实例化后的对象可以像tuple一样pack/unpack，也可以通过预先定义好的成员名称访问对象内部的数据。例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from collections import namedtuple</span><br><span class="line">&gt;&gt;&gt; Point = namedtuple(<span class="string">"Point"</span>, [<span class="string">'x'</span>, <span class="string">'y'</span>])</span><br><span class="line">&gt;&gt;&gt; Point                                           <span class="comment"># namedtuple函数返回一个类</span></span><br><span class="line">&lt;class <span class="string">'__main__.Point'</span>&gt;</span><br><span class="line">&gt;&gt;&gt; Point.__base__</span><br><span class="line">&lt;<span class="built_in">type</span> <span class="string">'tuple'</span>&gt;</span><br><span class="line">&gt;&gt;&gt; Point(x=<span class="number">1</span>, y=<span class="number">2</span>)</span><br><span class="line">Point(x=<span class="number">1</span>, y=<span class="number">2</span>)</span><br><span class="line">&gt;&gt;&gt; Point(<span class="number">1</span>,<span class="number">2</span>)                                      <span class="comment"># 两种定义方式均可，但是要注意的是，Point的参数长度是不可变的</span></span><br><span class="line">Point(x=<span class="number">1</span>, y=<span class="number">2</span>)</span><br><span class="line">&gt;&gt;&gt; p = Point(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">&gt;&gt;&gt; p.x</span><br><span class="line"><span class="number">1</span></span><br><span class="line">&gt;&gt;&gt; x, y = p                                        <span class="comment"># 可以像tuple一样进行unpack</span></span><br><span class="line">&gt;&gt;&gt; x</span><br><span class="line"><span class="number">1</span></span><br><span class="line">&gt;&gt;&gt; Point._make((<span class="number">1</span>,<span class="number">2</span>))                              <span class="comment"># pack的方式和tuple不同</span></span><br><span class="line">Point(x=<span class="number">1</span>, y=<span class="number">2</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="2-2_成员函数">2.2 成员函数</h2><ul>
<li><p><code>somenamedtuple._make(iterable)</code>, 将一个可迭代对象（list, tuple等）转化为一个namedtuple对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="prompt">&gt;&gt;&gt; </span>t = [<span class="number">11</span>, <span class="number">22</span>]</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>Point._make(t)</span><br><span class="line">Point(x=<span class="number">11</span>, y=<span class="number">22</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>somenamedtuple._asdict()</code>, 将对象转化一个为键值和数据对应的OrderedDict.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="prompt">&gt;&gt;&gt; </span>p._asdict()</span><br><span class="line">OrderedDict([(<span class="string">'x'</span>, <span class="number">11</span>), (<span class="string">'y'</span>, <span class="number">22</span>)])</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>somenamedtuple._replace(kwargs)</code>, 返回一个新对象，该对象中的值按照_replace函数中的参数所改变。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="prompt">&gt;&gt;&gt; </span>p = Point(x=<span class="number">11</span>, y=<span class="number">22</span>)</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>p._replace(x=<span class="number">33</span>)</span><br><span class="line">Point(x=<span class="number">33</span>, y=<span class="number">22</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>somenamedtuple._fields</code>, 返回一个所有键值构成的dict.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="prompt">&gt;&gt;&gt; </span>p._fields                                                       <span class="comment"># 查看键值名字</span></span><br><span class="line">(<span class="string">'x'</span>, <span class="string">'y'</span>)</span><br><span class="line"></span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>Color = namedtuple(<span class="string">'Color'</span>, <span class="string">'red green blue'</span>)</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>Pixel = namedtuple(<span class="string">'Pixel'</span>, Point._fields + Color._fields)      <span class="comment"># 将Color和Point“合并”</span></span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>Pixel(<span class="number">11</span>, <span class="number">22</span>, <span class="number">128</span>, <span class="number">255</span>, <span class="number">0</span>)</span><br><span class="line">Pixel(x=<span class="number">11</span>, y=<span class="number">22</span>, red=<span class="number">128</span>, green=<span class="number">255</span>, blue=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="2-3_应用场景">2.3 应用场景</h2><p>列举一个应用场景：在进行sql查询时，<code>cur.fetchone()</code>会返回一个tuple而不是dict，我们可以定义一个namedtuple, 然后将sql的查询数据转为namedtuple类，然后通过成员函数访问。举个栗子（私货）：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Account = namedtuple(<span class="string">"Account"</span>, [<span class="string">"username"</span>, <span class="string">"password"</span>])   <span class="comment"># 定义Account类</span></span><br><span class="line">...</span><br><span class="line">cur = self.db.cursor()</span><br><span class="line">cur.execute(<span class="string">"SELECT username, password FROM account\</span><br><span class="line">                WHERE valid=1\</span><br><span class="line">                ORDER BY RANDOM()\</span><br><span class="line">                LIMIT 1"</span>)</span><br><span class="line">account= Account._make(cur.fetchone())                      <span class="comment"># 将数据tuple转为Account对象</span></span><br><span class="line">self.postdata[<span class="string">"username"</span>] = account.username                <span class="comment"># 直接访问成员数据</span></span><br><span class="line">self.postdata[<span class="string">"password"</span>] = account.password</span><br><span class="line">...</span><br><span class="line"><span class="comment"># self.login(username, password)</span></span><br><span class="line">self.login(account)                                         <span class="comment"># 可以将account整体作为参数，使程序看起来更简洁</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<h1 id="3-_deque_-_双端队列">3. deque - 双端队列</h1><h2 id="3-1_介绍">3.1 介绍</h2><p>deque为Double-Ended Queue的简写，用于提供一个可以快速进行两端的插入或删除操作的队列，同时可以像list一样通过下标访问数据。由于list是储存在线性空间的，其插入/删除数据的时间复杂度为O(n)，所以当list比较长的时候，在其头部插入/删除数据的操作需要耗费大量时间。所以如果需要对list对象进行大量头和尾的插入删除操作时，使用deque会使程序的运行效率更高（当然，使用Queue模块的Queue和LifoQueue也是不错的选择）。需要注意的是，deque对象不支持在中间位置的插入操作。<br>deque对象也被包含在Queue模块中。</p>
<h2 id="3-2_成员函数">3.2 成员函数</h2><ul>
<li><code>append(x)</code>, <code>appendleft(x)</code>, 在deque的尾/头插入对象x, 与list类似；</li>
<li><code>extend(iterable)</code>, <code>extendleft(iterable)</code>, 与list的extend类似；</li>
<li><code>pop(x)</code>, <code>popleft(x)</code>, 与list的pop类似；</li>
<li><code>clear()</code>, 清空deque的所有元素；</li>
<li><code>count(x)</code>, 统计deque中x元素的个数；</li>
<li><code>remove(x)</code>, 删除deque中的x元素，若x元素不存在，则触发ValueError;</li>
<li><code>reverse()</code>, 将deque反转，返回None, 与list的reverse类似;</li>
<li><code>rotate(i)</code>, 将deque最末尾i个元素取出并插入头部，若i&lt;0, 则将头部|i|个元素取出添加到尾部。</li>
</ul>
<h1 id="4-_Counter_-_计数器">4. Counter - 计数器</h1><h2 id="4-1_介绍">4.1 介绍</h2><p>Counter类是dict的子类，提供一个计数器，可对hashable的对象进行计数。需要注意的是，对象的计数可以小于0.</p>
<h2 id="4-2_基本操作">4.2 基本操作</h2><p>直接上例子：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="prompt">&gt;&gt;&gt; </span>c = Counter()                           <span class="comment"># 空计数器</span></span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>c = Counter(<span class="string">'gallahad'</span>)                 <span class="comment"># 对iterable对象中的元素进行计数</span></span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>c = Counter(&#123;<span class="string">'red'</span>: <span class="number">4</span>, <span class="string">'blue'</span>: <span class="number">2</span>&#125;)      <span class="comment"># 从map中读取元素和对应计数</span></span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>c = Counter(cats=<span class="number">4</span>, dogs=<span class="number">8</span>)             <span class="comment"># 从关键字参数中获取</span></span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>c</span><br><span class="line">Counter(&#123;<span class="string">'dogs'</span>: <span class="number">8</span>, <span class="string">'cats'</span>: <span class="number">4</span>&#125;)</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>c[<span class="string">"dogs"</span>]                               <span class="comment"># 获取计数</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>c[<span class="string">"elephants"</span>]                          <span class="comment"># 对于不存在的元素，会返回0 </span></span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<h2 id="4-3_成员函数">4.3 成员函数</h2><ul>
<li><p><code>elements()</code>, 返回一个迭代器，包含Counter中的所有元素，若元素x的计数为n，则x在迭代器中会出现n次。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c = Counter(a=<span class="number">4</span>, b=<span class="number">2</span>, c=<span class="number">0</span>, d=-<span class="number">2</span>)</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>list(c.elements())</span><br><span class="line">[<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>most_common([n])</code>, 返回计数最多的n个元素。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="prompt">&gt;&gt;&gt; </span>Counter(<span class="string">'abracadabra'</span>).most_common(<span class="number">3</span>)</span><br><span class="line">[(<span class="string">'a'</span>, <span class="number">5</span>), (<span class="string">'r'</span>, <span class="number">2</span>), (<span class="string">'b'</span>, <span class="number">2</span>)]</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>update([iterable-or-mapping])</code>, 在现有计数上添加参数所对应的计数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="prompt">&gt;&gt;&gt; </span>c = Counter(<span class="string">"1233"</span>)</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>c</span><br><span class="line">Counter(&#123;<span class="string">'3'</span>: <span class="number">2</span>, <span class="string">'1'</span>: <span class="number">1</span>, <span class="string">'2'</span>: <span class="number">1</span>&#125;)</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>c.update(<span class="string">"2345"</span>)</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>c</span><br><span class="line">Counter(&#123;<span class="string">'3'</span>: <span class="number">3</span>, <span class="string">'2'</span>: <span class="number">2</span>, <span class="string">'1'</span>: <span class="number">1</span>, <span class="string">'5'</span>: <span class="number">1</span>, <span class="string">'4'</span>: <span class="number">1</span>&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>substact([iterable-or-mapping])</code>, 在现有计数上减去参数所对应的计数。</p>
</li>
</ul>
<p>可以用在Counter对象上的通用函数和常见用法有：</p>
<ul>
<li><code>sum(c.values())</code>, 所有计数之和</li>
<li><code>c.clear()</code>, 将计数重置</li>
<li><code>list(c)</code>, 返回所有元素构成的列表, 其中元素不会重复</li>
<li><code>set(c)</code>, 转化为set</li>
<li><code>dict(c)</code>, 转化为dict</li>
<li><code>c.items()</code>, 转化为由(元素, 计数)构成的列表</li>
<li><code>Counter(dict(list_of_pairs))</code>, 从上述列表转化为Counter对象</li>
<li><code>c.most_common()[:-n-1:-1]</code>, 出现最少的n个元素</li>
<li><code>c += Counter()</code>, 移除所有元素计数为0的元素<br>注意: 将某元素的计数赋值为0, 并不能在计数器的元素列表中删除该元素。若要删除该元素，需要用<code>del</code>.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="prompt">&gt;&gt;&gt; </span>c = Counter(<span class="string">"12"</span>)</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>c</span><br><span class="line">Counter(&#123;<span class="string">'1'</span>: <span class="number">1</span>, <span class="string">'2'</span>: <span class="number">1</span>&#125;)</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>c[<span class="string">"0"</span>]</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>c</span><br><span class="line">Counter(&#123;<span class="string">'1'</span>: <span class="number">1</span>, <span class="string">'2'</span>: <span class="number">1</span>&#125;)</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>c[<span class="string">"0"</span>] = <span class="number">0</span></span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>c</span><br><span class="line">Counter(&#123;<span class="string">'1'</span>: <span class="number">1</span>, <span class="string">'2'</span>: <span class="number">1</span>, <span class="string">'0'</span>: <span class="number">0</span>&#125;)</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span><span class="keyword">del</span> c[<span class="string">"0"</span>]</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>c</span><br><span class="line">Counter(&#123;<span class="string">'1'</span>: <span class="number">1</span>, <span class="string">'2'</span>: <span class="number">1</span>&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="5-_defaultdict">5. defaultdict</h1><h2 id="5-1_介绍">5.1 介绍</h2><p>defaultdict类是dict类的子类，包含dict类的所有功能。与dict不同的是，在调用不存在的键值时，dict会抛出<code>KeyError</code>异常，而defaultdict会执行<code>__missing__</code>函数, 通过调用该函数来进行操作或返回值。<br>定义方式如下:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">d = defaultdict()                                   <span class="comment"># 这种定义方式返回的对象跟普通dict无异</span></span><br><span class="line">a = defaultdict(<span class="keyword">lambda</span>: <span class="string">"N/A"</span>)                      <span class="comment"># 定义__missing__函数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> a[<span class="string">"0"</span>]                                        <span class="comment"># 返回"N/A", 同时a["0"]被赋值为"N/A"</span></span><br></pre></td></tr></table></figure></p>
<h2 id="5-2_应用场景">5.2 应用场景</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="prompt">&gt;&gt;&gt; </span>s = [(<span class="string">'yellow'</span>, <span class="number">1</span>), (<span class="string">'blue'</span>, <span class="number">2</span>), (<span class="string">'yellow'</span>, <span class="number">3</span>), (<span class="string">'blue'</span>, <span class="number">4</span>), (<span class="string">'red'</span>, <span class="number">1</span>)]</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>d = defaultdict(list)                                           <span class="comment"># 若键值不存在，则赋值为[]</span></span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span><span class="keyword">for</span> k, v <span class="keyword">in</span> s:</span><br><span class="line"><span class="prompt">... </span>    d[k].append(v)</span><br><span class="line">...</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>d.items()</span><br><span class="line">[(<span class="string">'blue'</span>, [<span class="number">2</span>, <span class="number">4</span>]), (<span class="string">'red'</span>, [<span class="number">1</span>]), (<span class="string">'yellow'</span>, [<span class="number">1</span>, <span class="number">3</span>])]</span><br></pre></td></tr></table></figure>
<h1 id="6-_OrderdDict">6. OrderdDict</h1><h2 id="6-1_简介">6.1 简介</h2><p>使用<code>dict</code>时，Key是无序的。在对<code>dict</code>做迭代时，我们无法确定Key的顺序。如果要保持Key的顺序，可以用<code>OrderedDict</code>.<br><code>OrderedDict</code>的键值顺序按照键值被插入的顺序排列，而不是Key本身的顺序。<br><code>OrderdDict</code>的键值可以通过调用<code>popitem</code>函数被弹出，弹出时弹出(key, item)的键值对。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="prompt">&gt;&gt;&gt; </span>a = OrderedDict(&#123;<span class="string">"one"</span>: <span class="number">1</span>&#125;)                     <span class="comment"># 可通过dict定义，也可传入可迭代对象</span></span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>a[<span class="string">"zero"</span>] = <span class="number">0</span></span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>a[<span class="string">"two"</span>] = <span class="number">2</span></span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>a</span><br><span class="line">OrderedDict([(<span class="string">'one'</span>, <span class="number">1</span>), (<span class="string">'zero'</span>, <span class="number">0</span>), (<span class="string">'two'</span>, <span class="number">2</span>)])</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>a.popitem()                                     <span class="comment"># 弹出最后一个键值对</span></span><br><span class="line">(<span class="string">'two'</span>, <span class="number">2</span>)</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>a.popitem(last=<span class="keyword">False</span>)                           <span class="comment"># 弹出第一个键值对</span></span><br><span class="line">(<span class="string">'one'</span>, <span class="number">1</span>)</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>a</span><br><span class="line">OrderedDict([(<span class="string">'zero'</span>, <span class="number">0</span>)])</span><br></pre></td></tr></table></figure></p>
<h1 id="7-_参考文档">7. 参考文档</h1><ol>
<li><a href="https://docs.python.org/2.7/library/collections.html#collections.OrderedDict" target="_blank" rel="external">8.3 collections — High-performance container datatypes</a></li>
<li><a href="http://www.liaoxuefeng.com/wiki/001374738125095c955c1e6d8bb493182103fac9270762a000/001411031239400f7181f65f33a4623bc42276a605debf6000" target="_blank" rel="external">collections - 廖雪峰的官方教程</a></li>
</ol>
<h1 id="8-_后记">8. 后记</h1><p>这篇博文写了两天，感觉在翻译文档，有点枯燥。一直觉得应该多去了解Python的内置常用模块，不要求完全熟练，至少要有个印象，这样在开发中需要使用这些模块的时候，才能够想起来用它。<br>所以，又填完一个坑。下一个应该是unittest吧。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>collection是Python内建的一个实用工具包，提供一些使用的容器，用于对传统容器类型进行功能提升。</p>]]>
    
    </summary>
    
      <category term="collections" scheme="//blog.stdioa.com/tags/collections/"/>
    
      <category term="python" scheme="//blog.stdioa.com/tags/python/"/>
    
      <category term="Python" scheme="//blog.stdioa.com/categories/Python/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Python学习之迭代器]]></title>
    <link href="//blog.stdioa.com/2015/10/learning-python-iterator/"/>
    <id>//blog.stdioa.com/2015/10/learning-python-iterator/</id>
    <published>2015-10-26T07:43:00.000Z</published>
    <updated>2015-12-20T02:22:13.570Z</updated>
    <content type="html"><![CDATA[<p>昨晚用python写了个简单的链表，突然想起了迭代器，就随手整理一下，顺便过一下itertools模块。</p>
<a id="more"></a>
<h1 id="1-_简介">1. 简介</h1><p>迭代器(iterator)是Python中一种用来进行惰性迭代的数据类型，迭代器可以惰性地在需要时生成数据并返回已进行迭代，而不需要在开始进行时生成所有数据（有的时候也不可能生成所有数据，比如斐波那契数列的无穷迭代等）然后一个一个返回。</p>
<h1 id="2-_用法">2. 用法</h1><h2 id="2-1_最基础的例子:_iter()函数生成迭代器">2.1 最基础的例子: iter()函数生成迭代器</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">list_ = [<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">it = iter(list_)                        <span class="comment"># 返回一个迭代器</span></span><br><span class="line"></span><br><span class="line">it.next()                               <span class="comment"># 获取一个迭代器元素，返回1</span></span><br><span class="line">next(it)                                <span class="comment"># 使用next内建函数，等同于it.next(), 返回2</span></span><br><span class="line">it.next()                               <span class="comment"># 迭代结束，触发StopIteration异常</span></span><br><span class="line"></span><br><span class="line">list_ = [<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">it = iter(list_)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> it:                            <span class="comment"># 用for循环对迭代器进行循环迭代</span></span><br><span class="line">    <span class="keyword">print</span> x                             <span class="comment"># 迭代结束时，StopIteration不会被触发</span></span><br></pre></td></tr></table></figure>
<p>值得注意的是，迭代器只可向前迭代，不能向后迭代，获取之前已返回过的值（当然绝大多数的时候也没必要向后迭代）。</p>
<h2 id="2-2_生成器">2.2 生成器</h2><p><code>[x*2 for x in range(10) if x%2==0]</code>, 这段代码为列表生成式（也称作列表解析），可以将一个列表进行转化；将方括号变为圆括号，<code>(x*2 for x in range(10) if x%2==0)</code>, 则该代码变为一个生成器(generator)。<br>生成器可以像迭代器一样进行迭代，还可以通过生成器的成员函数和生成器内部的代码进行数据交换。</p>
<h1 id="3-_自定义迭代器及生成器">3. 自定义迭代器及生成器</h1><h2 id="3-1_自定义迭代器">3.1 自定义迭代器</h2><p>在编写类的时候，可以通过定义类的<code>__iter__</code>函数来使类可以转化为迭代器。在<code>__iter__</code>函数结束时，会自动引发<code>StopIteration</code>异常。例:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.number = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">            <span class="keyword">yield</span> self.number</span><br><span class="line">            self.number += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">a = Counter()</span><br><span class="line">it = iter(a)</span><br><span class="line"><span class="keyword">print</span> it.next()                 <span class="comment"># 0</span></span><br><span class="line"><span class="keyword">print</span> it.next()                 <span class="comment"># 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> it:</span><br><span class="line">    <span class="keyword">print</span> num                   <span class="comment"># 因为该迭代器为无穷迭代，所以会导致死循环</span></span><br></pre></td></tr></table></figure></p>
<h2 id="3-2_自定义生成器">3.2 自定义生成器</h2><p>可以用函数自定义生成器。例：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span><span class="params">()</span>:</span></span><br><span class="line">    a, b = <span class="number">1</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        <span class="keyword">yield</span> a                 <span class="comment"># 用yield函数来在迭代时返回值，在下次迭代时，自动从yield语句的下一条语句开始执行</span></span><br><span class="line">        a, b = b, a+b</span><br><span class="line"></span><br><span class="line">k = fib()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">print</span> next(k)               <span class="comment"># 1 1 2 3 5 8 13 21 34 55</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> type(k)                   <span class="comment"># &lt;generator object fib at 0x0268BDF0&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="3-3_生成器的进阶用法">3.3 生成器的进阶用法</h2><p><code>generator.next()</code>用来进行迭代并获取返回值；<code>generator.close()</code>用来关闭生成器，并在下次迭代时出发StopIteration异常。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = fib()</span><br><span class="line"><span class="keyword">print</span> next(a)                   <span class="comment"># 1</span></span><br><span class="line">a.close()                       <span class="comment"># 关闭迭代器</span></span><br><span class="line"><span class="keyword">print</span> next(a)                   <span class="comment"># StopIteration</span></span><br></pre></td></tr></table></figure></p>
<p><code>generator.send(arg)</code>可以向生成器内部传递对象，<code>generator.throw(typ[,val[,tb]])</code>可以向生成器内部传递异常（包括类型，具体异常对象和Traceback）；在调用这两个函数后，生成器立刻进行迭代并返回值（或触发StopIteration）。具体操作：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">counter</span><span class="params">()</span>:</span></span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            ret = <span class="keyword">yield</span> num</span><br><span class="line">        <span class="keyword">except</span> ValueError:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"ValueError caught"</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ret <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            num = ret</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">c = counter()</span><br><span class="line"><span class="keyword">print</span> c.next()                          <span class="comment"># 0</span></span><br><span class="line"><span class="keyword">print</span> c.send(<span class="number">3</span>)                         <span class="comment"># 传输3，内部yield语句返回3，然后进行下次迭代，生成4</span></span><br><span class="line"><span class="keyword">print</span> c.next()                          <span class="comment"># 5</span></span><br><span class="line">c.throw(ValueError)                     <span class="comment"># 传递异常，内部yield函数触发异常，然后进行异常处理，输出"ValueError caught"，若未处理，则异常会向上层抛出</span></span><br><span class="line"><span class="keyword">print</span> c.next()                          <span class="comment"># 6</span></span><br></pre></td></tr></table></figure></p>
<h1 id="4-_itertools模块">4. itertools模块</h1><p>itertools是Python自带的一个模块，包含很多使用函数，用来对一个或多个可迭代对象进行操作后返回一个迭代器。具体函数列表：</p>
<ol>
<li><p>无限迭代器</p>
<ul>
<li><code>count(start, [step])</code><br>从start开始，以后每个元素都加上step。step默认值为1。<br><code>count(5)</code> -&gt; 5 6 7 …</li>
<li><code>cycle(p)</code><br>迭代至p的最后一个元素之后，从p的第一个元素重新迭代。<br><code>cycle(&#39;abc&#39;)</code> -&gt; a b c a b c …</li>
<li><code>repeat(elem [,n])</code><br>无限重复或重复n次返回elem。<br><code>repeat(&quot;Ah&quot;, 3)</code> -&gt; “Ah” “Ah” “Ah”</li>
</ul>
</li>
<li><p>在最短的序列结束迭代时停止迭代</p>
<ul>
<li>chain(p, q, …)<br>迭代至序列p的最后一个元素后，从q的第一个元素开始，直到所有序列终止。<br><code>chain(&quot;ABC&quot;, &quot;DEF&quot;)</code> -&gt; A B C D E F</li>
<li><code>compress(data, selectors)</code><br>如果bool(selectors[n])为True，则next()返回data[n]，否则跳过data[n]。<br><code>compress(&#39;ABCDEF&#39;, [1,0,1,0,1,1])</code> -&gt; A C E F</li>
<li><code>dropwhile(pred, seq)</code><br>当pred对seq[n]的调用返回False时才开始迭代。<br><code>dropwhile(lambda x: x&lt;5, [1,4,6,4,1])</code> -&gt; 6 4 1</li>
<li><code>takewhile(pred, seq)</code><br>dropwhile的相反版本。<br><code>takewhile(lambda x: x&lt;5, [1,4,6,4,1])</code> -&gt; 1 4</li>
<li><code>ifilter(pred, seq)</code><br>内建函数filter的迭代器版本。<br><code>ifilter(lambda x: x%2, range(10))</code> -&gt; 1 3 5 7 9</li>
<li><code>ifilterfalse(pred, seq)</code><br>ifilter的相反版本。<br><code>ifilterfalse(lambda x: x%2, range(10))</code> -&gt; 0 2 4 6 8</li>
<li><code>imap(func, p, q, ...)</code><br>内建函数map的迭代器版本。<br><code>imap(pow, (2,3,10), (5,2,3))</code> -&gt; 32 9 1000</li>
<li><code>starmap(func, seq)</code><br>将seq的每个元素以变长参数(*args)的形式调用func。<br><code>starmap(pow, [(2,5), (3,2), (10,3)])</code> -&gt; 32 9 1000</li>
<li><code>izip(p, q, ...)</code><br>内建函数zip的迭代器版本。<br><code>izip(&#39;ABCD&#39;, &#39;xy&#39;)</code> -&gt; Ax By</li>
<li><code>izip_longest(p, q, ..., fillvalue=None)</code><br>izip的取最长序列的版本，短序列将填入fillvalue。<br><code>izip_longest(&#39;ABCD&#39;, &#39;xy&#39;, fillvalue=&#39;-&#39;)</code> -&gt; Ax By C- D-</li>
<li><code>tee(it, n)</code><br>返回n个迭代器it的复制迭代器。</li>
<li><code>groupby(iterable[, keyfunc])</code><br>这个函数功能类似于SQL的分组。使用groupby前，首先需要使用相同的keyfunc对iterable进行排序，比如调用内建的sorted函数。然后，groupby返回迭代器，每次迭代的元素是元组(key值, iterable中具有相同key值的元素的集合的子迭代器)。或许看看Python的排序指南对理解这个函数有帮助。<br><code>groupby([0, 0, 0, 1, 1, 1, 2, 2, 2])</code> -&gt; (0, (0 0 0)) (1, (1 1 1)) (2, (2 2 2))</li>
</ul>
</li>
<li><p>组合迭代器</p>
<ul>
<li><code>product(p, q, ... [repeat=1])</code><br>生成笛卡尔积。<br><code>product(&#39;ABCD&#39;, repeat=2)</code> –&gt; AA AB AC AD BA BB BC BD CA CB CC CD DA DB DC DD</li>
<li><code>permutations(p[, r])</code><br>生成全排列。<br><code>permutations(&#39;ABCD&#39;, 2)</code> –&gt; AB AC AD BA BC BD CA CB CD DA DB DC</li>
<li><code>combinations(p, r)</code><br>生成组合。<br><code>combinations(&#39;ABCD&#39;, 2)</code> –&gt; AB AC AD BC BD CD</li>
<li><code>combinations_with_replacement()</code><br>生成排列元素(p, q), 且p<q. `combinations_with_replacement('abcd',="" 2)`="" --=""> AA AB AC AD BB BC BD CC CD DD</q.></li>
</ul>
</li>
</ol>
<p>部分文字来源：<a href="http://www.cnblogs.com/huxi/archive/2011/07/01/2095931.html" target="_blank" rel="external">http://www.cnblogs.com/huxi/archive/2011/07/01/2095931.html</a></p>
<h1 id="5-_参考文档">5. 参考文档</h1><ol>
<li><a href="https://docs.python.org/2.7/library/itertools.html#module-itertools" target="_blank" rel="external">itertools - Python Doc</a></li>
<li><a href="http://www.liaoxuefeng.com/wiki/001374738125095c955c1e6d8bb493182103fac9270762a000/00138681965108490cb4c13182e472f8d87830f13be6e88000" target="_blank" rel="external">生成器 - 廖雪峰的Python教程</a></li>
<li><a href="http://blog.csdn.net/bluebird_237/article/details/38894617" target="_blank" rel="external">Python 迭代器 &amp; __iter__方法</a></li>
<li><a href="http://www.cnblogs.com/huxi/archive/2011/07/01/2095931.html" target="_blank" rel="external">Python函数式编程指南（三）：迭代器</a></li>
</ol>
]]></content>
    <summary type="html">
    <![CDATA[<p>昨晚用python写了个简单的链表，突然想起了迭代器，就随手整理一下，顺便过一下itertools模块。</p>]]>
    
    </summary>
    
      <category term="python" scheme="//blog.stdioa.com/tags/python/"/>
    
      <category term="迭代器" scheme="//blog.stdioa.com/tags/%E8%BF%AD%E4%BB%A3%E5%99%A8/"/>
    
      <category term="Python" scheme="//blog.stdioa.com/categories/Python/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Python学习之上下文管理]]></title>
    <link href="//blog.stdioa.com/2015/10/learning-python-context-management/"/>
    <id>//blog.stdioa.com/2015/10/learning-python-context-management/</id>
    <published>2015-10-22T12:00:00.000Z</published>
    <updated>2015-12-20T02:22:08.283Z</updated>
    <content type="html"><![CDATA[<p>最近突发奇想，想写一个能改变当前输出环境，输出彩色文字的上下文管理器，于是学习了一下上下文管理。</p>
<a id="more"></a>
<h1 id="1-_简介">1. 简介</h1><p>上下文管理器(context manager)是Python2.5开始支持的一种语法，用于规定某个对象的使用范围。一旦进入或者离开该使用范围，会有特殊操作被调用 (比如为对象分配或者释放内存)。一个最简单的例子:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> file(<span class="string">"a.txt"</span>, <span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    s = f.read()</span><br><span class="line">    <span class="keyword">print</span> f.closed                  <span class="comment"># 此时文件是打开的</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> f.closed                      <span class="comment"># 变量s和f依然存在，但此时f已关闭</span></span><br></pre></td></tr></table></figure></p>
<h1 id="2-_编写上下文管理器">2. 编写上下文管理器</h1><p>为一个类编写上下文管理器时，需要定义类的<code>__enter__</code>和<code>__exit__</code>函数。</p>
<h2 id="2-1___enter__函数">2.1 __enter__函数</h2><p><code>__enter__</code>函数规定如下：</p>
<blockquote>
<p>contextmanager.__enter__()<br>  Enter the runtime context and return either this object or another object related to the runtime context. The value returned by this method is bound to the identifier in the as clause of with statements using this context manager.<br>进入当前上下文，并返回当前对象或另一个与当前上下文相关的对象。被该函数返回的变量会通过该上下文管理器与with文法中as后的声明所绑定。</p>
</blockquote>
<p>例：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BracketAdder</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># do something with self and runtime context</span></span><br><span class="line">        sys.stdout.write(<span class="string">"("</span>)           <span class="comment"># 输出左括号</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="comment"># __exit__函数略</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> BracketAdder() <span class="keyword">as</span> ba:</span><br><span class="line">    <span class="comment"># do_something</span></span><br></pre></td></tr></table></figure></p>
<h2 id="2-2___exit__函数">2.2 __exit__函数</h2><p><code>__exit__</code>函数格式如下:</p>
<blockquote>
<p>contexmanager.__exit__(exc_type, exc_val, exc_tb)</p>
</blockquote>
<p><em>文档太长懒得翻译了</em>_(:зゝ∠)_</p>
<p>如果代码块中出现异常，<code>exc_type</code>为异常类型，<code>exc_val</code>为该异常，<code>exc_tb</code>为traceback.<code>__exit__</code>函数应返回一个bool类型，若返回值为<code>True</code>, 则在代码块及<code>__exit__</code>函数运行结束后不会抛出任何异常，然后立即执行后面的代码；若返回值为<code>False</code>，则在<code>__exit__</code>函数运行结束后抛出异常。<br>若代码块中未出现异常，则三个变量均为<code>None</code>.<br>例：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BracketAdder</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="comment"># __enter__函数略</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, exc_type, exc_val, exc_tb)</span>:</span></span><br><span class="line">        <span class="comment"># do something with self and runtime context</span></span><br><span class="line">        sys.stdout.write(<span class="string">')'</span>)</span><br><span class="line">        <span class="keyword">if</span> exc_type == NameError:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> BracketAdder():</span><br><span class="line">    <span class="keyword">print</span> a                    <span class="comment"># 若执行这一条引发NameError异常，则异常不会被抛出</span></span><br><span class="line">    a = <span class="number">1</span>/<span class="number">0</span>                    <span class="comment"># 若执行这一条引发ZeroDivisionError, 则异常会被抛出</span></span><br></pre></td></tr></table></figure></p>
<h1 id="3-_综合示例">3. 综合示例</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CManager</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.in_context = <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.in_context = <span class="keyword">True</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"I'm entering the context"</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, exc_type, exc_val, exc_tb)</span>:</span></span><br><span class="line">        self.in_context = <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"I'm leaving the context"</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> exc_type == NameError:       <span class="comment"># 拦截NameError异常</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"I'm &#123;status&#125;in the context."</span>.format(</span><br><span class="line">                    status=<span class="string">""</span> <span class="keyword">if</span> self.in_context <span class="keyword">else</span> <span class="string">"not "</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> CManager() <span class="keyword">as</span> ba:</span><br><span class="line">    ba.show()</span><br><span class="line">    <span class="comment"># blahblah</span></span><br><span class="line">    <span class="keyword">raise</span> NameError                     <span class="comment"># 触发NameError异常，代码块后面的语句实际不会执行，而该异常会在__exit__函数中被拦截</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'k'</span></span><br><span class="line"></span><br><span class="line">ba.show()</span><br></pre></td></tr></table></figure>
<p>程序输出:<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I&#39;m entering the context&#10;I&#39;m in the context.&#10;I&#39;m leaving the context&#10;I&#39;m not in the context.</span><br></pre></td></tr></table></figure></p>
<h1 id="4-_参考文档">4. 参考文档</h1><ol>
<li><a href="https://docs.python.org/2.7/library/stdtypes.html#index-37" target="_blank" rel="external">Context Manager Types - Python Doc</a></li>
<li><a href="http://www.cnblogs.com/vamei/archive/2012/11/23/2772445.html" target="_blank" rel="external">Python深入02 上下文管理器</a></li>
<li><a href="http://python.jobbole.com/82494/" target="_blank" rel="external">浅谈 Python 的 with 语句</a></li>
</ol>
<h1 id="5-_后记">5. 后记</h1><p>这些小知识点平时只是粗略的看一下，只能达到会用的程度，有时候觉得只有自己整理一遍才能真正理解它们，才能熟练运用。<br>所以…又填完一个坑。周末简单写写PyQt4吧…</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>最近突发奇想，想写一个能改变当前输出环境，输出彩色文字的上下文管理器，于是学习了一下上下文管理。</p>]]>
    
    </summary>
    
      <category term="python" scheme="//blog.stdioa.com/tags/python/"/>
    
      <category term="上下文管理" scheme="//blog.stdioa.com/tags/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86/"/>
    
      <category term="Python" scheme="//blog.stdioa.com/categories/Python/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Python学习之virtualenv]]></title>
    <link href="//blog.stdioa.com/2015/10/learning-python-virtualenv/"/>
    <id>//blog.stdioa.com/2015/10/learning-python-virtualenv/</id>
    <published>2015-10-22T02:15:00.000Z</published>
    <updated>2015-12-20T02:22:28.361Z</updated>
    <content type="html"><![CDATA[<p>用过virtualenv的人都说好，可是我没有具体使用过，所以尝试了一下，用完我也说好~233333</p>
<a id="more"></a>
<h1 id="1-_简介">1. 简介</h1><p>virtualenv是一个python库，用于创建独立python开发及运行环境。一般linux环境下如果在全局用pip安装模块时需要使用sudo命令，可是在共享主机上将root权限交给一般用户是不显示而且不安全的。可是有了virtualenv, 普通用户就可以创建一个虚拟环境，然后在虚拟环境中以普通用户权限安装模块，更改环境变量，进行开发和运行python程序而不会影响系统环境的环境变量和Python模块。</p>
<h1 id="2-_创建virtualenv环境">2. 创建virtualenv环境</h1><p>输入<code>virtualenv venv</code>创建名为venv的虚拟环境。<br>创建虚拟环境的常用选项：</p>
<blockquote>
<p>–no-site-packages 不使用系统中的site packages<br>–system-site-package 使用系统中的site packages <em>(据说是默认，但在我这默认是不使用的)</em><br>-p PYTHON_EXE, –python=PYTHON_EXE 使用指定的python解释器，这里的PYTHON_EXE在Windows下需要用绝对路径，比如C:\Python27\python.exe\</p>
</blockquote>
<p>当然，也可以使用虚拟环境和系统配置文件来设置virtualenv默认创建选项，详情见<a href="http://virtualenv-chinese-docs.readthedocs.org/en/latest/#id7" target="_blank" rel="external">这里</a>。</p>
<p>输出：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">G:\&#62;virtualenv venv&#10;New python executable in venv\Scripts\python.exe&#10;Installing setuptools, pip, wheel...done.</span><br></pre></td></tr></table></figure></p>
<h1 id="3-_进入及退出虚拟环境">3. 进入及退出虚拟环境</h1><p>进入venv目录，Linux下输入<code>bin/activate</code>, Windows下输入<code>Scripts\activate</code>进入虚拟环境。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">G:\venv&#62;Scripts\activate&#10;(venv) G:\venv&#62;</span><br></pre></td></tr></table></figure></p>
<p>进入环境后，输入<code>deactivate</code>退出。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(venv) G:\venv&#62;deactivate&#10;G:\venv&#62;</span><br></pre></td></tr></table></figure></p>
<h1 id="4-_使用虚拟环境">4. 使用虚拟环境</h1><h2 id="4-1_安装第三方模块">4.1 安装第三方模块</h2><p>安装过程与平时相符（比如使用<code>pip install</code>), 只不过安装后的包会存储在虚拟环境中。</p>
<h2 id="4-2_设置环境变量">4.2 设置环境变量</h2><p>Linux下输入<code>export VAR1=&quot;value1&quot;</code>, Windows下输入<code>set VAR1=value1</code>来设置虚拟环境的环境变量<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(venv) C:\Users\Stdio\Desktop\temp\venv&#62;set VAR1=value1&#10;&#10;(venv) C:\Users\Stdio\Desktop\temp\venv&#62;echo %VAR1%&#10;value1</span><br></pre></td></tr></table></figure></p>
<p>环境变量设置成功后，即可在Python程序中利用虚拟环境的环境变量进行程序配置（比如flask中的<code>app.config.from_envvar(&quot;FLASK_SETTINGS&quot;)</code>）。该环境变量只在虚拟环境中有效，退出虚拟环境后环境变量即消失。</p>
<h1 id="5-_参考文档">5. 参考文档</h1><ol>
<li><a href="http://virtualenv.readthedocs.org/en/latest/index.html" target="_blank" rel="external">Virtualenv - virtualenv 13.1.2 documentation</a></li>
<li><a href="http://virtualenv.readthedocs.org/en/latest/index.html" target="_blank" rel="external">Virtualenv - virtualenv 1.7.1.2.post1 documentation 中文版</a></li>
<li><a href="http://flask123.sinaapp.com/article/39/" target="_blank" rel="external">virtualenv入门教程</a></li>
<li><a href="http://www.cnblogs.com/tk091/p/3700013.html" target="_blank" rel="external">virtualenv – python虚拟沙盒</a></li>
<li><a href="http://www.nowamagic.net/academy/detail/1330228" target="_blank" rel="external">用virtualenv建立多个Python独立开发环境</a></li>
</ol>
<h1 id="6-_后记">6. 后记</h1><p>又填完一个坑，本来打算昨天就写好的，结果昨天没写完…</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>用过virtualenv的人都说好，可是我没有具体使用过，所以尝试了一下，用完我也说好~233333</p>]]>
    
    </summary>
    
      <category term="python" scheme="//blog.stdioa.com/tags/python/"/>
    
      <category term="virtualenv" scheme="//blog.stdioa.com/tags/virtualenv/"/>
    
      <category term="Python" scheme="//blog.stdioa.com/categories/Python/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Python学习之logging]]></title>
    <link href="//blog.stdioa.com/2015/10/learning-python-logging/"/>
    <id>//blog.stdioa.com/2015/10/learning-python-logging/</id>
    <published>2015-10-21T08:00:00.000Z</published>
    <updated>2015-12-20T02:22:22.025Z</updated>
    <content type="html"><![CDATA[<p>以前写代码的时候，所有信息包括调试信息全部输出在屏幕上，有的时候会看起来乱糟糟的，这时就需要logging模块来记录信息或生成日志文件。</p>
<a id="more"></a>
<h1 id="1-_简介">1. 简介</h1><p>logging是一个用来记录日志信息的模块，它可以输出信息到stdout或者自定的日志文件中。</p>
<h1 id="2-_基本">2. 基本</h1><p>输出信息：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">logging.debug(<span class="string">"A debug message"</span>)</span><br><span class="line">logging.info(<span class="string">"A info message"</span>)</span><br><span class="line">logging.warn(<span class="string">"A warning message"</span>)</span><br><span class="line">logging.error(<span class="string">"A error message"</span>)</span><br><span class="line">logging.critical(<span class="string">"A critical message"</span>)</span><br></pre></td></tr></table></figure></p>
<p>日志级别：<br>logging默认的日志级别为WARNING，在当前级别下，只有warning及以上的日志可以被记录。logging的级别可通过<code>logging.basicConfig</code>或<code>logging.setLevel</code>来修改。级别大小关系为CRITICAL(50) &gt; ERROR(40) &gt; WARNING(30) &gt; INFO(20) &gt; DEBUG(10) &gt; NOTSET(0), 需要注意的是，一旦记录信息，logging的日志级别就不可再更改。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="prompt">&gt;&gt;&gt; </span>logging.basicConfig(level=logging.INFO)</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>logging.info(<span class="string">"Info"</span>)</span><br><span class="line">INFO:root:Info</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>logging.basicConfig(level=logging.DEBUG)</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>logging.debug(<span class="string">"Debug"</span>)                      <span class="comment"># 没有输出</span></span><br></pre></td></tr></table></figure></p>
<h1 id="3-_日志格式设置及日志文件操作">3. 日志格式设置及日志文件操作</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">logging.basicConfig(format=<span class="string">"%(asctime)s %(levelname)s %(message)s"</span>,</span><br><span class="line">                        datefmt=<span class="string">"%Y %b %d %H:%M:%S"</span>,</span><br><span class="line">                        filename=<span class="string">"./log.log"</span>,</span><br><span class="line">                        filemode=<span class="string">"w"</span>,               <span class="comment"># default is "a"</span></span><br><span class="line">                        level=logging.INFO)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">        logging.log(i*<span class="number">10</span>, <span class="string">"a log"</span>)                  <span class="comment"># logging.log(level, msg)</span></span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>log.log输出(可以用tail -f命令实时查看):<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2015</span> Oct <span class="number">21</span> <span class="number">14</span>:<span class="number">41</span>:<span class="number">36</span> INFO a <span class="built_in">log</span></span><br><span class="line"><span class="number">2015</span> Oct <span class="number">21</span> <span class="number">14</span>:<span class="number">41</span>:<span class="number">37</span> WARNING a <span class="built_in">log</span></span><br><span class="line"><span class="number">2015</span> Oct <span class="number">21</span> <span class="number">14</span>:<span class="number">41</span>:<span class="number">38</span> ERROR a <span class="built_in">log</span></span><br><span class="line"><span class="number">2015</span> Oct <span class="number">21</span> <span class="number">14</span>:<span class="number">41</span>:<span class="number">41</span> CRITICAL a <span class="built_in">log</span></span><br><span class="line"><span class="number">2015</span> Oct <span class="number">21</span> <span class="number">14</span>:<span class="number">41</span>:<span class="number">42</span> INFO a <span class="built_in">log</span></span><br><span class="line"><span class="number">2015</span> Oct <span class="number">21</span> <span class="number">14</span>:<span class="number">41</span>:<span class="number">43</span> WARNING a <span class="built_in">log</span></span><br><span class="line"><span class="number">2015</span> Oct <span class="number">21</span> <span class="number">14</span>:<span class="number">41</span>:<span class="number">44</span> ERROR a <span class="built_in">log</span></span><br><span class="line"><span class="number">2015</span> Oct <span class="number">21</span> <span class="number">14</span>:<span class="number">41</span>:<span class="number">45</span> CRITICAL a <span class="built_in">log</span></span><br></pre></td></tr></table></figure></p>
<h1 id="4-_将日志输出到多个流中">4. 将日志输出到多个流中</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以通过logging.basicConfig设置一个默认流</span></span><br><span class="line"></span><br><span class="line">console = logging.StreamHandler(stream=sys.stdout)                    <span class="comment"># 默认流为sys.stderr</span></span><br><span class="line">console.setLevel(logging.INFO)</span><br><span class="line">formatter = logging.Formatter(<span class="string">'%(name)-12s: %(levelname)-8s %(message)s'</span>)</span><br><span class="line">console.setFormatter(formatter)</span><br><span class="line">logging.getLogger().addHandler(console)</span><br><span class="line"></span><br><span class="line">files = logging.FileHandler(<span class="string">"log2.log"</span>, mode=<span class="string">"a"</span>, encoding=<span class="string">"utf-8"</span>)   <span class="comment"># 设置文件流</span></span><br><span class="line">files.setLevel(logging.WARNING)</span><br><span class="line">formatter = logging.Formatter(<span class="string">"%(levelname)s %(message)s"</span>)</span><br><span class="line">files.setFormatter(formatter)</span><br><span class="line">logging.getLogger().addHandler(files)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">6</span>):</span><br><span class="line">    logging.log(i*<span class="number">10</span>, logging.getLevelName(i*<span class="number">10</span>).lower())</span><br></pre></td></tr></table></figure>
<h1 id="5-_设置多个logger以记录不同信息">5. 设置多个logger以记录不同信息</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">log1 = logging.Logger(<span class="string">"0.0"</span>)</span><br><span class="line"></span><br><span class="line">console = logging.StreamHandler(sys.stdout)                               <span class="comment"># 默认流为sys.stderr</span></span><br><span class="line">console.setLevel(logging.INFO)</span><br><span class="line">formatter = logging.Formatter(<span class="string">'%(name)-12s: %(levelname)-8s %(message)s'</span>)</span><br><span class="line">console.setFormatter(formatter)</span><br><span class="line">log1.addHandler(console)</span><br><span class="line"></span><br><span class="line">log2 = logging.Logger(<span class="string">"-.-"</span>)</span><br><span class="line"></span><br><span class="line">files = logging.FileHandler(<span class="string">"log2.log"</span>, mode=<span class="string">"a"</span>, encoding=<span class="string">"utf-8"</span>)     <span class="comment"># 设置文件流</span></span><br><span class="line">files.setLevel(logging.WARNING)</span><br><span class="line">formatter = logging.Formatter(<span class="string">"%(name)s %(levelname)s %(message)s"</span>)</span><br><span class="line">files.setFormatter(formatter)</span><br><span class="line">log2.addHandler(files)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">6</span>):</span><br><span class="line">    log1.log(i*<span class="number">10</span>, logging.getLevelName(i*<span class="number">10</span>).lower())</span><br><span class="line">    log2.log(i*<span class="number">10</span>, logging.getLevelName(i*<span class="number">10</span>).lower())</span><br><span class="line"></span><br><span class="line">logging.critical(<span class="string">"AHHH! I'm the root logger but you forget me!"</span>)        <span class="comment"># 默认使用logging时logger name为"root"</span></span><br><span class="line">logging.getLogger(<span class="string">"root"</span>).info(<span class="string">"Of course not!"</span>)</span><br></pre></td></tr></table></figure>
<h1 id="5-_参考文档">5. 参考文档</h1><ol>
<li><a href="https://docs.python.org/2.7/howto/logging.html" target="_blank" rel="external">Logging HOWTO</a></li>
<li><a href="http://www.cnblogs.com/dkblog/archive/2011/08/26/2155018.html" target="_blank" rel="external">python 的日志logging模块学习</a></li>
</ol>
<h1 id="6-_后记">6. 后记</h1><p>又填完一个坑，最近要填的坑好多…</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>以前写代码的时候，所有信息包括调试信息全部输出在屏幕上，有的时候会看起来乱糟糟的，这时就需要logging模块来记录信息或生成日志文件。</p>]]>
    
    </summary>
    
      <category term="logging" scheme="//blog.stdioa.com/tags/logging/"/>
    
      <category term="python" scheme="//blog.stdioa.com/tags/python/"/>
    
      <category term="Python" scheme="//blog.stdioa.com/categories/Python/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[随手记之Git]]></title>
    <link href="//blog.stdioa.com/2015/10/essay-git/"/>
    <id>//blog.stdioa.com/2015/10/essay-git/</id>
    <published>2015-10-14T10:28:00.000Z</published>
    <updated>2015-12-20T02:22:00.577Z</updated>
    <content type="html"><![CDATA[<p>从一年前开始使用Git, 一直没系统整理过Git的命令，前几天在部署代码的时候出了问题不知道该如何解决，于是决定整理一份Git的使用方法。本博文会持续更新。</p>
<a id="more"></a>
<h1 id="1-_什么是Git">1. 什么是Git</h1><p>Linus大神写的分布式版本控制工具，具体请访问官网<a href="http://git-scm.com" target="_blank" rel="external">http://git-scm.com</a>.<br>Wikipedia链接: <a href="https://en.wikipedia.org/wiki/Git_(software" target="_blank" rel="external">Git (software)</a>)</p>
<h1 id="2-_基本操作">2. 基本操作</h1><p>初始化版本仓库: <code>git init</code><br>从远程仓库克隆: <code>git clone [url] [repo_name]</code><br>例: <code>git clone https://github.com/user/repo my_repo</code></p>
<p><img src="/pics/lifecycle.png" alt="life-cycle"></p>
<center><small>文件的状态变化周期</small></center>

<p>检查文件状态: <code>git status</code><br>状态简览: <code>git status -s</code><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git status -s&#10; M README&#10;MM Rakefile&#10;A  lib/git.rb&#10;M  lib/simplegit.rb&#10;?? LICENSE.txt</span><br></pre></td></tr></table></figure></p>
<table>
<thead>
<tr>
<th style="text-align:left">字母</th>
<th style="text-align:center">所代表的状态</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">??</td>
<td style="text-align:center">未追踪</td>
</tr>
<tr>
<td style="text-align:left">&nbsp;&nbsp;&nbsp;M</td>
<td style="text-align:center">已修改，未暂存</td>
</tr>
<tr>
<td style="text-align:left">MM</td>
<td style="text-align:center">修改后暂存，然后又修改</td>
</tr>
<tr>
<td style="text-align:left">A</td>
<td style="text-align:center">新添加到暂存区</td>
</tr>
<tr>
<td style="text-align:left">M</td>
<td style="text-align:center">修改后添加到暂存区</td>
</tr>
</tbody>
</table>
<p>忽略文件： 编辑<code>.gitignore</code>文件。<br>文件 .gitignore 的格式规范如下：</p>
<ul>
<li>所有空行或者以 ＃ 开头的行都会被 Git 忽略。</li>
<li>可以使用标准的 glob 模式匹配。</li>
<li>匹配模式可以以（/）开头防止递归。</li>
<li>匹配模式可以以（/）结尾指定目录。</li>
<li>要忽略指定模式以外的文件或目录，可以在模式前加上惊叹号（!）取反。<br>具体例子见<a href="http://git-scm.com/book/zh/v2/Git-%E5%9F%BA%E7%A1%80-%E8%AE%B0%E5%BD%95%E6%AF%8F%E6%AC%A1%E6%9B%B4%E6%96%B0%E5%88%B0%E4%BB%93%E5%BA%93" target="_blank" rel="external">Git-基础</a>。</li>
</ul>
<p>查看尚未暂存的文件更新部分: <code>git diff</code><br>查看已暂存的文件更新的部分: <code>git diff --staged</code></p>
<p>提交更新: <code>git commit</code><br><code>git commit -a</code> = <code>git add --all; git commit</code><br>提交时输入单行信息(Commit log): <code>git commit -m</code></p>
<p>添加文件: <code>git add [filename]</code>, 使git跟踪文件<br>删除文件: <code>git rm [filename]</code>, 使git停止跟踪文件并将文件删除<br>停止跟踪文件: <code>git rm --cached</code>, 停止跟踪但不删除文件<br>移动文件: <code>git mv</code>, 规则和<code>mv</code>基本相同</p>
<p>查看提交历史: <code>git log</code><br>显示每次提交的内容差异: <code>git log -p</code><br>查看每次提交的简略统计信息: <code>git log --stat</code><br>查看每次提交的代码更改详情：<code>git log --cc</code><br>显示ASCII图形表示的分支合并历史: <code>git log --graph</code><br>粗略显示: <code>git log --oneline --graph --decorate --all</code></p>
<p>更多请输入<code>git log --help</code>查看man page.</p>
<p>更改上次提交: <code>git commit --amend</code><br>取消暂存: <code>git reset HEAD [filename]</code><br>取消暂存并丢弃现有的更改: <code>git reset HEAD --hard [filename]</code>, 未提交的更改会丢失<br>撤销对文件的更改: <code>git checkout -- [filename]</code>, 未提交的更改会丢失</p>
<p><code>git push origin --delete [branch]</code>, 删除远程分支</p>
<h1 id="3-_分支操作">3. 分支操作</h1><p><code>git branch [branch]</code>, 在当前引用上建立新分支<br><code>git checkout -b [branch]</code>, 建立新分支并检出到该分支上</p>
<p>commit引用方式:  </p>
<ul>
<li>直接hash引用: <code>d921970aadf03b3cf0e71becdaab3147ba71cdef</code>, <code>d921970</code></li>
<li>分支引用: <code>HEAD</code>, <code>master</code></li>
<li>相对引用: <code>HEAD^</code>, <code>HEAD^^</code>, <code>HEAD~2</code></li>
<li>若<code>a</code>是一个合并提交，有两个父引用，则<code>a^</code>为a的第一父引用，<code>a^2</code>为a的第二父引用。</li>
<li>条件引用: <code>master@{yesterday}</code>, <code>master@{1.week.before}</code></li>
<li><p>引用区间: </p>
<ul>
<li><p><code>refA..refB</code>选择从refA和refB的共同祖先开始直到refB的所有提交。例:  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">若 <span class="number">1</span> - <span class="number">2</span> - <span class="number">3</span> - <span class="number">4</span> ← refA</span><br><span class="line">         \ <span class="number">5</span> - <span class="number">6</span> ← refB</span><br><span class="line">refA..refB 即为<span class="number">6</span> <span class="number">5</span>, refB..refA 即为<span class="number">4</span> <span class="number">3.</span></span><br><span class="line">origin/master..master为master分支上还未提交到远端的所有引用</span><br></pre></td></tr></table></figure>
</li>
<li><p>区间筛选，例：以下三条命令等价：<br>  <code>$ git log refA..refB</code><br>  <code>$ git log ^refA refB</code><br>  <code>$ git log refB --not refA</code></p>
</li>
<li><code>refA...refB</code>选择出被两个引用中的一个包含但又不被两者同时包含的提交，即<code>refA..refB</code>+<code>refB..refA</code><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --left-to-right refA...refB</span><br><span class="line">&lt; <span class="number">4</span></span><br><span class="line">&lt; <span class="number">3</span></span><br><span class="line">&gt; <span class="number">6</span></span><br><span class="line">&gt; <span class="number">5</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h1 id="4-_工作储藏">4. 工作储藏</h1><p><code>git stash &quot;comments&quot;</code>, 储藏所有工作，包括已添加的和已更改未添加的<br><code>git stash apply stash@{0}</code>, 恢复储藏，可能会产生冲突，解决冲突后<code>git add</code>添加<br><code>git stash list</code>, 列出储藏栈<br><code>git stash show [stashname]</code>, 查看储藏的更改<br><code>git stash pop</code>, 应用栈顶储藏并弹出储藏<br><code>git stash drop [stashname]</code>, 删除储藏<br><code>git stash branch [branchname]</code>, 应用储藏到某分支并切换到该分支<br><code>git stash --keep-index</code>, 只储藏已更改未添加的改动，不储藏 已添加的<br><code>git stash --include-untracked</code>, 储藏未追踪的文件（未追踪文件）并将其从工作目录中删除<br><code>git stash --all</code>, 贮藏所有文件</p>
<h1 id="5-_git_reset">5. git reset</h1><p><code>git reset --soft HEAD^</code>, 将HEAD指针及当前分支指针指向HEAD^, 工作目录中所有的文件均添加暂存(staged), 类似“撤销<code>git commit</code>命令”，但如果重新提交，会创造一个hash不同的commit，即时提交内容完全相同。<br><code>git reset --mixed HEAD^</code>, 将HEAD指针及当前分支指针指向HEAD^, 工作目录中的更改未暂存(modified but not staged), 类似“撤销<code>git add</code>和<code>git commit</code>命令”<br><code>git reset --hard HEAD^</code>, 将HEAD指针及当前分支指针指向HEAD^, 工作目录中的更改完全丢失，相当于“撤销更改, <code>git add</code>和<code>git commit</code>”.</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>从一年前开始使用Git, 一直没系统整理过Git的命令，前几天在部署代码的时候出了问题不知道该如何解决，于是决定整理一份Git的使用方法。本博文会持续更新。</p>]]>
    
    </summary>
    
      <category term="Git" scheme="//blog.stdioa.com/tags/Git/"/>
    
      <category term="编程工具" scheme="//blog.stdioa.com/tags/%E7%BC%96%E7%A8%8B%E5%B7%A5%E5%85%B7/"/>
    
      <category term="随手记" scheme="//blog.stdioa.com/categories/%E9%9A%8F%E6%89%8B%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[随手记 - 用国内镜像加速pip]]></title>
    <link href="//blog.stdioa.com/2015/09/essay-pip-acceleration/"/>
    <id>//blog.stdioa.com/2015/09/essay-pip-acceleration/</id>
    <published>2015-09-29T15:01:00.000Z</published>
    <updated>2015-12-20T02:21:47.485Z</updated>
    <content type="html"><![CDATA[<p>原来Windows和Linux更改镜像源的方式是不一样的啊。</p>
<a id="more"></a>
<h1 id="1-_引子">1. 引子</h1><p>偶然发现USTC有一个pypi的源(<a href="http://mirrors.ustc.edu.cn/pypi/" target="_blank" rel="external">在这里</a>)，照着USTC给的<a href="https://lug.ustc.edu.cn/wiki/mirrors/help/pypi" target="_blank" rel="external">镜像使用帮助</a>更改镜像源无果。今天闲来无事就多搜了一下。</p>
<h1 id="2-_过程">2. 过程</h1><p>USTC的镜像使用帮助里说，将<code>index-url = https://pypi.mirrors.ustc.edu.cn/simple</code>添加到<code>~/.pip/pip.conf</code>文件中，按照此思路看，如果我在Windows下使用的话，应该将配置信息添加到<code>C:\Users\Stdio\.pip\pip.conf</code>文件中。然而添加后并没有什么卵用。今天看见一个<a href="http://blog.csdn.net/sasoritattoo/article/details/10020547" target="_blank" rel="external">博文</a>说文件设置路径应为<code>%HOME%\pip\pip.ini</code>，于是试了一下（绝对路径为<code>C:\Users\Stdio\pip\pip.ini</code>），成功。用了USTC的源，装个软件速度简直飞起︿(￣︶￣)︿<br>弄好以后多了个心眼，去看看官方怎么说，于是找到了pip的Documentation（<a href="https://pip.pypa.io/en/stable/user_guide/#configuration" target="_blank" rel="external">在这里</a>）里面讲述了配置文件所在位置。</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Config file</span><br><span class="line">pip allows you to set all command line option defaults in a standard ini style config file.</span><br><span class="line"></span><br><span class="line">The names and locations of the configuration files vary slightly across platforms. You may have per-user, per-virtualenv or site-wide (shared amongst all users) configuration:</span><br><span class="line"></span><br><span class="line">Per-user:</span><br><span class="line"></span><br><span class="line">On Unix the default configuration file is: $HOME/.config/pip/pip.conf which respects the XDG<span class="emphasis">_CONFIG_</span>HOME environment variable.</span><br><span class="line">On Mac OS X the configuration file is $HOME/Library/Application Support/pip/pip.conf.</span><br><span class="line">On Windows the configuration file is %APPDATA%\pip\pip.ini.</span><br><span class="line">There are also a legacy per-user configuration file which is also respected, these are located at:</span><br><span class="line"></span><br><span class="line">On Unix and Mac OS X the configuration file is: $HOME/.pip/pip.conf</span><br><span class="line">On Windows the configuration file is: %HOME%\pip\pip.ini</span><br><span class="line">You can set a custom path location for this config file using the environment variable PIP<span class="emphasis">_CONFIG_</span>FILE.</span><br><span class="line"></span><br><span class="line">Inside a virtualenv:</span><br><span class="line"></span><br><span class="line">On Unix and Mac OS X the file is $VIRTUAL_ENV/pip.conf</span><br><span class="line">On Windows the file is: %VIRTUAL_ENV%\pip.ini</span><br></pre></td></tr></table></figure>
<p>于是自己将配置文件放在了<code>%APPDATA%\pip\pip.ini</code>，即<code>C:\Users\Stdio\AppData\Roaming\pip\pip.ini</code>下，经实验，加速成功。<br>经测试，系统层面的全局设置会影响到virtualenv建立的虚拟环境设置，所以可以通过设置虚拟环境的配置文件来更改虚拟环境设置，设置文件就放在虚拟环境根目录下就好了。</p>
<h1 id="3-_瞎写">3. 瞎写</h1><p>改了软件源以后为了做测试升级了numpy，然后编译用了半天中间电脑卡到死，现在它还在我的腿上发烫真是伤不起- -<br>写的东西越来越没有营养了，就当是写着玩顺带积累一下知识吧。如果不出意外的话，下一篇应该是关于Python Qt Creater和Qt GUI设计的小文章0.0也许是virtualenv的随手记吧。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>原来Windows和Linux更改镜像源的方式是不一样的啊。</p>]]>
    
    </summary>
    
      <category term="pip" scheme="//blog.stdioa.com/tags/pip/"/>
    
      <category term="python" scheme="//blog.stdioa.com/tags/python/"/>
    
      <category term="随手记" scheme="//blog.stdioa.com/categories/%E9%9A%8F%E6%89%8B%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[点点技能点之Ajax]]></title>
    <link href="//blog.stdioa.com/2015/09/essay-ajax/"/>
    <id>//blog.stdioa.com/2015/09/essay-ajax/</id>
    <published>2015-09-22T13:07:00.000Z</published>
    <updated>2015-12-20T02:21:41.907Z</updated>
    <content type="html"><![CDATA[<p>之前自己没怎么写过前端，一直以为Ajax写起来很麻烦，也没怎么接触Ajax，今天写了个小网页用到了Ajax，感觉它并不是想象的那么复杂，写完网页随手总结一下。（喂我这个技能点是不是点的太晚了啊！）</p>
<a id="more"></a>
<h1 id="1-_引子">1. 引子</h1><p>没啥可写的…</p>
<h1 id="2-_科普">2. 科普</h1><p><a href="http://www.w3school.com.cn/ajax/index.asp" target="_blank" rel="external">W3School - Ajax教程</a>，就这个吧，科普完毕。</p>
<h1 id="3-_笔记">3. 笔记</h1><h2 id="3-1_Ajax的特点">3.1 Ajax的特点</h2><p>Ajax为Asynchronous Javascript And XML的缩写，即异步JS与XML，因为它具有异步特性，所以我们可以在网页加载中或加载结束的任意时刻使用，通过与服务器进行少量数据交换来实现网页异步更新。利用Ajax可以直接更改网页的一部分来动态刷新网页，而不需要刷新整个网页。</p>
<h2 id="3-2_使用方法——原生方式">3.2 使用方法——原生方式</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ajax = <span class="keyword">new</span> XMLHttpRequest();                  <span class="comment">// IE6不能用这个方式，不管它了</span></span><br><span class="line">ajax.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(ajax.readyState==<span class="number">4</span> &amp;&amp; ajax.status==<span class="number">200</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// do something with ajax.responseText</span></span><br><span class="line">        <span class="comment">// 还有一个ajax.responseXML, 也不管它了，json大法好</span></span><br><span class="line">        alert(ajax.responseText);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">ajax.open(<span class="string">"GET"</span>, <span class="string">"./get?var1=val1&amp;var2=val2"</span>, <span class="literal">true</span>);     <span class="comment">// 异步方式运行</span></span><br><span class="line">ajax.send();</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ajax = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">ajax.open(<span class="string">"POST"</span>, <span class="string">"./post"</span>, <span class="literal">false</span>);                      <span class="comment">// 同步方式运行</span></span><br><span class="line">ajax.setRequestHeader(<span class="string">"Content-type"</span>,<span class="string">"application/x-www-form-urlencoded"</span>);</span><br><span class="line">ajax.send(<span class="string">"var1=val1&amp;var2=val2"</span>);</span><br><span class="line"><span class="comment">// do something with ajax.responseText</span></span><br><span class="line">alert(ajax.responseText);</span><br></pre></td></tr></table></figure>
<h2 id="3-3_原生的好麻烦！——jQuery_Ajax">3.3 原生的好麻烦！——jQuery Ajax</h2><p><a href="http://jquery.com/" target="_blank" rel="external">jQuery</a>，棒棒的前端库，不多说。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// $.get(URL, callback)</span></span><br><span class="line">$.get(<span class="string">"./get?var1=val1&amp;var2=val2"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data, status</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// do something with data &amp; status</span></span><br><span class="line">    &#125;);</span><br><span class="line"><span class="comment">// $.post(URL,data,callback)</span></span><br><span class="line">$.post(<span class="string">"./post"</span>, &#123;</span><br><span class="line">        var1: <span class="string">"val1"</span>,</span><br><span class="line">        var2: <span class="string">"val2"</span></span><br><span class="line">    &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">data, status</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// do something with data &amp; status</span></span><br><span class="line">    &#125;);</span><br><span class="line"><span class="comment">// $.getJSON(url, data, success(data,status,xhr))</span></span><br><span class="line"><span class="comment">// data和回调函数success可选</span></span><br><span class="line"><span class="comment">// success中，data参数必需，其它可选</span></span><br><span class="line">$.getJSON(<span class="string">"./get"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// do something with data</span></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></p>
<h1 id="4-_附带的小零碎">4. 附带的小零碎</h1><p><code>window.setInterval(getData, time);</code>用于实现轮询。</p>
<h1 id="5-_总结_&amp;_后记">5. 总结 &amp; 后记</h1><p>Ajax简单实用功能强大应用广泛，通过简单的步骤实现前后端的数据交换，来实现网页的动态加载。<br>开学到现在感觉一直不在状态（实在是想吐槽自己的一群神一样的舍友），今天找了个安静的、没人打扰的地方认认真真写了写代码，总结了一下自己到现在所学的知识才发现自己学的东西是如此零散、不成体系，仿佛从大一开始就在乱点技能点。这一年要多深入学习一个特定方面的知识（暂定后端开发），多写代码积累经验，不能再东学一点西学一点了。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>之前自己没怎么写过前端，一直以为Ajax写起来很麻烦，也没怎么接触Ajax，今天写了个小网页用到了Ajax，感觉它并不是想象的那么复杂，写完网页随手总结一下。（喂我这个技能点是不是点的太晚了啊！）</p>]]>
    
    </summary>
    
      <category term="Ajax" scheme="//blog.stdioa.com/tags/Ajax/"/>
    
      <category term="前端开发" scheme="//blog.stdioa.com/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
      <category term="网络" scheme="//blog.stdioa.com/categories/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[在Windows中使用Wget]]></title>
    <link href="//blog.stdioa.com/2015/09/using-wget-in-Windows/"/>
    <id>//blog.stdioa.com/2015/09/using-wget-in-Windows/</id>
    <published>2015-09-18T12:07:00.000Z</published>
    <updated>2015-12-20T02:21:22.500Z</updated>
    <content type="html"><![CDATA[<p>一直心心念念想在Windows里用wget，今天随便搞了搞，在Windows里面用上了wget，终于可以下载一些乱七八糟的小文件辣。</p>
<a id="more"></a>
<h1 id="1-_引子">1. 引子</h1><p>一直觉得Windows里面应该有一个类似wget的工具。今天想从github上下一个文件，结果文件直接以文本方式返回了(响应头的Content-Type为text/plain而不是application神马的)，自己很怨念，觉得要是Windows能像linux一样有个用来wget神马的下载文件的命令就好了…所以自己上网搜了一下，让自己用上了wget.</p>
<h1 id="2-_乱搞">2. 乱搞</h1><p>随便百度，找到一篇博文，又找到了一个叫做GnuWin(<a href="http://sourceforge.net/projects/gnuwin32/" target="_blank" rel="external">http://sourceforge.net/projects/gnuwin32/</a>)的项目，该项目主要提供Windows下的GNU工具，比如sed, grep, wget等等。于是下载安装，安装程序默认将程序安装在了C:\Program Files (x86)\GnuWin32\bin目录下。然而即使这样，我还是无法直接在命令行里使用。</p>
<p>Windows中有一个“PATH环境变量”，将某目录（比如C:\Python27）添加进PATH环境变量中，就可以直接在命令行中输入命令打开该目录下的文件。如果想在命令行中使用wget的话，把C:\Program Files (x86)\GnuWin32\bin目录添加进PATH变量中当然可行。但是这样的话，随着工具越来越多，PATH变量里面的路径也就越来越多，维护起来也会更加困难，所以自己使用了一种特殊的方法：在C盘的目录下建了一个Command_line_programs文件夹用来放一些自己常用的命令行工具（比如sqlite），然后将C:\Command_line_programs（以下简称C.L.P.）添加到PATH变量中，这样自己就能使用C.L.P.文件夹中的工具。可是，自己已经将程序安装到Program Files里了，所以需要想个办法在C.L.P.文件中新建一个文件来连接到wget程序。<em>经过尝试，使用快捷方式的方法失败了。</em>所以自己想到了<strong>新建批处理文件</strong>。于是在C.L.P.文件夹中新建wget.bat, 内容为<code>C:\&quot;Program Files (x86)&quot;\GnuWin32\bin\wget.exe %*</code> （<code>%*</code>表示在命令中嵌入程序所有参数，详情请百度或Google Windows批处理编程），保存，在命令行中尝试使用wget，成功。</p>
<h1 id="3-_然而这并没有什么卵用啊！">3. 然而这并没有什么卵用啊！</h1><p>自己搞完以后，盯着GnuWin这几个字，突然想到了git里面自带了很多GNU工具可以直接使用，于是就去git/bin的目录翻了翻，果然，里面没有wget，然而我看到了curl。然后…就没有然后了。<img src="/pics/hands_up_crying.jpg" alt=""></p>
<h1 id="4-_后记">4. 后记</h1><p>这篇文章是胡乱凑数的，最近学习兴趣不高，又有一堆乱七八糟的事情要忙，所以托更了好久T^T<br>好了好了要好好学习，说好了多去体验框架呢QAQ</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>一直心心念念想在Windows里用wget，今天随便搞了搞，在Windows里面用上了wget，终于可以下载一些乱七八糟的小文件辣。</p>]]>
    
    </summary>
    
      <category term="Windows" scheme="//blog.stdioa.com/tags/Windows/"/>
    
      <category term="wget" scheme="//blog.stdioa.com/tags/wget/"/>
    
      <category term="乱七八糟" scheme="//blog.stdioa.com/categories/%E4%B9%B1%E4%B8%83%E5%85%AB%E7%B3%9F/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[搭建私有KMS服务器]]></title>
    <link href="//blog.stdioa.com/2015/09/building-a-private-kms-server/"/>
    <id>//blog.stdioa.com/2015/09/building-a-private-kms-server/</id>
    <published>2015-09-02T14:26:00.000Z</published>
    <updated>2015-12-20T02:21:36.423Z</updated>
    <content type="html"><![CDATA[<p>最近win10又频繁提示“许可即将过期”，之前找到的kms服务器又挂掉了，于是就决定自己搭一个自己用。</p>
<a id="more"></a>
<h1 id="1-_引子">1. 引子</h1><p>好久没更新日志了，暑假在家每天过的乱七八糟，就没怎么研究技术，于是博客也没怎么更新…今天随便写点什么凑个数_(:зゝ∠)_</p>
<h1 id="2-_科普">2. 科普</h1><p>KMS (Key Management Service), 密钥管理服务，是一种对Windows及Office产品进行批量授权的服务，通常被部署在大型企业局域网中，用于对批量授权版（即VOL版）Windows系统进行大批量的激活。KMS服务器的作用是给局域网中的所有计算机的操作系统提供一个有效的产品序列号，然后计算机里面的KMS服务就会自动将系统激活。每一个由KMS Server提供的序列号的有效期只有180天，而不是其他版本的永久使用一个序列号。所以操作者必须在快到期的时候在此手动连接KMS服务器让它提供一个新的序列号，否则180天以后就会回到试用版本状态。由于KMS系统部署较为容易，所以在国内很多人通过MSDN等渠道下载VOL版本的软件，然后通过KMS服务进行激活，已达到盗版的目的。</p>
<h1 id="3-_搭(luan)建(gao)过程">3. 搭(luan)建(gao)过程</h1><p>昨天在满大街乱找野生KMS服务器的时候发现了一个帖子：<a href="http://wrlog.com/activate-kms-vlmcsd.html" target="_blank" rel="external">使用KMS激活windows系统及VL-office系列</a>, 里面提供了一个<a href="http://forums.mydigitallife.info/threads/50234-Emulated-KMS-Servers-on-non-Windows-platforms" target="_blank" rel="external">链接</a>指向一个帖子，帖子中提供了Python和C版本的KMS服务器模拟器，可以在自己的服务器中进行KMS服务器部署。于是把代码搞了下来（为此还注册了个账号, python版的代码在<a href="https://mega.co.nz/#F!6pIGEbhQ!DE2twA7dVG5C4knjAq56zQ" target="_blank" rel="external">这里</a>)，用VSFTP将代码传到了自己的树莓派上，然后运行<code>python server.py</code>进行部署。</p>
<pre><code>python server.py
TCP server listening at <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> on port <span class="number">1688.</span>
</code></pre><p>然后在Windows系统中打开具有管理员权限的命令提示符，输入<code>slmgr -skms 192.168.155.2:1688</code>设置KMS服务器地址（地址可以更换），然后输入`slmgr -ato’进行系统激活，此时服务器端显示：</p>
<pre><code>Connection accepted: <span class="number">192.168</span><span class="number">.56</span><span class="number">.1</span>:<span class="number">13023</span>
Received V6 request on Wed Sep  <span class="number">2</span> <span class="number">22</span>:<span class="number">59</span>:<span class="number">55</span> <span class="number">2015.</span>
Connection closed: <span class="number">192.168</span><span class="number">.56</span><span class="number">.1</span>:<span class="number">13023</span>
</code></pre><p>Windows系统提示“成功地激活了产品”，激活成功。</p>
<p>在树莓派上部署成功以后，随手在VPS上部署了一份以备用。帖子中提了一种设置Linux系统启动项来使KMS服务器开机自动部署的方法，不过自己没有这个需求就没搞。</p>
<h1 id="4-_总结">4. 总结</h1><p>这篇文章好像有点水，主要是因为自己实在没什么东西写了…自己的暑假过的乱七八糟，浪费了很多时间在游戏上，没什么心情研究技术。现在开学了，有更多时间来钻研技术了，收收心找找状态，以后博客会定期更新的，我对树莓派电源灯发誓→_→</p>
<h1 id="5-_各种Key">5. 各种Key</h1><p>最后附上Office 2016和Windows 10的VOL版激活码，其它版本软件激活码请自行百度。</p>
<blockquote>
<p>Office Professional Plus 2016 - XQNVK-8JYDB-WJ9W3-YJ8YR-WFG99<br>Office Standard 2016 - JNRGM-WHDWX-FJJG3-K47QV-DRTFM<br>Project Professional 2016 - YG9NW-3K39V-2T3HJ-93F3Q-G83KT<br>Project Standard 2016 - GNFHQ-F6YQM-KQDGJ-327XX-KQBVC<br>Visio Professional 2016 - PD3PC-RHNGV-FXJ29-8JK7D-RJRJK<br>Visio Standard 2016 - 7WHWN-4T7MP-G96JF-G33KR-W8GF4<br>Access 2016 - GNH9Y-D2J4T-FJHGG-QRVH7-QPFDW<br>Excel 2016 - 9C2PK-NWTVB-JMPW8-BFT28-7FTBF<br>OneNote 2016 - DR92N-9HTF2-97XKM-XW2WJ-XW3J6<br>Outlook 2016 - R69KK-NTPKF-7M3Q4-QYBHW-6MT9B<br>PowerPoint 2016 - J7MQP-HNJ4Y-WJ7YM-PFYGF-BY6C6<br>Publisher 2016 - F47MM-N3XJP-TQXJ9-BP99D-8K837<br>Skype for Business 2016 - 869NQ-FJ69K-466HW-QYCP2-DDBV6<br>Word 2016 - WXY84-JN2Q9-RBCCQ-3Q3J3-3PFJ6</p>
<p>Windows 10 Home - TX9XD-98N7V-6WMQ6-BX7FG-H8Q99<br>Windows 10 Home N - 3KHY7-WNT83-DGQKR-F7HPR-844BM<br>Windows 10 Home Single Language - 7HNRX-D7KGG-3K4RQ-4WPJ4-YTDFH<br>Windows 10 Home Country Specific - PVMJN-6DFY6-9CCP6-7BKTT-D3WVR<br>Windows 10 Professional - W269N-WFGWX-YVC9B-4J6C9-T83GX<br>Windows 10 Professional N - MH37W-N47XK-V7XM9-C7227-GCQG9<br>Windows 10 Education - NW6C2-QMPVW-D7KKK-3GKT6-VCFB2<br>Windows 10 Education N - 2WH4N-8QGBV-H22JP-CT43Q-MDWWJ<br>Windows 10 Enterprise - NPPR9-FWDCX-D2C8J-H872K-2YT43<br>Windows 10 Enterprise N - DPH2V-TTNVB-4X9Q3-TJR4H-KHJW4<br>Windows 10 Enterprise 2015 LTSB - WNMTR-4C88C-JK8YV-HQ7T2-76DF9<br>Windows 10 Enterprise 2015 LTSB N - 2F77B-TNFGY-69QQF-B8YKP-D69TJ</p>
</blockquote>
<p><em>可以考虑有空搞一个Office 2016来玩玩。</em></p>
<h1 id="6-_参考文档">6. 参考文档</h1><ol>
<li><a href="http://www.baike.com/wiki/KMS" target="_blank" rel="external">KMS - 互动百科</a></li>
<li><a href="http://wrlog.com/activate-kms-vlmcsd.html" target="_blank" rel="external">使用KMS激活windows系统及VL-office系列</a></li>
<li><a href="http://forums.mydigitallife.info/threads/50234-Emulated-KMS-Servers-on-non-Windows-platforms" target="_blank" rel="external">Emulated KMS Servers on non-Windows platforms</a></li>
</ol>
]]></content>
    <summary type="html">
    <![CDATA[<p>最近win10又频繁提示“许可即将过期”，之前找到的kms服务器又挂掉了，于是就决定自己搭一个自己用。</p>]]>
    
    </summary>
    
      <category term="KMS" scheme="//blog.stdioa.com/tags/KMS/"/>
    
      <category term="乱七八糟" scheme="//blog.stdioa.com/categories/%E4%B9%B1%E4%B8%83%E5%85%AB%E7%B3%9F/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[LAMP环境搭建心得]]></title>
    <link href="//blog.stdioa.com/2015/07/deploy-a-LAMP-environment/"/>
    <id>//blog.stdioa.com/2015/07/deploy-a-LAMP-environment/</id>
    <published>2015-07-09T12:05:00.000Z</published>
    <updated>2015-12-20T02:22:04.402Z</updated>
    <content type="html"><![CDATA[<p>闲来无事，在虚拟机上搭了一个LAMP服务器环境，把安装及配置过程记了下来。</p>
<a id="more"></a>
<h2 id="1-_引子">1. 引子</h2><h3 id="1-1_环境版本">1.1 环境版本</h3><p>此次搭建的LAMP环境版本：</p>
<ul>
<li>Ubuntu 14.04 LTS</li>
<li>Apache 2.4.7</li>
<li>mysql 5.6.19</li>
<li>php 5.5.9</li>
</ul>
<h3 id="1-2_写(hu)在(che)开(yi)头(tong)">1.2 写(hu)在(che)开(yi)头(tong)</h3><p>额…其实没什么好说的，自己一直想自己动手搭建、配置一个服务器，暑假之前师太（别问是谁）说如果要搞安全的话最好先自己从头搭一个服务器，把各种服务弄清楚，对整个架构有一个系统的理解，这样再深入搞安全的话接受一些观念也会更快更容易；但是因为自己太懒，再加上上学期忙成狗（其实还是太懒），一直没有去做这件事。暑假在一个小公司做软件测试，每天好像也没什么事干，有大把的时间做自己的事情，于是自己用了一中午加半个下午的时间照着一份<a href="http://segmentfault.com/q/1010000002397754" target="_blank" rel="external">指南</a>把它搭好了。 <em>不过话说回来，软件测试真的很无聊</em>_(:зゝ∠)_</p>
<hr>
<h2 id="2-_科普">2. 科普</h2><p><a href="https://zh.wikipedia.org/wiki/LAMP" target="_blank" rel="external">LAMP</a>: <a href="https://zh.wikipedia.org/wiki/Linux" target="_blank" rel="external">Linux</a> + <a href="https://zh.wikipedia.org/wiki/Apache_HTTP_Server" target="_blank" rel="external">Apache</a> + <a href="https://zh.wikipedia.org/wiki/MySQL" target="_blank" rel="external">Mysql</a> + <a href="https://zh.wikipedia.org/wiki/PHP" target="_blank" rel="external">PHP</a><br>科普结束。<br>刚看到LAMP里面的P还能指Python 0.0</p>
<hr>
<h2 id="3-_搭建过程">3. 搭建过程</h2><h3 id="3-1_安装">3.1 安装</h3><ol>
<li><p>Linux<br>我手上现在没实体机了，只有一个树莓派，我也不想每天带着它去上班，何况AMD架构上面软件好像少一点点，更何况树莓派性能挺差的（此处省略一坨借口），所以我只用Virtual Box装了一个虚拟机。<br>说到Linux，选一个用起来比较舒服的的发行版还是挺重要的。Linux发行版众多，一般用Red Hat或者CentOS（RH的社区版）或者Ubuntu Server来做服务器，不过…这学期用Debian系发行版用习惯了，再换到RH系的感觉有点不适应，于是我选择了Ubuntu Server. 当然，如果你想锻炼一下，推荐使用Arch Linux来搭建服务器。<br>下载Linux镜像，搭虚拟机，配置虚拟网络&amp;SSH，更改软件源，更新软件，配置自己需要的vim &amp; tmux &amp; vsftpd，不多说，想详细了解的可以去看某Linux虚拟机安装及配置指南（代号<a href="http://cslab.nju.edu.cn/ics/index.php/Ics:2013/PA0" target="_blank" rel="external">PA0</a>）。上学期装Linux装了绝不下10遍，再说下去自己都要吐了。<br>不过值得一提的是，Ubuntu Server安装程序的用户体验简直棒，安装过程中有一步是设置键盘布局，以前都要自己去一个长长的列表里翻自己的键盘布局（通常是US），而Ubuntu Server提供了一个小脚本来进行自动检测：依照提示敲几个字母/符号，再回答一个问题，安装程序会自动检测出适合你的键盘布局。</p>
</li>
<li><p>Apache<br>输入<code>apt-get install apache2</code>命令安装apache.<br>安装过程中apache服务已经启动，如果未启动，则输入<code>service apache2 start</code>启动apache服务。<br>启动后访问服务器ip，会出现apache的测试页面。<br><img src="/pics/apache.jpg" alt=""></p>
</li>
<li><p>MySQL<br>输入<code>apt-get install mysql-server-5.6 mysql-client-5.6</code>进行安装。<br>安装过程中需要输入MySQL root密码。 </p>
</li>
<li><p>PHP<br>输入<code>apt-get install php5 libapache2-mod-php5</code>安装php, 安装过后需要输入<code>service apache2 restart</code>重启apache服务。</p>
</li>
</ol>
<h3 id="3-2_配置">3.2 配置</h3><ol>
<li><p>安装phpMyAdmin<br>输入<code>apt-get install phpmyadmin</code>进行安装，安装的时候会提示输入mysql的root密码，并且提示新建一个数据库，当然也可以按需求不新建。<br>安装好以后访问<a href="http://localhost/phpmyadmin/index.php" target="_blank" rel="external">http://localhost/phpmyadmin/index.php</a> ，登录之后页面下方会有警告“缺少 mcrypt 扩展。请检查 PHP 配置。”此时按照指南的方法做没有效果，经百度+Google后找到了解决方案：安装php5-mcrypt后，更改php.ini后问题未解决，根据<a href="http://php.net/manual/en/mcrypt.setup.php" target="_blank" rel="external">官方的mcrypt安装指南</a>，输入<code>php5enmod mcrypt</code>后，问题解决。</p>
</li>
<li><p>MySQL命令行无法启动<br>注：这段是自己瞎折腾的，啥都没看就乱玩遇到的问题。<br>输入mysql后遇到问题：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  ~  mysql</span><br><span class="line">ERROR <span class="number">1045</span> (<span class="number">28000</span>): Access denied <span class="keyword">for</span> user <span class="string">'stdio'</span>@<span class="string">'localhost'</span> (<span class="keyword">using</span> password: NO)</span><br></pre></td></tr></table></figure>
<p>尝试用root权限运行，得到同样的结果。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  ~  sudo mysql</span><br><span class="line">ERROR <span class="number">1045</span> (<span class="number">28000</span>): Access denied <span class="keyword">for</span> user <span class="string">'root'</span>@<span class="string">'localhost'</span> (<span class="keyword">using</span> password: NO)</span><br></pre></td></tr></table></figure>
<p>一番百度+google+SegmentFault后，找到正确进入命令行的姿势：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">➜  ~  sudo mysql -u root -p</span><br><span class="line">Enter password:</span><br><span class="line">Welcome to the MySQ<span class="class">L monitor.  Commands end with ;</span><span class="instruction"> or </span>\g.</span><br><span class="line">Your MySQL connection id is 55</span><br><span class="line">Server version: 5.6.19-0ubuntu0.14.04.1<span class="function"> (</span>Ubuntu<span class="function">)</span></span><br><span class="line"></span><br><span class="line">Copyright<span class="function"> (</span>c<span class="function">)</span> 2000, 2014, Oracle<span class="instruction"> and/or </span>its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation<span class="instruction"> and/or </span>its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type 'help;'<span class="instruction"> or </span>'\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置Apache虚拟目录<br>把所有文件全部放在/var/www下真的好麻烦，何况普通账户没有/var/www的写权限，所以设置一个alias，将某个Apache虚拟目录映射到home目录下，以后操作起来就会方便很多。<br>修改/etc/apache2/mods-enabled/alias.conf文件，添加如下行，然后重启Apache服务：</p>
 <figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Alias /web <span class="string">"/home/stdio/websites/"</span></span><br><span class="line"></span><br><span class="line">&lt;<span class="keyword">Directory</span> <span class="string">"/home/stdio/websites/"</span>&gt;</span><br><span class="line">    <span class="keyword">Options</span> <span class="keyword">None</span> </span><br><span class="line">    AllowOverride <span class="keyword">None</span></span><br><span class="line">    <span class="keyword">Order</span> allow,deny</span><br><span class="line">    Allow from all</span><br><span class="line">&lt;/<span class="keyword">Directory</span>&gt;</span><br></pre></td></tr></table></figure>
<p> 然而在我访问<a href="http://localhost/web时，却得到了503" target="_blank" rel="external">http://localhost/web时，却得到了503</a> Forbidden的状态码，各种乱访问无果，于是在网上乱搜解决方案，有让改httpd的（httpd跟Apache有啥关系），有改alias配置的（我的alias配置的没有问题啊），最后看到了一个方案，查看apache2.conf的目录权限配置。<br> 修改/etc/apache2/apache2.conf文件，发现以下设置：</p>
 <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;Directory /&gt;</span></span><br><span class="line">    <span class="keyword"><span class="common">Options</span></span> FollowSymLinks</span><br><span class="line">    <span class="keyword">AllowOverride</span> None</span><br><span class="line">    <span class="keyword">Require</span> <span class="literal">all</span> denied</span><br><span class="line"><span class="tag">&lt;/Directory&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;Directory /usr/share&gt;</span></span><br><span class="line">    <span class="keyword">AllowOverride</span> None</span><br><span class="line">    <span class="keyword">Require</span> <span class="literal">all</span> granted</span><br><span class="line"><span class="tag">&lt;/Directory&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;Directory /var/www/&gt;</span></span><br><span class="line">    <span class="keyword"><span class="common">Options</span></span> Indexes FollowSymLinks</span><br><span class="line">    <span class="keyword">AllowOverride</span> None</span><br><span class="line">    <span class="keyword">Require</span> <span class="literal">all</span> granted</span><br><span class="line"><span class="tag">&lt;/Directory&gt;</span></span><br></pre></td></tr></table></figure>
<p> 因为Apache的默认配置是不能访问/的，所以我没有对~/websites的访问权限（这里逻辑好混乱）。添加配置：</p>
 <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;Directory /home/stdio/websites&gt;</span></span><br><span class="line">    <span class="keyword"><span class="common">Options</span></span> FollowSymLinks</span><br><span class="line">    <span class="keyword">AllowOverride</span> None</span><br><span class="line">    <span class="keyword">Require</span> <span class="literal">all</span> granted</span><br><span class="line"><span class="tag">&lt;/Directory&gt;</span></span><br></pre></td></tr></table></figure>
<p> 重启Apache服务，<a href="http://localhost/web目录下的文件均可正常访问。" target="_blank" rel="external">http://localhost/web目录下的文件均可正常访问。</a></p>
</li>
</ol>
<hr>
<h2 id="4-_乱搞">4. 乱搞</h2><p>去年开学的时候用php写过一个小的文件浏览器（就像Apache自带的文件服务器那样的），闲得无聊想把它部署到自己刚搭好的服务器上，看看能不能正常运行，于是就把文件传到服务器上访问，<strong>不出意外，失败了</strong>。然后就找呀找呀找bug，找到一个小bug（请自动脑补背景音乐），找了半个点最后发现，在从配置文档读取根目录路径的时候，会在目录结尾加一个空格（现在想起来觉得应该是^M）导致路径拼接时出错，于是在$rootpath前面加了trim，然后就好了…我真是能作_(:зゝ∠)_</p>
<hr>
<h2 id="5-_总结">5. 总结</h2><ol>
<li>自己动手搭建LAMP环境还是一件挺有意思的事情，遇到问题自己去找答案自己解决，最后所有的服务全都正常运行时还是有一点点成就感的~</li>
<li>半年没碰PHP，一共就写了不到10行代码，还写错了一半，比如把<code>phpinfo()</code>写成<code>php_info</code>，忘了在<code>&lt;?</code>后面加php神马的…（我记得以前谁跟我说<code>&lt;?</code>后面可以不加php的啊）</li>
<li>一篇文章写了一晚上。好久没写过博文了，写这篇文章主要是把自己的经验记下来，如果这篇文章可以帮到谁的话，那当然更好~</li>
<li>Linux挺好玩的，比软件测试好玩多了！（果然到了最后还是要黑一把测试）</li>
</ol>
<hr>
<h2 id="6-_参考文档">6. 参考文档</h2><ol>
<li><a href="http://segmentfault.com/a/1190000000619342" target="_blank" rel="external">ubuntu下搭建LAMP</a></li>
<li><a href="http://php.net/manual/en/mcrypt.setup.php" target="_blank" rel="external">PHP Mcrypt Installing/Configuring</a></li>
<li><a href="http://www.douban.com/note/410696698/" target="_blank" rel="external">apache服务出现Forbidden 403问题的解决方法总结</a></li>
<li><a href="http://segmentfault.com/q/1010000000263069" target="_blank" rel="external">ERROR 1045 (28000): Access denied for user ‘root’@’localhost’ (using password: NO)</a></li>
</ol>
]]></content>
    <summary type="html">
    <![CDATA[<p>闲来无事，在虚拟机上搭了一个LAMP服务器环境，把安装及配置过程记了下来。</p>]]>
    
    </summary>
    
      <category term="Apache" scheme="//blog.stdioa.com/tags/Apache/"/>
    
      <category term="Linux" scheme="//blog.stdioa.com/tags/Linux/"/>
    
      <category term="MySQL" scheme="//blog.stdioa.com/tags/MySQL/"/>
    
      <category term="PHP" scheme="//blog.stdioa.com/tags/PHP/"/>
    
      <category term="网络" scheme="//blog.stdioa.com/categories/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
</feed>
